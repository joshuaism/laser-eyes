function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableRest()}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(u){i=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw o}}return n}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _createForOfIteratorHelper(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _construct(e,t,n){return(_construct=_isNativeReflectConstruct()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&_setPrototypeOf(i,n.prototype),i}).apply(null,arguments)}function _get(e,t,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=_superPropBase(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(e);if(t){var i=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{0:function(e,t,n){e.exports=n("zUnb")},1:function(e,t){},2:function(e,t){},3:function(e,t){},Iab2:function(e,t,n){var r,i;void 0===(i="function"==typeof(r=function(){"use strict";function t(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){o(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function n(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var i="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0,o=i.saveAs||("object"!=typeof window||window!==i?function(){}:"download"in HTMLAnchorElement.prototype?function(e,o,a){var s=i.URL||i.webkitURL,u=document.createElement("a");u.download=o=o||e.name||"download",u.rel="noopener","string"==typeof e?(u.href=e,u.origin===location.origin?r(u):n(u.href)?t(e,o,a):r(u,u.target="_blank")):(u.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(u.href)}),4e4),setTimeout((function(){r(u)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,i,o){if(i=i||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(function(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}(e,o),i);else if(n(e))t(e,i,o);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((function(){r(a)}))}}:function(e,n,r,o){if((o=o||open("","_blank"))&&(o.document.title=o.document.body.innerText="downloading..."),"string"==typeof e)return t(e,n,r);var a="application/octet-stream"===e.type,s=/constructor/i.test(i.HTMLElement)||i.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||a&&s)&&"object"==typeof FileReader){var c=new FileReader;c.onloadend=function(){var e=c.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=e:location=e,o=null},c.readAsDataURL(e)}else{var l=i.URL||i.webkitURL,h=l.createObjectURL(e);o?o.location=h:location.href=h,o=null,setTimeout((function(){l.revokeObjectURL(h)}),4e4)}});i.saveAs=o.saveAs=o,e.exports=o})?r.apply(t,[]):r)||(e.exports=i)},zUnb:function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t);var i=!1,o={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else i&&console.log("RxJS: Back to a better error behavior. Thank you. <3");i=e},get useDeprecatedSynchronousErrorHandling(){return i}};function a(e){setTimeout((function(){throw e}),0)}var s={closed:!0,next:function(e){},error:function(e){if(o.useDeprecatedSynchronousErrorHandling)throw e;a(e)},complete:function(){}},u=Array.isArray||function(e){return e&&"number"==typeof e.length};function c(e){return null!==e&&"object"==typeof e}var l,h=function(){function e(e){return Error.call(this),this.message=e?"".concat(e.length," errors occurred during unsubscription:\n").concat(e.map((function(e,t){return"".concat(t+1,") ").concat(e.toString())})).join("\n  ")):"",this.name="UnsubscriptionError",this.errors=e,this}return e.prototype=Object.create(Error.prototype),e}(),f=((l=function(){function e(t){_classCallCheck(this,e),this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}return _createClass(e,[{key:"unsubscribe",value:function(){var t;if(!this.closed){var n=this._parentOrParents,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(null!==n)for(var a=0;a<n.length;++a)n[a].remove(this);if(r(i))try{i.call(this)}catch(p){t=p instanceof h?d(p.errors):[p]}if(u(o))for(var s=-1,l=o.length;++s<l;){var f=o[s];if(c(f))try{f.unsubscribe()}catch(p){t=t||[],p instanceof h?t=t.concat(d(p.errors)):t.push(p)}}if(t)throw new h(t)}}},{key:"add",value:function(t){var n=t;if(!t)return e.EMPTY;switch(typeof t){case"function":n=new e(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof e)){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof e){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n}},{key:"remove",value:function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}}}]),e}()).EMPTY=function(e){return e.closed=!0,e}(new l),l);function d(e){return e.reduce((function(e,t){return e.concat(t instanceof h?t.errors:t)}),[])}var p="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),v=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;switch(_classCallCheck(this,n),(o=t.call(this)).syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=s;break;case 1:if(!e){o.destination=s;break}if("object"==typeof e){e instanceof n?(o.syncErrorThrowable=e.syncErrorThrowable,o.destination=e,e.add(_assertThisInitialized(o))):(o.syncErrorThrowable=!0,o.destination=new m(_assertThisInitialized(o),e));break}default:o.syncErrorThrowable=!0,o.destination=new m(_assertThisInitialized(o),e,r,i)}return o}return _createClass(n,[{key:p,value:function(){return this}},{key:"next",value:function(e){this.isStopped||this._next(e)}},{key:"error",value:function(e){this.isStopped||(this.isStopped=!0,this._error(e))}},{key:"complete",value:function(){this.isStopped||(this.isStopped=!0,this._complete())}},{key:"unsubscribe",value:function(){this.closed||(this.isStopped=!0,_get(_getPrototypeOf(n.prototype),"unsubscribe",this).call(this))}},{key:"_next",value:function(e){this.destination.next(e)}},{key:"_error",value:function(e){this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.destination.complete(),this.unsubscribe()}},{key:"_unsubscribeAndRecycle",value:function(){var e=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}],[{key:"create",value:function(e,t,r){var i=new n(e,t,r);return i.syncErrorThrowable=!1,i}}]),n}(f),m=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o,a){var u,c;_classCallCheck(this,n),(u=t.call(this))._parentSubscriber=e;var l=_assertThisInitialized(u);return r(i)?c=i:i&&(c=i.next,o=i.error,a=i.complete,i!==s&&(r((l=Object.create(i)).unsubscribe)&&u.add(l.unsubscribe.bind(l)),l.unsubscribe=u.unsubscribe.bind(_assertThisInitialized(u)))),u._context=l,u._next=c,u._error=o,u._complete=a,u}return _createClass(n,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;o.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber,n=o.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):a(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;a(e)}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};o.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),o.useDeprecatedSynchronousErrorHandling)throw n;a(n)}}},{key:"__tryOrSetError",value:function(e,t,n){if(!o.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return o.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(a(r),!0)}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),n}(v),g="function"==typeof Symbol&&Symbol.observable||"@@observable";function y(e){return e}function b(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return _(t)}function _(e){return 0===e.length?y:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var w,x=((w=function(){function e(t){_classCallCheck(this,e),this._isScalar=!1,t&&(this._subscribe=t)}return _createClass(e,[{key:"lift",value:function(t){var n=new e;return n.source=this,n.operator=t,n}},{key:"subscribe",value:function(e,t,n){var r=this.operator,i=function(e,t,n){if(e){if(e instanceof v)return e;if(e[p])return e[p]()}return e||t||n?new v(e,t,n):new v(s)}(e,t,n);if(i.add(r?r.call(i,this.source):this.source||o.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),o.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i}},{key:"_trySubscribe",value:function(e){try{return this._subscribe(e)}catch(t){o.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),function(e){for(;e;){var t=e,n=t.closed,r=t.destination,i=t.isStopped;if(n||i)return!1;e=r&&r instanceof v?r:null}return!0}(e)?e.error(t):console.warn(t)}}},{key:"forEach",value:function(e,t){var n=this;return new(t=k(t))((function(t,r){var i;i=n.subscribe((function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}}),r,t)}))}},{key:"_subscribe",value:function(e){var t=this.source;return t&&t.subscribe(e)}},{key:g,value:function(){return this}},{key:"pipe",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?this:_(t)(this)}},{key:"toPromise",value:function(e){var t=this;return new(e=k(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))}}]),e}()).create=function(e){return new w(e)},w);function k(e){if(e||(e=o.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var C,E=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),S=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this)).subject=e,i.subscriber=r,i.closed=!1,i}return _createClass(n,[{key:"unsubscribe",value:function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}}}]),n}(f),I=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e)).destination=e,r}return n}(v),R=((C=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;return _classCallCheck(this,n),(e=t.call(this)).observers=[],e.closed=!1,e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return _createClass(n,[{key:p,value:function(){return new I(this)}},{key:"lift",value:function(e){var t=new T(this,this);return t.operator=e,t}},{key:"next",value:function(e){if(this.closed)throw new E;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)}},{key:"error",value:function(e){if(this.closed)throw new E;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0}},{key:"complete",value:function(){if(this.closed)throw new E;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0}},{key:"unsubscribe",value:function(){this.isStopped=!0,this.closed=!0,this.observers=null}},{key:"_trySubscribe",value:function(e){if(this.closed)throw new E;return _get(_getPrototypeOf(n.prototype),"_trySubscribe",this).call(this,e)}},{key:"_subscribe",value:function(e){if(this.closed)throw new E;return this.hasError?(e.error(this.thrownError),f.EMPTY):this.isStopped?(e.complete(),f.EMPTY):(this.observers.push(e),new S(this,e))}},{key:"asObservable",value:function(){var e=new x;return e.source=this,e}}]),n}(x)).create=function(e,t){return new T(e,t)},C),T=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this)).destination=e,i.source=r,i}return _createClass(n,[{key:"next",value:function(e){var t=this.destination;t&&t.next&&t.next(e)}},{key:"error",value:function(e){var t=this.destination;t&&t.error&&this.destination.error(e)}},{key:"complete",value:function(){var e=this.destination;e&&e.complete&&this.destination.complete()}},{key:"_subscribe",value:function(e){return this.source?this.source.subscribe(e):f.EMPTY}}]),n}(R);function A(e){return e&&"function"==typeof e.schedule}var D=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this)).parent=e,o.outerValue=r,o.outerIndex=i,o.index=0,o}return _createClass(n,[{key:"_next",value:function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}},{key:"_error",value:function(e){this.parent.notifyError(e,this),this.unsubscribe()}},{key:"_complete",value:function(){this.parent.notifyComplete(this),this.unsubscribe()}}]),n}(v),N=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.complete()}};var O="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator",F=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function P(e){return!!e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}var M=function(e){if(e&&"function"==typeof e[g])return r=e,function(e){var t=r[g]();if("function"!=typeof t.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return t.subscribe(e)};if(F(e))return N(e);if(P(e))return n=e,function(e){return n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,a),e};if(e&&"function"==typeof e[O])return t=e,function(e){for(var n=t[O]();;){var r=n.next();if(r.done){e.complete();break}if(e.next(r.value),e.closed)break}return"function"==typeof n.return&&e.add((function(){n.return&&n.return()})),e};var t,n,r,i=c(e)?"an invalid object":"'".concat(e,"'");throw new TypeError("You provided ".concat(i," where a stream was expected. You can provide an Observable, Promise, Array, or Iterable."))};function L(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new D(e,n,r);if(!i.closed)return t instanceof x?t.subscribe(i):M(t)(i)}var B=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"notifyNext",value:function(e,t,n,r,i){this.destination.next(t)}},{key:"notifyError",value:function(e,t){this.destination.error(e)}},{key:"notifyComplete",value:function(e){this.destination.complete()}}]),n}(v);function U(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new W(e,t))}}var W=function(){function e(t,n){_classCallCheck(this,e),this.project=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new z(e,this.project,this.thisArg))}}]),e}(),z=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).project=r,o.count=0,o.thisArg=i||_assertThisInitialized(o),o}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(v);function V(e,t){return new x((function(n){var r=new f,i=0;return r.add(t.schedule((function(){i!==e.length?(n.next(e[i++]),n.closed||r.add(this.schedule())):n.complete()}))),r}))}function j(e,t){return t?function(e,t){if(null!=e){if(function(e){return e&&"function"==typeof e[g]}(e))return function(e,t){return new x((function(n){var r=new f;return r.add(t.schedule((function(){var i=e[g]();r.add(i.subscribe({next:function(e){r.add(t.schedule((function(){return n.next(e)})))},error:function(e){r.add(t.schedule((function(){return n.error(e)})))},complete:function(){r.add(t.schedule((function(){return n.complete()})))}}))}))),r}))}(e,t);if(P(e))return function(e,t){return new x((function(n){var r=new f;return r.add(t.schedule((function(){return e.then((function(e){r.add(t.schedule((function(){n.next(e),r.add(t.schedule((function(){return n.complete()})))})))}),(function(e){r.add(t.schedule((function(){return n.error(e)})))}))}))),r}))}(e,t);if(F(e))return V(e,t);if(function(e){return e&&"function"==typeof e[O]}(e)||"string"==typeof e)return function(e,t){if(!e)throw new Error("Iterable cannot be null");return new x((function(n){var r,i=new f;return i.add((function(){r&&"function"==typeof r.return&&r.return()})),i.add(t.schedule((function(){r=e[O](),i.add(t.schedule((function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(o){return void n.error(o)}t?n.complete():(n.next(e),this.schedule())}})))}))),i}))}(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}(e,t):e instanceof x?e:new x(M(e))}function H(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return"function"==typeof t?function(r){return r.pipe(H((function(n,r){return j(e(n,r)).pipe(U((function(e,i){return t(n,e,r,i)})))}),n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new q(e,n))})}var q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.POSITIVE_INFINITY;_classCallCheck(this,e),this.project=t,this.concurrent=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new G(e,this.project,this.concurrent))}}]),e}(),G=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.POSITIVE_INFINITY;return _classCallCheck(this,n),(i=t.call(this,e)).project=r,i.concurrent=o,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return _createClass(n,[{key:"_next",value:function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=new D(this,t,n),i=this.destination;i.add(r);var o=L(this,e,void 0,void 0,r);o!==r&&i.add(o)}},{key:"_complete",value:function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}},{key:"notifyNext",value:function(e,t,n,r,i){this.destination.next(t)}},{key:"notifyComplete",value:function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}]),n}(B);function K(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Number.POSITIVE_INFINITY;return H(y,e)}function X(e,t){return t?V(e,t):new x(N(e))}function Q(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=Number.POSITIVE_INFINITY,i=null,o=t[t.length-1];return A(o)?(i=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(r=t.pop())):"number"==typeof o&&(r=t.pop()),null===i&&1===t.length&&t[0]instanceof x?t[0]:K(r)(X(t,i))}function Y(){return function(e){return e.lift(new Z(e))}}var $,Z=function(){function e(t){_classCallCheck(this,e),this.connectable=t}return _createClass(e,[{key:"call",value:function(e,t){var n=this.connectable;n._refCount++;var r=new J(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i}}]),e}(),J=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).connectable=r,i}return _createClass(n,[{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null}}]),n}(v),ee={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:($=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this)).source=e,i.subjectFactory=r,i._refCount=0,i._isComplete=!1,i}return _createClass(n,[{key:"_subscribe",value:function(e){return this.getSubject().subscribe(e)}},{key:"getSubject",value:function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject}},{key:"connect",value:function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new f).add(this.source.subscribe(new te(this.getSubject(),this))),e.closed&&(this._connection=null,e=f.EMPTY)),e}},{key:"refCount",value:function(){return Y()(this)}}]),n}(x).prototype)._subscribe},_isComplete:{value:$._isComplete,writable:!0},getSubject:{value:$.getSubject},connect:{value:$.connect},refCount:{value:$.refCount}},te=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).connectable=r,i}return _createClass(n,[{key:"_error",value:function(e){this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_error",this).call(this,e)}},{key:"_complete",value:function(){this.connectable._isComplete=!0,this._unsubscribe(),_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"_unsubscribe",value:function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}}}]),n}(I);function ne(e,t){return function(n){var r;if(r="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new re(r,t));var i=Object.create(n,ee);return i.source=n,i.subjectFactory=r,i}}var re=function(){function e(t,n){_classCallCheck(this,e),this.subjectFactory=t,this.selector=n}return _createClass(e,[{key:"call",value:function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i}}]),e}();function ie(){return new R}function oe(e){return{toString:e}.toString()}function ae(e,t,n){return oe((function(){var r=function(e){return function(){if(e){var t=e.apply(void 0,arguments);for(var n in t)this[n]=t[n]}}}(t);function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(this instanceof i)return r.apply(this,t),this;var o=_construct(i,t);return a.annotation=o,a;function a(e,t,n){for(var r=e.hasOwnProperty("__parameters__")?e.__parameters__:Object.defineProperty(e,"__parameters__",{value:[]}).__parameters__;r.length<=n;)r.push(null);return(r[n]=r[n]||[]).push(o),e}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=e,i.annotationCls=i,i}))}var se=ae("Inject",(function(e){return{token:e}})),ue=ae("Optional"),ce=ae("Self"),le=ae("SkipSelf"),he=function(e){return e[e.Default=0]="Default",e[e.Host=1]="Host",e[e.Self=2]="Self",e[e.SkipSelf=4]="SkipSelf",e[e.Optional=8]="Optional",e}({});function fe(e){for(var t in e)if(e[t]===fe)return t;throw Error("Could not find renamed property on target object.")}function de(e,t){for(var n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&(e[n]=t[n])}function pe(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function ve(e){return{factory:e.factory,providers:e.providers||[],imports:e.imports||[]}}function me(e){return ge(e,e[be])||ge(e,e[xe])}function ge(e,t){return t&&t.token===e?t:null}function ye(e){return e&&(e.hasOwnProperty(_e)||e.hasOwnProperty(ke))?e[_e]:null}var be=fe({"\u0275prov":fe}),_e=fe({"\u0275inj":fe}),we=fe({"\u0275provFallback":fe}),xe=fe({ngInjectableDef:fe}),ke=fe({ngInjectorDef:fe});function Ce(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(Ce).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return""+e.overriddenName;if(e.name)return""+e.name;var t=e.toString();if(null==t)return""+t;var n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Ee(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}var Se=fe({__forward_ref__:fe});function Ie(e){return e.__forward_ref__=Ie,e.toString=function(){return Ce(this())},e}function Re(e){return Te(e)?e():e}function Te(e){return"function"==typeof e&&e.hasOwnProperty(Se)&&e.__forward_ref__===Ie}var Ae,De="undefined"!=typeof globalThis&&globalThis,Ne="undefined"!=typeof window&&window,Oe="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Fe="undefined"!=typeof global&&global,Pe=De||Fe||Ne||Oe,Me=fe({"\u0275cmp":fe}),Le=fe({"\u0275dir":fe}),Be=fe({"\u0275pipe":fe}),Ue=fe({"\u0275mod":fe}),We=fe({"\u0275loc":fe}),ze=fe({"\u0275fac":fe}),Ve=fe({__NG_ELEMENT_ID__:fe}),je=function(){function e(t,n){_classCallCheck(this,e),this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=pe({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}return _createClass(e,[{key:"toString",value:function(){return"InjectionToken "+this._desc}}]),e}(),He=new je("INJECTOR",-1),qe={},Ge=/\n/gm,Ke=fe({provide:String,useValue:fe}),Xe=void 0;function Qe(e){var t=Xe;return Xe=e,t}function Ye(e){var t=Ae;return Ae=e,t}function $e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.Default;if(void 0===Xe)throw new Error("inject() must be called from an injection context");return null===Xe?et(e,void 0,t):Xe.get(e,t&he.Optional?null:void 0,t)}function Ze(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.Default;return(Ae||$e)(Re(e),t)}var Je=Ze;function et(e,t,n){var r=me(e);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&he.Optional)return null;if(void 0!==t)return t;throw new Error("Injector: NOT_FOUND [".concat(Ce(e),"]"))}function tt(e){for(var t=[],n=0;n<e.length;n++){var r=Re(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");for(var i=void 0,o=he.Default,a=0;a<r.length;a++){var s=r[a];s instanceof ue||"Optional"===s.ngMetadataName||s===ue?o|=he.Optional:s instanceof le||"SkipSelf"===s.ngMetadataName||s===le?o|=he.SkipSelf:s instanceof ce||"Self"===s.ngMetadataName||s===ce?o|=he.Self:i=s instanceof se||s===se?s.token:s}t.push(Ze(i,o))}else t.push(Ze(r))}return t}var nt=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qe;if(t===qe){var n=new Error("NullInjectorError: No provider for ".concat(Ce(e),"!"));throw n.name="NullInjectorError",n}return t}}]),e}(),rt=function e(){_classCallCheck(this,e)},it=function e(){_classCallCheck(this,e)};function ot(e,t){e.forEach((function(e){return Array.isArray(e)?ot(e,t):t(e)}))}function at(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function st(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}function ut(e,t){for(var n=[],r=0;r<e;r++)n.push(t);return n}function ct(e,t){var n=lt(e,t);if(n>=0)return e[1|n]}function lt(e,t){return function(e,t,n){for(var r=0,i=e.length>>1;i!==r;){var o=r+(i-r>>1),a=e[o<<1];if(t===a)return o<<1;a>t?i=o:r=o+1}return~(i<<1)}(e,t)}var ht=function(){var e={OnPush:0,Default:1};return e[e.OnPush]="OnPush",e[e.Default]="Default",e}(),ft=function(){var e={Emulated:0,Native:1,None:2,ShadowDom:3};return e[e.Emulated]="Emulated",e[e.Native]="Native",e[e.None]="None",e[e.ShadowDom]="ShadowDom",e}(),dt={},pt=[],vt=0;function mt(e){return oe((function(){var t=e.type,n=t.prototype,r={},i={type:t,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onChanges:null,onInit:n.ngOnInit||null,doCheck:n.ngDoCheck||null,afterContentInit:n.ngAfterContentInit||null,afterContentChecked:n.ngAfterContentChecked||null,afterViewInit:n.ngAfterViewInit||null,afterViewChecked:n.ngAfterViewChecked||null,onDestroy:n.ngOnDestroy||null,onPush:e.changeDetection===ht.OnPush,directiveDefs:null,pipeDefs:null,selectors:e.selectors||pt,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||ft.Emulated,id:"c",styles:e.styles||pt,_:null,setInput:null,schemas:e.schemas||null,tView:null},o=e.directives,a=e.features,s=e.pipes;return i.id+=vt++,i.inputs=wt(e.inputs,r),i.outputs=wt(e.outputs),a&&a.forEach((function(e){return e(i)})),i.directiveDefs=o?function(){return("function"==typeof o?o():o).map(gt)}:null,i.pipeDefs=s?function(){return("function"==typeof s?s():s).map(yt)}:null,i}))}function gt(e){return kt(e)||function(e){return e[Le]||null}(e)}function yt(e){return function(e){return e[Be]||null}(e)}var bt={};function _t(e){var t={type:e.type,bootstrap:e.bootstrap||pt,declarations:e.declarations||pt,imports:e.imports||pt,exports:e.exports||pt,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null};return null!=e.id&&oe((function(){bt[e.id]=e.type})),t}function wt(e,t){if(null==e)return dt;var n={};for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),n[i]=r,t&&(t[i]=o)}return n}var xt=mt;function kt(e){return e[Me]||null}function Ct(e,t){return e.hasOwnProperty(ze)?e[ze]:null}function Et(e,t){var n=e[Ue]||null;if(!n&&!0===t)throw new Error("Type ".concat(Ce(e)," does not have '\u0275mod' property."));return n}function St(e){return Array.isArray(e)&&"object"==typeof e[1]}function It(e){return Array.isArray(e)&&!0===e[1]}function Rt(e){return 0!=(8&e.flags)}function Tt(e){return 2==(2&e.flags)}function At(e){return 1==(1&e.flags)}function Dt(e){return null!==e.template}function Nt(e){return 0!=(512&e[2])}var Ot=void 0;function Ft(e){return!!e.listen}var Pt={createRenderer:function(e,t){return void 0!==Ot?Ot:"undefined"!=typeof document?document:void 0}};function Mt(e){for(;Array.isArray(e);)e=e[0];return e}function Lt(e,t){return Mt(t[e+20])}function Bt(e,t){return Mt(t[e.index])}function Ut(e,t){return e.data[t+20]}function Wt(e,t){var n=t[e];return St(n)?n:n[0]}function zt(e){var t=function(e){return e.__ngContext__||null}(e);return t?Array.isArray(t)?t:t.lView:null}function Vt(e){return 4==(4&e[2])}function jt(e){return 128==(128&e[2])}function Ht(e,t){return null===e||null==t?null:e[t]}function qt(e){e[18]=0}function Gt(e,t){e[5]+=t;for(var n=e,r=e[3];null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}var Kt={lFrame:dn(null),bindingsEnabled:!0,checkNoChangesMode:!1};function Xt(){return Kt.bindingsEnabled}function Qt(){return Kt.lFrame.lView}function Yt(){return Kt.lFrame.tView}function $t(e){Kt.lFrame.contextLView=e}function Zt(){return Kt.lFrame.previousOrParentTNode}function Jt(e,t){Kt.lFrame.previousOrParentTNode=e,Kt.lFrame.isParent=t}function en(){return Kt.lFrame.isParent}function tn(){Kt.lFrame.isParent=!1}function nn(){return Kt.checkNoChangesMode}function rn(e){Kt.checkNoChangesMode=e}function on(){return Kt.lFrame.bindingIndex++}function an(e,t){var n=Kt.lFrame;n.bindingIndex=n.bindingRootIndex=e,sn(t)}function sn(e){Kt.lFrame.currentDirectiveIndex=e}function un(){return Kt.lFrame.currentQueryIndex}function cn(e){Kt.lFrame.currentQueryIndex=e}function ln(e,t){var n=fn();Kt.lFrame=n,n.previousOrParentTNode=t,n.lView=e}function hn(e,t){var n=fn(),r=e[1];Kt.lFrame=n,n.previousOrParentTNode=t,n.lView=e,n.tView=r,n.contextLView=e,n.bindingIndex=r.bindingStartIndex}function fn(){var e=Kt.lFrame,t=null===e?null:e.child;return null===t?dn(e):t}function dn(e){var t={previousOrParentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:0,contextLView:null,elementDepthCount:0,currentNamespace:null,currentSanitizer:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null};return null!==e&&(e.child=t),t}function pn(){var e=Kt.lFrame;return Kt.lFrame=e.parent,e.previousOrParentTNode=null,e.lView=null,e}var vn=pn;function mn(){var e=pn();e.isParent=!0,e.tView=null,e.selectedIndex=0,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.currentSanitizer=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function gn(){return Kt.lFrame.selectedIndex}function yn(e){Kt.lFrame.selectedIndex=e}function bn(){var e=Kt.lFrame;return Ut(e.tView,e.selectedIndex)}function _n(e,t){for(var n=t.directiveStart,r=t.directiveEnd;n<r;n++){var i=e.data[n];i.afterContentInit&&(e.contentHooks||(e.contentHooks=[])).push(-n,i.afterContentInit),i.afterContentChecked&&((e.contentHooks||(e.contentHooks=[])).push(n,i.afterContentChecked),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,i.afterContentChecked)),i.afterViewInit&&(e.viewHooks||(e.viewHooks=[])).push(-n,i.afterViewInit),i.afterViewChecked&&((e.viewHooks||(e.viewHooks=[])).push(n,i.afterViewChecked),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,i.afterViewChecked)),null!=i.onDestroy&&(e.destroyHooks||(e.destroyHooks=[])).push(n,i.onDestroy)}}function wn(e,t,n){Cn(e,t,3,n)}function xn(e,t,n,r){(3&e[2])===n&&Cn(e,t,n,r)}function kn(e,t){var n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Cn(e,t,n,r){for(var i=null!=r?r:-1,o=0,a=void 0!==r?65535&e[18]:0;a<t.length;a++)if("number"==typeof t[a+1]){if(o=t[a],null!=r&&o>=r)break}else t[a]<0&&(e[18]+=65536),(o<i||-1==i)&&(En(e,n,t,a),e[18]=(4294901760&e[18])+a+2),a++}function En(e,t,n,r){var i=n[r]<0,o=n[r+1],a=e[i?-n[r]:n[r]];i?e[2]>>11<e[18]>>16&&(3&e[2])===t&&(e[2]+=2048,o.call(a)):o.call(a)}var Sn=function e(t,n,r){_classCallCheck(this,e),this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r};function In(e,t,n){for(var r=Ft(e),i=0;i<n.length;){var o=n[i];if("number"==typeof o){if(0!==o)break;i++;var a=n[i++],s=n[i++],u=n[i++];r?e.setAttribute(t,s,u,a):t.setAttributeNS(a,s,u)}else{var c=o,l=n[++i];Tn(c)?r&&e.setProperty(t,c,l):r?e.setAttribute(t,c,l):t.setAttribute(c,l),i++}}return i}function Rn(e){return 3===e||4===e||6===e}function Tn(e){return 64===e.charCodeAt(0)}function An(e,t){if(null===t||0===t.length);else if(null===e||0===e.length)e=t.slice();else for(var n=-1,r=0;r<t.length;r++){var i=t[r];"number"==typeof i?n=i:0===n||Dn(e,n,i,null,-1===n||2===n?t[++r]:null)}return e}function Dn(e,t,n,r,i){var o=0,a=e.length;if(-1===t)a=-1;else for(;o<e.length;){var s=e[o++];if("number"==typeof s){if(s===t){a=-1;break}if(s>t){a=o-1;break}}}for(;o<e.length;){var u=e[o];if("number"==typeof u)break;if(u===n){if(null===r)return void(null!==i&&(e[o+1]=i));if(r===e[o+1])return void(e[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==a&&(e.splice(a,0,t),o=a+1),e.splice(o++,0,n),null!==r&&e.splice(o++,0,r),null!==i&&e.splice(o++,0,i)}function Nn(e){return-1!==e}function On(e){return 32767&e}function Fn(e){return e>>16}function Pn(e,t){for(var n=Fn(e),r=t;n>0;)r=r[15],n--;return r}function Mn(e){return"string"==typeof e?e:null==e?"":""+e}function Ln(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():Mn(e)}var Bn=("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Pe);function Un(e){return e instanceof Function?e():e}var Wn=!0;function zn(e){var t=Wn;return Wn=e,t}var Vn=0;function jn(e,t){var n=qn(e,t);if(-1!==n)return n;var r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Hn(r.data,e),Hn(t,null),Hn(r.blueprint,null));var i=Gn(e,t),o=e.injectorIndex;if(Nn(i))for(var a=On(i),s=Pn(i,t),u=s[1].data,c=0;c<8;c++)t[o+c]=s[a+c]|u[a+c];return t[o+8]=i,o}function Hn(e,t){e.push(0,0,0,0,0,0,0,0,t)}function qn(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null==t[e.injectorIndex+8]?-1:e.injectorIndex}function Gn(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;for(var n=t[6],r=1;n&&-1===n.injectorIndex;)n=(t=t[15])?t[6]:null,r++;return n?n.injectorIndex|r<<16:-1}function Kn(e,t,n){!function(e,t,n){var r="string"!=typeof n?n[Ve]:n.charCodeAt(0)||0;null==r&&(r=n[Ve]=Vn++);var i=255&r,o=1<<i,a=64&i,s=32&i,u=t.data;128&i?a?s?u[e+7]|=o:u[e+6]|=o:s?u[e+5]|=o:u[e+4]|=o:a?s?u[e+3]|=o:u[e+2]|=o:s?u[e+1]|=o:u[e]|=o}(e,t,n)}function Xn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:he.Default,i=arguments.length>4?arguments[4]:void 0;if(null!==e){var o=function(e){if("string"==typeof e)return e.charCodeAt(0)||0;var t=e[Ve];return"number"==typeof t&&t>0?255&t:t}(n);if("function"==typeof o){ln(t,e);try{var a=o();if(null!=a||r&he.Optional)return a;throw new Error("No provider for ".concat(Ln(n),"!"))}finally{vn()}}else if("number"==typeof o){if(-1===o)return new tr(e,t);var s=null,u=qn(e,t),c=-1,l=r&he.Host?t[16][6]:null;for((-1===u||r&he.SkipSelf)&&(c=-1===u?Gn(e,t):t[u+8],er(r,!1)?(s=t[1],u=On(c),t=Pn(c,t)):u=-1);-1!==u;){c=t[u+8];var h=t[1];if(Jn(o,u,h.data)){var f=Yn(u,t,n,s,r,l);if(f!==Qn)return f}er(r,t[1].data[u+8]===l)&&Jn(o,u,t)?(s=h,u=On(c),t=Pn(c,t)):u=-1}}}if(r&he.Optional&&void 0===i&&(i=null),0==(r&(he.Self|he.Host))){var d=t[9],p=Ye(void 0);try{return d?d.get(n,i,r&he.Optional):et(n,i,r&he.Optional)}finally{Ye(p)}}if(r&he.Optional)return i;throw new Error("NodeInjector: NOT_FOUND [".concat(Ln(n),"]"))}var Qn={};function Yn(e,t,n,r,i,o){var a=t[1],s=a.data[e+8],u=$n(s,a,n,null==r?Tt(s)&&Wn:r!=a&&3===s.type,i&he.Host&&o===s);return null!==u?Zn(t,a,u,s):Qn}function $n(e,t,n,r,i){for(var o=e.providerIndexes,a=t.data,s=65535&o,u=e.directiveStart,c=o>>16,l=i?s+c:e.directiveEnd,h=r?s:s+c;h<l;h++){var f=a[h];if(h<u&&n===f||h>=u&&f.type===n)return h}if(i){var d=a[u];if(d&&Dt(d)&&d.type===n)return u}return null}function Zn(e,t,n,r){var i=e[n],o=t.data;if(i instanceof Sn){var a=i;if(a.resolving)throw new Error("Circular dep for "+Ln(o[n]));var s,u=zn(a.canSeeViewProviders);a.resolving=!0,a.injectImpl&&(s=Ye(a.injectImpl)),ln(e,r);try{i=e[n]=a.factory(void 0,o,e,r),t.firstCreatePass&&n>=r.directiveStart&&function(e,t,n){var r=t.onChanges,i=t.onInit,o=t.doCheck;r&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,r)),i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(-e,i),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,o))}(n,o[n],t)}finally{a.injectImpl&&Ye(s),zn(u),a.resolving=!1,vn()}}return i}function Jn(e,t,n){var r=64&e,i=32&e;return!!((128&e?r?i?n[t+7]:n[t+6]:i?n[t+5]:n[t+4]:r?i?n[t+3]:n[t+2]:i?n[t+1]:n[t])&1<<e)}function er(e,t){return!(e&he.Self||e&he.Host&&t)}var tr=function(){function e(t,n){_classCallCheck(this,e),this._tNode=t,this._lView=n}return _createClass(e,[{key:"get",value:function(e,t){return Xn(this._tNode,this._lView,e,void 0,t)}}]),e}();function nr(e){return e.ngDebugContext}function rr(e){return e.ngOriginalError}function ir(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.error.apply(e,n)}var or=function(){function e(){_classCallCheck(this,e),this._console=console}return _createClass(e,[{key:"handleError",value:function(e){var t=this._findOriginalError(e),n=this._findContext(e),r=function(e){return e.ngErrorLogger||ir}(e);r(this._console,"ERROR",e),t&&r(this._console,"ORIGINAL ERROR",t),n&&r(this._console,"ERROR CONTEXT",n)}},{key:"_findContext",value:function(e){return e?nr(e)?nr(e):this._findContext(rr(e)):null}},{key:"_findOriginalError",value:function(e){for(var t=rr(e);t&&rr(t);)t=rr(t);return t}}]),e}(),ar=function(){function e(t){_classCallCheck(this,e),this.changingThisBreaksApplicationSecurity=t}return _createClass(e,[{key:"toString",value:function(){return"SafeValue must use [property]=binding: "+this.changingThisBreaksApplicationSecurity+" (see http://g.co/ng/security#xss)"}}]),e}();function sr(e){return e instanceof ar?e.changingThisBreaksApplicationSecurity:e}var ur=!0,cr=!1;function lr(){return cr=!0,ur}var hr=/^(?:(?:https?|mailto|ftp|tel|file):|[^&:/?#]*(?:[/?#]|$))/gi,fr=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i,dr=function(){var e={NONE:0,HTML:1,STYLE:2,SCRIPT:3,URL:4,RESOURCE_URL:5};return e[e.NONE]="NONE",e[e.HTML]="HTML",e[e.STYLE]="STYLE",e[e.SCRIPT]="SCRIPT",e[e.URL]="URL",e[e.RESOURCE_URL]="RESOURCE_URL",e}();function pr(e){var t,n,r=(t=Qt())&&t[12];return r?r.sanitize(dr.URL,e)||"":function(e,t){var n=function(e){return e instanceof ar&&e.getTypeName()||null}(e);if(null!=n&&"URL"!==n){if("ResourceURL"===n)return!0;throw new Error("Required a safe ".concat("URL",", got a ").concat(n," (see http://g.co/ng/security#xss)"))}return"URL"===n}(e)?sr(e):(n=Mn(e),(n=String(n)).match(hr)||n.match(fr)?n:(lr()&&console.warn("WARNING: sanitizing unsafe URL value ".concat(n," (see http://g.co/ng/security#xss)")),"unsafe:"+n))}function vr(e,t){e.__ngContext__=t}function mr(e){throw new Error("Multiple components match node with tagname "+e.tagName)}function gr(){throw new Error("Cannot mix multi providers and regular providers")}function yr(e,t,n){for(var r=e.length;;){var i=e.indexOf(t,n);if(-1===i)return i;if(0===i||e.charCodeAt(i-1)<=32){var o=t.length;if(i+o===r||e.charCodeAt(i+o)<=32)return i}n=i+1}}function br(e,t,n){for(var r=0;r<e.length;){var i=e[r++];if(n&&"class"===i){if(-1!==yr((i=e[r]).toLowerCase(),t,0))return!0}else if(1===i){for(;r<e.length&&"string"==typeof(i=e[r++]);)if(i.toLowerCase()===t)return!0;return!1}}return!1}function _r(e){return 0===e.type&&"ng-template"!==e.tagName}function wr(e,t,n){return t===(0!==e.type||n?e.tagName:"ng-template")}function xr(e,t,n){for(var r=4,i=e.attrs||[],o=function(e){for(var t=0;t<e.length;t++)if(Rn(e[t]))return t;return e.length}(i),a=!1,s=0;s<t.length;s++){var u=t[s];if("number"!=typeof u){if(!a)if(4&r){if(r=2|1&r,""!==u&&!wr(e,u,n)||""===u&&1===t.length){if(kr(r))return!1;a=!0}}else{var c=8&r?u:t[++s];if(8&r&&null!==e.attrs){if(!br(e.attrs,c,n)){if(kr(r))return!1;a=!0}continue}var l=Cr(8&r?"class":u,i,_r(e),n);if(-1===l){if(kr(r))return!1;a=!0;continue}if(""!==c){var h;h=l>o?"":i[l+1].toLowerCase();var f=8&r?h:null;if(f&&-1!==yr(f,c,0)||2&r&&c!==h){if(kr(r))return!1;a=!0}}}}else{if(!a&&!kr(r)&&!kr(u))return!1;if(a&&kr(u))continue;a=!1,r=u|1&r}}return kr(r)||a}function kr(e){return 0==(1&e)}function Cr(e,t,n,r){if(null===t)return-1;var i=0;if(r||!n){for(var o=!1;i<t.length;){var a=t[i];if(a===e)return i;if(3===a||6===a)o=!0;else{if(1===a||2===a){for(var s=t[++i];"string"==typeof s;)s=t[++i];continue}if(4===a)break;if(0===a){i+=4;continue}}i+=o?1:2}return-1}return function(e,t){var n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){var r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Er(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=0;r<t.length;r++)if(xr(e,t[r],n))return!0;return!1}function Sr(e,t){return e?":not("+t.trim()+")":t}function Ir(e){for(var t=e[0],n=1,r=2,i="",o=!1;n<e.length;){var a=e[n];if("string"==typeof a)if(2&r){var s=e[++n];i+="["+a+(s.length>0?'="'+s+'"':"")+"]"}else 8&r?i+="."+a:4&r&&(i+=" "+a);else""===i||kr(a)||(t+=Sr(o,i),i=""),r=a,o=o||!kr(r);n++}return""!==i&&(t+=Sr(o,i)),t}var Rr={};function Tr(e){var t=e[3];return It(t)?t[3]:t}function Ar(e){return Nr(e[13])}function Dr(e){return Nr(e[4])}function Nr(e){for(;null!==e&&!It(e);)e=e[4];return e}function Or(e){Fr(Yt(),Qt(),gn()+e,nn())}function Fr(e,t,n,r){if(!r)if(3==(3&t[2])){var i=e.preOrderCheckHooks;null!==i&&wn(t,i,n)}else{var o=e.preOrderHooks;null!==o&&xn(t,o,0,n)}yn(n)}function Pr(e,t){return e<<17|t<<2}function Mr(e){return e>>17&32767}function Lr(e){return 2|e}function Br(e){return(131068&e)>>2}function Ur(e,t){return-131069&e|t<<2}function Wr(e){return 1|e}function zr(e,t){var n=e.contentQueries;if(null!==n)for(var r=0;r<n.length;r+=2){var i=n[r],o=n[r+1];if(-1!==o){var a=e.data[o];cn(i),a.contentQueries(2,t[o],o)}}}function Vr(e,t,n){return Ft(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function jr(e,t,n,r,i,o,a,s,u,c){var l=t.blueprint.slice();return l[0]=i,l[2]=140|r,qt(l),l[3]=l[15]=e,l[8]=n,l[10]=a||e&&e[10],l[11]=s||e&&e[11],l[12]=u||e&&e[12]||null,l[9]=c||e&&e[9]||null,l[6]=o,l[16]=2==t.type?e[16]:l,l}function Hr(e,t,n,r,i,o){var a=n+20,s=e.data[a]||function(e,t,n,r,i,o){var a=Zt(),s=en(),u=s?a:a&&a.parent,c=e.data[n]=Jr(0,u&&u!==t?u:null,r,n,i,o);return null===e.firstChild&&(e.firstChild=c),a&&(!s||null!=a.child||null===c.parent&&2!==a.type?s||(a.next=c):a.child=c),c}(e,t,a,r,i,o);return Jt(s,!0),s}function qr(e,t,n){hn(t,t[6]);try{var r=e.viewQuery;null!==r&&wi(1,r,n);var i=e.template;null!==i&&Xr(e,t,i,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&zr(e,t),e.staticViewQueries&&wi(2,e.viewQuery,n);var o=e.components;null!==o&&function(e,t){for(var n=0;n<t.length;n++)mi(e,t[n])}(t,o)}catch(a){throw e.firstCreatePass&&(e.incompleteFirstPass=!0),a}finally{t[2]&=-5,mn()}}function Gr(e,t,n,r){var i=t[2];if(256!=(256&i)){hn(t,t[6]);var o=nn();try{qt(t),Kt.lFrame.bindingIndex=e.bindingStartIndex,null!==n&&Xr(e,t,n,2,r);var a=3==(3&i);if(!o)if(a){var s=e.preOrderCheckHooks;null!==s&&wn(t,s,null)}else{var u=e.preOrderHooks;null!==u&&xn(t,u,0,null),kn(t,0)}if(function(e){for(var t=Ar(e);null!==t;t=Dr(t))if(t[2])for(var n=t[9],r=0;r<n.length;r++){var i=n[r],o=i[3];0==(1024&i[2])&&Gt(o,1),i[2]|=1024}}(t),function(e){for(var t=Ar(e);null!==t;t=Dr(t))for(var n=10;n<t.length;n++){var r=t[n],i=r[1];jt(r)&&Gr(i,r,i.template,r[8])}}(t),null!==e.contentQueries&&zr(e,t),!o)if(a){var c=e.contentCheckHooks;null!==c&&wn(t,c)}else{var l=e.contentHooks;null!==l&&xn(t,l,1),kn(t,1)}!function(e,t){try{var n=e.expandoInstructions;if(null!==n)for(var r=e.expandoStartIndex,i=-1,o=0;o<n.length;o++){var a=n[o];"number"==typeof a?a<=0?(yn(0-a),i=r+=9+n[++o]):r+=a:(null!==a&&(an(r,i),a(2,t[i])),i++)}}finally{yn(-1)}}(e,t);var h=e.components;null!==h&&function(e,t){for(var n=0;n<t.length;n++)vi(e,t[n])}(t,h);var f=e.viewQuery;if(null!==f&&wi(2,f,r),!o)if(a){var d=e.viewCheckHooks;null!==d&&wn(t,d)}else{var p=e.viewHooks;null!==p&&xn(t,p,2),kn(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),o||(t[2]&=-73),1024&t[2]&&(t[2]&=-1025,Gt(t[3],-1))}finally{mn()}}}function Kr(e,t,n,r){var i=t[10],o=!nn(),a=Vt(t);try{o&&!a&&i.begin&&i.begin(),a&&qr(e,t,r),Gr(e,t,n,r)}finally{o&&!a&&i.end&&i.end()}}function Xr(e,t,n,r,i){var o=gn();try{yn(-1),2&r&&t.length>20&&Fr(e,t,0,nn()),n(r,i)}finally{yn(o)}}function Qr(e,t,n){Xt()&&(function(e,t,n,r){var i=n.directiveStart,o=n.directiveEnd;e.firstCreatePass||jn(n,t),vr(r,t);for(var a=n.initialInputs,s=i;s<o;s++){var u=e.data[s],c=Dt(u);c&&hi(t,n,u);var l=Zn(t,e,s,n);vr(l,t),null!==a&&fi(0,s-i,l,u,0,a),c&&(Wt(n.index,t)[8]=l)}}(e,t,n,Bt(n,t)),128==(128&n.flags)&&function(e,t,n){var r=n.directiveStart,i=n.directiveEnd,o=e.expandoInstructions,a=e.firstCreatePass,s=n.index-20,u=Kt.lFrame.currentDirectiveIndex;try{yn(s);for(var c=r;c<i;c++){var l=e.data[c],h=t[c];sn(c),null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs?oi(l,h):a&&o.push(null)}}finally{yn(-1),sn(u)}}(e,t,n))}function Yr(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bt,r=t.localNames;if(null!==r)for(var i=t.index+1,o=0;o<r.length;o+=2){var a=r[o+1],s=-1===a?n(t,e):e[a];e[i++]=s}}function $r(e){var t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Zr(1,-1,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Zr(e,t,n,r,i,o,a,s,u,c){var l=20+r,h=l+i,f=function(e,t){for(var n=[],r=0;r<t;r++)n.push(r<e?null:Rr);return n}(l,h);return f[1]={type:e,id:t,blueprint:f,template:n,queries:null,viewQuery:s,node:null,data:f.slice().fill(null,l),bindingStartIndex:l,expandoStartIndex:h,expandoInstructions:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof a?a():a,firstChild:null,schemas:u,consts:c,incompleteFirstPass:!1}}function Jr(e,t,n,r,i,o){return{type:n,index:r,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,tagName:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function ei(e,t,n){for(var r in e)if(e.hasOwnProperty(r)){var i=e[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(t,i):n[r]=[t,i]}return n}function ti(e,t,n,r,i,o,a,s){var u,c,l=Bt(t,n),h=t.inputs;!s&&null!=h&&(u=h[r])?(Si(e,n,u,r,i),Tt(t)&&function(e,t){var n=Wt(t,e);16&n[2]||(n[2]|=64)}(n,t.index)):3===t.type&&(r="class"===(c=r)?"className":"for"===c?"htmlFor":"formaction"===c?"formAction":"innerHtml"===c?"innerHTML":"readonly"===c?"readOnly":"tabindex"===c?"tabIndex":c,i=null!=a?a(i,t.tagName||"",r):i,Ft(o)?o.setProperty(l,r,i):Tn(r)||(l.setProperty?l.setProperty(r,i):l[r]=i))}function ni(e,t,n,r){var i=!1;if(Xt()){var o=function(e,t,n){var r=e.directiveRegistry,i=null;if(r)for(var o=0;o<r.length;o++){var a=r[o];Er(n,a.selectors,!1)&&(i||(i=[]),Kn(jn(n,t),e,a.type),Dt(a)?(2&n.flags&&mr(n),si(e,n),i.unshift(a)):i.push(a))}return i}(e,t,n),a=null===r?null:{"":-1};if(null!==o){var s=0;i=!0,ci(n,e.data.length,o.length);for(var u=0;u<o.length;u++){var c=o[u];c.providersResolver&&c.providersResolver(c)}ai(e,n,o.length);for(var l=!1,h=!1,f=0;f<o.length;f++){var d=o[f];n.mergedAttrs=An(n.mergedAttrs,d.hostAttrs),li(e,t,d),ui(e.data.length-1,d,a),null!==d.contentQueries&&(n.flags|=8),null===d.hostBindings&&null===d.hostAttrs&&0===d.hostVars||(n.flags|=128),!l&&(d.onChanges||d.onInit||d.doCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index-20),l=!0),h||!d.onChanges&&!d.doCheck||((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index-20),h=!0),ri(e,d),s+=d.hostVars}!function(e,t){for(var n=t.directiveEnd,r=e.data,i=t.attrs,o=[],a=null,s=null,u=t.directiveStart;u<n;u++){var c=r[u],l=c.inputs,h=null===i||_r(t)?null:di(l,i);o.push(h),a=ei(l,u,a),s=ei(c.outputs,u,s)}null!==a&&(a.hasOwnProperty("class")&&(t.flags|=16),a.hasOwnProperty("style")&&(t.flags|=32)),t.initialInputs=o,t.inputs=a,t.outputs=s}(e,n),ii(e,t,s)}a&&function(e,t,n){if(t)for(var r=e.localNames=[],i=0;i<t.length;i+=2){var o=n[t[i+1]];if(null==o)throw new Error("Export of name '".concat(t[i+1],"' not found!"));r.push(t[i],o)}}(n,r,a)}return n.mergedAttrs=An(n.mergedAttrs,n.attrs),i}function ri(e,t){var n=e.expandoInstructions;n.push(t.hostBindings),0!==t.hostVars&&n.push(t.hostVars)}function ii(e,t,n){for(var r=0;r<n;r++)t.push(Rr),e.blueprint.push(Rr),e.data.push(null)}function oi(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function ai(e,t,n){var r=20-t.index,i=e.data.length-(65535&t.providerIndexes);(e.expandoInstructions||(e.expandoInstructions=[])).push(r,i,n)}function si(e,t){t.flags|=2,(e.components||(e.components=[])).push(t.index)}function ui(e,t,n){if(n){if(t.exportAs)for(var r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Dt(t)&&(n[""]=e)}}function ci(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}function li(e,t,n){e.data.push(n);var r=n.factory||(n.factory=Ct(n.type)),i=new Sn(r,Dt(n),null);e.blueprint.push(i),t.push(i)}function hi(e,t,n){var r=Bt(t,e),i=$r(n),o=e[10],a=gi(e,jr(e,i,null,n.onPush?64:16,r,t,o,o.createRenderer(r,n)));e[t.index]=a}function fi(e,t,n,r,i,o){var a=o[t];if(null!==a)for(var s=r.setInput,u=0;u<a.length;){var c=a[u++],l=a[u++],h=a[u++];null!==s?r.setInput(n,h,c,l):n[l]=h}}function di(e,t){for(var n=null,r=0;r<t.length;){var i=t[r];if(0!==i)if(5!==i){if("number"==typeof i)break;e.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,e[i],t[r+1])),r+=2}else r+=2;else r+=4}return n}function pi(e,t,n,r){return new Array(e,!0,!1,t,null,0,r,n,null,null)}function vi(e,t){var n=Wt(t,e);if(jt(n)){var r=n[1];80&n[2]?Gr(r,n,r.template,n[8]):n[5]>0&&function e(t){for(var n=Ar(t);null!==n;n=Dr(n))for(var r=10;r<n.length;r++){var i=n[r];if(1024&i[2]){var o=i[1];Gr(o,i,o.template,i[8])}else i[5]>0&&e(i)}var a=t[1].components;if(null!==a)for(var s=0;s<a.length;s++){var u=Wt(a[s],t);jt(u)&&u[5]>0&&e(u)}}(n)}}function mi(e,t){var n=Wt(t,e),r=n[1];!function(e,t){for(var n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])}(r,n),qr(r,n,n[8])}function gi(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function yi(e){for(;e;){e[2]|=64;var t=Tr(e);if(Nt(e)&&!t)return e;e=t}return null}function bi(e,t,n){var r=t[10];r.begin&&r.begin();try{Gr(e,t,e.template,n)}catch(i){throw Ei(t,i),i}finally{r.end&&r.end()}}function _i(e){!function(e){for(var t=0;t<e.components.length;t++){var n=e.components[t],r=zt(n),i=r[1];Kr(i,r,i.template,n)}}(e[8])}function wi(e,t,n){cn(0),t(e,n)}var xi=Promise.resolve(null);function ki(e){return e[7]||(e[7]=[])}function Ci(e){return e.cleanup||(e.cleanup=[])}function Ei(e,t){var n=e[9],r=n?n.get(or,null):null;r&&r.handleError(t)}function Si(e,t,n,r,i){for(var o=0;o<n.length;){var a=n[o++],s=n[o++],u=t[a],c=e.data[a];null!==c.setInput?c.setInput(u,i,r,s):u[s]=i}}function Ii(e,t){var n=t[3];return-1===e.index?It(n)?n:null:n}function Ri(e,t){var n=Ii(e,t);return n?Wi(t[11],n[7]):null}function Ti(e,t,n,r,i){if(null!=r){var o,a=!1;It(r)?o=r:St(r)&&(a=!0,r=r[0]);var s=Mt(r);0===e&&null!==n?null==i?Bi(t,n,s):Li(t,n,s,i||null):1===e&&null!==n?Li(t,n,s,i||null):2===e?function(e,t,n){var r=Wi(e,t);r&&function(e,t,n,r){Ft(e)?e.removeChild(t,n,r):t.removeChild(n)}(e,r,t,n)}(t,s,a):3===e&&t.destroyNode(s),null!=o&&function(e,t,n,r,i){var o=n[7];o!==Mt(n)&&Ti(t,e,r,o,i);for(var a=10;a<n.length;a++){var s=n[a];qi(s[1],s,e,t,r,o)}}(t,e,o,n,i)}}function Ai(e,t,n,r){var i=Ri(e.node,t);i&&qi(e,t,t[11],n?1:2,i,r)}function Di(e,t){var n=e[9],r=n.indexOf(t);1024&t[2]&&Gt(t[3],-1),n.splice(r,1)}function Ni(e,t){if(!(e.length<=10)){var n=10+t,r=e[n];if(r){var i=r[17];null!==i&&i!==e&&Di(i,r),t>0&&(e[n-1][4]=r[4]);var o=st(e,10+t);Ai(r[1],r,!1,null);var a=o[19];null!==a&&a.detachView(o[1]),r[3]=null,r[4]=null,r[2]&=-129}return r}}function Oi(e,t){if(!(256&t[2])){var n=t[11];Ft(n)&&n.destroyNode&&qi(e,t,n,3,null,null),function(e){var t=e[13];if(!t)return Pi(e[1],e);for(;t;){var n=null;if(St(t))n=t[13];else{var r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)St(t)&&Pi(t[1],t),t=Fi(t,e);null===t&&(t=e),St(t)&&Pi(t[1],t),n=t&&t[4]}t=n}}(t)}}function Fi(e,t){var n;return St(e)&&(n=e[6])&&2===n.type?Ii(n,e):e[3]===t?null:e[3]}function Pi(e,t){if(!(256&t[2])){t[2]&=-129,t[2]|=256,function(e,t){var n;if(null!=e&&null!=(n=e.destroyHooks))for(var r=0;r<n.length;r+=2){var i=t[n[r]];if(!(i instanceof Sn)){var o=n[r+1];if(Array.isArray(o))for(var a=0;a<o.length;a+=2)o[a+1].call(i[o[a]]);else o.call(i)}}}(e,t),function(e,t){var n=e.cleanup;if(null!==n){for(var r=t[7],i=0;i<n.length-1;i+=2)if("string"==typeof n[i]){var o=n[i+1],a="function"==typeof o?o(t):Mt(t[o]),s=r[n[i+2]],u=n[i+3];"boolean"==typeof u?a.removeEventListener(n[i],s,u):u>=0?r[u]():r[-u].unsubscribe(),i+=2}else n[i].call(r[n[i+1]]);t[7]=null}}(e,t);var n=t[6];n&&3===n.type&&Ft(t[11])&&t[11].destroy();var r=t[17];if(null!==r&&It(t[3])){r!==t[3]&&Di(r,t);var i=t[19];null!==i&&i.detachView(e)}}}function Mi(e,t,n){for(var r=t.parent;null!=r&&(4===r.type||5===r.type);)r=(t=r).parent;if(null==r){var i=n[6];return 2===i.type?Ri(i,n):n[0]}if(t&&5===t.type&&4&t.flags)return Bt(t,n).parentNode;if(2&r.flags){var o=e.data,a=o[o[r.index].directiveStart].encapsulation;if(a!==ft.ShadowDom&&a!==ft.Native)return null}return Bt(r,n)}function Li(e,t,n,r){Ft(e)?e.insertBefore(t,n,r):t.insertBefore(n,r,!0)}function Bi(e,t,n){Ft(e)?e.appendChild(t,n):t.appendChild(n)}function Ui(e,t,n,r){null!==r?Li(e,t,n,r):Bi(e,t,n)}function Wi(e,t){return Ft(e)?e.parentNode(t):t.parentNode}function zi(e,t){if(2===e.type){var n=Ii(e,t);return null===n?null:ji(n.indexOf(t,10)-10,n)}return 4===e.type||5===e.type?Bt(e,t):null}function Vi(e,t,n,r){var i=Mi(e,r,t);if(null!=i){var o=t[11],a=zi(r.parent||t[6],t);if(Array.isArray(n))for(var s=0;s<n.length;s++)Ui(o,i,n[s],a);else Ui(o,i,n,a)}}function ji(e,t){var n=10+e+1;if(n<t.length){var r=t[n],i=r[1].firstChild;if(null!==i)return function e(t,n){if(null!==n){var r=n.type;if(3===r)return Bt(n,t);if(0===r)return ji(-1,t[n.index]);if(4===r||5===r){var i=n.child;if(null!==i)return e(t,i);var o=t[n.index];return It(o)?ji(-1,o):Mt(o)}var a=t[16],s=a[6],u=Tr(a),c=s.projection[n.projection];return null!=c?e(u,c):e(t,n.next)}return null}(r,i)}return t[7]}function Hi(e,t,n,r,i,o,a){for(;null!=n;){var s=r[n.index],u=n.type;a&&0===t&&(s&&vr(Mt(s),r),n.flags|=4),64!=(64&n.flags)&&(4===u||5===u?(Hi(e,t,n.child,r,i,o,!1),Ti(t,e,i,s,o)):1===u?Gi(e,t,r,n,i,o):Ti(t,e,i,s,o)),n=a?n.projectionNext:n.next}}function qi(e,t,n,r,i,o){Hi(n,r,e.node.child,t,i,o,!1)}function Gi(e,t,n,r,i,o){var a=n[16],s=a[6].projection[r.projection];if(Array.isArray(s))for(var u=0;u<s.length;u++)Ti(t,e,i,s[u],o);else Hi(e,t,s,a[3],i,o,!0)}function Ki(e,t,n){Ft(e)?e.setAttribute(t,"style",n):t.style.cssText=n}function Xi(e,t,n){Ft(e)?""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n):t.className=n}var Qi,Yi,$i,Zi=function(){function e(t,n){_classCallCheck(this,e),this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._viewContainerRef=null}return _createClass(e,[{key:"destroy",value:function(){if(this._appRef)this._appRef.detachView(this);else if(this._viewContainerRef){var e=this._viewContainerRef.indexOf(this);e>-1&&this._viewContainerRef.detach(e),this._viewContainerRef=null}Oi(this._lView[1],this._lView)}},{key:"onDestroy",value:function(e){var t,n,r;t=this._lView[1],r=e,ki(n=this._lView).push(r),t.firstCreatePass&&Ci(t).push(n[7].length-1,null)}},{key:"markForCheck",value:function(){yi(this._cdRefInjectingView||this._lView)}},{key:"detach",value:function(){this._lView[2]&=-129}},{key:"reattach",value:function(){this._lView[2]|=128}},{key:"detectChanges",value:function(){bi(this._lView[1],this._lView,this.context)}},{key:"checkNoChanges",value:function(){!function(e,t,n){rn(!0);try{bi(e,t,n)}finally{rn(!1)}}(this._lView[1],this._lView,this.context)}},{key:"attachToViewContainerRef",value:function(e){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._viewContainerRef=e}},{key:"detachFromAppRef",value:function(){var e;this._appRef=null,qi(this._lView[1],e=this._lView,e[11],2,null,null)}},{key:"attachToAppRef",value:function(e){if(this._viewContainerRef)throw new Error("This view is already attached to a ViewContainer!");this._appRef=e}},{key:"rootNodes",get:function(){var e=this._lView;return null==e[0]?function e(t,n,r,i){for(var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];null!==r;){var a=n[r.index];if(null!==a&&i.push(Mt(a)),It(a))for(var s=10;s<a.length;s++){var u=a[s],c=u[1].firstChild;null!==c&&e(u[1],u,c,i)}var l=r.type;if(4===l||5===l)e(t,n,r.child,i);else if(1===l){var h=n[16],f=h[6].projection[r.projection];if(Array.isArray(f))i.push.apply(i,_toConsumableArray(f));else{var d=Tr(h);e(d[1],d,f,i,!0)}}r=o?r.projectionNext:r.next}return i}(e[1],e,e[6].child,[]):[]}},{key:"context",get:function(){return this._lView[8]}},{key:"destroyed",get:function(){return 256==(256&this._lView[2])}}]),e}(),Ji=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this,e))._view=e,r}return _createClass(n,[{key:"detectChanges",value:function(){_i(this._view)}},{key:"checkNoChanges",value:function(){!function(e){rn(!0);try{_i(e)}finally{rn(!1)}}(this._view)}},{key:"context",get:function(){return null}}]),n}(Zi);function eo(e,t,n){return Qi||(Qi=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(e)),new Qi(Bt(t,n))}function to(e,t,n,r){return Yi||(Yi=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this))._declarationView=e,o._declarationTContainer=r,o.elementRef=i,o}return _createClass(n,[{key:"createEmbeddedView",value:function(e){var t=this._declarationTContainer.tViews,n=jr(this._declarationView,t,e,16,null,t.node);n[17]=this._declarationView[this._declarationTContainer.index];var r=this._declarationView[19];return null!==r&&(n[19]=r.createEmbeddedView(t)),qr(t,n,e),new Zi(n)}}]),n}(e)),0===n.type?new Yi(r,n,eo(t,n,r)):null}function no(e,t,n,r){var i;$i||($i=function(e){_inherits(r,e);var n=_createSuper(r);function r(e,t,i){var o;return _classCallCheck(this,r),(o=n.call(this))._lContainer=e,o._hostTNode=t,o._hostView=i,o}return _createClass(r,[{key:"clear",value:function(){for(;this.length>0;)this.remove(this.length-1)}},{key:"get",value:function(e){return null!==this._lContainer[8]&&this._lContainer[8][e]||null}},{key:"createEmbeddedView",value:function(e,t,n){var r=e.createEmbeddedView(t||{});return this.insert(r,n),r}},{key:"createComponent",value:function(e,t,n,r,i){var o=n||this.parentInjector;if(!i&&null==e.ngModule&&o){var a=o.get(rt,null);a&&(i=a)}var s=e.create(o,r,void 0,i);return this.insert(s.hostView,t),s}},{key:"insert",value:function(e,t){var n=e._lView,r=n[1];if(e.destroyed)throw new Error("Cannot insert a destroyed View in a ViewContainer!");if(this.allocateContainerIfNeeded(),It(n[3])){var i=this.indexOf(e);if(-1!==i)this.detach(i);else{var o=n[3],a=new $i(o,o[6],o[3]);a.detach(a.indexOf(e))}}var s=this._adjustIndex(t);return function(e,t,n,r){var i=10+r,o=n.length;r>0&&(n[i-1][4]=t),r<o-10?(t[4]=n[i],at(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;var a=t[17];null!==a&&n!==a&&function(e,t){var n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(a,t);var s=t[19];null!==s&&s.insertView(e),t[2]|=128}(r,n,this._lContainer,s),Ai(r,n,!0,ji(s,this._lContainer)),e.attachToViewContainerRef(this),at(this._lContainer[8],s,e),e}},{key:"move",value:function(e,t){if(e.destroyed)throw new Error("Cannot move a destroyed View in a ViewContainer!");return this.insert(e,t)}},{key:"indexOf",value:function(e){var t=this._lContainer[8];return null!==t?t.indexOf(e):-1}},{key:"remove",value:function(e){this.allocateContainerIfNeeded();var t=this._adjustIndex(e,-1);!function(e,t){var n=Ni(e,t);n&&Oi(n[1],n)}(this._lContainer,t),st(this._lContainer[8],t)}},{key:"detach",value:function(e){this.allocateContainerIfNeeded();var t=this._adjustIndex(e,-1),n=Ni(this._lContainer,t);return n&&null!=st(this._lContainer[8],t)?new Zi(n):null}},{key:"_adjustIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return null==e?this.length+t:e}},{key:"allocateContainerIfNeeded",value:function(){null===this._lContainer[8]&&(this._lContainer[8]=[])}},{key:"element",get:function(){return eo(t,this._hostTNode,this._hostView)}},{key:"injector",get:function(){return new tr(this._hostTNode,this._hostView)}},{key:"parentInjector",get:function(){var e=Gn(this._hostTNode,this._hostView),t=Pn(e,this._hostView),n=function(e,t,n){if(n.parent&&-1!==n.parent.injectorIndex){for(var r=n.parent.injectorIndex,i=n.parent;null!=i.parent&&r==i.parent.injectorIndex;)i=i.parent;return i}for(var o=Fn(e),a=t,s=t[6];o>1;)s=(a=a[15])[6],o--;return s}(e,this._hostView,this._hostTNode);return Nn(e)&&null!=n?new tr(n,t):new tr(null,this._hostView)}},{key:"length",get:function(){return this._lContainer.length-10}}]),r}(e));var o=r[n.index];if(It(o))i=o;else{var a;if(4===n.type)a=Mt(o);else if(a=r[11].createComment(""),Nt(r)){var s=r[11],u=Bt(n,r);Li(s,Wi(s,u),a,function(e,t){return Ft(e)?e.nextSibling(t):t.nextSibling}(s,u))}else Vi(r[1],r,a,n);r[n.index]=i=pi(o,r,a,n),gi(r,i)}return new $i(i,n,r)}var ro=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return io()},e}(),io=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return function(e,t,n){if(!n&&Tt(e)){var r=Wt(e.index,t);return new Zi(r,r)}return 3===e.type||0===e.type||4===e.type||5===e.type?new Zi(t[16],t):null}(Zt(),Qt(),e)},oo=new je("Set Injector scope."),ao={},so={},uo=[],co=void 0;function lo(){return void 0===co&&(co=new nt),co}function ho(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0;return new fo(e,n,t||lo(),r)}var fo=function(){function e(t,n,r){var i=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.parent=r,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;var a=[];n&&ot(n,(function(e){return i.processProvider(e,t,n)})),ot([t],(function(e){return i.processInjectorType(e,[],a)})),this.records.set(He,mo(void 0,this));var s=this.records.get(oo);this.scope=null!=s?s.value:null,this.source=o||("object"==typeof t?null:Ce(t))}return _createClass(e,[{key:"destroy",value:function(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach((function(e){return e.ngOnDestroy()}))}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:qe,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.Default;this.assertNotDestroyed();var r,i=Qe(this);try{if(!(n&he.SkipSelf)){var o=this.records.get(e);if(void 0===o){var a=("function"==typeof(r=e)||"object"==typeof r&&r instanceof je)&&me(e);o=a&&this.injectableDefInScope(a)?mo(po(e),ao):null,this.records.set(e,o)}if(null!=o)return this.hydrate(e,o)}return(n&he.Self?lo():this.parent).get(e,t=n&he.Optional&&t===qe?null:t)}catch(s){if("NullInjectorError"===s.name){if((s.ngTempTokenPath=s.ngTempTokenPath||[]).unshift(Ce(e)),i)throw s;return function(e,t,n,r){var i=e.ngTempTokenPath;throw t.__source&&i.unshift(t.__source),e.message=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.substr(2):e;var i=Ce(t);if(Array.isArray(t))i=t.map(Ce).join(" -> ");else if("object"==typeof t){var o=[];for(var a in t)if(t.hasOwnProperty(a)){var s=t[a];o.push(a+":"+("string"==typeof s?JSON.stringify(s):Ce(s)))}i="{".concat(o.join(", "),"}")}return"".concat(n).concat(r?"("+r+")":"","[").concat(i,"]: ").concat(e.replace(Ge,"\n  "))}("\n"+e.message,i,"R3InjectorError",r),e.ngTokenPath=i,e.ngTempTokenPath=null,e}(s,e,0,this.source)}throw s}finally{Qe(i)}}},{key:"_resolveInjectorDefTypes",value:function(){var e=this;this.injectorDefTypes.forEach((function(t){return e.get(t)}))}},{key:"toString",value:function(){var e=[];return this.records.forEach((function(t,n){return e.push(Ce(n))})),"R3Injector[".concat(e.join(", "),"]")}},{key:"assertNotDestroyed",value:function(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}},{key:"processInjectorType",value:function(e,t,n){var r=this;if(!(e=Re(e)))return!1;var i=ye(e),o=null==i&&e.ngModule||void 0,a=void 0===o?e:o,s=-1!==n.indexOf(a);if(void 0!==o&&(i=ye(o)),null==i)return!1;if(null!=i.imports&&!s){var u;n.push(a);try{ot(i.imports,(function(e){r.processInjectorType(e,t,n)&&(void 0===u&&(u=[]),u.push(e))}))}finally{}if(void 0!==u)for(var c=function(e){var t=u[e],n=t.ngModule,i=t.providers;ot(i,(function(e){return r.processProvider(e,n,i||uo)}))},l=0;l<u.length;l++)c(l)}this.injectorDefTypes.add(a),this.records.set(a,mo(i.factory,ao));var h=i.providers;if(null!=h&&!s){var f=e;ot(h,(function(e){return r.processProvider(e,f,h)}))}return void 0!==o&&void 0!==e.providers}},{key:"processProvider",value:function(e,t,n){var r=yo(e=Re(e))?e:Re(e&&e.provide),i=function(e,t,n){return go(e)?mo(void 0,e.useValue):mo(vo(e,t,n),ao)}(e,t,n);if(yo(e)||!0!==e.multi){var o=this.records.get(r);o&&void 0!==o.multi&&gr()}else{var a=this.records.get(r);a?void 0===a.multi&&gr():((a=mo(void 0,ao,!0)).factory=function(){return tt(a.multi)},this.records.set(r,a)),r=e,a.multi.push(e)}this.records.set(r,i)}},{key:"hydrate",value:function(e,t){var n;return t.value===so?function(e){throw new Error("Cannot instantiate cyclic dependency! "+e)}(Ce(e)):t.value===ao&&(t.value=so,t.value=t.factory()),"object"==typeof t.value&&t.value&&null!==(n=t.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(t.value),t.value}},{key:"injectableDefInScope",value:function(e){return!!e.providedIn&&("string"==typeof e.providedIn?"any"===e.providedIn||e.providedIn===this.scope:this.injectorDefTypes.has(e.providedIn))}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();function po(e){var t=me(e),n=null!==t?t.factory:Ct(e);if(null!==n)return n;var r=ye(e);if(null!==r)return r.factory;if(e instanceof je)throw new Error("Token ".concat(Ce(e)," is missing a \u0275prov definition."));if(e instanceof Function)return function(e){var t=e.length;if(t>0){var n=ut(t,"?");throw new Error("Can't resolve all parameters for ".concat(Ce(e),": (").concat(n.join(", "),")."))}var r=function(e){var t=e&&(e[be]||e[xe]||e[we]&&e[we]());if(t){var n=function(e){if(e.hasOwnProperty("name"))return e.name;var t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn('DEPRECATED: DI is instantiating a token "'.concat(n,'" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in v10. Please add @Injectable() to the "').concat(n,'" class.')),t}return null}(e);return null!==r?function(){return r.factory(e)}:function(){return new e}}(e);throw new Error("unreachable")}function vo(e,t,n){var r,i=void 0;if(yo(e)){var o=Re(e);return Ct(o)||po(o)}if(go(e))i=function(){return Re(e.useValue)};else if((r=e)&&r.useFactory)i=function(){return e.useFactory.apply(e,_toConsumableArray(tt(e.deps||[])))};else if(function(e){return!(!e||!e.useExisting)}(e))i=function(){return Ze(Re(e.useExisting))};else{var a=Re(e&&(e.useClass||e.provide));if(a||function(e,t,n){var r="";throw e&&t&&(r=" - only instances of Provider and Type are allowed, got: [".concat(t.map((function(e){return e==n?"?"+n+"?":"..."})).join(", "),"]")),new Error("Invalid provider for the NgModule '".concat(Ce(e),"'")+r)}(t,n,e),!function(e){return!!e.deps}(e))return Ct(a)||po(a);i=function(){return _construct(a,_toConsumableArray(tt(e.deps)))}}return i}function mo(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return{factory:e,value:t,multi:n?[]:void 0}}function go(e){return null!==e&&"object"==typeof e&&Ke in e}function yo(e){return"function"==typeof e}var bo=function(e,t,n){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3?arguments[3]:void 0,i=ho(e,t,n,r);return i._resolveInjectorDefTypes(),i}({name:n},t,e,n)},_o=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"create",value:function(e,t){return Array.isArray(e)?bo(e,t,""):bo(e.providers,e.parent,e.name||"")}}]),e}();return e.THROW_IF_NOT_FOUND=qe,e.NULL=new nt,e.\u0275prov=pe({token:e,providedIn:"any",factory:function(){return Ze(He)}}),e.__NG_ELEMENT_ID__=-1,e}(),wo=new je("AnalyzeForEntryComponents"),xo=new Map,ko=new Set;function Co(e){return"string"==typeof e?e:e.text()}function Eo(e,t,n){var r=n?e.styles:null,i=n?e.classes:null,o=0;if(null!==t)for(var a=0;a<t.length;a++){var s=t[a];"number"==typeof s?o=s:1==o?i=Ee(i,s):2==o&&(r=Ee(r,s+": "+t[++a]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=i:e.classesWithoutHost=i}var So=null;function Io(){if(!So){var e=Pe.Symbol;if(e&&e.iterator)So=e.iterator;else for(var t=Object.getOwnPropertyNames(Map.prototype),n=0;n<t.length;++n){var r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(So=r)}}return So}function Ro(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)}function To(e){return!!Ao(e)&&(Array.isArray(e)||!(e instanceof Map)&&Io()in e)}function Ao(e){return null!==e&&("function"==typeof e||"object"==typeof e)}function Do(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function No(e,t,n,r){var i=Qt();return Do(i,on(),t)&&(Yt(),function(e,t,n,r,i,o){var a=Bt(e,t),s=t[11];if(null==r)Ft(s)?s.removeAttribute(a,n,o):a.removeAttribute(n);else{var u=null==i?Mn(r):i(r,e.tagName||"",n);Ft(s)?s.setAttribute(a,n,u,o):o?a.setAttributeNS(o,n,u):a.setAttribute(n,u)}}(bn(),i,e,t,n,r)),No}function Oo(e,t,n,r){return Do(e,on(),n)?t+Mn(n)+r:Rr}function Fo(e,t,n,r,i,o,a,s){var u=Qt(),c=Yt(),l=e+20,h=c.firstCreatePass?function(e,t,n,r,i,o,a,s,u){var c=t.consts,l=Hr(t,n[6],e,0,a||null,Ht(c,s));ni(t,n,l,Ht(c,u)),_n(t,l);var h=l.tViews=Zr(2,-1,r,i,o,t.directiveRegistry,t.pipeRegistry,null,t.schemas,c),f=Jr(0,null,2,-1,null,null);return f.injectorIndex=l.injectorIndex,h.node=f,null!==t.queries&&(t.queries.template(t,l),h.queries=t.queries.embeddedTView(l)),l}(e,c,u,t,n,r,i,o,a):c.data[l];Jt(h,!1);var f=u[11].createComment("");Vi(c,u,f,h),vr(f,u),gi(u,u[l]=pi(f,u,f,h)),At(h)&&Qr(c,u,h),null!=a&&Yr(u,h,s)}function Po(e){return function(e,t){return e[t+20]}(Kt.lFrame.contextLView,e)}function Mo(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he.Default,n=Qt();return null==n?Ze(e,t):Xn(Zt(),n,Re(e),t)}function Lo(e){return function(e,t){if("class"===t)return e.classes;if("style"===t)return e.styles;var n=e.attrs;if(n)for(var r=n.length,i=0;i<r;){var o=n[i];if(Rn(o))break;if(0===o)i+=2;else if("number"==typeof o)for(i++;i<r&&"string"==typeof n[i];)i++;else{if(o===t)return n[i+1];i+=2}}return null}(Zt(),e)}function Bo(){throw new Error("invalid")}function Uo(e,t,n){var r=Qt();return Do(r,on(),t)&&ti(Yt(),bn(),r,e,t,r[11],n,!1),Uo}function Wo(e,t,n,r,i){var o=i?"class":"style";Si(e,n,t.inputs[o],o,r)}function zo(e,t,n,r){var i=Qt(),o=Yt(),a=20+e,s=i[11],u=i[a]=Vr(t,s,Kt.lFrame.currentNamespace),c=o.firstCreatePass?function(e,t,n,r,i,o,a){var s=t.consts,u=Ht(s,o),c=Hr(t,n[6],e,3,i,u);return ni(t,n,c,Ht(s,a)),null!==c.attrs&&Eo(c,c.attrs,!1),null!==c.mergedAttrs&&Eo(c,c.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,c),c}(e,o,i,0,t,n,r):o.data[a];Jt(c,!0);var l=c.mergedAttrs;null!==l&&In(s,u,l);var h=c.classes;null!==h&&Xi(s,u,h);var f=c.styles;null!==f&&Ki(s,u,f),Vi(o,i,u,c),0===Kt.lFrame.elementDepthCount&&vr(u,i),Kt.lFrame.elementDepthCount++,At(c)&&(Qr(o,i,c),function(e,t,n){if(Rt(t))for(var r=t.directiveEnd,i=t.directiveStart;i<r;i++){var o=e.data[i];o.contentQueries&&o.contentQueries(1,n[i],i)}}(o,c,i)),null!==r&&Yr(i,c)}function Vo(){var e=Zt();en()?tn():Jt(e=e.parent,!1);var t=e;Kt.lFrame.elementDepthCount--;var n=Yt();n.firstCreatePass&&(_n(n,e),Rt(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function(e){return 0!=(16&e.flags)}(t)&&Wo(n,t,Qt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function(e){return 0!=(32&e.flags)}(t)&&Wo(n,t,Qt(),t.stylesWithoutHost,!1)}function jo(e,t,n,r){zo(e,t,n,r),Vo()}function Ho(e){return!!e&&"function"==typeof e.then}function qo(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,i=Qt(),o=Yt(),a=Zt();return function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7?arguments[7]:void 0,u=At(r),c=e.firstCreatePass&&(e.cleanup||(e.cleanup=[])),l=ki(t),h=!0;if(3===r.type){var f=Bt(r,t),d=s?s(f):dt,p=d.target||f,v=l.length,m=s?function(e){return s(Mt(e[r.index])).target}:r.index;if(Ft(n)){var g=null;if(!s&&u&&(g=function(e,t,n,r){var i=e.cleanup;if(null!=i)for(var o=0;o<i.length-1;o+=2){var a=i[o];if(a===n&&i[o+1]===r){var s=t[7],u=i[o+2];return s.length>u?s[u]:null}"string"==typeof a&&(o+=2)}return null}(e,t,i,r.index)),null!==g)(g.__ngLastListenerFn__||g).__ngNextListenerFn__=o,g.__ngLastListenerFn__=o,h=!1;else{o=Ko(r,t,o,!1);var y=n.listen(d.name||p,i,o);l.push(o,y),c&&c.push(i,m,v,v+1)}}else o=Ko(r,t,o,!0),p.addEventListener(i,o,a),l.push(o),c&&c.push(i,m,v,a)}var b,_=r.outputs;if(h&&null!==_&&(b=_[i])){var w=b.length;if(w)for(var x=0;x<w;x+=2){var k=t[b[x]][b[x+1]].subscribe(o),C=l.length;l.push(o,k),c&&c.push(i,r.index,C,-(C+1))}}}(o,i,i[11],a,e,t,n,r),qo}function Go(e,t,n){try{return!1!==t(n)}catch(r){return Ei(e,r),!1}}function Ko(e,t,n,r){return function i(o){if(o===Function)return n;var a=2&e.flags?Wt(e.index,t):t;0==(32&t[2])&&yi(a);for(var s=Go(t,n,o),u=i.__ngNextListenerFn__;u;)s=Go(t,u,o)&&s,u=u.__ngNextListenerFn__;return r&&!1===s&&(o.preventDefault(),o.returnValue=!1),s}}function Xo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return function(e){return(Kt.lFrame.contextLView=function(e,t){for(;e>0;)t=t[15],e--;return t}(e,Kt.lFrame.contextLView))[8]}(e)}function Qo(e,t,n,r,i){var o=Qt(),a=Oo(o,t,n,r);return a!==Rr&&ti(Yt(),bn(),o,e,a,o[11],i,!1),Qo}var Yo=[];function $o(e,t,n,r,i){for(var o=e[n+1],a=null===t,s=r?Mr(o):Br(o),u=!1;0!==s&&(!1===u||a);){var c=e[s+1];Zo(e[s],t)&&(u=!0,e[s+1]=r?Wr(c):Lr(c)),s=r?Mr(c):Br(c)}u&&(e[n+1]=r?Lr(o):Wr(o))}function Zo(e,t){return null===e||null==t||(Array.isArray(e)?e[1]:e)===t||!(!Array.isArray(e)||"string"!=typeof t)&&lt(e,t)>=0}function Jo(e,t){return function(e,t,n,r){var i,o,a,s=Qt(),u=Yt(),c=(i=Kt.lFrame,o=i.bindingIndex,i.bindingIndex=i.bindingIndex+2,o);(u.firstUpdatePass&&function(e,t,n,r){var i=e.data;if(null===i[n+1]){var o=i[gn()+20],a=function(e,t){return t>=e.expandoStartIndex}(e,n);(function(e,t){return 0!=(16&e.flags)})(o)&&null===t&&!a&&(t=!1),t=function(e,t,n,r){var i=function(e){var t=Kt.lFrame.currentDirectiveIndex;return-1===t?null:e[t]}(e),o=t.residualClasses;if(null===i)0===t.classBindings&&(n=ta(n=ea(null,e,t,n,!0),t.attrs,!0),o=null);else{var a=t.directiveStylingLast;if(-1===a||e[a]!==i)if(n=ea(i,e,t,n,!0),null===o){var s=function(e,t,n){var r=t.classBindings;if(0!==Br(r))return e[Mr(r)]}(e,t);void 0!==s&&Array.isArray(s)&&function(e,t,n,r){e[Mr(t.classBindings)]=r}(e,t,0,s=ta(s=ea(null,e,t,s[1],!0),t.attrs,!0))}else o=function(e,t,n){for(var r=void 0,i=t.directiveEnd,o=1+t.directiveStylingLast;o<i;o++)r=ta(r,e[o].hostAttrs,!0);return ta(r,t.attrs,!0)}(e,t)}return void 0!==o&&(t.residualClasses=o),n}(i,o,t),function(e,t,n,r,i,o){var a=t.classBindings,s=Mr(a),u=Br(a);e[r]=n;var c,l=!1;if(Array.isArray(n)){var h=n;(null===(c=h[1])||lt(h,c)>0)&&(l=!0)}else c=n;if(i)if(0!==u){var f=Mr(e[s+1]);e[r+1]=Pr(f,s),0!==f&&(e[f+1]=Ur(e[f+1],r)),e[s+1]=131071&e[s+1]|r<<17}else e[r+1]=Pr(s,0),0!==s&&(e[s+1]=Ur(e[s+1],r)),s=r;else e[r+1]=Pr(u,0),0===s?s=r:e[u+1]=Ur(e[u+1],r),u=r;l&&(e[r+1]=Lr(e[r+1])),$o(e,c,r,!0),$o(e,c,r,!1),function(e,t,n,r,i){var o=e.residualClasses;null!=o&&"string"==typeof t&&lt(o,t)>=0&&(n[r+1]=Wr(n[r+1]))}(t,c,e,r),a=Pr(s,u),t.classBindings=a}(i,o,t,n,a)}}(u,e,c),t!==Rr&&Do(s,c,t))&&(null==n&&(a=function(){var e=Kt.lFrame;return null===e?null:e.currentSanitizer}())&&(n=a),function(e,t,n,r,i,o,a,s){if(3===t.type){var u=e.data,c=u[s+1];ra(1==(1&c)?na(u,t,n,i,Br(c),!0):void 0)||(ra(o)||2==(2&c)&&(o=na(u,null,n,i,s,!0)),function(e,t,n,r,i){var o=Ft(e);i?o?e.addClass(n,r):n.classList.add(r):o?e.removeClass(n,r):n.classList.remove(r)}(r,0,Lt(gn(),n),i,o))}}(u,u.data[gn()+20],s,s[11],e,s[c+1]=function(e,t){return null==e||("function"==typeof t?e=t(e):"string"==typeof t?e+=t:"object"==typeof e&&(e=Ce(sr(e)))),e}(t,n),0,c))}(e,t,null),Jo}function ea(e,t,n,r,i){var o=null,a=n.directiveEnd,s=n.directiveStylingLast;for(-1===s?s=n.directiveStart:s++;s<a&&(r=ta(r,(o=t[s]).hostAttrs,i),o!==e);)s++;return null!==e&&(n.directiveStylingLast=s),r}function ta(e,t,n){var r,i,o,a,s=n?1:2,u=-1;if(null!==t)for(var c=0;c<t.length;c++){var l=t[c];"number"==typeof l?u=l:u===s&&(Array.isArray(e)||(e=void 0===e?[]:["",e]),r=e,i=l,o=!!n||t[++c],a=void 0,(a=lt(r,i))>=0?r[1|a]=o:function(e,t,n,r){var i=e.length;if(i==t)e.push(n,r);else if(1===i)e.push(r,e[0]),e[0]=n;else{for(i--,e.push(e[i-1],e[i]);i>t;)e[i]=e[i-2],i--;e[t]=n,e[t+1]=r}}(r,a=~a,i,o))}return void 0===e?null:e}function na(e,t,n,r,i,o){for(var a=null===t,s=void 0;i>0;){var u=e[i],c=Array.isArray(u),l=c?u[1]:u,h=null===l,f=n[i+1];f===Rr&&(f=h?Yo:void 0);var d=h?ct(f,r):l===r?f:void 0;if(c&&!ra(d)&&(d=ct(u,r)),ra(d)&&(s=d,a))return s;var p=e[i+1];i=a?Mr(p):Br(p)}if(null!==t){var v=o?t.residualClasses:t.residualStyles;null!=v&&(s=ct(v,r))}return s}function ra(e){return void 0!==e}function ia(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=Qt(),r=Yt(),i=e+20,o=r.firstCreatePass?Hr(r,n[6],e,3,null,null):r.data[i],a=n[i]=function(e,t){return Ft(t)?t.createText(e):t.createTextNode(e)}(t,n[11]);Vi(r,n,a,o),Jt(o,!1)}function oa(e){return aa("",e,""),oa}function aa(e,t,n){var r=Qt(),i=Oo(r,e,t,n);return i!==Rr&&function(e,t,n){var r=Lt(t,e),i=e[11];Ft(i)?i.setValue(r,n):r.textContent=n}(r,gn(),i),aa}function sa(e,t,n){var r=Qt();return Do(r,on(),t)&&ti(Yt(),bn(),r,e,t,r[11],n,!0),sa}function ua(e,t){var n=zt(e)[1],r=n.data.length-1;_n(n,{directiveStart:r,directiveEnd:r+1})}function ca(e){for(var t=Object.getPrototypeOf(e.type.prototype).constructor,n=!0,r=[e];t;){var i=void 0;if(Dt(e))i=t.\u0275cmp||t.\u0275dir;else{if(t.\u0275cmp)throw new Error("Directives cannot inherit Components");i=t.\u0275dir}if(i){if(n){r.push(i);var o=e;o.inputs=la(e.inputs),o.declaredInputs=la(e.declaredInputs),o.outputs=la(e.outputs);var a=i.hostBindings;a&&da(e,a);var s=i.viewQuery,u=i.contentQueries;if(s&&ha(e,s),u&&fa(e,u),de(e.inputs,i.inputs),de(e.declaredInputs,i.declaredInputs),de(e.outputs,i.outputs),Dt(i)&&i.data.animation){var c=e.data;c.animation=(c.animation||[]).concat(i.data.animation)}o.afterContentChecked=o.afterContentChecked||i.afterContentChecked,o.afterContentInit=e.afterContentInit||i.afterContentInit,o.afterViewChecked=e.afterViewChecked||i.afterViewChecked,o.afterViewInit=e.afterViewInit||i.afterViewInit,o.doCheck=e.doCheck||i.doCheck,o.onDestroy=e.onDestroy||i.onDestroy,o.onInit=e.onInit||i.onInit}var l=i.features;if(l)for(var h=0;h<l.length;h++){var f=l[h];f&&f.ngInherit&&f(e),f===ca&&(n=!1)}}t=Object.getPrototypeOf(t)}!function(e){for(var t=0,n=null,r=e.length-1;r>=0;r--){var i=e[r];i.hostVars=t+=i.hostVars,i.hostAttrs=An(i.hostAttrs,n=An(n,i.hostAttrs))}}(r)}function la(e){return e===dt?{}:e===pt?[]:e}function ha(e,t){var n=e.viewQuery;e.viewQuery=n?function(e,r){t(e,r),n(e,r)}:t}function fa(e,t){var n=e.contentQueries;e.contentQueries=n?function(e,r,i){t(e,r,i),n(e,r,i)}:t}function da(e,t){var n=e.hostBindings;e.hostBindings=n?function(e,r){t(e,r),n(e,r)}:t}function pa(e,t,n,r,i){if(e=Re(e),Array.isArray(e))for(var o=0;o<e.length;o++)pa(e[o],t,n,r,i);else{var a=Yt(),s=Qt(),u=yo(e)?e:Re(e.provide),c=vo(e),l=Zt(),h=65535&l.providerIndexes,f=l.directiveStart,d=l.providerIndexes>>16;if(yo(e)||!e.multi){var p=new Sn(c,i,Mo),v=ga(u,t,i?h:h+d,f);-1===v?(Kn(jn(l,s),a,u),va(a,e,t.length),t.push(u),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=65536),n.push(p),s.push(p)):(n[v]=p,s[v]=p)}else{var m=ga(u,t,h+d,f),g=ga(u,t,h,h+d),y=m>=0&&n[m],b=g>=0&&n[g];if(i&&!b||!i&&!y){Kn(jn(l,s),a,u);var _=function(e,t,n,r,i){var o=new Sn(e,n,Mo);return o.multi=[],o.index=t,o.componentProviders=0,ma(o,i,r&&!n),o}(i?ba:ya,n.length,i,r,c);!i&&b&&(n[g].providerFactory=_),va(a,e,t.length,0),t.push(u),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=65536),n.push(_),s.push(_)}else va(a,e,m>-1?m:g,ma(n[i?g:m],c,!i&&r));!i&&r&&b&&n[g].componentProviders++}}}function va(e,t,n,r){var i=yo(t);if(i||t.useClass){var o=(t.useClass||t).prototype.ngOnDestroy;if(o){var a=e.destroyHooks||(e.destroyHooks=[]);if(!i&&t.multi){var s=a.indexOf(n);-1===s?a.push(n,[r,o]):a[s+1].push(r,o)}else a.push(n,o)}}}function ma(e,t,n){return n&&e.componentProviders++,e.multi.push(t)-1}function ga(e,t,n,r){for(var i=n;i<r;i++)if(t[i]===e)return i;return-1}function ya(e,t,n,r){return _a(this.multi,[])}function ba(e,t,n,r){var i,o=this.multi;if(this.providerFactory){var a=this.providerFactory.componentProviders,s=Zn(n,n[1],this.providerFactory.index,r);_a(o,i=s.slice(0,a));for(var u=a;u<s.length;u++)i.push(s[u])}else _a(o,i=[]);return i}function _a(e,t){for(var n=0;n<e.length;n++)t.push((0,e[n])());return t}function wa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return function(n){n.providersResolver=function(n,r){return function(e,t,n){var r=Yt();if(r.firstCreatePass){var i=Dt(e);pa(n,r.data,r.blueprint,i,!0),pa(t,r.data,r.blueprint,i,!1)}}(n,r?r(e):e,t)}}}var xa=function e(){_classCallCheck(this,e)},ka=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"resolveComponentFactory",value:function(e){throw function(e){var t=Error("No component factory found for ".concat(Ce(e),". Did you add it to @NgModule.entryComponents?"));return t.ngComponent=e,t}(e)}}]),e}(),Ca=function(){var e=function e(){_classCallCheck(this,e)};return e.NULL=new ka,e}(),Ea=function(){var e=function e(t){_classCallCheck(this,e),this.nativeElement=t};return e.__NG_ELEMENT_ID__=function(){return Sa(e)},e}(),Sa=function(e){return eo(e,Zt(),Qt())},Ia=function e(){_classCallCheck(this,e)},Ra=function(){var e={Important:1,DashCase:2};return e[e.Important]="Important",e[e.DashCase]="DashCase",e}(),Ta=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return Aa()},e}(),Aa=function(){var e=Qt(),t=Wt(Zt().index,e);return function(e){var t=e[11];if(Ft(t))return t;throw new Error("Cannot inject Renderer2 when the application uses Renderer3!")}(St(t)?t:e)},Da=function(){var e=function e(){_classCallCheck(this,e)};return e.\u0275prov=pe({token:e,providedIn:"root",factory:function(){return null}}),e}(),Na=function e(t){_classCallCheck(this,e),this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")},Oa=new Na("9.1.9"),Fa=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return To(e)}},{key:"create",value:function(e){return new Ma(e)}}]),e}(),Pa=function(e,t){return t},Ma=function(){function e(t){_classCallCheck(this,e),this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Pa}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._itHead;null!==t;t=t._next)e(t)}},{key:"forEachOperation",value:function(e){for(var t=this._itHead,n=this._removalsHead,r=0,i=null;t||n;){var o=!n||t&&t.currentIndex<Wa(n,r,i)?t:n,a=Wa(o,r,i),s=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{i||(i=[]);var u=a-r,c=s-r;if(u!=c){for(var l=0;l<u;l++){var h=l<i.length?i[l]:i[l]=0,f=h+l;c<=f&&f<u&&(i[l]=h+1)}i[o.previousIndex]=c-u}}a!==s&&e(o,a,s)}}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachMovedItem",value:function(e){var t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"forEachIdentityChange",value:function(e){var t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}},{key:"diff",value:function(e){if(null==e&&(e=[]),!To(e))throw new Error("Error trying to diff '".concat(Ce(e),"'. Only arrays and iterables are allowed"));return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n,r,i,o=this._itHead,a=!1;if(Array.isArray(e)){this.length=e.length;for(var s=0;s<this.length;s++)r=e[s],i=this._trackByFn(s,r),null!==o&&Ro(o.trackById,i)?(a&&(o=this._verifyReinsertion(o,r,i,s)),Ro(o.item,r)||this._addIdentityChange(o,r)):(o=this._mismatch(o,r,i,s),a=!0),o=o._next}else n=0,function(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++)t(e[n]);else for(var r,i=e[Io()]();!(r=i.next()).done;)t(r.value)}(e,(function(e){i=t._trackByFn(n,e),null!==o&&Ro(o.trackById,i)?(a&&(o=t._verifyReinsertion(o,e,i,n)),Ro(o.item,e)||t._addIdentityChange(o,e)):(o=t._mismatch(o,e,i,n),a=!0),o=o._next,n++})),this.length=n;return this._truncate(o),this.collection=e,this.isDirty}},{key:"_reset",value:function(){if(this.isDirty){var e,t;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=t)e.previousIndex=e.currentIndex,t=e._nextMoved;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}},{key:"_mismatch",value:function(e,t,n,r){var i;return null===e?i=this._itTail:(i=e._prev,this._remove(e)),null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Ro(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,i,r)):null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Ro(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,i,r)):e=this._addAfter(new La(t,n),i,r),e}},{key:"_verifyReinsertion",value:function(e,t,n,r){var i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?e=this._reinsertAfter(i,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}},{key:"_truncate",value:function(e){for(;null!==e;){var t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}},{key:"_reinsertAfter",value:function(e,t,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);var r=e._prevRemoved,i=e._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_moveAfter",value:function(e,t,n){return this._unlink(e),this._insertAfter(e,t,n),this._addToMoves(e,n),e}},{key:"_addAfter",value:function(e,t,n){return this._insertAfter(e,t,n),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}},{key:"_insertAfter",value:function(e,t,n){var r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new Ua),this._linkedRecords.put(e),e.currentIndex=n,e}},{key:"_remove",value:function(e){return this._addToRemovals(this._unlink(e))}},{key:"_unlink",value:function(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);var t=e._prev,n=e._next;return null===t?this._itHead=n:t._next=n,null===n?this._itTail=t:n._prev=t,e}},{key:"_addToMoves",value:function(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}},{key:"_addToRemovals",value:function(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Ua),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}},{key:"_addIdentityChange",value:function(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}}]),e}(),La=function e(t,n){_classCallCheck(this,e),this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null},Ba=function(){function e(){_classCallCheck(this,e),this._head=null,this._tail=null}return _createClass(e,[{key:"add",value:function(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}},{key:"get",value:function(e,t){var n;for(n=this._head;null!==n;n=n._nextDup)if((null===t||t<=n.currentIndex)&&Ro(n.trackById,e))return n;return null}},{key:"remove",value:function(e){var t=e._prevDup,n=e._nextDup;return null===t?this._head=n:t._nextDup=n,null===n?this._tail=t:n._prevDup=t,null===this._head}}]),e}(),Ua=function(){function e(){_classCallCheck(this,e),this.map=new Map}return _createClass(e,[{key:"put",value:function(e){var t=e.trackById,n=this.map.get(t);n||(n=new Ba,this.map.set(t,n)),n.add(e)}},{key:"get",value:function(e,t){var n=this.map.get(e);return n?n.get(e,t):null}},{key:"remove",value:function(e){var t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}},{key:"clear",value:function(){this.map.clear()}},{key:"isEmpty",get:function(){return 0===this.map.size}}]),e}();function Wa(e,t,n){var r=e.previousIndex;if(null===r)return r;var i=0;return n&&r<n.length&&(i=n[r]),r+t+i}var za=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"supports",value:function(e){return e instanceof Map||Ao(e)}},{key:"create",value:function(){return new Va}}]),e}(),Va=function(){function e(){_classCallCheck(this,e),this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}return _createClass(e,[{key:"forEachItem",value:function(e){var t;for(t=this._mapHead;null!==t;t=t._next)e(t)}},{key:"forEachPreviousItem",value:function(e){var t;for(t=this._previousMapHead;null!==t;t=t._nextPrevious)e(t)}},{key:"forEachChangedItem",value:function(e){var t;for(t=this._changesHead;null!==t;t=t._nextChanged)e(t)}},{key:"forEachAddedItem",value:function(e){var t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}},{key:"forEachRemovedItem",value:function(e){var t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}},{key:"diff",value:function(e){if(e){if(!(e instanceof Map||Ao(e)))throw new Error("Error trying to diff '".concat(Ce(e),"'. Only maps and objects are allowed"))}else e=new Map;return this.check(e)?this:null}},{key:"onDestroy",value:function(){}},{key:"check",value:function(e){var t=this;this._reset();var n=this._mapHead;if(this._appendAfter=null,this._forEach(e,(function(e,r){if(n&&n.key===r)t._maybeAddToChanges(n,e),t._appendAfter=n,n=n._next;else{var i=t._getOrCreateRecordForKey(r,e);n=t._insertBeforeOrAppend(n,i)}})),n){n._prev&&(n._prev._next=null),this._removalsHead=n;for(var r=n;null!==r;r=r._nextRemoved)r===this._mapHead&&(this._mapHead=null),this._records.delete(r.key),r._nextRemoved=r._next,r.previousValue=r.currentValue,r.currentValue=null,r._prev=null,r._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}},{key:"_insertBeforeOrAppend",value:function(e,t){if(e){var n=e._prev;return t._next=e,t._prev=n,e._prev=t,n&&(n._next=t),e===this._mapHead&&(this._mapHead=t),this._appendAfter=e,e}return this._appendAfter?(this._appendAfter._next=t,t._prev=this._appendAfter):this._mapHead=t,this._appendAfter=t,null}},{key:"_getOrCreateRecordForKey",value:function(e,t){if(this._records.has(e)){var n=this._records.get(e);this._maybeAddToChanges(n,t);var r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}var o=new ja(e);return this._records.set(e,o),o.currentValue=t,this._addToAdditions(o),o}},{key:"_reset",value:function(){if(this.isDirty){var e;for(this._previousMapHead=this._mapHead,e=this._previousMapHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._changesHead;null!==e;e=e._nextChanged)e.previousValue=e.currentValue;for(e=this._additionsHead;null!=e;e=e._nextAdded)e.previousValue=e.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}},{key:"_maybeAddToChanges",value:function(e,t){Ro(t,e.currentValue)||(e.previousValue=e.currentValue,e.currentValue=t,this._addToChanges(e))}},{key:"_addToAdditions",value:function(e){null===this._additionsHead?this._additionsHead=this._additionsTail=e:(this._additionsTail._nextAdded=e,this._additionsTail=e)}},{key:"_addToChanges",value:function(e){null===this._changesHead?this._changesHead=this._changesTail=e:(this._changesTail._nextChanged=e,this._changesTail=e)}},{key:"_forEach",value:function(e,t){e instanceof Map?e.forEach(t):Object.keys(e).forEach((function(n){return t(e[n],n)}))}},{key:"isDirty",get:function(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}}]),e}(),ja=function e(t){_classCallCheck(this,e),this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null},Ha=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t,n=this.factories.find((function(t){return t.supports(e)}));if(null!=n)return n;throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'"))}}],[{key:"create",value:function(t,n){if(null!=n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend IterableDiffers without a parent injector");return e.create(t,n)},deps:[[e,new le,new ue]]}}}]),e}();return e.\u0275prov=pe({token:e,providedIn:"root",factory:function(){return new e([new Fa])}}),e}(),qa=function(){var e=function(){function e(t){_classCallCheck(this,e),this.factories=t}return _createClass(e,[{key:"find",value:function(e){var t=this.factories.find((function(t){return t.supports(e)}));if(t)return t;throw new Error("Cannot find a differ supporting object '".concat(e,"'"))}}],[{key:"create",value:function(t,n){if(n){var r=n.factories.slice();t=t.concat(r)}return new e(t)}},{key:"extend",value:function(t){return{provide:e,useFactory:function(n){if(!n)throw new Error("Cannot extend KeyValueDiffers without a parent injector");return e.create(t,n)},deps:[[e,new le,new ue]]}}}]),e}();return e.\u0275prov=pe({token:e,providedIn:"root",factory:function(){return new e([new za])}}),e}(),Ga=[new za],Ka=new Ha([new Fa]),Xa=new qa(Ga),Qa=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return Ya(e,Ea)},e}(),Ya=function(e,t){return to(e,t,Zt(),Qt())},$a=function(){var e=function e(){_classCallCheck(this,e)};return e.__NG_ELEMENT_ID__=function(){return Za(e,Ea)},e}(),Za=function(e,t){return no(e,t,Zt(),Qt())},Ja={},es=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).ngModule=e,r}return _createClass(n,[{key:"resolveComponentFactory",value:function(e){var t=kt(e);return new rs(t,this.ngModule)}}]),n}(Ca);function ts(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}var ns=new je("SCHEDULER_TOKEN",{providedIn:"root",factory:function(){return Bn}}),rs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this)).componentDef=e,i.ngModule=r,i.componentType=e.type,i.selector=e.selectors.map(Ir).join(","),i.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],i.isBoundToModule=!!r,i}return _createClass(n,[{key:"create",value:function(e,t,n,r){var i,o,a=(r=r||this.ngModule)?function(e,t){return{get:function(n,r,i){var o=e.get(n,Ja,i);return o!==Ja||r===Ja?o:t.get(n,r,i)}}}(e,r.injector):e,s=a.get(Ia,Pt),u=a.get(Da,null),c=s.createRenderer(null,this.componentDef),l=this.componentDef.selectors[0][0]||"div",h=n?function(e,t,n){if(Ft(e))return e.selectRootElement(t,n===ft.ShadowDom);var r="string"==typeof t?e.querySelector(t):t;return r.textContent="",r}(c,n,this.componentDef.encapsulation):Vr(l,s.createRenderer(null,this.componentDef),function(e){var t=e.toLowerCase();return"svg"===t?"http://www.w3.org/2000/svg":"math"===t?"http://www.w3.org/1998/MathML/":null}(l)),f=this.componentDef.onPush?576:528,d="string"==typeof n&&/^#root-ng-internal-isolated-\d+/.test(n),p={components:[],scheduler:Bn,clean:xi,playerHandler:null,flags:0},v=Zr(0,-1,null,1,0,null,null,null,null,null),m=jr(null,v,p,f,null,null,s,c,u,a);hn(m,null);try{var g=function(e,t,n,r,i,o){var a=n[1];n[20]=e;var s=Hr(a,null,0,3,null,null),u=s.mergedAttrs=t.hostAttrs;null!==u&&(Eo(s,u,!0),null!==e&&(In(i,e,u),null!==s.classes&&Xi(i,e,s.classes),null!==s.styles&&Ki(i,e,s.styles)));var c=r.createRenderer(e,t),l=jr(n,$r(t),null,t.onPush?64:16,n[20],s,r,c,void 0);return a.firstCreatePass&&(Kn(jn(s,n),a,t.type),si(a,s),ci(s,n.length,1)),gi(n,l),n[20]=l}(h,this.componentDef,m,s,c);if(h)if(n)In(c,h,["ng-version",Oa.full]);else{var y=function(e){for(var t=[],n=[],r=1,i=2;r<e.length;){var o=e[r];if("string"==typeof o)2===i?""!==o&&t.push(o,e[++r]):8===i&&n.push(o);else{if(!kr(i))break;i=o}r++}return{attrs:t,classes:n}}(this.componentDef.selectors[0]),b=y.attrs,_=y.classes;b&&In(c,h,b),_&&_.length>0&&Xi(c,h,_.join(" "))}if(o=Ut(v,0),void 0!==t)for(var w=o.projection=[],x=0;x<this.ngContentSelectors.length;x++){var k=t[x];w.push(null!=k?Array.from(k):null)}i=function(e,t,n,r,i){var o=n[1],a=function(e,t,n){var r=Zt();e.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),ai(e,r,1),li(e,t,n));var i=Zn(t,e,t.length-1,r);vr(i,t);var o=Bt(r,t);return o&&vr(o,t),i}(o,n,t);r.components.push(a),e[8]=a,i&&i.forEach((function(e){return e(a,t)})),t.contentQueries&&t.contentQueries(1,a,n.length-1);var s=Zt();if(o.firstCreatePass&&(null!==t.hostBindings||null!==t.hostAttrs)){yn(s.index-20);var u=n[1];ri(u,t),ii(u,n,t.hostVars),oi(t,a)}return a}(g,this.componentDef,m,p,[ua]),qr(v,m,null)}finally{mn()}var C=new is(this.componentType,i,eo(Ea,o,m),m,o);return n&&!d||(v.node.child=o),C}},{key:"inputs",get:function(){return ts(this.componentDef.inputs)}},{key:"outputs",get:function(){return ts(this.componentDef.outputs)}}]),n}(xa),is=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a){var s,u,c,l;return _classCallCheck(this,n),(s=t.call(this)).location=i,s._rootLView=o,s._tNode=a,s.destroyCbs=[],s.instance=r,s.hostView=s.changeDetectorRef=new Ji(o),u=o[1],c=o,null==(l=u.node)&&(u.node=l=Jr(0,null,2,-1,null,null)),c[6]=l,s.componentType=e,s}return _createClass(n,[{key:"destroy",value:function(){this.destroyCbs&&(this.destroyCbs.forEach((function(e){return e()})),this.destroyCbs=null,!this.hostView.destroyed&&this.hostView.destroy())}},{key:"onDestroy",value:function(e){this.destroyCbs&&this.destroyCbs.push(e)}},{key:"injector",get:function(){return new tr(this._tNode,this._rootLView)}}]),n}(function(){return function e(){_classCallCheck(this,e)}}()),os=void 0,as=["en",[["a","p"],["AM","PM"],os],[["AM","PM"],os,os],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],os,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],os,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",os,"{1} 'at' {0}",os],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(e){var t=Math.floor(Math.abs(e)),n=e.toString().replace(/^[^.]*\.?/,"").length;return 1===t&&0===n?1:5}],ss={};function us(e){return e in ss||(ss[e]=Pe.ng&&Pe.ng.common&&Pe.ng.common.locales&&Pe.ng.common.locales[e]),ss[e]}var cs=function(){var e={LocaleId:0,DayPeriodsFormat:1,DayPeriodsStandalone:2,DaysFormat:3,DaysStandalone:4,MonthsFormat:5,MonthsStandalone:6,Eras:7,FirstDayOfWeek:8,WeekendRange:9,DateFormat:10,TimeFormat:11,DateTimeFormat:12,NumberSymbols:13,NumberFormats:14,CurrencyCode:15,CurrencySymbol:16,CurrencyName:17,Currencies:18,Directionality:19,PluralCase:20,ExtraData:21};return e[e.LocaleId]="LocaleId",e[e.DayPeriodsFormat]="DayPeriodsFormat",e[e.DayPeriodsStandalone]="DayPeriodsStandalone",e[e.DaysFormat]="DaysFormat",e[e.DaysStandalone]="DaysStandalone",e[e.MonthsFormat]="MonthsFormat",e[e.MonthsStandalone]="MonthsStandalone",e[e.Eras]="Eras",e[e.FirstDayOfWeek]="FirstDayOfWeek",e[e.WeekendRange]="WeekendRange",e[e.DateFormat]="DateFormat",e[e.TimeFormat]="TimeFormat",e[e.DateTimeFormat]="DateTimeFormat",e[e.NumberSymbols]="NumberSymbols",e[e.NumberFormats]="NumberFormats",e[e.CurrencyCode]="CurrencyCode",e[e.CurrencySymbol]="CurrencySymbol",e[e.CurrencyName]="CurrencyName",e[e.Currencies]="Currencies",e[e.Directionality]="Directionality",e[e.PluralCase]="PluralCase",e[e.ExtraData]="ExtraData",e}();function ls(e){var t;null==(t=e)&&function(e,t,n,r){throw new Error("ASSERTION ERROR: Expected localeId to be defined"+" [Expected=> null != ".concat(t," <=Actual]"))}(0,t),"string"==typeof e&&e.toLowerCase().replace(/_/g,"-")}var hs=new Map,fs=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;_classCallCheck(this,n),(i=t.call(this))._parent=r,i._bootstrapComponents=[],i.injector=_assertThisInitialized(i),i.destroyCbs=[],i.componentFactoryResolver=new es(_assertThisInitialized(i));var o=Et(e),a=e[We]||null;return a&&ls(a),i._bootstrapComponents=Un(o.bootstrap),i._r3Injector=ho(e,r,[{provide:rt,useValue:_assertThisInitialized(i)},{provide:Ca,useValue:i.componentFactoryResolver}],Ce(e)),i._r3Injector._resolveInjectorDefTypes(),i.instance=i.get(e),i}return _createClass(n,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_o.THROW_IF_NOT_FOUND,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:he.Default;return e===_o||e===rt||e===He?this:this._r3Injector.get(e,t,n)}},{key:"destroy",value:function(){var e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach((function(e){return e()})),this.destroyCbs=null}},{key:"onDestroy",value:function(e){this.destroyCbs.push(e)}}]),n}(rt),ds=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).moduleType=e,null!==Et(e)&&function e(t){if(null!==t.\u0275mod.id){var n=t.\u0275mod.id;(function(e,t,n){if(t&&t!==n)throw new Error("Duplicate module registered for ".concat(e," - ").concat(Ce(t)," vs ").concat(Ce(t.name)))})(n,hs.get(n),t),hs.set(n,t)}var r=t.\u0275mod.imports;r instanceof Function&&(r=r()),r&&r.forEach((function(t){return e(t)}))}(e),r}return _createClass(n,[{key:"create",value:function(e){return new fs(this.moduleType,e)}}]),n}(it),ps=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return _classCallCheck(this,n),(e=t.call(this)).__isAsync=r,e}return _createClass(n,[{key:"emit",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,e)}},{key:"subscribe",value:function(e,t,r){var i,o=function(e){return null},a=function(){return null};e&&"object"==typeof e?(i=this.__isAsync?function(t){setTimeout((function(){return e.next(t)}))}:function(t){e.next(t)},e.error&&(o=this.__isAsync?function(t){setTimeout((function(){return e.error(t)}))}:function(t){e.error(t)}),e.complete&&(a=this.__isAsync?function(){setTimeout((function(){return e.complete()}))}:function(){e.complete()})):(i=this.__isAsync?function(t){setTimeout((function(){return e(t)}))}:function(t){e(t)},t&&(o=this.__isAsync?function(e){setTimeout((function(){return t(e)}))}:function(e){t(e)}),r&&(a=this.__isAsync?function(){setTimeout((function(){return r()}))}:function(){r()}));var s=_get(_getPrototypeOf(n.prototype),"subscribe",this).call(this,i,o,a);return e instanceof f&&e.add(s),s}}]),n}(R);function vs(){return this._results[Io()]()}var ms=function(){function e(){_classCallCheck(this,e),this.dirty=!0,this._results=[],this.changes=new ps,this.length=0;var t=Io(),n=e.prototype;n[t]||(n[t]=vs)}return _createClass(e,[{key:"map",value:function(e){return this._results.map(e)}},{key:"filter",value:function(e){return this._results.filter(e)}},{key:"find",value:function(e){return this._results.find(e)}},{key:"reduce",value:function(e,t){return this._results.reduce(e,t)}},{key:"forEach",value:function(e){this._results.forEach(e)}},{key:"some",value:function(e){return this._results.some(e)}},{key:"toArray",value:function(){return this._results.slice()}},{key:"toString",value:function(){return this._results.toString()}},{key:"reset",value:function(e){this._results=function e(t,n){void 0===n&&(n=t);for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?(n===t&&(n=t.slice(0,r)),e(i,n)):n!==t&&n.push(i)}return n}(e),this.dirty=!1,this.length=this._results.length,this.last=this._results[this.length-1],this.first=this._results[0]}},{key:"notifyOnChanges",value:function(){this.changes.emit(this)}},{key:"setDirty",value:function(){this.dirty=!0}},{key:"destroy",value:function(){this.changes.complete(),this.changes.unsubscribe()}}]),e}(),gs=function(){function e(t){_classCallCheck(this,e),this.queryList=t,this.matches=null}return _createClass(e,[{key:"clone",value:function(){return new e(this.queryList)}},{key:"setDirty",value:function(){this.queryList.setDirty()}}]),e}(),ys=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.queries=t}return _createClass(e,[{key:"createEmbeddedView",value:function(t){var n=t.queries;if(null!==n){for(var r=null!==t.contentQueries?t.contentQueries[0]:n.length,i=[],o=0;o<r;o++){var a=n.getByIndex(o);i.push(this.queries[a.indexInDeclarationView].clone())}return new e(i)}return null}},{key:"insertView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"detachView",value:function(e){this.dirtyQueriesWithMatches(e)}},{key:"dirtyQueriesWithMatches",value:function(e){for(var t=0;t<this.queries.length;t++)null!==As(e,t).matches&&this.queries[t].setDirty()}}]),e}(),bs=function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;_classCallCheck(this,e),this.predicate=t,this.descendants=n,this.isStatic=r,this.read=i},_s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.queries=t}return _createClass(e,[{key:"elementStart",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].elementStart(e,t)}},{key:"elementEnd",value:function(e){for(var t=0;t<this.queries.length;t++)this.queries[t].elementEnd(e)}},{key:"embeddedTView",value:function(t){for(var n=null,r=0;r<this.length;r++){var i=null!==n?n.length:0,o=this.getByIndex(r).embeddedTView(t,i);o&&(o.indexInDeclarationView=r,null!==n?n.push(o):n=[o])}return null!==n?new e(n):null}},{key:"template",value:function(e,t){for(var n=0;n<this.queries.length;n++)this.queries[n].template(e,t)}},{key:"getByIndex",value:function(e){return this.queries[e]}},{key:"track",value:function(e){this.queries.push(e)}},{key:"length",get:function(){return this.queries.length}}]),e}(),ws=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;_classCallCheck(this,e),this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}return _createClass(e,[{key:"elementStart",value:function(e,t){this.isApplyingToNode(t)&&this.matchTNode(e,t)}},{key:"elementEnd",value:function(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}},{key:"template",value:function(e,t){this.elementStart(e,t)}},{key:"embeddedTView",value:function(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new e(this.metadata)):null}},{key:"isApplyingToNode",value:function(e){if(this._appliesToNextNode&&!1===this.metadata.descendants){for(var t=this._declarationNodeIndex,n=e.parent;null!==n&&4===n.type&&n.index!==t;)n=n.parent;return t===(null!==n?n.index:-1)}return this._appliesToNextNode}},{key:"matchTNode",value:function(e,t){if(Array.isArray(this.metadata.predicate))for(var n=this.metadata.predicate,r=0;r<n.length;r++)this.matchTNodeWithReadOption(e,t,xs(t,n[r]));else{var i=this.metadata.predicate;i===Qa?0===t.type&&this.matchTNodeWithReadOption(e,t,-1):this.matchTNodeWithReadOption(e,t,$n(t,e,i,!1,!1))}}},{key:"matchTNodeWithReadOption",value:function(e,t,n){if(null!==n){var r=this.metadata.read;if(null!==r)if(r===Ea||r===$a||r===Qa&&0===t.type)this.addMatch(t.index,-2);else{var i=$n(t,e,r,!1,!1);null!==i&&this.addMatch(t.index,i)}else this.addMatch(t.index,n)}}},{key:"addMatch",value:function(e,t){null===this.matches?this.matches=[e,t]:this.matches.push(e,t)}}]),e}();function xs(e,t){var n=e.localNames;if(null!==n)for(var r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function ks(e,t,n,r){return-1===n?function(e,t){return 3===e.type||4===e.type?eo(Ea,e,t):0===e.type?to(Qa,Ea,e,t):null}(t,e):-2===n?function(e,t,n){return n===Ea?eo(Ea,t,e):n===Qa?to(Qa,Ea,t,e):n===$a?no($a,Ea,t,e):void 0}(e,t,r):Zn(e,e[1],n,t)}function Cs(e,t,n,r){var i=t[19].queries[r];if(null===i.matches){for(var o=e.data,a=n.matches,s=[],u=0;u<a.length;u+=2){var c=a[u];s.push(c<0?null:ks(t,o[c],a[u+1],n.metadata.read))}i.matches=s}return i.matches}function Es(e){var t=Qt(),n=Yt(),r=un();cn(r+1);var i=As(n,r);if(e.dirty&&Vt(t)===i.metadata.isStatic){if(null===i.matches)e.reset([]);else{var o=i.crossesNgTemplate?function e(t,n,r,i){var o=t.queries.getByIndex(r),a=o.matches;if(null!==a)for(var s=Cs(t,n,o,r),u=0;u<a.length;u+=2){var c=a[u];if(c>0)i.push(s[u/2]);else{for(var l=a[u+1],h=n[-c],f=10;f<h.length;f++){var d=h[f];d[17]===d[3]&&e(d[1],d,l,i)}if(null!==h[9])for(var p=h[9],v=0;v<p.length;v++){var m=p[v];e(m[1],m,l,i)}}}return i}(n,t,r,[]):Cs(n,t,i,r);e.reset(o),e.notifyOnChanges()}return!0}return!1}function Ss(e,t,n){!function(e,t,n,r,i,o){e.firstCreatePass&&Ts(e,new bs(n,r,!1,i),-1),Rs(e,t)}(Yt(),Qt(),e,t,n)}function Is(){return e=Qt(),t=un(),e[19].queries[t].queryList;var e,t}function Rs(e,t){var n=new ms;!function(e,t,n,r){var i=ki(t);i.push(n),e.firstCreatePass&&Ci(e).push(r,i.length-1)}(e,t,n,n.destroy),null===t[19]&&(t[19]=new ys),t[19].queries.push(new gs(n))}function Ts(e,t,n){null===e.queries&&(e.queries=new _s),e.queries.track(new ws(t,n))}function As(e,t){return e.queries.getByIndex(t)}var Ds=new je("Application Initializer"),Ns=function(){var e=function(){function e(t){var n=this;_classCallCheck(this,e),this.appInits=t,this.initialized=!1,this.done=!1,this.donePromise=new Promise((function(e,t){n.resolve=e,n.reject=t}))}return _createClass(e,[{key:"runInitializers",value:function(){var e=this;if(!this.initialized){var t=[],n=function(){e.done=!0,e.resolve()};if(this.appInits)for(var r=0;r<this.appInits.length;r++){var i=this.appInits[r]();Ho(i)&&t.push(i)}Promise.all(t).then((function(){n()})).catch((function(t){e.reject(t)})),0===t.length&&n(),this.initialized=!0}}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Ze(Ds,8))},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}(),Os=new je("AppId"),Fs={provide:Os,useFactory:function(){return"".concat(Ps()).concat(Ps()).concat(Ps())},deps:[]};function Ps(){return String.fromCharCode(97+Math.floor(25*Math.random()))}var Ms=new je("Platform Initializer"),Ls=new je("Platform ID"),Bs=new je("appBootstrapListener"),Us=function(){var e=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"log",value:function(e){console.log(e)}},{key:"warn",value:function(e){console.warn(e)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}(),Ws=new je("LocaleId"),zs=new je("DefaultCurrencyCode"),Vs=function e(t,n){_classCallCheck(this,e),this.ngModuleFactory=t,this.componentFactories=n},js=function(e){return new ds(e)},Hs=js,qs=function(e){return Promise.resolve(js(e))},Gs=function(e){var t=js(e),n=Un(Et(e).declarations).reduce((function(e,t){var n=kt(t);return n&&e.push(new rs(n)),e}),[]);return new Vs(t,n)},Ks=Gs,Xs=function(e){return Promise.resolve(Gs(e))},Qs=function(){var e=function(){function e(){_classCallCheck(this,e),this.compileModuleSync=Hs,this.compileModuleAsync=qs,this.compileModuleAndAllComponentsSync=Ks,this.compileModuleAndAllComponentsAsync=Xs}return _createClass(e,[{key:"clearCache",value:function(){}},{key:"clearCacheFor",value:function(e){}},{key:"getModuleId",value:function(e){}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}(),Ys=new je("compilerOptions"),$s=Promise.resolve(0);function Zs(e){"undefined"==typeof Zone?$s.then((function(){e&&e.apply(null,null)})):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}var Js=function(){function e(t){var n,r,i=t.enableLongStackTrace,o=void 0!==i&&i,a=t.shouldCoalesceEventChangeDetection,s=void 0!==a&&a;if(_classCallCheck(this,e),this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new ps(!1),this.onMicrotaskEmpty=new ps(!1),this.onStable=new ps(!1),this.onError=new ps(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched(),this._nesting=0,this._outer=this._inner=Zone.current,Zone.wtfZoneSpec&&(this._inner=this._inner.fork(Zone.wtfZoneSpec)),Zone.TaskTrackingZoneSpec&&(this._inner=this._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(this._inner=this._inner.fork(Zone.longStackTraceZoneSpec)),this.shouldCoalesceEventChangeDetection=s,this.lastRequestAnimationFrameId=-1,this.nativeRequestAnimationFrame=function(){var e=Pe.requestAnimationFrame,t=Pe.cancelAnimationFrame;if("undefined"!=typeof Zone&&e&&t){var n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);var r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,r=!!(n=this).shouldCoalesceEventChangeDetection&&n.nativeRequestAnimationFrame&&function(){!function(e){-1===e.lastRequestAnimationFrameId&&(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Pe,(function(){e.lastRequestAnimationFrameId=-1,ru(e),nu(e)})),ru(e))}(n)},n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0,maybeDelayChangeDetection:r},onInvokeTask:function(e,t,i,o,a,s){try{return iu(n),e.invokeTask(i,o,a,s)}finally{r&&"eventTask"===o.type&&r(),ou(n)}},onInvoke:function(e,t,r,i,o,a,s){try{return iu(n),e.invoke(r,i,o,a,s)}finally{ou(n)}},onHasTask:function(e,t,r,i){e.hasTask(r,i),t===r&&("microTask"==i.change?(n._hasPendingMicrotasks=i.microTask,ru(n),nu(n)):"macroTask"==i.change&&(n.hasPendingMacrotasks=i.macroTask))},onHandleError:function(e,t,r,i){return e.handleError(r,i),n.runOutsideAngular((function(){return n.onError.emit(i)})),!1}})}return _createClass(e,[{key:"run",value:function(e,t,n){return this._inner.run(e,t,n)}},{key:"runTask",value:function(e,t,n,r){var i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,e,tu,eu,eu);try{return i.runTask(o,t,n)}finally{i.cancelTask(o)}}},{key:"runGuarded",value:function(e,t,n){return this._inner.runGuarded(e,t,n)}},{key:"runOutsideAngular",value:function(e){return this._outer.run(e)}}],[{key:"isInAngularZone",value:function(){return!0===Zone.current.get("isAngularZone")}},{key:"assertInAngularZone",value:function(){if(!e.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}},{key:"assertNotInAngularZone",value:function(){if(e.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}}]),e}();function eu(){}var tu={};function nu(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular((function(){return e.onStable.emit(null)}))}finally{e.isStable=!0}}}function ru(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||e.shouldCoalesceEventChangeDetection&&-1!==e.lastRequestAnimationFrameId)}function iu(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function ou(e){e._nesting--,nu(e)}var au,su=function(){function e(){_classCallCheck(this,e),this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new ps,this.onMicrotaskEmpty=new ps,this.onStable=new ps,this.onError=new ps}return _createClass(e,[{key:"run",value:function(e,t,n){return e.apply(t,n)}},{key:"runGuarded",value:function(e,t,n){return e.apply(t,n)}},{key:"runOutsideAngular",value:function(e){return e()}},{key:"runTask",value:function(e,t,n,r){return e.apply(t,n)}}]),e}(),uu=function(){var e=function(){function e(t){var n=this;_classCallCheck(this,e),this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run((function(){n.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")}))}return _createClass(e,[{key:"_watchAngularEvents",value:function(){var e=this;this._ngZone.onUnstable.subscribe({next:function(){e._didWork=!0,e._isZoneStable=!1}}),this._ngZone.runOutsideAngular((function(){e._ngZone.onStable.subscribe({next:function(){Js.assertNotInAngularZone(),Zs((function(){e._isZoneStable=!0,e._runCallbacksIfReady()}))}})}))}},{key:"increasePendingRequestCount",value:function(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}},{key:"decreasePendingRequestCount",value:function(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}},{key:"isStable",value:function(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}},{key:"_runCallbacksIfReady",value:function(){var e=this;if(this.isStable())Zs((function(){for(;0!==e._callbacks.length;){var t=e._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(e._didWork)}e._didWork=!1}));else{var t=this.getPendingTasks();this._callbacks=this._callbacks.filter((function(e){return!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)})),this._didWork=!0}}},{key:"getPendingTasks",value:function(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map((function(e){return{source:e.source,creationLocation:e.creationLocation,data:e.data}})):[]}},{key:"addCallback",value:function(e,t,n){var r=this,i=-1;t&&t>0&&(i=setTimeout((function(){r._callbacks=r._callbacks.filter((function(e){return e.timeoutId!==i})),e(r._didWork,r.getPendingTasks())}),t)),this._callbacks.push({doneCb:e,timeoutId:i,updateCb:n})}},{key:"whenStable",value:function(e,t,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(e,t,n),this._runCallbacksIfReady()}},{key:"getPendingRequestCount",value:function(){return this._pendingCount}},{key:"findProviders",value:function(e,t,n){return[]}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Ze(Js))},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}(),cu=function(){var e=function(){function e(){_classCallCheck(this,e),this._applications=new Map,lu.addToWindow(this)}return _createClass(e,[{key:"registerApplication",value:function(e,t){this._applications.set(e,t)}},{key:"unregisterApplication",value:function(e){this._applications.delete(e)}},{key:"unregisterAllApplications",value:function(){this._applications.clear()}},{key:"getTestability",value:function(e){return this._applications.get(e)||null}},{key:"getAllTestabilities",value:function(){return Array.from(this._applications.values())}},{key:"getAllRootElements",value:function(){return Array.from(this._applications.keys())}},{key:"findTestabilityInTree",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return lu.findTestabilityInTree(this,e,t)}}]),e}();return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}(),lu=new(function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){}},{key:"findTestabilityInTree",value:function(e,t,n){return null}}]),e}()),hu=function(e,t,n){var r=e.get(Ys,[]).concat(t),i=new ds(n);if(0===xo.size)return Promise.resolve(i);var o,a,s=(o=r.map((function(e){return e.providers})),a=[],o.forEach((function(e){return e&&a.push.apply(a,_toConsumableArray(e))})),a);if(0===s.length)return Promise.resolve(i);var u=function(){var e=Pe.ng;if(!e||!e.\u0275compilerFacade)throw new Error("Angular JIT compilation failed: '@angular/compiler' not loaded!\n  - JIT compilation is discouraged for production use-cases! Consider AOT mode instead.\n  - Did you bootstrap using '@angular/platform-browser-dynamic' or '@angular/platform-server'?\n  - Alternatively provide the compiler with 'import \"@angular/compiler\";' before bootstrapping.");return e.\u0275compilerFacade}(),c=_o.create({providers:s}).get(u.ResourceLoader);return function(e){var t=[],n=new Map;function r(e){var t=n.get(e);if(!t){var r=function(e){return Promise.resolve(c.get(e))}(e);n.set(e,t=r.then(Co))}return t}return xo.forEach((function(e,n){var i=[];e.templateUrl&&i.push(r(e.templateUrl).then((function(t){e.template=t})));var o=e.styleUrls,a=e.styles||(e.styles=[]),s=e.styles.length;o&&o.forEach((function(t,n){a.push(""),i.push(r(t).then((function(r){a[s+n]=r,o.splice(o.indexOf(t),1),0==o.length&&(e.styleUrls=void 0)})))}));var u=Promise.all(i).then((function(){return function(e){ko.delete(e)}(n)}));t.push(u)})),xo=new Map,Promise.all(t).then((function(){}))}().then((function(){return i}))},fu=new je("AllowMultipleToken"),du=function e(t,n){_classCallCheck(this,e),this.name=t,this.token=n};function pu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r="Platform: "+t,i=new je(r);return function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],o=vu();if(!o||o.injector.get(fu,!1))if(e)e(n.concat(t).concat({provide:i,useValue:!0}));else{var a=n.concat(t).concat({provide:i,useValue:!0},{provide:oo,useValue:"platform"});!function(e){if(au&&!au.destroyed&&!au.injector.get(fu,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");au=e.get(mu);var t=e.get(Ms,null);t&&t.forEach((function(e){return e()}))}(_o.create({providers:a,name:r}))}return function(e){var t=vu();if(!t)throw new Error("No platform exists!");if(!t.injector.get(e,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return t}(i)}}function vu(){return au&&!au.destroyed?au:null}var mu=function(){var e=function(){function e(t){_classCallCheck(this,e),this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}return _createClass(e,[{key:"bootstrapModuleFactory",value:function(e,t){var n,r,i=this,o=(n=t?t.ngZone:void 0,r=t&&t.ngZoneEventCoalescing||!1,"noop"===n?new su:("zone.js"===n?void 0:n)||new Js({enableLongStackTrace:lr(),shouldCoalesceEventChangeDetection:r})),a=[{provide:Js,useValue:o}];return o.run((function(){var t=_o.create({providers:a,parent:i.injector,name:e.moduleType.name}),n=e.create(t),r=n.injector.get(or,null);if(!r)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.onDestroy((function(){return _u(i._modules,n)})),o.runOutsideAngular((function(){return o.onError.subscribe({next:function(e){r.handleError(e)}})})),function(e,t,r){try{var o=((a=n.injector.get(Ns)).runInitializers(),a.donePromise.then((function(){return ls(n.injector.get(Ws,"en-US")||"en-US"),i._moduleDoBootstrap(n),n})));return Ho(o)?o.catch((function(n){throw t.runOutsideAngular((function(){return e.handleError(n)})),n})):o}catch(s){throw t.runOutsideAngular((function(){return e.handleError(s)})),s}var a}(r,o)}))}},{key:"bootstrapModule",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=gu({},n);return hu(this.injector,r,e).then((function(e){return t.bootstrapModuleFactory(e,r)}))}},{key:"_moduleDoBootstrap",value:function(e){var t=e.injector.get(bu);if(e._bootstrapComponents.length>0)e._bootstrapComponents.forEach((function(e){return t.bootstrap(e)}));else{if(!e.instance.ngDoBootstrap)throw new Error("The module ".concat(Ce(e.instance.constructor),' was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.'));e.instance.ngDoBootstrap(t)}this._modules.push(e)}},{key:"onDestroy",value:function(e){this._destroyListeners.push(e)}},{key:"destroy",value:function(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach((function(e){return e.destroy()})),this._destroyListeners.forEach((function(e){return e()})),this._destroyed=!0}},{key:"injector",get:function(){return this._injector}},{key:"destroyed",get:function(){return this._destroyed}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Ze(_o))},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}();function gu(e,t){return Array.isArray(t)?t.reduce(gu,e):Object.assign(Object.assign({},e),t)}var yu,bu=((yu=function(){function e(t,n,r,i,o,a){var s=this;_classCallCheck(this,e),this._zone=t,this._console=n,this._injector=r,this._exceptionHandler=i,this._componentFactoryResolver=o,this._initStatus=a,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._enforceNoNewChanges=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._enforceNoNewChanges=lr(),this._zone.onMicrotaskEmpty.subscribe({next:function(){s._zone.run((function(){s.tick()}))}});var u=new x((function(e){s._stable=s._zone.isStable&&!s._zone.hasPendingMacrotasks&&!s._zone.hasPendingMicrotasks,s._zone.runOutsideAngular((function(){e.next(s._stable),e.complete()}))})),c=new x((function(e){var t;s._zone.runOutsideAngular((function(){t=s._zone.onStable.subscribe((function(){Js.assertNotInAngularZone(),Zs((function(){s._stable||s._zone.hasPendingMacrotasks||s._zone.hasPendingMicrotasks||(s._stable=!0,e.next(!0))}))}))}));var n=s._zone.onUnstable.subscribe((function(){Js.assertInAngularZone(),s._stable&&(s._stable=!1,s._zone.runOutsideAngular((function(){e.next(!1)})))}));return function(){t.unsubscribe(),n.unsubscribe()}}));this.isStable=Q(u,c.pipe((function(e){return Y()(ne(ie)(e))})))}return _createClass(e,[{key:"bootstrap",value:function(e,t){var n,r=this;if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");n=e instanceof xa?e:this._componentFactoryResolver.resolveComponentFactory(e),this.componentTypes.push(n.componentType);var i=function(e){return e.isBoundToModule}(n)?void 0:this._injector.get(rt),o=n.create(_o.NULL,[],t||n.selector,i);o.onDestroy((function(){r._unloadComponent(o)}));var a=o.injector.get(uu,null);return a&&o.injector.get(cu).registerApplication(o.location.nativeElement,a),this._loadComponent(o),lr()&&this._console.log("Angular is running in the development mode. Call enableProdMode() to enable the production mode."),o}},{key:"tick",value:function(){var e=this;if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;var t,n=_createForOfIteratorHelper(this._views);try{for(n.s();!(t=n.n()).done;)t.value.detectChanges()}catch(o){n.e(o)}finally{n.f()}if(this._enforceNoNewChanges){var r,i=_createForOfIteratorHelper(this._views);try{for(i.s();!(r=i.n()).done;)r.value.checkNoChanges()}catch(o){i.e(o)}finally{i.f()}}}catch(a){this._zone.runOutsideAngular((function(){return e._exceptionHandler.handleError(a)}))}finally{this._runningTick=!1}}},{key:"attachView",value:function(e){var t=e;this._views.push(t),t.attachToAppRef(this)}},{key:"detachView",value:function(e){var t=e;_u(this._views,t),t.detachFromAppRef()}},{key:"_loadComponent",value:function(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Bs,[]).concat(this._bootstrapListeners).forEach((function(t){return t(e)}))}},{key:"_unloadComponent",value:function(e){this.detachView(e.hostView),_u(this.components,e)}},{key:"ngOnDestroy",value:function(){this._views.slice().forEach((function(e){return e.destroy()}))}},{key:"viewCount",get:function(){return this._views.length}}]),e}()).\u0275fac=function(e){return new(e||yu)(Ze(Js),Ze(Us),Ze(_o),Ze(or),Ze(Ca),Ze(Ns))},yu.\u0275prov=pe({token:yu,factory:yu.\u0275fac}),yu);function _u(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}var wu=function e(){_classCallCheck(this,e)},xu=function e(){_classCallCheck(this,e)},ku={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"},Cu=function(){var e=function(){function e(t,n){_classCallCheck(this,e),this._compiler=t,this._config=n||ku}return _createClass(e,[{key:"load",value:function(e){return this.loadAndCompile(e)}},{key:"loadAndCompile",value:function(e){var t=this,r=_slicedToArray(e.split("#"),2),i=r[0],o=r[1];return void 0===o&&(o="default"),n("zn8P")(i).then((function(e){return e[o]})).then((function(e){return Eu(e,i,o)})).then((function(e){return t._compiler.compileModuleAsync(e)}))}},{key:"loadFactory",value:function(e){var t=_slicedToArray(e.split("#"),2),r=t[0],i=t[1],o="NgFactory";return void 0===i&&(i="default",o=""),n("zn8P")(this._config.factoryPathPrefix+r+this._config.factoryPathSuffix).then((function(e){return e[i+o]})).then((function(e){return Eu(e,r,i)}))}}]),e}();return e.\u0275fac=function(t){return new(t||e)(Ze(Qs),Ze(xu,8))},e.\u0275prov=pe({token:e,factory:e.\u0275fac}),e}();function Eu(e,t,n){if(!e)throw new Error("Cannot find '".concat(n,"' in '").concat(t,"'"));return e}var Su=pu(null,"core",[{provide:Ls,useValue:"unknown"},{provide:mu,deps:[_o]},{provide:cu,deps:[]},{provide:Us,deps:[]}]),Iu=[{provide:bu,useClass:bu,deps:[Js,Us,_o,or,Ca,Ns]},{provide:ns,deps:[Js],useFactory:function(e){var t=[];return e.onStable.subscribe((function(){for(;t.length;)t.pop()()})),function(e){t.push(e)}}},{provide:Ns,useClass:Ns,deps:[[new ue,Ds]]},{provide:Qs,useClass:Qs,deps:[]},Fs,{provide:Ha,useFactory:function(){return Ka},deps:[]},{provide:qa,useFactory:function(){return Xa},deps:[]},{provide:Ws,useFactory:function(e){return ls(e=e||"undefined"!=typeof $localize&&$localize.locale||"en-US"),e},deps:[[new se(Ws),new ue,new le]]},{provide:zs,useValue:"USD"}],Ru=function(){var e=function e(t){_classCallCheck(this,e)};return e.\u0275mod=_t({type:e}),e.\u0275inj=ve({factory:function(t){return new(t||e)(Ze(bu))},providers:Iu}),e}(),Tu=null;function Au(){return Tu}var Du,Nu=new je("DocumentToken"),Ou=((Du=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Du)},Du.\u0275prov=pe({factory:Fu,token:Du,providedIn:"platform"}),Du);function Fu(){return Ze(Lu)}var Pu,Mu=new je("Location Initialized"),Lu=((Pu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._init(),r}return _createClass(n,[{key:"_init",value:function(){this.location=Au().getLocation(),this._history=Au().getHistory()}},{key:"getBaseHrefFromDOM",value:function(){return Au().getBaseHref(this._doc)}},{key:"onPopState",value:function(e){Au().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",e,!1)}},{key:"onHashChange",value:function(e){Au().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",e,!1)}},{key:"pushState",value:function(e,t,n){Bu()?this._history.pushState(e,t,n):this.location.hash=n}},{key:"replaceState",value:function(e,t,n){Bu()?this._history.replaceState(e,t,n):this.location.hash=n}},{key:"forward",value:function(){this._history.forward()}},{key:"back",value:function(){this._history.back()}},{key:"getState",value:function(){return this._history.state}},{key:"href",get:function(){return this.location.href}},{key:"protocol",get:function(){return this.location.protocol}},{key:"hostname",get:function(){return this.location.hostname}},{key:"port",get:function(){return this.location.port}},{key:"pathname",get:function(){return this.location.pathname},set:function(e){this.location.pathname=e}},{key:"search",get:function(){return this.location.search}},{key:"hash",get:function(){return this.location.hash}}]),n}(Ou)).\u0275fac=function(e){return new(e||Pu)(Ze(Nu))},Pu.\u0275prov=pe({factory:Uu,token:Pu,providedIn:"platform"}),Pu);function Bu(){return!!window.history.pushState}function Uu(){return new Lu(Ze(Nu))}function Wu(e,t){if(0==e.length)return t;if(0==t.length)return e;var n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function zu(e){var t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Vu(e){return e&&"?"!==e[0]?"?"+e:e}var ju,Hu=((ju=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||ju)},ju.\u0275prov=pe({factory:qu,token:ju,providedIn:"root"}),ju);function qu(e){var t=Ze(Nu).location;return new Yu(Ze(Ou),t&&t.origin||"")}var Gu,Ku,Xu,Qu=new je("appBaseHref"),Yu=((Xu=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;if(_classCallCheck(this,n),(i=t.call(this))._platformLocation=e,null==r&&(r=i._platformLocation.getBaseHrefFromDOM()),null==r)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");return i._baseHref=r,_possibleConstructorReturn(i)}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"prepareExternalUrl",value:function(e){return Wu(this._baseHref,e)}},{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this._platformLocation.pathname+Vu(this._platformLocation.search),n=this._platformLocation.hash;return n&&e?"".concat(t).concat(n):t}},{key:"pushState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+Vu(r));this._platformLocation.pushState(e,t,i)}},{key:"replaceState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+Vu(r));this._platformLocation.replaceState(e,t,i)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Hu)).\u0275fac=function(e){return new(e||Xu)(Ze(Ou),Ze(Qu,8))},Xu.\u0275prov=pe({token:Xu,factory:Xu.\u0275fac}),Xu),$u=((Ku=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this))._platformLocation=e,i._baseHref="",null!=r&&(i._baseHref=r),i}return _createClass(n,[{key:"onPopState",value:function(e){this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e)}},{key:"getBaseHref",value:function(){return this._baseHref}},{key:"path",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}},{key:"prepareExternalUrl",value:function(e){var t=Wu(this._baseHref,e);return t.length>0?"#"+t:t}},{key:"pushState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+Vu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(e,t,i)}},{key:"replaceState",value:function(e,t,n,r){var i=this.prepareExternalUrl(n+Vu(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(e,t,i)}},{key:"forward",value:function(){this._platformLocation.forward()}},{key:"back",value:function(){this._platformLocation.back()}}]),n}(Hu)).\u0275fac=function(e){return new(e||Ku)(Ze(Ou),Ze(Qu,8))},Ku.\u0275prov=pe({token:Ku,factory:Ku.\u0275fac}),Ku),Zu=((Gu=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._subject=new ps,this._urlChangeListeners=[],this._platformStrategy=t;var i=this._platformStrategy.getBaseHref();this._platformLocation=n,this._baseHref=zu(ec(i)),this._platformStrategy.onPopState((function(e){r._subject.emit({url:r.path(!0),pop:!0,state:e.state,type:e.type})}))}return _createClass(e,[{key:"path",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.normalize(this._platformStrategy.path(e))}},{key:"getState",value:function(){return this._platformLocation.getState()}},{key:"isCurrentPathEqualTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return this.path()==this.normalize(e+Vu(t))}},{key:"normalize",value:function(t){return e.stripTrailingSlash(function(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._baseHref,ec(t)))}},{key:"prepareExternalUrl",value:function(e){return e&&"/"!==e[0]&&(e="/"+e),this._platformStrategy.prepareExternalUrl(e)}},{key:"go",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.pushState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Vu(t)),n)}},{key:"replaceState",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._platformStrategy.replaceState(n,"",e,t),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Vu(t)),n)}},{key:"forward",value:function(){this._platformStrategy.forward()}},{key:"back",value:function(){this._platformStrategy.back()}},{key:"onUrlChange",value:function(e){var t=this;this._urlChangeListeners.push(e),this.subscribe((function(e){t._notifyUrlChangeListeners(e.url,e.state)}))}},{key:"_notifyUrlChangeListeners",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;this._urlChangeListeners.forEach((function(n){return n(e,t)}))}},{key:"subscribe",value:function(e,t,n){return this._subject.subscribe({next:e,error:t,complete:n})}}]),e}()).\u0275fac=function(e){return new(e||Gu)(Ze(Hu),Ze(Ou))},Gu.normalizeQueryParams=Vu,Gu.joinWithSlash=Wu,Gu.stripTrailingSlash=zu,Gu.\u0275prov=pe({factory:Ju,token:Gu,providedIn:"root"}),Gu);function Ju(){return new Zu(Ze(Hu),Ze(Ou))}function ec(e){return e.replace(/\/index.html$/,"")}var tc,nc,rc,ic=function(){var e={Zero:0,One:1,Two:2,Few:3,Many:4,Other:5};return e[e.Zero]="Zero",e[e.One]="One",e[e.Two]="Two",e[e.Few]="Few",e[e.Many]="Many",e[e.Other]="Other",e}(),oc=function e(){_classCallCheck(this,e)},ac=((tc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this)).locale=e,r}return _createClass(n,[{key:"getPluralCategory",value:function(e,t){switch(function(e){return function(e){var t=function(e){return e.toLowerCase().replace(/_/g,"-")}(e),n=us(t);if(n)return n;var r=t.split("-")[0];if(n=us(r))return n;if("en"===r)return as;throw new Error('Missing locale data for the locale "'.concat(e,'".'))}(e)[cs.PluralCase]}(t||this.locale)(e)){case ic.Zero:return"zero";case ic.One:return"one";case ic.Two:return"two";case ic.Few:return"few";case ic.Many:return"many";default:return"other"}}}]),n}(oc)).\u0275fac=function(e){return new(e||tc)(Ze(Ws))},tc.\u0275prov=pe({token:tc,factory:tc.\u0275fac}),tc),sc=function(){function e(t,n,r,i){_classCallCheck(this,e),this.$implicit=t,this.ngForOf=n,this.index=r,this.count=i}return _createClass(e,[{key:"first",get:function(){return 0===this.index}},{key:"last",get:function(){return this.index===this.count-1}},{key:"even",get:function(){return this.index%2==0}},{key:"odd",get:function(){return!this.even}}]),e}(),uc=((nc=function(){function e(t,n,r){_classCallCheck(this,e),this._viewContainer=t,this._template=n,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._ngForOfDirty){this._ngForOfDirty=!1;var e=this._ngForOf;if(!this._differ&&e)try{this._differ=this._differs.find(e).create(this.ngForTrackBy)}catch(r){throw new Error("Cannot find a differ supporting object '".concat(e,"' of type '").concat((t=e).name||typeof t,"'. NgFor only supports binding to Iterables such as Arrays."))}}var t;if(this._differ){var n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}},{key:"_applyChanges",value:function(e){var t=this,n=[];e.forEachOperation((function(e,r,i){if(null==e.previousIndex){var o=t._viewContainer.createEmbeddedView(t._template,new sc(null,t._ngForOf,-1,-1),null===i?void 0:i),a=new cc(e,o);n.push(a)}else if(null==i)t._viewContainer.remove(null===r?void 0:r);else if(null!==r){var s=t._viewContainer.get(r);t._viewContainer.move(s,i);var u=new cc(e,s);n.push(u)}}));for(var r=0;r<n.length;r++)this._perViewChange(n[r].view,n[r].record);for(var i=0,o=this._viewContainer.length;i<o;i++){var a=this._viewContainer.get(i);a.context.index=i,a.context.count=o,a.context.ngForOf=this._ngForOf}e.forEachIdentityChange((function(e){t._viewContainer.get(e.currentIndex).context.$implicit=e.item}))}},{key:"_perViewChange",value:function(e,t){e.context.$implicit=t.item}},{key:"ngForOf",set:function(e){this._ngForOf=e,this._ngForOfDirty=!0}},{key:"ngForTrackBy",set:function(e){lr()&&null!=e&&"function"!=typeof e&&console&&console.warn&&console.warn("trackBy must be a function, but received ".concat(JSON.stringify(e),". See https://angular.io/api/common/NgForOf#change-propagation for more information.")),this._trackByFn=e},get:function(){return this._trackByFn}},{key:"ngForTemplate",set:function(e){e&&(this._template=e)}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}()).\u0275fac=function(e){return new(e||nc)(Mo($a),Mo(Qa),Mo(Ha))},nc.\u0275dir=xt({type:nc,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),nc),cc=function e(t,n){_classCallCheck(this,e),this.record=t,this.view=n},lc=((rc=function(){function e(t,n){_classCallCheck(this,e),this._viewContainer=t,this._context=new hc,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=n}return _createClass(e,[{key:"_updateView",value:function(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}},{key:"ngIf",set:function(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}},{key:"ngIfThen",set:function(e){fc("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}},{key:"ngIfElse",set:function(e){fc("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}}],[{key:"ngTemplateContextGuard",value:function(e,t){return!0}}]),e}()).\u0275fac=function(e){return new(e||rc)(Mo($a),Mo(Qa))},rc.\u0275dir=xt({type:rc,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),rc),hc=function e(){_classCallCheck(this,e),this.$implicit=null,this.ngIf=null};function fc(e,t){if(t&&!t.createEmbeddedView)throw new Error("".concat(e," must be a TemplateRef, but received '").concat(Ce(t),"'."))}var dc,pc,vc=((pc=function(){function e(t,n,r){_classCallCheck(this,e),this._ngEl=t,this._differs=n,this._renderer=r,this._ngStyle=null,this._differ=null}return _createClass(e,[{key:"ngDoCheck",value:function(){if(this._differ){var e=this._differ.diff(this._ngStyle);e&&this._applyChanges(e)}}},{key:"_setStyle",value:function(e,t){var n=_slicedToArray(e.split("."),2),r=n[0],i=n[1];null!=(t=null!=t&&i?"".concat(t).concat(i):t)?this._renderer.setStyle(this._ngEl.nativeElement,r,t):this._renderer.removeStyle(this._ngEl.nativeElement,r)}},{key:"_applyChanges",value:function(e){var t=this;e.forEachRemovedItem((function(e){return t._setStyle(e.key,null)})),e.forEachAddedItem((function(e){return t._setStyle(e.key,e.currentValue)})),e.forEachChangedItem((function(e){return t._setStyle(e.key,e.currentValue)}))}},{key:"ngStyle",set:function(e){this._ngStyle=e,!this._differ&&e&&(this._differ=this._differs.find(e).create())}}]),e}()).\u0275fac=function(e){return new(e||pc)(Mo(Ea),Mo(qa),Mo(Ta))},pc.\u0275dir=xt({type:pc,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),pc),mc=((dc=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:dc}),dc.\u0275inj=ve({factory:function(e){return new(e||dc)},providers:[{provide:oc,useClass:ac}]}),dc);function gc(e){return"browser"===e}var yc,bc,_c,wc,xc,kc=((yc=function e(){_classCallCheck(this,e)}).\u0275prov=pe({token:yc,providedIn:"root",factory:function(){return new Cc(Ze(Nu),window,Ze(or))}}),yc),Cc=function(){function e(t,n,r){_classCallCheck(this,e),this.document=t,this.window=n,this.errorHandler=r,this.offset=function(){return[0,0]}}return _createClass(e,[{key:"setOffset",value:function(e){this.offset=Array.isArray(e)?function(){return e}:e}},{key:"getScrollPosition",value:function(){return this.supportScrollRestoration()?[this.window.scrollX,this.window.scrollY]:[0,0]}},{key:"scrollToPosition",value:function(e){this.supportScrollRestoration()&&this.window.scrollTo(e[0],e[1])}},{key:"scrollToAnchor",value:function(e){if(this.supportScrollRestoration()){e=this.window.CSS&&this.window.CSS.escape?this.window.CSS.escape(e):e.replace(/(\"|\'\ |:|\.|\[|\]|,|=)/g,"\\$1");try{var t=this.document.querySelector("#"+e);if(t)return void this.scrollToElement(t);var n=this.document.querySelector("[name='".concat(e,"']"));if(n)return void this.scrollToElement(n)}catch(r){this.errorHandler.handleError(r)}}}},{key:"setHistoryScrollRestoration",value:function(e){if(this.supportScrollRestoration()){var t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}},{key:"scrollToElement",value:function(e){var t=e.getBoundingClientRect(),n=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}},{key:"supportScrollRestoration",value:function(){try{return!!this.window&&!!this.window.scrollTo}catch(e){return!1}}}]),e}(),Ec=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"getProperty",value:function(e,t){return e[t]}},{key:"log",value:function(e){window.console&&window.console.log&&window.console.log(e)}},{key:"logGroup",value:function(e){window.console&&window.console.group&&window.console.group(e)}},{key:"logGroupEnd",value:function(){window.console&&window.console.groupEnd&&window.console.groupEnd()}},{key:"onAndCancel",value:function(e,t,n){return e.addEventListener(t,n,!1),function(){e.removeEventListener(t,n,!1)}}},{key:"dispatchEvent",value:function(e,t){e.dispatchEvent(t)}},{key:"remove",value:function(e){return e.parentNode&&e.parentNode.removeChild(e),e}},{key:"getValue",value:function(e){return e.value}},{key:"createElement",value:function(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}},{key:"createHtmlDocument",value:function(){return document.implementation.createHTMLDocument("fakeTitle")}},{key:"getDefaultDocument",value:function(){return document}},{key:"isElementNode",value:function(e){return e.nodeType===Node.ELEMENT_NODE}},{key:"isShadowRoot",value:function(e){return e instanceof DocumentFragment}},{key:"getGlobalEventTarget",value:function(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}},{key:"getHistory",value:function(){return window.history}},{key:"getLocation",value:function(){return window.location}},{key:"getBaseHref",value:function(e){var t,n=Sc||(Sc=document.querySelector("base"))?Sc.getAttribute("href"):null;return null==n?null:(t=n,bc||(bc=document.createElement("a")),bc.setAttribute("href",t),"/"===bc.pathname.charAt(0)?bc.pathname:"/"+bc.pathname)}},{key:"resetBaseElement",value:function(){Sc=null}},{key:"getUserAgent",value:function(){return window.navigator.userAgent}},{key:"performanceNow",value:function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}},{key:"supportsCookies",value:function(){return!0}},{key:"getCookie",value:function(e){return function(e,t){t=encodeURIComponent(t);var n,r=_createForOfIteratorHelper(e.split(";"));try{for(r.s();!(n=r.n()).done;){var i=n.value,o=i.indexOf("="),a=_slicedToArray(-1==o?[i,""]:[i.slice(0,o),i.slice(o+1)],2),s=a[0],u=a[1];if(s.trim()===t)return decodeURIComponent(u)}}catch(c){r.e(c)}finally{r.f()}return null}(document.cookie,e)}}],[{key:"makeCurrent",value:function(){var e;e=new n,Tu||(Tu=e)}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.call(this)}return _createClass(n,[{key:"supportsDOMEvents",value:function(){return!0}}]),n}(function(){return function e(){_classCallCheck(this,e)}}())),Sc=null,Ic=new je("TRANSITION_ID"),Rc=[{provide:Ds,useFactory:function(e,t,n){return function(){n.get(Ns).donePromise.then((function(){var n=Au();Array.prototype.slice.apply(t.querySelectorAll("style[ng-transition]")).filter((function(t){return t.getAttribute("ng-transition")===e})).forEach((function(e){return n.remove(e)}))}))}},deps:[Ic,Nu,_o],multi:!0}],Tc=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"addToWindow",value:function(e){Pe.getAngularTestability=function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e.findTestabilityInTree(t,n);if(null==r)throw new Error("Could not find testability for element.");return r},Pe.getAllAngularTestabilities=function(){return e.getAllTestabilities()},Pe.getAllAngularRootElements=function(){return e.getAllRootElements()},Pe.frameworkStabilizers||(Pe.frameworkStabilizers=[]),Pe.frameworkStabilizers.push((function(e){var t=Pe.getAllAngularTestabilities(),n=t.length,r=!1,i=function(t){r=r||t,0==--n&&e(r)};t.forEach((function(e){e.whenStable(i)}))}))}},{key:"findTestabilityInTree",value:function(e,t,n){if(null==t)return null;var r=e.getTestability(t);return null!=r?r:n?Au().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null}}],[{key:"init",value:function(){var t;t=new e,lu=t}}]),e}(),Ac=new je("EventManagerPlugins"),Dc=((_c=function(){function e(t,n){var r=this;_classCallCheck(this,e),this._zone=n,this._eventNameToPlugin=new Map,t.forEach((function(e){return e.manager=r})),this._plugins=t.slice().reverse()}return _createClass(e,[{key:"addEventListener",value:function(e,t,n){return this._findPluginFor(t).addEventListener(e,t,n)}},{key:"addGlobalEventListener",value:function(e,t,n){return this._findPluginFor(t).addGlobalEventListener(e,t,n)}},{key:"getZone",value:function(){return this._zone}},{key:"_findPluginFor",value:function(e){var t=this._eventNameToPlugin.get(e);if(t)return t;for(var n=this._plugins,r=0;r<n.length;r++){var i=n[r];if(i.supports(e))return this._eventNameToPlugin.set(e,i),i}throw new Error("No event manager plugin found for event "+e)}}]),e}()).\u0275fac=function(e){return new(e||_c)(Ze(Ac),Ze(Js))},_c.\u0275prov=pe({token:_c,factory:_c.\u0275fac}),_c),Nc=function(){function e(t){_classCallCheck(this,e),this._doc=t}return _createClass(e,[{key:"addGlobalEventListener",value:function(e,t,n){var r=Au().getGlobalEventTarget(this._doc,e);if(!r)throw new Error("Unsupported event target ".concat(r," for event ").concat(t));return this.addEventListener(r,t,n)}}]),e}(),Oc=((xc=function(){function e(){_classCallCheck(this,e),this._stylesSet=new Set}return _createClass(e,[{key:"addStyles",value:function(e){var t=this,n=new Set;e.forEach((function(e){t._stylesSet.has(e)||(t._stylesSet.add(e),n.add(e))})),this.onStylesAdded(n)}},{key:"onStylesAdded",value:function(e){}},{key:"getAllStyles",value:function(){return Array.from(this._stylesSet)}}]),e}()).\u0275fac=function(e){return new(e||xc)},xc.\u0275prov=pe({token:xc,factory:xc.\u0275fac}),xc),Fc=((wc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._doc=e,r._hostNodes=new Set,r._styleNodes=new Set,r._hostNodes.add(e.head),r}return _createClass(n,[{key:"_addStylesToHost",value:function(e,t){var n=this;e.forEach((function(e){var r=n._doc.createElement("style");r.textContent=e,n._styleNodes.add(t.appendChild(r))}))}},{key:"addHost",value:function(e){this._addStylesToHost(this._stylesSet,e),this._hostNodes.add(e)}},{key:"removeHost",value:function(e){this._hostNodes.delete(e)}},{key:"onStylesAdded",value:function(e){var t=this;this._hostNodes.forEach((function(n){return t._addStylesToHost(e,n)}))}},{key:"ngOnDestroy",value:function(){this._styleNodes.forEach((function(e){return Au().remove(e)}))}}]),n}(Oc)).\u0275fac=function(e){return new(e||wc)(Ze(Nu))},wc.\u0275prov=pe({token:wc,factory:wc.\u0275fac}),wc),Pc={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Mc=/%COMP%/g;function Lc(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];Array.isArray(i)?Lc(e,i,n):(i=i.replace(Mc,e),n.push(i))}return n}function Bc(e){return function(t){if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}var Uc,Wc,zc,Vc,jc=((Uc=function(){function e(t,n,r){_classCallCheck(this,e),this.eventManager=t,this.sharedStylesHost=n,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new Hc(t)}return _createClass(e,[{key:"createRenderer",value:function(e,t){if(!e||!t)return this.defaultRenderer;switch(t.encapsulation){case ft.Emulated:var n=this.rendererByCompId.get(t.id);return n||(n=new qc(this.eventManager,this.sharedStylesHost,t,this.appId),this.rendererByCompId.set(t.id,n)),n.applyToHost(e),n;case ft.Native:case ft.ShadowDom:return new Gc(this.eventManager,this.sharedStylesHost,e,t);default:if(!this.rendererByCompId.has(t.id)){var r=Lc(t.id,t.styles,[]);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(t.id,this.defaultRenderer)}return this.defaultRenderer}}},{key:"begin",value:function(){}},{key:"end",value:function(){}}]),e}()).\u0275fac=function(e){return new(e||Uc)(Ze(Dc),Ze(Fc),Ze(Os))},Uc.\u0275prov=pe({token:Uc,factory:Uc.\u0275fac}),Uc),Hc=function(){function e(t){_classCallCheck(this,e),this.eventManager=t,this.data=Object.create(null)}return _createClass(e,[{key:"destroy",value:function(){}},{key:"createElement",value:function(e,t){return t?document.createElementNS(Pc[t]||t,e):document.createElement(e)}},{key:"createComment",value:function(e){return document.createComment(e)}},{key:"createText",value:function(e){return document.createTextNode(e)}},{key:"appendChild",value:function(e,t){e.appendChild(t)}},{key:"insertBefore",value:function(e,t,n){e&&e.insertBefore(t,n)}},{key:"removeChild",value:function(e,t){e&&e.removeChild(t)}},{key:"selectRootElement",value:function(e,t){var n="string"==typeof e?document.querySelector(e):e;if(!n)throw new Error('The selector "'.concat(e,'" did not match any elements'));return t||(n.textContent=""),n}},{key:"parentNode",value:function(e){return e.parentNode}},{key:"nextSibling",value:function(e){return e.nextSibling}},{key:"setAttribute",value:function(e,t,n,r){if(r){t=r+":"+t;var i=Pc[r];i?e.setAttributeNS(i,t,n):e.setAttribute(t,n)}else e.setAttribute(t,n)}},{key:"removeAttribute",value:function(e,t,n){if(n){var r=Pc[n];r?e.removeAttributeNS(r,t):e.removeAttribute("".concat(n,":").concat(t))}else e.removeAttribute(t)}},{key:"addClass",value:function(e,t){e.classList.add(t)}},{key:"removeClass",value:function(e,t){e.classList.remove(t)}},{key:"setStyle",value:function(e,t,n,r){r&Ra.DashCase?e.style.setProperty(t,n,r&Ra.Important?"important":""):e.style[t]=n}},{key:"removeStyle",value:function(e,t,n){n&Ra.DashCase?e.style.removeProperty(t):e.style[t]=""}},{key:"setProperty",value:function(e,t,n){e[t]=n}},{key:"setValue",value:function(e,t){e.nodeValue=t}},{key:"listen",value:function(e,t,n){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,Bc(n)):this.eventManager.addEventListener(e,t,Bc(n))}}]),e}(),qc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;_classCallCheck(this,n),(a=t.call(this,e)).component=i;var s,u=Lc(o+"-"+i.id,i.styles,[]);return r.addStyles(u),a.contentAttr="_ngcontent-%COMP%".replace(Mc,o+"-"+i.id),a.hostAttr=(s=o+"-"+i.id,"_nghost-%COMP%".replace(Mc,s)),a}return _createClass(n,[{key:"applyToHost",value:function(e){_get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,e,this.hostAttr,"")}},{key:"createElement",value:function(e,t){var r=_get(_getPrototypeOf(n.prototype),"createElement",this).call(this,e,t);return _get(_getPrototypeOf(n.prototype),"setAttribute",this).call(this,r,this.contentAttr,""),r}}]),n}(Hc),Gc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;_classCallCheck(this,n),(a=t.call(this,e)).sharedStylesHost=r,a.hostEl=i,a.component=o,a.shadowRoot=o.encapsulation===ft.ShadowDom?i.attachShadow({mode:"open"}):i.createShadowRoot(),a.sharedStylesHost.addHost(a.shadowRoot);for(var s=Lc(o.id,o.styles,[]),u=0;u<s.length;u++){var c=document.createElement("style");c.textContent=s[u],a.shadowRoot.appendChild(c)}return a}return _createClass(n,[{key:"nodeOrShadowRoot",value:function(e){return e===this.hostEl?this.shadowRoot:e}},{key:"destroy",value:function(){this.sharedStylesHost.removeHost(this.shadowRoot)}},{key:"appendChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"appendChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"insertBefore",value:function(e,t,r){return _get(_getPrototypeOf(n.prototype),"insertBefore",this).call(this,this.nodeOrShadowRoot(e),t,r)}},{key:"removeChild",value:function(e,t){return _get(_getPrototypeOf(n.prototype),"removeChild",this).call(this,this.nodeOrShadowRoot(e),t)}},{key:"parentNode",value:function(e){return this.nodeOrShadowRoot(_get(_getPrototypeOf(n.prototype),"parentNode",this).call(this,this.nodeOrShadowRoot(e)))}}]),n}(Hc),Kc=((Wc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"supports",value:function(e){return!0}},{key:"addEventListener",value:function(e,t,n){var r=this;return e.addEventListener(t,n,!1),function(){return r.removeEventListener(e,t,n)}}},{key:"removeEventListener",value:function(e,t,n){return e.removeEventListener(t,n)}}]),n}(Nc)).\u0275fac=function(e){return new(e||Wc)(Ze(Nu))},Wc.\u0275prov=pe({token:Wc,factory:Wc.\u0275fac}),Wc),Xc=["alt","control","meta","shift"],Qc={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Yc={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},$c={alt:function(e){return e.altKey},control:function(e){return e.ctrlKey},meta:function(e){return e.metaKey},shift:function(e){return e.shiftKey}},Zc=((zc=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){return _classCallCheck(this,n),t.call(this,e)}return _createClass(n,[{key:"supports",value:function(e){return null!=n.parseEventName(e)}},{key:"addEventListener",value:function(e,t,r){var i=n.parseEventName(t),o=n.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular((function(){return Au().onAndCancel(e,i.domEventName,o)}))}}],[{key:"parseEventName",value:function(e){var t=e.toLowerCase().split("."),r=t.shift();if(0===t.length||"keydown"!==r&&"keyup"!==r)return null;var i=n._normalizeKey(t.pop()),o="";if(Xc.forEach((function(e){var n=t.indexOf(e);n>-1&&(t.splice(n,1),o+=e+".")})),o+=i,0!=t.length||0===i.length)return null;var a={};return a.domEventName=r,a.fullKey=o,a}},{key:"getEventFullKey",value:function(e){var t="",n=function(e){var t=e.key;if(null==t){if(null==(t=e.keyIdentifier))return"Unidentified";t.startsWith("U+")&&(t=String.fromCharCode(parseInt(t.substring(2),16)),3===e.location&&Yc.hasOwnProperty(t)&&(t=Yc[t]))}return Qc[t]||t}(e);return" "===(n=n.toLowerCase())?n="space":"."===n&&(n="dot"),Xc.forEach((function(r){r!=n&&(0,$c[r])(e)&&(t+=r+".")})),t+=n}},{key:"eventCallback",value:function(e,t,r){return function(i){n.getEventFullKey(i)===e&&r.runGuarded((function(){return t(i)}))}}},{key:"_normalizeKey",value:function(e){switch(e){case"esc":return"escape";default:return e}}}]),n}(Nc)).\u0275fac=function(e){return new(e||zc)(Ze(Nu))},zc.\u0275prov=pe({token:zc,factory:zc.\u0275fac}),zc),Jc=pu(Su,"browser",[{provide:Ls,useValue:"browser"},{provide:Ms,useValue:function(){Ec.makeCurrent(),Tc.init()},multi:!0},{provide:Nu,useFactory:function(){return function(e){Ot=e}(document),document},deps:[]}]),el=[[],{provide:oo,useValue:"root"},{provide:or,useFactory:function(){return new or},deps:[]},{provide:Ac,useClass:Kc,multi:!0,deps:[Nu,Js,Ls]},{provide:Ac,useClass:Zc,multi:!0,deps:[Nu]},[],{provide:jc,useClass:jc,deps:[Dc,Fc,Os]},{provide:Ia,useExisting:jc},{provide:Oc,useExisting:Fc},{provide:Fc,useClass:Fc,deps:[Nu]},{provide:uu,useClass:uu,deps:[Js]},{provide:Dc,useClass:Dc,deps:[Ac,Js]},[]],tl=((Vc=function(){function e(t){if(_classCallCheck(this,e),t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}return _createClass(e,null,[{key:"withServerTransition",value:function(t){return{ngModule:e,providers:[{provide:Os,useValue:t.appId},{provide:Ic,useExisting:Os},Rc]}}}]),e}()).\u0275mod=_t({type:Vc}),Vc.\u0275inj=ve({factory:function(e){return new(e||Vc)(Ze(Vc,12))},providers:el,imports:[mc,Ru]}),Vc);function nl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return A(r)?(t.pop(),V(t,r)):X(t)}"undefined"!=typeof window&&window;var rl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r;return _classCallCheck(this,n),(r=t.call(this))._value=e,r}return _createClass(n,[{key:"_subscribe",value:function(e){var t=_get(_getPrototypeOf(n.prototype),"_subscribe",this).call(this,e);return t&&!t.closed&&e.next(this._value),t}},{key:"getValue",value:function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new E;return this._value}},{key:"next",value:function(e){_get(_getPrototypeOf(n.prototype),"next",this).call(this,this._value=e)}},{key:"value",get:function(){return this.getValue()}}]),n}(R),il=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),ol={},al=function(){function e(t){_classCallCheck(this,e),this.resultSelector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new sl(e,this.resultSelector))}}]),e}(),sl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).resultSelector=r,i.active=0,i.values=[],i.observables=[],i}return _createClass(n,[{key:"_next",value:function(e){this.values.push(ol),this.observables.push(e)}},{key:"_complete",value:function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(L(this,r,r,n))}}}},{key:"notifyComplete",value:function(e){0==(this.active-=1)&&this.destination.complete()}},{key:"notifyNext",value:function(e,t,n,r,i){var o=this.values,a=this.toRespond?o[n]===ol?--this.toRespond:this.toRespond:0;o[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))}},{key:"_tryResultSelector",value:function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)}}]),n}(B),ul=new x((function(e){return e.complete()}));function cl(e){return e?function(e){return new x((function(t){return e.schedule((function(){return t.complete()}))}))}(e):ul}function ll(e){return new x((function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?j(n):cl()).subscribe(t)}))}function hl(){return K(1)}function fl(e,t){return function(n){return n.lift(new dl(e,t))}}var dl=function(){function e(t,n){_classCallCheck(this,e),this.predicate=t,this.thisArg=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new pl(e,this.predicate,this.thisArg))}}]),e}(),pl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).predicate=r,o.thisArg=i,o.count=0,o}return _createClass(n,[{key:"_next",value:function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)}}]),n}(v),vl=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}();function ml(e){return function(t){return 0===e?cl():t.lift(new gl(e))}}var gl=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new vl}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new yl(e,this.total))}}]),e}(),yl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).total=r,i.ring=new Array,i.count=0,i}return _createClass(n,[{key:"_next",value:function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e}},{key:"_complete",value:function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()}}]),n}(v);function bl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xl;return function(t){return t.lift(new _l(e))}}var _l=function(){function e(t){_classCallCheck(this,e),this.errorFactory=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new wl(e,this.errorFactory))}}]),e}(),wl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).errorFactory=r,i.hasValue=!1,i}return _createClass(n,[{key:"_next",value:function(e){this.hasValue=!0,this.destination.next(e)}},{key:"_complete",value:function(){if(this.hasValue)return this.destination.complete();var e;try{e=this.errorFactory()}catch(t){e=t}this.destination.error(e)}}]),n}(v);function xl(){return new il}function kl(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return function(t){return t.lift(new Cl(e))}}var Cl=function(){function e(t){_classCallCheck(this,e),this.defaultValue=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new El(e,this.defaultValue))}}]),e}(),El=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).defaultValue=r,i.isEmpty=!0,i}return _createClass(n,[{key:"_next",value:function(e){this.isEmpty=!1,this.destination.next(e)}},{key:"_complete",value:function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}]),n}(v);function Sl(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?fl((function(t,n){return e(t,n,r)})):y,ml(1),n?kl(t):bl((function(){return new il})))}}function Il(e){return function(t){var n=new Rl(e),r=t.lift(n);return n.caught=r}}var Rl=function(){function e(t){_classCallCheck(this,e),this.selector=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Tl(e,this.selector,this.caught))}}]),e}(),Tl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).selector=r,o.caught=i,o}return _createClass(n,[{key:"error",value:function(e){if(!this.isStopped){var t;try{t=this.selector(e,this.caught)}catch(o){return void _get(_getPrototypeOf(n.prototype),"error",this).call(this,o)}this._unsubscribeAndRecycle();var r=new D(this,void 0,void 0);this.add(r);var i=L(this,t,void 0,void 0,r);i!==r&&this.add(i)}}}]),n}(B);function Al(e){return function(t){return 0===e?cl():t.lift(new Dl(e))}}var Dl=function(){function e(t){if(_classCallCheck(this,e),this.total=t,this.total<0)throw new vl}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Nl(e,this.total))}}]),e}(),Nl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).total=r,i.count=0,i}return _createClass(n,[{key:"_next",value:function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))}}]),n}(v);function Ol(e,t){var n=arguments.length>=2;return function(r){return r.pipe(e?fl((function(t,n){return e(t,n,r)})):y,Al(1),n?kl(t):bl((function(){return new il})))}}var Fl=function(){function e(t,n,r){_classCallCheck(this,e),this.predicate=t,this.thisArg=n,this.source=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Pl(e,this.predicate,this.thisArg,this.source))}}]),e}(),Pl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e)).predicate=r,a.thisArg=i,a.source=o,a.index=0,a.thisArg=i||_assertThisInitialized(a),a}return _createClass(n,[{key:"notifyComplete",value:function(e){this.destination.next(e),this.destination.complete()}},{key:"_next",value:function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)}},{key:"_complete",value:function(){this.notifyComplete(!0)}}]),n}(v);function Ml(e,t){return"function"==typeof t?function(n){return n.pipe(Ml((function(n,r){return j(e(n,r)).pipe(U((function(e,i){return t(n,e,r,i)})))})))}:function(t){return t.lift(new Ll(e))}}var Ll=function(){function e(t){_classCallCheck(this,e),this.project=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Bl(e,this.project))}}]),e}(),Bl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).project=r,i.index=0,i}return _createClass(n,[{key:"_next",value:function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t,e,n)}},{key:"_innerSub",value:function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe();var i=new D(this,t,n),o=this.destination;o.add(i),this.innerSubscription=L(this,e,void 0,void 0,i),this.innerSubscription!==i&&o.add(this.innerSubscription)}},{key:"_complete",value:function(){var e=this.innerSubscription;e&&!e.closed||_get(_getPrototypeOf(n.prototype),"_complete",this).call(this),this.unsubscribe()}},{key:"_unsubscribe",value:function(){this.innerSubscription=null}},{key:"notifyComplete",value:function(e){this.destination.remove(e),this.innerSubscription=null,this.isStopped&&_get(_getPrototypeOf(n.prototype),"_complete",this).call(this)}},{key:"notifyNext",value:function(e,t,n,r,i){this.destination.next(t)}}]),n}(B);function Ul(){return hl()(nl.apply(void 0,arguments))}function Wl(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new zl(e,t,n))}}var zl=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,e),this.accumulator=t,this.seed=n,this.hasSeed=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Vl(e,this.accumulator,this.seed,this.hasSeed))}}]),e}(),Vl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e)).accumulator=r,a._seed=i,a.hasSeed=o,a.index=0,a}return _createClass(n,[{key:"_next",value:function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}},{key:"_tryNext",value:function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)}},{key:"seed",get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e}}]),n}(v);function jl(e,t){return H(e,t,1)}function Hl(){}function ql(e,t,n){return function(r){return r.lift(new Kl(e,t,n))}}var Gl,Kl=function(){function e(t,n,r){_classCallCheck(this,e),this.nextOrObserver=t,this.error=n,this.complete=r}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Xl(e,this.nextOrObserver,this.error,this.complete))}}]),e}(),Xl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,i,o,a){var s;return _classCallCheck(this,n),(s=t.call(this,e))._tapNext=Hl,s._tapError=Hl,s._tapComplete=Hl,s._tapError=o||Hl,s._tapComplete=a||Hl,r(i)?(s._context=_assertThisInitialized(s),s._tapNext=i):i&&(s._context=i,s._tapNext=i.next||Hl,s._tapError=i.error||Hl,s._tapComplete=i.complete||Hl),s}return _createClass(n,[{key:"_next",value:function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)}},{key:"_error",value:function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)}},{key:"_complete",value:function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}]),n}(v),Ql=function(){function e(t){_classCallCheck(this,e),this.callback=t}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new Yl(e,this.callback))}}]),e}(),Yl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).add(new f(r)),i}return n}(v),$l=function e(t,n){_classCallCheck(this,e),this.id=t,this.url=n},Zl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"imperative",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _classCallCheck(this,n),(i=t.call(this,e,r)).navigationTrigger=o,i.restoredState=a,i}return _createClass(n,[{key:"toString",value:function(){return"NavigationStart(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}($l),Jl=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).urlAfterRedirects=i,o}return _createClass(n,[{key:"toString",value:function(){return"NavigationEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"')")}}]),n}($l),eh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).reason=i,o}return _createClass(n,[{key:"toString",value:function(){return"NavigationCancel(id: ".concat(this.id,", url: '").concat(this.url,"')")}}]),n}($l),th=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e,r)).error=i,o}return _createClass(n,[{key:"toString",value:function(){return"NavigationError(id: ".concat(this.id,", url: '").concat(this.url,"', error: ").concat(this.error,")")}}]),n}($l),nh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).urlAfterRedirects=i,a.state=o,a}return _createClass(n,[{key:"toString",value:function(){return"RoutesRecognized(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}($l),rh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).urlAfterRedirects=i,a.state=o,a}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}($l),ih=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a){var s;return _classCallCheck(this,n),(s=t.call(this,e,r)).urlAfterRedirects=i,s.state=o,s.shouldActivate=a,s}return _createClass(n,[{key:"toString",value:function(){return"GuardsCheckEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,", shouldActivate: ").concat(this.shouldActivate,")")}}]),n}($l),oh=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).urlAfterRedirects=i,a.state=o,a}return _createClass(n,[{key:"toString",value:function(){return"ResolveStart(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}($l),ah=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,e,r)).urlAfterRedirects=i,a.state=o,a}return _createClass(n,[{key:"toString",value:function(){return"ResolveEnd(id: ".concat(this.id,", url: '").concat(this.url,"', urlAfterRedirects: '").concat(this.urlAfterRedirects,"', state: ").concat(this.state,")")}}]),n}($l),sh=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadStart(path: ".concat(this.route.path,")")}}]),e}(),uh=function(){function e(t){_classCallCheck(this,e),this.route=t}return _createClass(e,[{key:"toString",value:function(){return"RouteConfigLoadEnd(path: ".concat(this.route.path,")")}}]),e}(),ch=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),lh=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ChildActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),hh=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationStart(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),fh=function(){function e(t){_classCallCheck(this,e),this.snapshot=t}return _createClass(e,[{key:"toString",value:function(){return"ActivationEnd(path: '".concat(this.snapshot.routeConfig&&this.snapshot.routeConfig.path||"","')")}}]),e}(),dh=function(){function e(t,n,r){_classCallCheck(this,e),this.routerEvent=t,this.position=n,this.anchor=r}return _createClass(e,[{key:"toString",value:function(){return"Scroll(anchor: '".concat(this.anchor,"', position: '").concat(this.position?"".concat(this.position[0],", ").concat(this.position[1]):null,"')")}}]),e}(),ph=((Gl=function e(){_classCallCheck(this,e)}).\u0275fac=function(e){return new(e||Gl)},Gl.\u0275cmp=mt({type:Gl,selectors:[["ng-component"]],decls:1,vars:0,template:function(e,t){1&e&&jo(0,"router-outlet")},directives:function(){return[bd]},encapsulation:2}),Gl),vh=function(){function e(t){_classCallCheck(this,e),this.params=t||{}}return _createClass(e,[{key:"has",value:function(e){return this.params.hasOwnProperty(e)}},{key:"get",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t[0]:t}return null}},{key:"getAll",value:function(e){if(this.has(e)){var t=this.params[e];return Array.isArray(t)?t:[t]}return[]}},{key:"keys",get:function(){return Object.keys(this.params)}}]),e}();function mh(e){return new vh(e)}function gh(e){var t=Error("NavigationCancelingError: "+e);return t.ngNavigationCancelingError=!0,t}function yh(e,t,n){var r=n.path.split("/");if(r.length>e.length)return null;if("full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;for(var i={},o=0;o<r.length;o++){var a=r[o],s=e[o];if(a.startsWith(":"))i[a.substring(1)]=s;else if(a!==s.path)return null}return{consumed:e.slice(0,r.length),posParams:i}}var bh=function e(t,n){_classCallCheck(this,e),this.routes=t,this.module=n};function _h(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=0;n<e.length;n++){var r=e[n];wh(r,xh(t,r))}}function wh(e,t){if(!e)throw new Error("\n      Invalid configuration of route '".concat(t,"': Encountered undefined route.\n      The reason might be an extra comma.\n\n      Example:\n      const routes: Routes = [\n        { path: '', redirectTo: '/dashboard', pathMatch: 'full' },\n        { path: 'dashboard',  component: DashboardComponent },, << two commas\n        { path: 'detail/:id', component: HeroDetailComponent }\n      ];\n    "));if(Array.isArray(e))throw new Error("Invalid configuration of route '".concat(t,"': Array cannot be specified"));if(!e.component&&!e.children&&!e.loadChildren&&e.outlet&&"primary"!==e.outlet)throw new Error("Invalid configuration of route '".concat(t,"': a componentless route without children or loadChildren cannot have a named outlet set"));if(e.redirectTo&&e.children)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and children cannot be used together"));if(e.redirectTo&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and loadChildren cannot be used together"));if(e.children&&e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"': children and loadChildren cannot be used together"));if(e.redirectTo&&e.component)throw new Error("Invalid configuration of route '".concat(t,"': redirectTo and component cannot be used together"));if(e.path&&e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': path and matcher cannot be used together"));if(void 0===e.redirectTo&&!e.component&&!e.children&&!e.loadChildren)throw new Error("Invalid configuration of route '".concat(t,"'. One of the following must be provided: component, redirectTo, children or loadChildren"));if(void 0===e.path&&void 0===e.matcher)throw new Error("Invalid configuration of route '".concat(t,"': routes must have either a path or a matcher specified"));if("string"==typeof e.path&&"/"===e.path.charAt(0))throw new Error("Invalid configuration of route '".concat(t,"': path cannot start with a slash"));if(""===e.path&&void 0!==e.redirectTo&&void 0===e.pathMatch)throw new Error("Invalid configuration of route '{path: \"".concat(t,'", redirectTo: "').concat(e.redirectTo,"\"}': please provide 'pathMatch'. The default value of 'pathMatch' is 'prefix', but often the intent is to use 'full'."));if(void 0!==e.pathMatch&&"full"!==e.pathMatch&&"prefix"!==e.pathMatch)throw new Error("Invalid configuration of route '".concat(t,"': pathMatch can only be set to 'prefix' or 'full'"));e.children&&_h(e.children,t)}function xh(e,t){return t?e||t.path?e&&!t.path?e+"/":!e&&t.path?t.path:"".concat(e,"/").concat(t.path):"":e}function kh(e){var t=e.children&&e.children.map(kh),n=t?Object.assign(Object.assign({},e),{children:t}):Object.assign({},e);return!n.component&&(t||n.loadChildren)&&n.outlet&&"primary"!==n.outlet&&(n.component=ph),n}function Ch(e,t){var n,r=Object.keys(e),i=Object.keys(t);if(!r||!i||r.length!=i.length)return!1;for(var o=0;o<r.length;o++)if(!Eh(e[n=r[o]],t[n]))return!1;return!0}function Eh(e,t){return Array.isArray(e)&&Array.isArray(t)?e.length==t.length&&e.every((function(e){return t.indexOf(e)>-1})):e===t}function Sh(e){return Array.prototype.concat.apply([],e)}function Ih(e){return e.length>0?e[e.length-1]:null}function Rh(e,t){for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Th(e){return(t=e)&&"function"==typeof t.subscribe?e:Ho(e)?j(Promise.resolve(e)):nl(e);var t}function Ah(e,t,n){return n?function(e,t){return Ch(e,t)}(e.queryParams,t.queryParams)&&function e(t,n){if(!Fh(t.segments,n.segments))return!1;if(t.numberOfChildren!==n.numberOfChildren)return!1;for(var r in n.children){if(!t.children[r])return!1;if(!e(t.children[r],n.children[r]))return!1}return!0}(e.root,t.root):function(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every((function(n){return Eh(e[n],t[n])}))}(e.queryParams,t.queryParams)&&function e(t,n){return function t(n,r,i){if(n.segments.length>i.length)return!!Fh(n.segments.slice(0,i.length),i)&&!r.hasChildren();if(n.segments.length===i.length){if(!Fh(n.segments,i))return!1;for(var o in r.children){if(!n.children[o])return!1;if(!e(n.children[o],r.children[o]))return!1}return!0}var a=i.slice(0,n.segments.length),s=i.slice(n.segments.length);return!!Fh(n.segments,a)&&!!n.children.primary&&t(n.children.primary,r,s)}(t,n,n.segments)}(e.root,t.root)}var Dh=function(){function e(t,n,r){_classCallCheck(this,e),this.root=t,this.queryParams=n,this.fragment=r}return _createClass(e,[{key:"toString",value:function(){return Bh.serialize(this)}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=mh(this.queryParams)),this._queryParamMap}}]),e}(),Nh=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.segments=t,this.children=n,this.parent=null,Rh(n,(function(e,t){return e.parent=r}))}return _createClass(e,[{key:"hasChildren",value:function(){return this.numberOfChildren>0}},{key:"toString",value:function(){return Uh(this)}},{key:"numberOfChildren",get:function(){return Object.keys(this.children).length}}]),e}(),Oh=function(){function e(t,n){_classCallCheck(this,e),this.path=t,this.parameters=n}return _createClass(e,[{key:"toString",value:function(){return qh(this)}},{key:"parameterMap",get:function(){return this._parameterMap||(this._parameterMap=mh(this.parameters)),this._parameterMap}}]),e}();function Fh(e,t){return e.length===t.length&&e.every((function(e,n){return e.path===t[n].path}))}function Ph(e,t){var n=[];return Rh(e.children,(function(e,r){"primary"===r&&(n=n.concat(t(e,r)))})),Rh(e.children,(function(e,r){"primary"!==r&&(n=n.concat(t(e,r)))})),n}var Mh=function e(){_classCallCheck(this,e)},Lh=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"parse",value:function(e){var t=new Yh(e);return new Dh(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}},{key:"serialize",value:function(e){return"".concat("/"+function e(t,n){if(!t.hasChildren())return Uh(t);if(n){var r=t.children.primary?e(t.children.primary,!1):"",i=[];return Rh(t.children,(function(t,n){"primary"!==n&&i.push("".concat(n,":").concat(e(t,!1)))})),i.length>0?"".concat(r,"(").concat(i.join("//"),")"):r}var o=Ph(t,(function(n,r){return"primary"===r?[e(t.children.primary,!1)]:["".concat(r,":").concat(e(n,!1))]}));return"".concat(Uh(t),"/(").concat(o.join("//"),")")}(e.root,!0)).concat((t=e.queryParams,n=Object.keys(t).map((function(e){var n=t[e];return Array.isArray(n)?n.map((function(t){return"".concat(zh(e),"=").concat(zh(t))})).join("&"):"".concat(zh(e),"=").concat(zh(n))})),n.length?"?"+n.join("&"):"")).concat("string"==typeof e.fragment?"#"+encodeURI(e.fragment):"");var t,n}}]),e}(),Bh=new Lh;function Uh(e){return e.segments.map((function(e){return qh(e)})).join("/")}function Wh(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function zh(e){return Wh(e).replace(/%3B/gi,";")}function Vh(e){return Wh(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function jh(e){return decodeURIComponent(e)}function Hh(e){return jh(e.replace(/\+/g,"%20"))}function qh(e){return"".concat(Vh(e.path)).concat((t=e.parameters,Object.keys(t).map((function(e){return";".concat(Vh(e),"=").concat(Vh(t[e]))})).join("")));var t}var Gh=/^[^\/()?;=#]+/;function Kh(e){var t=e.match(Gh);return t?t[0]:""}var Xh=/^[^=?&#]+/,Qh=/^[^?&#]+/,Yh=function(){function e(t){_classCallCheck(this,e),this.url=t,this.remaining=t}return _createClass(e,[{key:"parseRootSegment",value:function(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Nh([],{}):new Nh([],this.parseChildren())}},{key:"parseQueryParams",value:function(){var e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}},{key:"parseFragment",value:function(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}},{key:"parseChildren",value:function(){if(""===this.remaining)return{};this.consumeOptional("/");var e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());var t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));var n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(n.primary=new Nh(e,t)),n}},{key:"parseSegment",value:function(){var e=Kh(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error("Empty path url segment cannot have parameters: '".concat(this.remaining,"'."));return this.capture(e),new Oh(jh(e),this.parseMatrixParams())}},{key:"parseMatrixParams",value:function(){for(var e={};this.consumeOptional(";");)this.parseParam(e);return e}},{key:"parseParam",value:function(e){var t=Kh(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=Kh(this.remaining);r&&(n=r,this.capture(n))}e[jh(t)]=jh(n)}}},{key:"parseQueryParam",value:function(e){var t=function(e){var t=e.match(Xh);return t?t[0]:""}(this.remaining);if(t){this.capture(t);var n="";if(this.consumeOptional("=")){var r=function(e){var t=e.match(Qh);return t?t[0]:""}(this.remaining);r&&(n=r,this.capture(n))}var i=Hh(t),o=Hh(n);if(e.hasOwnProperty(i)){var a=e[i];Array.isArray(a)||(a=[a],e[i]=a),a.push(o)}else e[i]=o}}},{key:"parseParens",value:function(e){var t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){var n=Kh(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error("Cannot parse url '".concat(this.url,"'"));var i=void 0;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):e&&(i="primary");var o=this.parseChildren();t[i]=1===Object.keys(o).length?o.primary:new Nh([],o),this.consumeOptional("//")}return t}},{key:"peekStartsWith",value:function(e){return this.remaining.startsWith(e)}},{key:"consumeOptional",value:function(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}},{key:"capture",value:function(e){if(!this.consumeOptional(e))throw new Error('Expected "'.concat(e,'".'))}}]),e}(),$h=function(){function e(t){_classCallCheck(this,e),this._root=t}return _createClass(e,[{key:"parent",value:function(e){var t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}},{key:"children",value:function(e){var t=Zh(e,this._root);return t?t.children.map((function(e){return e.value})):[]}},{key:"firstChild",value:function(e){var t=Zh(e,this._root);return t&&t.children.length>0?t.children[0].value:null}},{key:"siblings",value:function(e){var t=Jh(e,this._root);return t.length<2?[]:t[t.length-2].children.map((function(e){return e.value})).filter((function(t){return t!==e}))}},{key:"pathFromRoot",value:function(e){return Jh(e,this._root).map((function(e){return e.value}))}},{key:"root",get:function(){return this._root.value}}]),e}();function Zh(e,t){if(e===t.value)return t;var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var i=Zh(e,n.value);if(i)return i}}catch(o){r.e(o)}finally{r.f()}return null}function Jh(e,t){if(e===t.value)return[t];var n,r=_createForOfIteratorHelper(t.children);try{for(r.s();!(n=r.n()).done;){var i=Jh(e,n.value);if(i.length)return i.unshift(t),i}}catch(o){r.e(o)}finally{r.f()}return[]}var ef=function(){function e(t,n){_classCallCheck(this,e),this.value=t,this.children=n}return _createClass(e,[{key:"toString",value:function(){return"TreeNode(".concat(this.value,")")}}]),e}();function tf(e){var t={};return e&&e.children.forEach((function(e){return t[e.value.outlet]=e})),t}var nf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e)).snapshot=r,cf(_assertThisInitialized(i),e),i}return _createClass(n,[{key:"toString",value:function(){return this.snapshot.toString()}}]),n}($h);function rf(e,t){var n=function(e,t){var n=new sf([],{},{},"",{},"primary",t,null,e.root,-1,{});return new uf("",new ef(n,[]))}(e,t),r=new rl([new Oh("",{})]),i=new rl({}),o=new rl({}),a=new rl({}),s=new rl(""),u=new of(r,i,a,s,o,"primary",t,n.root);return u.snapshot=n.root,new nf(new ef(u,[]),n)}var of=function(){function e(t,n,r,i,o,a,s,u){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=a,this.component=s,this._futureSnapshot=u}return _createClass(e,[{key:"toString",value:function(){return this.snapshot?this.snapshot.toString():"Future(".concat(this._futureSnapshot,")")}},{key:"routeConfig",get:function(){return this._futureSnapshot.routeConfig}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=this.params.pipe(U((function(e){return mh(e)})))),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(U((function(e){return mh(e)})))),this._queryParamMap}}]),e}();function af(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"emptyOnly",n=e.pathFromRoot,r=0;if("always"!==t)for(r=n.length-1;r>=1;){var i=n[r],o=n[r-1];if(i.routeConfig&&""===i.routeConfig.path)r--;else{if(o.component)break;r--}}return function(e){return e.reduce((function(e,t){return{params:Object.assign(Object.assign({},e.params),t.params),data:Object.assign(Object.assign({},e.data),t.data),resolve:Object.assign(Object.assign({},e.resolve),t._resolvedData)}}),{params:{},data:{},resolve:{}})}(n.slice(r))}var sf=function(){function e(t,n,r,i,o,a,s,u,c,l,h){_classCallCheck(this,e),this.url=t,this.params=n,this.queryParams=r,this.fragment=i,this.data=o,this.outlet=a,this.component=s,this.routeConfig=u,this._urlSegment=c,this._lastPathIndex=l,this._resolve=h}return _createClass(e,[{key:"toString",value:function(){return"Route(url:'".concat(this.url.map((function(e){return e.toString()})).join("/"),"', path:'").concat(this.routeConfig?this.routeConfig.path:"","')")}},{key:"root",get:function(){return this._routerState.root}},{key:"parent",get:function(){return this._routerState.parent(this)}},{key:"firstChild",get:function(){return this._routerState.firstChild(this)}},{key:"children",get:function(){return this._routerState.children(this)}},{key:"pathFromRoot",get:function(){return this._routerState.pathFromRoot(this)}},{key:"paramMap",get:function(){return this._paramMap||(this._paramMap=mh(this.params)),this._paramMap}},{key:"queryParamMap",get:function(){return this._queryParamMap||(this._queryParamMap=mh(this.queryParams)),this._queryParamMap}}]),e}(),uf=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,r)).url=e,cf(_assertThisInitialized(i),r),i}return _createClass(n,[{key:"toString",value:function(){return lf(this._root)}}]),n}($h);function cf(e,t){t.value._routerState=e,t.children.forEach((function(t){return cf(e,t)}))}function lf(e){var t=e.children.length>0?" { ".concat(e.children.map(lf).join(", ")," } "):"";return"".concat(e.value).concat(t)}function hf(e){if(e.snapshot){var t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,Ch(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),Ch(t.params,n.params)||e.params.next(n.params),function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(!Ch(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),Ch(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function ff(e,t){return Ch(e.params,t.params)&&function(e,t){return Fh(e,t)&&e.every((function(e,n){return Ch(e.parameters,t[n].parameters)}))}(e.url,t.url)&&!(!e.parent!=!t.parent)&&(!e.parent||ff(e.parent,t.parent))}function df(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function pf(e,t,n,r,i){var o={};return r&&Rh(r,(function(e,t){o[t]=Array.isArray(e)?e.map((function(e){return""+e})):""+e})),new Dh(n.root===e?t:function e(t,n,r){var i={};return Rh(t.children,(function(t,o){i[o]=t===n?r:e(t,n,r)})),new Nh(t.segments,i)}(n.root,e,t),o,i)}var vf=function(){function e(t,n,r){if(_classCallCheck(this,e),this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&df(r[0]))throw new Error("Root segment cannot have matrix parameters");var i=r.find((function(e){return"object"==typeof e&&null!=e&&e.outlets}));if(i&&i!==Ih(r))throw new Error("{outlets:{}} has to be the last command")}return _createClass(e,[{key:"toRoot",value:function(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}]),e}(),mf=function e(t,n,r){_classCallCheck(this,e),this.segmentGroup=t,this.processChildren=n,this.index=r};function gf(e){return"object"==typeof e&&null!=e&&e.outlets?e.outlets.primary:""+e}function yf(e,t,n){if(e||(e=new Nh([],{})),0===e.segments.length&&e.hasChildren())return bf(e,t,n);var r=function(e,t,n){for(var r=0,i=t,o={match:!1,pathIndex:0,commandIndex:0};i<e.segments.length;){if(r>=n.length)return o;var a=e.segments[i],s=gf(n[r]),u=r<n.length-1?n[r+1]:null;if(i>0&&void 0===s)break;if(s&&u&&"object"==typeof u&&void 0===u.outlets){if(!kf(s,u,a))return o;r+=2}else{if(!kf(s,{},a))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(e,t,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){var o=new Nh(e.segments.slice(0,r.pathIndex),{});return o.children.primary=new Nh(e.segments.slice(r.pathIndex),e.children),bf(o,0,i)}return r.match&&0===i.length?new Nh(e.segments,{}):r.match&&!e.hasChildren()?_f(e,t,n):r.match?bf(e,0,i):_f(e,t,n)}function bf(e,t,n){if(0===n.length)return new Nh(e.segments,{});var r=function(e){return"object"!=typeof e[0]||void 0===e[0].outlets?{primary:e}:e[0].outlets}(n),i={};return Rh(r,(function(n,r){null!==n&&(i[r]=yf(e.children[r],t,n))})),Rh(e.children,(function(e,t){void 0===r[t]&&(i[t]=e)})),new Nh(e.segments,i)}function _f(e,t,n){for(var r=e.segments.slice(0,t),i=0;i<n.length;){if("object"==typeof n[i]&&void 0!==n[i].outlets){var o=wf(n[i].outlets);return new Nh(r,o)}if(0===i&&df(n[0]))r.push(new Oh(e.segments[t].path,n[0])),i++;else{var a=gf(n[i]),s=i<n.length-1?n[i+1]:null;a&&s&&df(s)?(r.push(new Oh(a,xf(s))),i+=2):(r.push(new Oh(a,{})),i++)}}return new Nh(r,{})}function wf(e){var t={};return Rh(e,(function(e,n){null!==e&&(t[n]=_f(new Nh([],{}),0,e))})),t}function xf(e){var t={};return Rh(e,(function(e,n){return t[n]=""+e})),t}function kf(e,t,n){return e==n.path&&Ch(t,n.parameters)}var Cf=function(){function e(t,n,r,i){_classCallCheck(this,e),this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=i}return _createClass(e,[{key:"activate",value:function(e){var t=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,n,e),hf(this.futureState.root),this.activateChildRoutes(t,n,e)}},{key:"deactivateChildRoutes",value:function(e,t,n){var r=this,i=tf(t);e.children.forEach((function(e){var t=e.value.outlet;r.deactivateRoutes(e,i[t],n),delete i[t]})),Rh(i,(function(e,t){r.deactivateRouteAndItsChildren(e,n)}))}},{key:"deactivateRoutes",value:function(e,t,n){var r=e.value,i=t?t.value:null;if(r===i)if(r.component){var o=n.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,n);else i&&this.deactivateRouteAndItsChildren(t,n)}},{key:"deactivateRouteAndItsChildren",value:function(e,t){this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}},{key:"detachAndStoreRouteSubtree",value:function(e,t){var n=t.getContext(e.value.outlet);if(n&&n.outlet){var r=n.outlet.detach(),i=n.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:r,route:e,contexts:i})}}},{key:"deactivateRouteAndOutlet",value:function(e,t){var n=this,r=t.getContext(e.value.outlet);if(r){var i=tf(e),o=e.value.component?r.children:t;Rh(i,(function(e,t){return n.deactivateRouteAndItsChildren(e,o)})),r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated())}}},{key:"activateChildRoutes",value:function(e,t,n){var r=this,i=tf(t);e.children.forEach((function(e){r.activateRoutes(e,i[e.value.outlet],n),r.forwardEvent(new fh(e.value.snapshot))})),e.children.length&&this.forwardEvent(new lh(e.value.snapshot))}},{key:"activateRoutes",value:function(e,t,n){var r=e.value,i=t?t.value:null;if(hf(r),r===i)if(r.component){var o=n.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,n);else if(r.component){var a=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){var s=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),a.children.onOutletReAttached(s.contexts),a.attachRef=s.componentRef,a.route=s.route.value,a.outlet&&a.outlet.attach(s.componentRef,s.route.value),Ef(s.route)}else{var u=function(e){for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(r.snapshot),c=u?u.module.componentFactoryResolver:null;a.attachRef=null,a.route=r,a.resolver=c,a.outlet&&a.outlet.activateWith(r,c),this.activateChildRoutes(e,null,a.children)}}else this.activateChildRoutes(e,null,n)}}]),e}();function Ef(e){hf(e.value),e.children.forEach(Ef)}function Sf(e){return"function"==typeof e}function If(e){return e instanceof Dh}var Rf=function e(t){_classCallCheck(this,e),this.segmentGroup=t||null},Tf=function e(t){_classCallCheck(this,e),this.urlTree=t};function Af(e){return new x((function(t){return t.error(new Rf(e))}))}function Df(e){return new x((function(t){return t.error(new Tf(e))}))}function Nf(e){return new x((function(t){return t.error(new Error("Only absolute redirects can have named outlets. redirectTo: '".concat(e,"'")))}))}var Of=function(){function e(t,n,r,i,o){_classCallCheck(this,e),this.configLoader=n,this.urlSerializer=r,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(rt)}return _createClass(e,[{key:"apply",value:function(){var e=this;return this.expandSegmentGroup(this.ngModule,this.config,this.urlTree.root,"primary").pipe(U((function(t){return e.createUrlTree(t,e.urlTree.queryParams,e.urlTree.fragment)}))).pipe(Il((function(t){if(t instanceof Tf)return e.allowRedirects=!1,e.match(t.urlTree);if(t instanceof Rf)throw e.noMatchError(t);throw t})))}},{key:"match",value:function(e){var t=this;return this.expandSegmentGroup(this.ngModule,this.config,e.root,"primary").pipe(U((function(n){return t.createUrlTree(n,e.queryParams,e.fragment)}))).pipe(Il((function(e){if(e instanceof Rf)throw t.noMatchError(e);throw e})))}},{key:"noMatchError",value:function(e){return new Error("Cannot match any routes. URL Segment: '".concat(e.segmentGroup,"'"))}},{key:"createUrlTree",value:function(e,t,n){var r=e.segments.length>0?new Nh([],{primary:e}):e;return new Dh(r,t,n)}},{key:"expandSegmentGroup",value:function(e,t,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(e,t,n).pipe(U((function(e){return new Nh([],e)}))):this.expandSegment(e,n,t,n.segments,r,!0)}},{key:"expandChildren",value:function(e,t,n){var r=this;return function(n,i){if(0===Object.keys(n).length)return nl({});var o=[],a=[],s={};return Rh(n,(function(n,i){var u,c,l=(u=i,c=n,r.expandSegmentGroup(e,t,c,u)).pipe(U((function(e){return s[i]=e})));"primary"===i?o.push(l):a.push(l)})),nl.apply(null,o.concat(a)).pipe(hl(),Sl(),U((function(){return s})))}(n.children)}},{key:"expandSegment",value:function(e,t,n,r,i,o){var a=this;return nl.apply(void 0,_toConsumableArray(n)).pipe(U((function(s){return a.expandSegmentAgainstRoute(e,t,n,s,r,i,o).pipe(Il((function(e){if(e instanceof Rf)return nl(null);throw e})))})),hl(),Ol((function(e){return!!e})),Il((function(e,n){if(e instanceof il||"EmptyError"===e.name){if(a.noLeftoversInUrl(t,r,i))return nl(new Nh([],{}));throw new Rf(t)}throw e})))}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"expandSegmentAgainstRoute",value:function(e,t,n,r,i,o,a){return Lf(r)!==o?Af(t):void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,i):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o):Af(t)}},{key:"expandSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,i,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,n,r,i,o)}},{key:"expandWildCardWithParamsAgainstRouteUsingRedirect",value:function(e,t,n,r){var i=this,o=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?Df(o):this.lineralizeSegments(n,o).pipe(H((function(n){var o=new Nh(n,{});return i.expandSegment(e,o,t,n,r,!1)})))}},{key:"expandRegularSegmentAgainstRouteUsingRedirect",value:function(e,t,n,r,i,o){var a=this,s=Ff(t,r,i),u=s.matched,c=s.consumedSegments,l=s.lastChild,h=s.positionalParamSegments;if(!u)return Af(t);var f=this.applyRedirectCommands(c,r.redirectTo,h);return r.redirectTo.startsWith("/")?Df(f):this.lineralizeSegments(r,f).pipe(H((function(r){return a.expandSegment(e,t,n,r.concat(i.slice(l)),o,!1)})))}},{key:"matchSegmentAgainstRoute",value:function(e,t,n,r){var i=this;if("**"===n.path)return n.loadChildren?this.configLoader.load(e.injector,n).pipe(U((function(e){return n._loadedConfig=e,new Nh(r,{})}))):nl(new Nh(r,{}));var o=Ff(t,n,r),a=o.matched,s=o.consumedSegments,u=o.lastChild;if(!a)return Af(t);var c=r.slice(u);return this.getChildConfig(e,n,r).pipe(H((function(e){var n=e.module,r=e.routes,o=function(e,t,n,r){return n.length>0&&function(e,t,n){return n.some((function(n){return Mf(e,t,n)&&"primary"!==Lf(n)}))}(e,n,r)?{segmentGroup:Pf(new Nh(t,function(e,t){var n={};n.primary=t;var r,i=_createForOfIteratorHelper(e);try{for(i.s();!(r=i.n()).done;){var o=r.value;""===o.path&&"primary"!==Lf(o)&&(n[Lf(o)]=new Nh([],{}))}}catch(a){i.e(a)}finally{i.f()}return n}(r,new Nh(n,e.children)))),slicedSegments:[]}:0===n.length&&function(e,t,n){return n.some((function(n){return Mf(e,t,n)}))}(e,n,r)?{segmentGroup:Pf(new Nh(e.segments,function(e,t,n,r){var i,o={},a=_createForOfIteratorHelper(n);try{for(a.s();!(i=a.n()).done;){var s=i.value;Mf(e,t,s)&&!r[Lf(s)]&&(o[Lf(s)]=new Nh([],{}))}}catch(u){a.e(u)}finally{a.f()}return Object.assign(Object.assign({},r),o)}(e,n,r,e.children))),slicedSegments:n}:{segmentGroup:e,slicedSegments:n}}(t,s,c,r),a=o.segmentGroup,u=o.slicedSegments;return 0===u.length&&a.hasChildren()?i.expandChildren(n,r,a).pipe(U((function(e){return new Nh(s,e)}))):0===r.length&&0===u.length?nl(new Nh(s,{})):i.expandSegment(n,a,r,u,"primary",!0).pipe(U((function(e){return new Nh(s.concat(e.segments),e.children)})))})))}},{key:"getChildConfig",value:function(e,t,n){var r=this;return t.children?nl(new bh(t.children,e)):t.loadChildren?void 0!==t._loadedConfig?nl(t._loadedConfig):function(e,t,n){var r,i=t.canLoad;return i&&0!==i.length?j(i).pipe(U((function(r){var i,o=e.get(r);if(function(e){return e&&Sf(e.canLoad)}(o))i=o.canLoad(t,n);else{if(!Sf(o))throw new Error("Invalid CanLoad guard");i=o(t,n)}return Th(i)}))).pipe(hl(),(r=function(e){return!0===e},function(e){return e.lift(new Fl(r,void 0,e))})):nl(!0)}(e.injector,t,n).pipe(H((function(n){return n?r.configLoader.load(e.injector,t).pipe(U((function(e){return t._loadedConfig=e,e}))):function(e){return new x((function(t){return t.error(gh("Cannot load children because the guard of the route \"path: '".concat(e.path,"'\" returned false")))}))}(t)}))):nl(new bh([],e))}},{key:"lineralizeSegments",value:function(e,t){for(var n=[],r=t.root;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return nl(n);if(r.numberOfChildren>1||!r.children.primary)return Nf(e.redirectTo);r=r.children.primary}}},{key:"applyRedirectCommands",value:function(e,t,n){return this.applyRedirectCreatreUrlTree(t,this.urlSerializer.parse(t),e,n)}},{key:"applyRedirectCreatreUrlTree",value:function(e,t,n,r){var i=this.createSegmentGroup(e,t.root,n,r);return new Dh(i,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}},{key:"createQueryParams",value:function(e,t){var n={};return Rh(e,(function(e,r){if("string"==typeof e&&e.startsWith(":")){var i=e.substring(1);n[r]=t[i]}else n[r]=e})),n}},{key:"createSegmentGroup",value:function(e,t,n,r){var i=this,o=this.createSegments(e,t.segments,n,r),a={};return Rh(t.children,(function(t,o){a[o]=i.createSegmentGroup(e,t,n,r)})),new Nh(o,a)}},{key:"createSegments",value:function(e,t,n,r){var i=this;return t.map((function(t){return t.path.startsWith(":")?i.findPosParam(e,t,r):i.findOrReturn(t,n)}))}},{key:"findPosParam",value:function(e,t,n){var r=n[t.path.substring(1)];if(!r)throw new Error("Cannot redirect to '".concat(e,"'. Cannot find '").concat(t.path,"'."));return r}},{key:"findOrReturn",value:function(e,t){var n,r=0,i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.path===e.path)return t.splice(r),o;r++}}catch(a){i.e(a)}finally{i.f()}return e}}]),e}();function Ff(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}:{matched:!0,consumedSegments:[],lastChild:0,positionalParamSegments:{}};var r=(t.matcher||yh)(n,e,t);return r?{matched:!0,consumedSegments:r.consumed,lastChild:r.consumed.length,positionalParamSegments:r.posParams}:{matched:!1,consumedSegments:[],lastChild:0,positionalParamSegments:{}}}function Pf(e){if(1===e.numberOfChildren&&e.children.primary){var t=e.children.primary;return new Nh(e.segments.concat(t.segments),t.children)}return e}function Mf(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0!==n.redirectTo}function Lf(e){return e.outlet||"primary"}var Bf=function e(t){_classCallCheck(this,e),this.path=t,this.route=this.path[this.path.length-1]},Uf=function e(t,n){_classCallCheck(this,e),this.component=t,this.route=n};function Wf(e,t,n){var r=function(e){if(!e)return null;for(var t=e.parent;t;t=t.parent){var n=t.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(t);return(r?r.module.injector:n).get(e)}function zf(e,t,n){var r=tf(e),i=e.value;Rh(r,(function(e,r){zf(e,i.component?t?t.children.getContext(r):null:t,n)})),n.canDeactivateChecks.push(new Uf(i.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,i))}var Vf=Symbol("INITIAL_VALUE");function jf(){return Ml((function(e){return(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=null,i=null;return A(t[t.length-1])&&(i=t.pop()),"function"==typeof t[t.length-1]&&(r=t.pop()),1===t.length&&u(t[0])&&(t=t[0]),X(t,i).lift(new al(r))}).apply(void 0,_toConsumableArray(e.map((function(e){return e.pipe(Al(1),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[t.length-1];return A(r)?(t.pop(),function(e){return Ul(t,e,r)}):function(e){return Ul(t,e)}}(Vf))})))).pipe(Wl((function(e,t){var n=!1;return t.reduce((function(e,r,i){if(e!==Vf)return e;if(r===Vf&&(n=!0),!n){if(!1===r)return r;if(i===t.length-1||If(r))return r}return e}),e)}),Vf),fl((function(e){return e!==Vf})),U((function(e){return If(e)?e:!0===e})),Al(1))}))}function Hf(e,t){return null!==e&&t&&t(new hh(e)),nl(!0)}function qf(e,t){return null!==e&&t&&t(new ch(e)),nl(!0)}function Gf(e,t,n){var r=t.routeConfig?t.routeConfig.canActivate:null;return r&&0!==r.length?nl(r.map((function(r){return ll((function(){var i,o=Wf(r,t,n);if(function(e){return e&&Sf(e.canActivate)}(o))i=Th(o.canActivate(t,e));else{if(!Sf(o))throw new Error("Invalid CanActivate guard");i=Th(o(t,e))}return i.pipe(Ol())}))}))).pipe(jf()):nl(!0)}function Kf(e,t,n){var r=t[t.length-1],i=t.slice(0,t.length-1).reverse().map((function(e){return function(e){var t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(e)})).filter((function(e){return null!==e})).map((function(t){return ll((function(){return nl(t.guards.map((function(i){var o,a=Wf(i,t.node,n);if(function(e){return e&&Sf(e.canActivateChild)}(a))o=Th(a.canActivateChild(r,e));else{if(!Sf(a))throw new Error("Invalid CanActivateChild guard");o=Th(a(r,e))}return o.pipe(Ol())}))).pipe(jf())}))}));return nl(i).pipe(jf())}var Xf=function e(){_classCallCheck(this,e)},Qf=function(){function e(t,n,r,i,o,a){_classCallCheck(this,e),this.rootComponentType=t,this.config=n,this.urlTree=r,this.url=i,this.paramsInheritanceStrategy=o,this.relativeLinkResolution=a}return _createClass(e,[{key:"recognize",value:function(){try{var e=Zf(this.urlTree.root,[],[],this.config,this.relativeLinkResolution).segmentGroup,t=this.processSegmentGroup(this.config,e,"primary"),n=new sf([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},"primary",this.rootComponentType,null,this.urlTree.root,-1,{}),r=new ef(n,t),i=new uf(this.url,r);return this.inheritParamsAndData(i._root),nl(i)}catch(o){return new x((function(e){return e.error(o)}))}}},{key:"inheritParamsAndData",value:function(e){var t=this,n=e.value,r=af(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),e.children.forEach((function(e){return t.inheritParamsAndData(e)}))}},{key:"processSegmentGroup",value:function(e,t,n){return 0===t.segments.length&&t.hasChildren()?this.processChildren(e,t):this.processSegment(e,t,t.segments,n)}},{key:"processChildren",value:function(e,t){var n,r=this,i=Ph(t,(function(t,n){return r.processSegmentGroup(e,t,n)}));return n={},i.forEach((function(e){var t=n[e.value.outlet];if(t){var r=t.url.map((function(e){return e.toString()})).join("/"),i=e.value.url.map((function(e){return e.toString()})).join("/");throw new Error("Two segments cannot have the same outlet name: '".concat(r,"' and '").concat(i,"'."))}n[e.value.outlet]=e.value})),i.sort((function(e,t){return"primary"===e.value.outlet?-1:"primary"===t.value.outlet?1:e.value.outlet.localeCompare(t.value.outlet)})),i}},{key:"processSegment",value:function(e,t,n,r){var i,o=_createForOfIteratorHelper(e);try{for(o.s();!(i=o.n()).done;){var a=i.value;try{return this.processSegmentAgainstRoute(a,t,n,r)}catch(s){if(!(s instanceof Xf))throw s}}}catch(u){o.e(u)}finally{o.f()}if(this.noLeftoversInUrl(t,n,r))return[];throw new Xf}},{key:"noLeftoversInUrl",value:function(e,t,n){return 0===t.length&&!e.children[n]}},{key:"processSegmentAgainstRoute",value:function(e,t,n,r){if(e.redirectTo)throw new Xf;if((e.outlet||"primary")!==r)throw new Xf;var i,o=[],a=[];if("**"===e.path){var s=n.length>0?Ih(n).parameters:{};i=new sf(n,s,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,td(e),r,e.component,e,Yf(t),$f(t)+n.length,nd(e))}else{var u=function(e,t,n){if(""===t.path){if("full"===t.pathMatch&&(e.hasChildren()||n.length>0))throw new Xf;return{consumedSegments:[],lastChild:0,parameters:{}}}var r=(t.matcher||yh)(n,e,t);if(!r)throw new Xf;var i={};Rh(r.posParams,(function(e,t){i[t]=e.path}));var o=r.consumed.length>0?Object.assign(Object.assign({},i),r.consumed[r.consumed.length-1].parameters):i;return{consumedSegments:r.consumed,lastChild:r.consumed.length,parameters:o}}(t,e,n);o=u.consumedSegments,a=n.slice(u.lastChild),i=new sf(o,u.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,td(e),r,e.component,e,Yf(t),$f(t)+o.length,nd(e))}var c=function(e){return e.children?e.children:e.loadChildren?e._loadedConfig.routes:[]}(e),l=Zf(t,o,a,c,this.relativeLinkResolution),h=l.segmentGroup,f=l.slicedSegments;if(0===f.length&&h.hasChildren()){var d=this.processChildren(c,h);return[new ef(i,d)]}if(0===c.length&&0===f.length)return[new ef(i,[])];var p=this.processSegment(c,h,f,"primary");return[new ef(i,p)]}}]),e}();function Yf(e){for(var t=e;t._sourceSegment;)t=t._sourceSegment;return t}function $f(e){for(var t=e,n=t._segmentIndexShift?t._segmentIndexShift:0;t._sourceSegment;)n+=(t=t._sourceSegment)._segmentIndexShift?t._segmentIndexShift:0;return n-1}function Zf(e,t,n,r,i){if(n.length>0&&function(e,t,n){return n.some((function(n){return Jf(e,t,n)&&"primary"!==ed(n)}))}(e,n,r)){var o=new Nh(t,function(e,t,n,r){var i={};i.primary=r,r._sourceSegment=e,r._segmentIndexShift=t.length;var o,a=_createForOfIteratorHelper(n);try{for(a.s();!(o=a.n()).done;){var s=o.value;if(""===s.path&&"primary"!==ed(s)){var u=new Nh([],{});u._sourceSegment=e,u._segmentIndexShift=t.length,i[ed(s)]=u}}}catch(c){a.e(c)}finally{a.f()}return i}(e,t,r,new Nh(n,e.children)));return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:[]}}if(0===n.length&&function(e,t,n){return n.some((function(n){return Jf(e,t,n)}))}(e,n,r)){var a=new Nh(e.segments,function(e,t,n,r,i,o){var a,s={},u=_createForOfIteratorHelper(r);try{for(u.s();!(a=u.n()).done;){var c=a.value;if(Jf(e,n,c)&&!i[ed(c)]){var l=new Nh([],{});l._sourceSegment=e,l._segmentIndexShift="legacy"===o?e.segments.length:t.length,s[ed(c)]=l}}}catch(h){u.e(h)}finally{u.f()}return Object.assign(Object.assign({},i),s)}(e,t,n,r,e.children,i));return a._sourceSegment=e,a._segmentIndexShift=t.length,{segmentGroup:a,slicedSegments:n}}var s=new Nh(e.segments,e.children);return s._sourceSegment=e,s._segmentIndexShift=t.length,{segmentGroup:s,slicedSegments:n}}function Jf(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path&&void 0===n.redirectTo}function ed(e){return e.outlet||"primary"}function td(e){return e.data||{}}function nd(e){return e.resolve||{}}function rd(e,t,n,r){var i=Wf(e,t,r);return Th(i.resolve?i.resolve(t,n):i(t,n))}function id(e){return function(t){return t.pipe(Ml((function(t){var n=e(t);return n?j(n).pipe(U((function(){return t}))):j([t])})))}}var od=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldDetach",value:function(e){return!1}},{key:"store",value:function(e,t){}},{key:"shouldAttach",value:function(e){return!1}},{key:"retrieve",value:function(e){return null}},{key:"shouldReuseRoute",value:function(e,t){return e.routeConfig===t.routeConfig}}]),e}(),ad=new je("ROUTES"),sd=function(){function e(t,n,r,i){_classCallCheck(this,e),this.loader=t,this.compiler=n,this.onLoadStartListener=r,this.onLoadEndListener=i}return _createClass(e,[{key:"load",value:function(e,t){var n=this;return this.onLoadStartListener&&this.onLoadStartListener(t),this.loadModuleFactory(t.loadChildren).pipe(U((function(r){n.onLoadEndListener&&n.onLoadEndListener(t);var i=r.create(e);return new bh(Sh(i.injector.get(ad)).map(kh),i)})))}},{key:"loadModuleFactory",value:function(e){var t=this;return"string"==typeof e?j(this.loader.load(e)):Th(e()).pipe(H((function(e){return e instanceof it?nl(e):j(t.compiler.compileModuleAsync(e))})))}}]),e}(),ud=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"shouldProcessUrl",value:function(e){return!0}},{key:"extract",value:function(e){return e}},{key:"merge",value:function(e,t){return e}}]),e}();function cd(e){throw e}function ld(e,t,n){return t.parse("/")}function hd(e,t){return nl(null)}var fd,dd,pd,vd,md=((fd=function(){function e(t,n,r,i,o,a,s,u){var c=this;_classCallCheck(this,e),this.rootComponentType=t,this.urlSerializer=n,this.rootContexts=r,this.location=i,this.config=u,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new R,this.errorHandler=cd,this.malformedUriErrorHandler=ld,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:hd,afterPreactivation:hd},this.urlHandlingStrategy=new ud,this.routeReuseStrategy=new od,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="legacy",this.ngModule=o.get(rt),this.console=o.get(Us);var l=o.get(Js);this.isNgZoneEnabled=l instanceof Js,this.resetConfig(u),this.currentUrlTree=new Dh(new Nh([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new sd(a,s,(function(e){return c.triggerEvent(new sh(e))}),(function(e){return c.triggerEvent(new uh(e))})),this.routerState=rf(this.currentUrlTree,this.rootComponentType),this.transitions=new rl({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}return _createClass(e,[{key:"setupNavigations",value:function(e){var t=this,n=this.events;return e.pipe(fl((function(e){return 0!==e.id})),U((function(e){return Object.assign(Object.assign({},e),{extractedUrl:t.urlHandlingStrategy.extract(e.rawUrl)})})),Ml((function(e){var r,i,o,a,s=!1,u=!1;return nl(e).pipe(ql((function(e){t.currentNavigation={id:e.id,initialUrl:e.currentRawUrl,extractedUrl:e.extractedUrl,trigger:e.source,extras:e.extras,previousNavigation:t.lastSuccessfulNavigation?Object.assign(Object.assign({},t.lastSuccessfulNavigation),{previousNavigation:null}):null}})),Ml((function(e){var r,i,o,a,s=!t.navigated||e.extractedUrl.toString()!==t.browserUrlTree.toString();if(("reload"===t.onSameUrlNavigation||s)&&t.urlHandlingStrategy.shouldProcessUrl(e.rawUrl))return nl(e).pipe(Ml((function(e){var r=t.transitions.getValue();return n.next(new Zl(e.id,t.serializeUrl(e.extractedUrl),e.source,e.restoredState)),r!==t.transitions.getValue()?ul:[e]})),Ml((function(e){return Promise.resolve(e)})),(r=t.ngModule.injector,i=t.configLoader,o=t.urlSerializer,a=t.config,function(e){return e.pipe(Ml((function(e){return function(e,t,n,r,i){return new Of(e,t,n,r,i).apply()}(r,i,o,e.extractedUrl,a).pipe(U((function(t){return Object.assign(Object.assign({},e),{urlAfterRedirects:t})})))})))}),ql((function(e){t.currentNavigation=Object.assign(Object.assign({},t.currentNavigation),{finalUrl:e.urlAfterRedirects})})),function(e,n,r,i,o){return function(r){return r.pipe(H((function(r){return function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"emptyOnly",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"legacy";return new Qf(e,t,n,r,i,o).recognize()}(e,n,r.urlAfterRedirects,(a=r.urlAfterRedirects,t.serializeUrl(a)),i,o).pipe(U((function(e){return Object.assign(Object.assign({},r),{targetSnapshot:e})})));var a})))}}(t.rootComponentType,t.config,0,t.paramsInheritanceStrategy,t.relativeLinkResolution),ql((function(e){"eager"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(e.urlAfterRedirects,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),ql((function(e){var r=new nh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);n.next(r)})));if(s&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){var u=e.id,c=e.extractedUrl,l=e.source,h=e.restoredState,f=e.extras,d=new Zl(u,t.serializeUrl(c),l,h);n.next(d);var p=rf(c,t.rootComponentType).snapshot;return nl(Object.assign(Object.assign({},e),{targetSnapshot:p,urlAfterRedirects:c,extras:Object.assign(Object.assign({},f),{skipLocationChange:!1,replaceUrl:!1})}))}return t.rawUrlTree=e.rawUrl,t.browserUrlTree=e.urlAfterRedirects,e.resolve(null),ul})),id((function(e){var n=e.targetSnapshot,r=e.id,i=e.extractedUrl,o=e.rawUrl,a=e.extras,s=a.skipLocationChange,u=a.replaceUrl;return t.hooks.beforePreactivation(n,{navigationId:r,appliedUrlTree:i,rawUrlTree:o,skipLocationChange:!!s,replaceUrl:!!u})})),ql((function(e){var n=new rh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),U((function(e){return Object.assign(Object.assign({},e),{guards:(n=e.targetSnapshot,r=e.currentSnapshot,i=t.rootContexts,o=n._root,function e(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},a=tf(n);return t.children.forEach((function(t){!function(t,n,r,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{canDeactivateChecks:[],canActivateChecks:[]},a=t.value,s=n?n.value:null,u=r?r.getContext(t.value.outlet):null;if(s&&a.routeConfig===s.routeConfig){var c=function(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Fh(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Fh(e.url,t.url)||!Ch(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ff(e,t)||!Ch(e.queryParams,t.queryParams);case"paramsChange":default:return!ff(e,t)}}(s,a,a.routeConfig.runGuardsAndResolvers);c?o.canActivateChecks.push(new Bf(i)):(a.data=s.data,a._resolvedData=s._resolvedData),e(t,n,a.component?u?u.children:null:r,i,o),c&&o.canDeactivateChecks.push(new Uf(u&&u.outlet&&u.outlet.component||null,s))}else s&&zf(n,u,o),o.canActivateChecks.push(new Bf(i)),e(t,null,a.component?u?u.children:null:r,i,o)}(t,a[t.value.outlet],r,i.concat([t.value]),o),delete a[t.value.outlet]})),Rh(a,(function(e,t){return zf(e,r.getContext(t),o)})),o}(o,r?r._root:null,i,[o.value]))});var n,r,i,o})),function(e,t){return function(n){return n.pipe(H((function(n){var r=n.targetSnapshot,i=n.currentSnapshot,o=n.guards,a=o.canActivateChecks,s=o.canDeactivateChecks;return 0===s.length&&0===a.length?nl(Object.assign(Object.assign({},n),{guardsResult:!0})):function(e,t,n,r){return j(e).pipe(H((function(e){return function(e,t,n,r,i){var o=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return o&&0!==o.length?nl(o.map((function(o){var a,s=Wf(o,t,i);if(function(e){return e&&Sf(e.canDeactivate)}(s))a=Th(s.canDeactivate(e,t,n,r));else{if(!Sf(s))throw new Error("Invalid CanDeactivate guard");a=Th(s(e,t,n,r))}return a.pipe(Ol())}))).pipe(jf()):nl(!0)}(e.component,e.route,n,t,r)})),Ol((function(e){return!0!==e}),!0))}(s,r,i,e).pipe(H((function(n){return n&&"boolean"==typeof n?function(e,t,n,r){return j(t).pipe(jl((function(t){return j([qf(t.route.parent,r),Hf(t.route,r),Kf(e,t.path,n),Gf(e,t.route,n)]).pipe(hl(),Ol((function(e){return!0!==e}),!0))})),Ol((function(e){return!0!==e}),!0))}(r,a,e,t):nl(n)})),U((function(e){return Object.assign(Object.assign({},n),{guardsResult:e})})))})))}}(t.ngModule.injector,(function(e){return t.triggerEvent(e)})),ql((function(e){if(If(e.guardsResult)){var n=gh('Redirecting to "'.concat(t.serializeUrl(e.guardsResult),'"'));throw n.url=e.guardsResult,n}})),ql((function(e){var n=new ih(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot,!!e.guardsResult);t.triggerEvent(n)})),fl((function(e){if(!e.guardsResult){t.resetUrlToCurrentUrlTree();var r=new eh(e.id,t.serializeUrl(e.extractedUrl),"");return n.next(r),e.resolve(!1),!1}return!0})),id((function(e){if(e.guards.canActivateChecks.length)return nl(e).pipe(ql((function(e){var n=new oh(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})),(n=t.paramsInheritanceStrategy,r=t.ngModule.injector,function(e){return e.pipe(H((function(e){var t=e.targetSnapshot,i=e.guards.canActivateChecks;return i.length?j(i).pipe(jl((function(e){return function(e,t,n,r){return function(e,t,n,r){var i=Object.keys(e);if(0===i.length)return nl({});if(1===i.length){var o=i[0];return rd(e[o],t,n,r).pipe(U((function(e){return _defineProperty({},o,e)})))}var a={};return j(i).pipe(H((function(i){return rd(e[i],t,n,r).pipe(U((function(e){return a[i]=e,e})))}))).pipe(Sl(),U((function(){return a})))}(e._resolve,e,t,r).pipe(U((function(t){return e._resolvedData=t,e.data=Object.assign(Object.assign({},e.data),af(e,n).resolve),null})))}(e.route,t,n,r)})),function(e,t){return arguments.length>=2?function(n){return b(Wl(e,t),ml(1),kl(t))(n)}:function(t){return b(Wl((function(t,n,r){return e(t,n,r+1)})),ml(1))(t)}}((function(e,t){return e})),U((function(t){return e}))):nl(e)})))}),ql((function(e){var n=new ah(e.id,t.serializeUrl(e.extractedUrl),t.serializeUrl(e.urlAfterRedirects),e.targetSnapshot);t.triggerEvent(n)})));var n,r})),id((function(e){var n=e.targetSnapshot,r=e.id,i=e.extractedUrl,o=e.rawUrl,a=e.extras,s=a.skipLocationChange,u=a.replaceUrl;return t.hooks.afterPreactivation(n,{navigationId:r,appliedUrlTree:i,rawUrlTree:o,skipLocationChange:!!s,replaceUrl:!!u})})),U((function(e){var n=function(e,t,n){var r=function e(t,n,r){if(r&&t.shouldReuseRoute(n.value,r.value.snapshot)){var i=r.value;i._futureSnapshot=n.value;var o=function(t,n,r){return n.children.map((function(n){var i,o=_createForOfIteratorHelper(r.children);try{for(o.s();!(i=o.n()).done;){var a=i.value;if(t.shouldReuseRoute(a.value.snapshot,n.value))return e(t,n,a)}}catch(s){o.e(s)}finally{o.f()}return e(t,n)}))}(t,n,r);return new ef(i,o)}var a=t.retrieve(n.value);if(a){var s=a.route;return function e(t,n){if(t.value.routeConfig!==n.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==n.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");n.value._futureSnapshot=t.value;for(var r=0;r<t.children.length;++r)e(t.children[r],n.children[r])}(n,s),s}var u,c=new of(new rl((u=n.value).url),new rl(u.params),new rl(u.queryParams),new rl(u.fragment),new rl(u.data),u.outlet,u.component,u),l=n.children.map((function(n){return e(t,n)}));return new ef(c,l)}(e,t._root,n?n._root:void 0);return new nf(r,t)}(t.routeReuseStrategy,e.targetSnapshot,e.currentRouterState);return Object.assign(Object.assign({},e),{targetRouterState:n})})),ql((function(e){t.currentUrlTree=e.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(t.currentUrlTree,e.rawUrl),t.routerState=e.targetRouterState,"deferred"===t.urlUpdateStrategy&&(e.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,!!e.extras.replaceUrl,e.id,e.extras.state),t.browserUrlTree=e.urlAfterRedirects)})),(i=t.rootContexts,o=t.routeReuseStrategy,a=function(e){return t.triggerEvent(e)},U((function(e){return new Cf(o,e.targetRouterState,e.currentRouterState,a).activate(i),e}))),ql({next:function(){s=!0},complete:function(){s=!0}}),(r=function(){if(!s&&!u){t.resetUrlToCurrentUrlTree();var r=new eh(e.id,t.serializeUrl(e.extractedUrl),"Navigation ID ".concat(e.id," is not equal to the current navigation id ").concat(t.navigationId));n.next(r),e.resolve(!1)}t.currentNavigation=null},function(e){return e.lift(new Ql(r))}),Il((function(r){if(u=!0,(s=r)&&s.ngNavigationCancelingError){var i=If(r.url);i||(t.navigated=!0,t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl));var o=new eh(e.id,t.serializeUrl(e.extractedUrl),r.message);n.next(o),i?setTimeout((function(){var n=t.urlHandlingStrategy.merge(r.url,t.rawUrlTree);return t.scheduleNavigation(n,"imperative",null,{skipLocationChange:e.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy},{resolve:e.resolve,reject:e.reject,promise:e.promise})}),0):e.resolve(!1)}else{t.resetStateAndUrl(e.currentRouterState,e.currentUrlTree,e.rawUrl);var a=new th(e.id,t.serializeUrl(e.extractedUrl),r);n.next(a);try{e.resolve(t.errorHandler(r))}catch(zv){e.reject(zv)}}var s;return ul})))})))}},{key:"resetRootComponentType",value:function(e){this.rootComponentType=e,this.routerState.root.component=this.rootComponentType}},{key:"getTransition",value:function(){var e=this.transitions.value;return e.urlAfterRedirects=this.browserUrlTree,e}},{key:"setTransition",value:function(e){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),e))}},{key:"initialNavigation",value:function(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}},{key:"setUpLocationChangeListener",value:function(){var e=this;this.locationSubscription||(this.locationSubscription=this.location.subscribe((function(t){var n=e.parseUrl(t.url),r="popstate"===t.type?"popstate":"hashchange",i=t.state&&t.state.navigationId?t.state:null;setTimeout((function(){e.scheduleNavigation(n,r,i,{replaceUrl:!0})}),0)})))}},{key:"getCurrentNavigation",value:function(){return this.currentNavigation}},{key:"triggerEvent",value:function(e){this.events.next(e)}},{key:"resetConfig",value:function(e){_h(e),this.config=e.map(kh),this.navigated=!1,this.lastSuccessfulId=-1}},{key:"ngOnDestroy",value:function(){this.dispose()}},{key:"dispose",value:function(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=null)}},{key:"createUrlTree",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.relativeTo,r=t.queryParams,i=t.fragment,o=t.preserveQueryParams,a=t.queryParamsHandling,s=t.preserveFragment;lr()&&o&&console&&console.warn&&console.warn("preserveQueryParams is deprecated, use queryParamsHandling instead.");var u=n||this.routerState.root,c=s?this.currentUrlTree.fragment:i,l=null;if(a)switch(a){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}else l=o?this.currentUrlTree.queryParams:r||null;return null!==l&&(l=this.removeEmptyProps(l)),function(e,t,n,r,i){if(0===n.length)return pf(t.root,t.root,t,r,i);var o=function(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new vf(!0,0,e);var t=0,n=!1,r=e.reduce((function(e,r,i){if("object"==typeof r&&null!=r){if(r.outlets){var o={};return Rh(r.outlets,(function(e,t){o[t]="string"==typeof e?e.split("/"):e})),[].concat(_toConsumableArray(e),[{outlets:o}])}if(r.segmentPath)return[].concat(_toConsumableArray(e),[r.segmentPath])}return"string"!=typeof r?[].concat(_toConsumableArray(e),[r]):0===i?(r.split("/").forEach((function(r,i){0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?t++:""!=r&&e.push(r))})),e):[].concat(_toConsumableArray(e),[r])}),[]);return new vf(n,t,r)}(n);if(o.toRoot())return pf(t.root,new Nh([],{}),t,r,i);var a=function(e,t,n){if(e.isAbsolute)return new mf(t.root,!0,0);if(-1===n.snapshot._lastPathIndex)return new mf(n.snapshot._urlSegment,!0,0);var r=df(e.commands[0])?0:1;return function(e,t,n){for(var r=e,i=t,o=n;o>i;){if(o-=i,!(r=r.parent))throw new Error("Invalid number of '../'");i=r.segments.length}return new mf(r,!1,i-o)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,e.numberOfDoubleDots)}(o,t,e),s=a.processChildren?bf(a.segmentGroup,a.index,o.commands):yf(a.segmentGroup,a.index,o.commands);return pf(a.segmentGroup,s,t,r,i)}(u,this.currentUrlTree,e,l,c)}},{key:"navigateByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};lr()&&this.isNgZoneEnabled&&!Js.isInAngularZone()&&this.console.warn("Navigation triggered outside Angular zone, did you forget to call 'ngZone.run()'?");var n=If(e)?e:this.parseUrl(e),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,t)}},{key:"navigate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipLocationChange:!1};return function(e){for(var t=0;t<e.length;t++){var n=e[t];if(null==n)throw new Error("The requested path contains ".concat(n," segment at index ").concat(t))}}(e),this.navigateByUrl(this.createUrlTree(e,t),t)}},{key:"serializeUrl",value:function(e){return this.urlSerializer.serialize(e)}},{key:"parseUrl",value:function(e){var t;try{t=this.urlSerializer.parse(e)}catch(n){t=this.malformedUriErrorHandler(n,this.urlSerializer,e)}return t}},{key:"isActive",value:function(e,t){if(If(e))return Ah(this.currentUrlTree,e,t);var n=this.parseUrl(e);return Ah(this.currentUrlTree,n,t)}},{key:"removeEmptyProps",value:function(e){return Object.keys(e).reduce((function(t,n){var r=e[n];return null!=r&&(t[n]=r),t}),{})}},{key:"processNavigations",value:function(){var e=this;this.navigations.subscribe((function(t){e.navigated=!0,e.lastSuccessfulId=t.id,e.events.next(new Jl(t.id,e.serializeUrl(t.extractedUrl),e.serializeUrl(e.currentUrlTree))),e.lastSuccessfulNavigation=e.currentNavigation,e.currentNavigation=null,t.resolve(!0)}),(function(t){e.console.warn("Unhandled Navigation Error: ")}))}},{key:"scheduleNavigation",value:function(e,t,n,r,i){var o,a,s,u=this.getTransition();if(u&&"imperative"!==t&&"imperative"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(u&&"hashchange"==t&&"popstate"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);if(u&&"popstate"==t&&"hashchange"===u.source&&u.rawUrl.toString()===e.toString())return Promise.resolve(!0);i?(o=i.resolve,a=i.reject,s=i.promise):s=new Promise((function(e,t){o=e,a=t}));var c=++this.navigationId;return this.setTransition({id:c,source:t,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:e,extras:r,resolve:o,reject:a,promise:s,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),s.catch((function(e){return Promise.reject(e)}))}},{key:"setBrowserUrl",value:function(e,t,n,r){var i=this.urlSerializer.serialize(e);r=r||{},this.location.isCurrentPathEqualTo(i)||t?this.location.replaceState(i,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(i,"",Object.assign(Object.assign({},r),{navigationId:n}))}},{key:"resetStateAndUrl",value:function(e,t,n){this.routerState=e,this.currentUrlTree=t,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}},{key:"resetUrlToCurrentUrlTree",value:function(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}},{key:"url",get:function(){return this.serializeUrl(this.currentUrlTree)}}]),e}()).\u0275fac=function(e){Bo()},fd.\u0275dir=xt({type:fd}),fd),gd=function e(){_classCallCheck(this,e),this.outlet=null,this.route=null,this.resolver=null,this.children=new yd,this.attachRef=null},yd=function(){function e(){_classCallCheck(this,e),this.contexts=new Map}return _createClass(e,[{key:"onChildOutletCreated",value:function(e,t){var n=this.getOrCreateContext(e);n.outlet=t,this.contexts.set(e,n)}},{key:"onChildOutletDestroyed",value:function(e){var t=this.getContext(e);t&&(t.outlet=null)}},{key:"onOutletDeactivated",value:function(){var e=this.contexts;return this.contexts=new Map,e}},{key:"onOutletReAttached",value:function(e){this.contexts=e}},{key:"getOrCreateContext",value:function(e){var t=this.getContext(e);return t||(t=new gd,this.contexts.set(e,t)),t}},{key:"getContext",value:function(e){return this.contexts.get(e)||null}}]),e}(),bd=((dd=function(){function e(t,n,r,i,o){_classCallCheck(this,e),this.parentContexts=t,this.location=n,this.resolver=r,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new ps,this.deactivateEvents=new ps,this.name=i||"primary",t.onChildOutletCreated(this.name,this)}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.parentContexts.onChildOutletDestroyed(this.name)}},{key:"ngOnInit",value:function(){if(!this.activated){var e=this.parentContexts.getContext(this.name);e&&e.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.resolver||null))}}},{key:"detach",value:function(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();var e=this.activated;return this.activated=null,this._activatedRoute=null,e}},{key:"attach",value:function(e,t){this.activated=e,this._activatedRoute=t,this.location.insert(e.hostView)}},{key:"deactivate",value:function(){if(this.activated){var e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}},{key:"activateWith",value:function(e,t){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=e;var n=(t=t||this.resolver).resolveComponentFactory(e._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new _d(e,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}},{key:"isActivated",get:function(){return!!this.activated}},{key:"component",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}},{key:"activatedRoute",get:function(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}},{key:"activatedRouteData",get:function(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}}]),e}()).\u0275fac=function(e){return new(e||dd)(Mo(yd),Mo($a),Mo(Ca),Lo("name"),Mo(ro))},dd.\u0275dir=xt({type:dd,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),dd),_d=function(){function e(t,n,r){_classCallCheck(this,e),this.route=t,this.childContexts=n,this.parent=r}return _createClass(e,[{key:"get",value:function(e,t){return e===of?this.route:e===yd?this.childContexts:this.parent.get(e,t)}}]),e}(),wd=function e(){_classCallCheck(this,e)},xd=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return nl(null)}}]),e}(),kd=((vd=function(){function e(t,n,r,i,o){_classCallCheck(this,e),this.router=t,this.injector=i,this.preloadingStrategy=o,this.loader=new sd(n,r,(function(e){return t.triggerEvent(new sh(e))}),(function(e){return t.triggerEvent(new uh(e))}))}return _createClass(e,[{key:"setUpPreloading",value:function(){var e=this;this.subscription=this.router.events.pipe(fl((function(e){return e instanceof Jl})),jl((function(){return e.preload()}))).subscribe((function(){}))}},{key:"preload",value:function(){var e=this.injector.get(rt);return this.processRoutes(e,this.router.config)}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"processRoutes",value:function(e,t){var n,r=[],i=_createForOfIteratorHelper(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(o.loadChildren&&!o.canLoad&&o._loadedConfig){var a=o._loadedConfig;r.push(this.processRoutes(a.module,a.routes))}else o.loadChildren&&!o.canLoad?r.push(this.preloadConfig(e,o)):o.children&&r.push(this.processRoutes(e,o.children))}}catch(s){i.e(s)}finally{i.f()}return j(r).pipe(K(),U((function(e){})))}},{key:"preloadConfig",value:function(e,t){var n=this;return this.preloadingStrategy.preload(t,(function(){return n.loader.load(e.injector,t).pipe(H((function(e){return t._loadedConfig=e,n.processRoutes(e.module,e.routes)})))}))}}]),e}()).\u0275fac=function(e){return new(e||vd)(Ze(md),Ze(wu),Ze(Qs),Ze(_o),Ze(wd))},vd.\u0275prov=pe({token:vd,factory:vd.\u0275fac}),vd),Cd=((pd=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,e),this.router=t,this.viewportScroller=n,this.options=r,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},r.scrollPositionRestoration=r.scrollPositionRestoration||"disabled",r.anchorScrolling=r.anchorScrolling||"disabled"}return _createClass(e,[{key:"init",value:function(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}},{key:"createScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof Zl?(e.store[e.lastId]=e.viewportScroller.getScrollPosition(),e.lastSource=t.navigationTrigger,e.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Jl&&(e.lastId=t.id,e.scheduleScrollEvent(t,e.router.parseUrl(t.urlAfterRedirects).fragment))}))}},{key:"consumeScrollEvents",value:function(){var e=this;return this.router.events.subscribe((function(t){t instanceof dh&&(t.position?"top"===e.options.scrollPositionRestoration?e.viewportScroller.scrollToPosition([0,0]):"enabled"===e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===e.options.anchorScrolling?e.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==e.options.scrollPositionRestoration&&e.viewportScroller.scrollToPosition([0,0]))}))}},{key:"scheduleScrollEvent",value:function(e,t){this.router.triggerEvent(new dh(e,"popstate"===this.lastSource?this.store[this.restoredId]:null,t))}},{key:"ngOnDestroy",value:function(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}]),e}()).\u0275fac=function(e){Bo()},pd.\u0275dir=xt({type:pd}),pd),Ed=new je("ROUTER_CONFIGURATION"),Sd=new je("ROUTER_FORROOT_GUARD"),Id=[Zu,{provide:Mh,useClass:Lh},{provide:md,useFactory:function(e,t,n,r,i,o,a){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:{},u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,l=new md(null,e,t,n,r,i,o,Sh(a));if(u&&(l.urlHandlingStrategy=u),c&&(l.routeReuseStrategy=c),s.errorHandler&&(l.errorHandler=s.errorHandler),s.malformedUriErrorHandler&&(l.malformedUriErrorHandler=s.malformedUriErrorHandler),s.enableTracing){var h=Au();l.events.subscribe((function(e){h.logGroup("Router Event: "+e.constructor.name),h.log(e.toString()),h.log(e),h.logGroupEnd()}))}return s.onSameUrlNavigation&&(l.onSameUrlNavigation=s.onSameUrlNavigation),s.paramsInheritanceStrategy&&(l.paramsInheritanceStrategy=s.paramsInheritanceStrategy),s.urlUpdateStrategy&&(l.urlUpdateStrategy=s.urlUpdateStrategy),s.relativeLinkResolution&&(l.relativeLinkResolution=s.relativeLinkResolution),l},deps:[Mh,yd,Zu,_o,wu,Qs,ad,Ed,[function(){return function e(){_classCallCheck(this,e)}}(),new ue],[function(){return function e(){_classCallCheck(this,e)}}(),new ue]]},yd,{provide:of,useFactory:function(e){return e.routerState.root},deps:[md]},{provide:wu,useClass:Cu},kd,xd,function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"preload",value:function(e,t){return t().pipe(Il((function(){return nl(null)})))}}]),e}(),{provide:Ed,useValue:{enableTracing:!1}}];function Rd(){return new du("Router",md)}var Td,Ad=((Td=function(){function e(t,n){_classCallCheck(this,e)}return _createClass(e,null,[{key:"forRoot",value:function(t,n){return{ngModule:e,providers:[Id,Fd(t),{provide:Sd,useFactory:Od,deps:[[md,new ue,new le]]},{provide:Ed,useValue:n||{}},{provide:Hu,useFactory:Nd,deps:[Ou,[new se(Qu),new ue],Ed]},{provide:Cd,useFactory:Dd,deps:[md,kc,Ed]},{provide:wd,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:xd},{provide:du,multi:!0,useFactory:Rd},[Md,{provide:Ds,multi:!0,useFactory:Ld,deps:[Md]},{provide:Wd,useFactory:Bd,deps:[Md]},{provide:Bs,multi:!0,useExisting:Wd}]]}}},{key:"forChild",value:function(t){return{ngModule:e,providers:[Fd(t)]}}}]),e}()).\u0275mod=_t({type:Td}),Td.\u0275inj=ve({factory:function(e){return new(e||Td)(Ze(Sd,8),Ze(md,8))}}),Td);function Dd(e,t,n){return n.scrollOffset&&t.setOffset(n.scrollOffset),new Cd(e,t,n)}function Nd(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n.useHash?new $u(e,t):new Yu(e,t)}function Od(e){if(e)throw new Error("RouterModule.forRoot() called twice. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function Fd(e){return[{provide:wo,multi:!0,useValue:e},{provide:ad,multi:!0,useValue:e}]}var Pd,Md=((Pd=function(){function e(t){_classCallCheck(this,e),this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new R}return _createClass(e,[{key:"appInitializer",value:function(){var e=this;return this.injector.get(Mu,Promise.resolve(null)).then((function(){var t=null,n=new Promise((function(e){return t=e})),r=e.injector.get(md),i=e.injector.get(Ed);if(e.isLegacyDisabled(i)||e.isLegacyEnabled(i))t(!0);else if("disabled"===i.initialNavigation)r.setUpLocationChangeListener(),t(!0);else{if("enabled"!==i.initialNavigation)throw new Error("Invalid initialNavigation options: '".concat(i.initialNavigation,"'"));r.hooks.afterPreactivation=function(){return e.initNavigation?nl(null):(e.initNavigation=!0,t(!0),e.resultOfPreactivationDone)},r.initialNavigation()}return n}))}},{key:"bootstrapListener",value:function(e){var t=this.injector.get(Ed),n=this.injector.get(kd),r=this.injector.get(Cd),i=this.injector.get(md),o=this.injector.get(bu);e===o.components[0]&&(this.isLegacyEnabled(t)?i.initialNavigation():this.isLegacyDisabled(t)&&i.setUpLocationChangeListener(),n.setUpPreloading(),r.init(),i.resetRootComponentType(o.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}},{key:"isLegacyEnabled",value:function(e){return"legacy_enabled"===e.initialNavigation||!0===e.initialNavigation||void 0===e.initialNavigation}},{key:"isLegacyDisabled",value:function(e){return"legacy_disabled"===e.initialNavigation||!1===e.initialNavigation}}]),e}()).\u0275fac=function(e){return new(e||Pd)(Ze(_o))},Pd.\u0275prov=pe({token:Pd,factory:Pd.\u0275fac}),Pd);function Ld(e){return e.appInitializer.bind(e)}function Bd(e){return e.bootstrapListener.bind(e)}var Ud,Wd=new je("Router Initializer"),zd=[],Vd=((Ud=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:Ud}),Ud.\u0275inj=ve({factory:function(e){return new(e||Ud)},imports:[[Ad.forRoot(zd)],Ad]}),Ud),jd=function(e,t){return(jd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function Hd(e,t){function n(){this.constructor=e}jd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var qd=function(){return(qd=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function Gd(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(t){o(t)}}function s(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function Kd(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Xd(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var Qd=n("Iab2"),Yd=function(e,t){return(Yd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function $d(e,t){function n(){this.constructor=e}Yd(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Zd(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function Jd(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var ep=function(){function e(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return e.prototype.setPlatform=function(e,t){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},e.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+r+"."),this.set(e,r)}},e.prototype.get=function(e){return e in this.flags||(this.flags[e]=this.evaluateFlag(e)),this.flags[e]},e.prototype.getNumber=function(e){return this.get(e)},e.prototype.getBool=function(e){return this.get(e)},e.prototype.getFlags=function(){return this.flags},Object.defineProperty(e.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)},e.prototype.evaluateFlag=function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},e.prototype.setFlags=function(e){this.flags=Object.assign({},e)},e.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},e.prototype.populateURLFlags=function(){var e=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var t,n=(t={},this.global.location.search.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return tp(t,n[0],n[1]),n.join("=")})),t);"tfjsflags"in n&&n.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=n[0];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if(""+ +t===t)return+t;throw new Error("Could not parse value flag value "+t+" for flag "+e+".")}(r,n[1])}))}},e}();function tp(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function np(){return rp}var rp=null,ip=new Map,op=new Map;function ap(e,t){var n=lp(e,t);return ip.get(n)}function sp(e){for(var t=ip.entries(),n=[];;){var r=t.next(),i=r.value;if(r.done)break;var o=i[1];i[0].split("_")[0]===e&&n.push(o)}return n}function up(e){var t=e.kernelName,n=e.backendName,r=lp(t,n);if(ip.has(r))throw new Error("The kernel '"+t+"' for backend '"+n+"' is already registered");ip.set(r,e)}function cp(e){var t=e.kernelName;op.has(t)&&console.warn("Overriding the gradient for '"+t+"'"),op.set(t,e)}function lp(e,t){return t+"_"+e}function hp(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function fp(e,t,n){return Math.max(e,Math.min(t,n))}function dp(e){return e%2==0?e:e+1}function pp(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function vp(e,t){if(!e)throw new Error("string"==typeof t?t:t())}function mp(e,t,n){void 0===n&&(n=""),vp(_p(e,t),(function(){return n+" Shapes "+e+" and "+t+" must match"}))}function gp(e){vp(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function yp(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n=!1),null==t&&(t=[]),Array.isArray(e)||Fp(e)&&!n)for(var r=0;r<e.length;++r)yp(e[r],t,n);else t.push(e);return t}function bp(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function _p(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function wp(e){return e%1==0}function xp(e){if(null!=Math.tanh)return Math.tanh(e);if(e===1/0)return 1;if(e===-1/0)return-1;var t=Math.exp(2*e);return(t-1)/(t+1)}function kp(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Cp(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Ep(e,t,n){return void 0===t&&(t=function(e){return 0}),new Promise((function(r,i){var o=0;!function a(){if(e())r();else{o++;var s=t(o);null!=n&&o>=n?i():setTimeout(a,s)}}()}))}function Sp(e,t){for(var n=1,r=-1,i=0;i<e.length;++i)if(e[i]>=0)n*=e[i];else if(-1===e[i]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(e[i]<0)throw Error("Shapes can not be < 0. Found "+e[i]+" at dim "+i);if(-1===r){if(t>0&&t!==n)throw Error("Size("+t+") must match the product of shape "+e);return e}if(0===n)throw Error("Cannot infer the missing size in ["+e+"] when there are 0 elements");if(t%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+t+" / "+n);var o=e.slice();return o[r]=t/n,o}function Ip(e,t){var n=t.length;return vp((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+e})),vp(e.every((function(e){return wp(e)})),(function(){return"All values in axis param must be integers but got axis "+e})),e.map((function(e){return e<0?n+e:e}))}function Rp(e,t){for(var n=[],r=[],i=null!=t&&Array.isArray(t)&&0===t.length,o=null==t||i?null:Ip(t,e).sort(),a=0,s=0;s<e.length;++s){if(null!=o){if(o[a]===s&&1!==e[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+e[s]+"' is not 1");(null==o[a]||o[a]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),o[a]<=s&&a++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Tp(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type "+e);n=new Uint8Array(t)}return n}function Ap(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type "+e);n=new Array(t)}return n}function Dp(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+t+" being uploaded contains "+r+".")}}function Np(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}function Op(e,t){return!("complex64"===t||"float32"===t&&"complex64"!==e||"int32"===t&&"float32"!==e&&"complex64"!==e||"bool"===t&&"bool"===e)}function Fp(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Pp(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype "+e)}function Mp(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}function Lp(e){return"string"==typeof e||e instanceof String}function Bp(e){return"boolean"==typeof e}function Up(e){return"number"==typeof e}function Wp(e){return Array.isArray(e)?Wp(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Up(e)?"float32":Lp(e)?"string":Bp(e)?"bool":"float32"}function zp(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Vp(e,t){for(var n=t;n<e;++n)if(e%n==0)return n;return e}function jp(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Hp(e,t,n){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=yp(e)),n&&Dp(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var r=new Uint8Array(e.length),i=0;i<r.length;++i)0!==Math.round(e[i])&&(r[i]=1);return r}throw new Error("Unknown data type "+t)}function qp(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("["+e+"] does not match the input size.");return function e(t,n,r){var i=new Array;if(1===n.length)for(var o=n[0],a=0;a<o;a++)i[a]=r[t+a];else{o=n[0];var s=n.slice(1),u=s.reduce((function(e,t){return e*t}));for(a=0;a<o;a++)i[a]=e(t+a*u,s,r)}return i}(0,e,t)}function Gp(e,t){for(var n=Kp(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Kp(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type "+t)}function Xp(){return np().platform.now()}function Qp(e){e.forEach((function(t){vp(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+e+"]."}))}))}function Yp(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",np().platform.encode(e,t)}function $p(e,t){return void 0===t&&(t="utf-8"),t=t||"utf-8",np().platform.decode(e,t)}function Zp(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],i=0;i<e.length-1;++i)r+=n[i]*e[i];return r}function Jp(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),i=0;i<r.length-1;++i)r[i]=Math.floor(e/n[i]),e-=r[i]*n[i];return r[r.length-1]=e,r}Object.freeze({shuffle:hp,clamp:fp,nearestLargerEven:dp,sum:pp,randUniform:function(e,t){var n=Math.random();return t*n+(1-n)*e},distSquared:function(e,t){for(var n=0,r=0;r<e.length;r++){var i=Number(e[r])-Number(t[r]);n+=i*i}return n},assert:vp,assertShapesMatch:mp,assertNonNull:gp,flatten:yp,sizeFromShape:bp,isScalarShape:function(e){return 0===e.length},arraysEqual:_p,isInt:wp,tanh:xp,sizeToSquarishShape:kp,createShuffledIndices:function(e){for(var t=new Uint32Array(e),n=0;n<e;++n)t[n]=n;return hp(t),t},rightPad:Cp,repeatedTry:Ep,inferFromImplicitShape:Sp,parseAxisParam:Ip,squeezeShape:Rp,getTypedArrayFromDType:Tp,getArrayFromDType:Ap,checkConversionForErrors:Dp,isValidDtype:Np,hasEncodingLoss:Op,isTypedArray:Fp,bytesPerElement:Pp,bytesFromStringArray:Mp,isString:Lp,isBoolean:Bp,isNumber:Up,inferDtype:Wp,isFunction:zp,nearestDivisor:Vp,computeStrides:jp,toTypedArray:Hp,toNestedArray:qp,makeOnesTypedArray:Gp,makeZerosTypedArray:Kp,now:Xp,assertNonNegativeIntegerDimensions:Qp,fetch:function(e,t){return np().platform.fetch(e,t)},encodeString:Yp,decodeString:$p,locToIndex:Zp,indexToLoc:Jp});var ev=function(){function e(e,t){this.backendTimer=e,this.logger=t,null==t&&(this.logger=new tv)}return e.prototype.profileKernel=function(e,t,n){var r,i=this,o=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var i=e[r];if(isNaN(i)||!isFinite(i))return console.warn("Found "+i+" in the result of '"+n+"'"),!0}}(r,n.dtype,e),o.then((function(o){var a="";null!=o.getExtraProfileInfo&&(a=o.getExtraProfileInfo()),i.logger.logKernelProfile(e,n,r,o.kernelMs,t,a)}))}))})),r},e}(),tv=function(){function e(){}return e.prototype.logKernelProfile=function(e,t,n,r,i,o){var a="number"==typeof r?Cp(r+"ms",9):r.error,s=Cp(e,25),u=t.rank,c=t.size,l=Cp(t.shape.toString(),14),h="";for(var f in i){var d=i[f].shape||t.shape,p=d.length;h+=f+": "+p+"D "+(p>0?d:"")+" "}console.log("%c"+s+"\t%c"+a+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+h+"\t%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},e}();function nv(e,t,n){return Cp(Array.isArray(e)?parseFloat(e[0].toFixed(7))+" + "+parseFloat(e[1].toFixed(7))+"j":Lp(e)?"'"+e+"'":"bool"===n?rv(e):parseFloat(e.toFixed(7)).toString(),t)}function rv(e){return 0===e?"false":"true"}function iv(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var ov=function(){function e(e,t,n){var r=this;if(this.dtype=t,this.shape=e.slice(),this.size=bp(e),null!=n){var i=n.length;vp(i===this.size,(function(){return"Length of values '"+i+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===t)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Ap(t,this.size),this.strides=jp(e)}return e.prototype.set=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),vp(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var i=this.locToIndex(n);this.values[i]=e},e.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];0===e.length&&(e=[0]);for(var n=0,r=0,i=e;r<i.length;r++){var o=i[r];if(o<0||o>=this.shape[n]){var a="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(a)}n++}for(var s=e[e.length-1],u=0;u<e.length-1;++u)s+=this.strides[u]*e[u];return this.values[s]},e.prototype.locToIndex=function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},e.prototype.indexToLoc=function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.toTensor=function(){return av().makeTensor(this.values,this.shape,this.dtype)},e}(),av=null,sv=null,uv=null,cv=function(){function e(e,t,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=bp(e),this.strides=jp(e),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return e.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},e.prototype.asScalar=function(){return this.throwIfDisposed(),vp(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},e.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},e.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},e.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},e.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),this.reshape([e,t,n,r])},e.prototype.as5D=function(e,t,n,r,i){return this.throwIfDisposed(),this.reshape([e,t,n,r,i])},e.prototype.asType=function(e){return this.throwIfDisposed(),sv.cast(this,e)},Object.defineProperty(e.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),e.prototype.buffer=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,sv.buffer(this.shape,this.dtype,e)]}}))}))},e.prototype.bufferSync=function(){return sv.buffer(this.shape,this.dtype,this.dataSync())},e.prototype.array=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,qp(this.shape,e)]}}))}))},e.prototype.arraySync=function(){return qp(this.shape,this.dataSync())},e.prototype.data=function(){return Zd(this,void 0,void 0,(function(){var e,t;return Jd(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=av().read(this.dataId),"string"!==this.dtype?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(e){return $p(e)}))]}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},e.prototype.dataSync=function(){this.throwIfDisposed();var e=av().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return $p(e)}))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},e.prototype.bytes=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,av().read(this.dataId)];case 1:return e=t.sent(),"string"===this.dtype?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},e.prototype.dispose=function(){this.isDisposed||(av().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),e.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},e.prototype.toFloat=function(){return this.asType("float32")},e.prototype.toInt=function(){return this.asType("int32")},e.prototype.toBool=function(){return this.asType("bool")},e.prototype.print=function(e){return void 0===e&&(e=!1),sv.print(this,e)},e.prototype.reshape=function(e){return this.throwIfDisposed(),sv.reshape(this,e)},e.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},e.prototype.expandDims=function(e){return void 0===e&&(e=0),sv.expandDims(this,e)},e.prototype.cumsum=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=!1),void 0===n&&(n=!1),sv.cumsum(this,e,t,n)},e.prototype.squeeze=function(e){return this.throwIfDisposed(),sv.squeeze(this,e)},e.prototype.clone=function(){return this.throwIfDisposed(),sv.clone(this)},e.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),sv.oneHot(this,e,t,n)},e.prototype.toString=function(e){return void 0===e&&(e=!1),function(e,t,n,r){var i=jp(t),o=function(e,t,n,r){var i=bp(t),o=r[r.length-1],a=new Array(o).fill(0),s=t.length,u="complex64"===n?iv(e):e;if(s>1)for(var c=0;c<i/o;c++)for(var l=c*o,h=0;h<o;h++)a[h]=Math.max(a[h],nv(u[l+h],0,n).length);return a}(e,t,n,i),a=t.length,s=function e(t,n,r,i,o,a){void 0===a&&(a=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[nv(iv(t)[0],0,r)]:"bool"===r?[rv(t[0])]:[t[0].toString()];if(1===c){if(u>20){var l=Array.from(t.slice(0,3*s)),h=Array.from(t.slice((u-3)*s,u*s));return"complex64"===r&&(l=iv(l),h=iv(h)),["["+l.map((function(e,t){return nv(e,o[t],r)})).join(", ")+", ..., "+h.map((function(e,t){return nv(e,o[u-3+t],r)})).join(", ")+"]"]}return["["+("complex64"===r?iv(t):Array.from(t)).map((function(e,t){return nv(e,o[t],r)})).join(", ")+"]"]}var f=n.slice(1),d=i.slice(1),p=i[0]*s,v=[];if(u>20){for(var m=0;m<3;m++){var g=(y=m*p)+p;v.push.apply(v,e(t.slice(y,g),f,r,d,o,!1))}for(v.push("..."),m=u-3;m<u;m++)g=(y=m*p)+p,v.push.apply(v,e(t.slice(y,g),f,r,d,o,m===u-1))}else for(m=0;m<u;m++){var y;g=(y=m*p)+p,v.push.apply(v,e(t.slice(y,g),f,r,d,o,m===u-1))}var b=2===c?",":"";for(v[0]="["+v[0]+b,m=1;m<v.length-1;m++)v[m]=" "+v[m]+b;var _=",\n";for(m=2;m<c;m++)_+="\n";return v[v.length-1]=" "+v[v.length-1]+"]"+(a?"":_),v}(e,t,n,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+a),u.push("  shape: ["+t+"]"),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,e)},e.prototype.tile=function(e){return this.throwIfDisposed(),sv.tile(this,e)},e.prototype.gather=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),sv.gather(this,e,t)},e.prototype.matMul=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!1),this.throwIfDisposed(),sv.matMul(this,e,t,n)},e.prototype.dot=function(e){return this.throwIfDisposed(),sv.dot(this,e)},e.prototype.norm=function(e,t,n){return void 0===e&&(e="euclidean"),void 0===t&&(t=null),void 0===n&&(n=!1),this.throwIfDisposed(),sv.norm(this,e,t,n)},e.prototype.slice=function(e,t){return this.throwIfDisposed(),sv.slice(this,e,t)},e.prototype.reverse=function(e){return this.throwIfDisposed(),sv.reverse(this,e)},e.prototype.concat=function(t,n){return void 0===n&&(n=0),this.throwIfDisposed(),t instanceof e&&(t=[t]),sv.concat([this].concat(t),n)},e.prototype.split=function(e,t){return void 0===t&&(t=0),this.throwIfDisposed(),sv.split(this,e,t)},e.prototype.stack=function(e,t){return void 0===t&&(t=0),sv.stack([this,e],t)},e.prototype.unstack=function(e){return void 0===e&&(e=0),sv.unstack(this,e)},e.prototype.pad=function(e,t){return void 0===t&&(t=0),sv.pad(this,e,t)},e.prototype.batchNormalization=function(e,t,n,r,i){return void 0===n&&(n=.001),uv("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,i,r,n)},e.prototype.batchNorm=function(e,t,n,r,i){return void 0===i&&(i=.001),this.throwIfDisposed(),sv.batchNorm(this,e,t,n,r,i)},e.prototype.all=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.all(this,e,t)},e.prototype.any=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.any(this,e,t)},e.prototype.logSumExp=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.logSumExp(this,e,t)},e.prototype.sum=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.sum(this,e,t)},e.prototype.prod=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.prod(this,e,t)},e.prototype.mean=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.mean(this,e,t)},e.prototype.min=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.min(this,e,t)},e.prototype.max=function(e,t){return void 0===e&&(e=null),void 0===t&&(t=!1),this.throwIfDisposed(),sv.max(this,e,t)},e.prototype.argMin=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),sv.argMin(this,e)},e.prototype.argMax=function(e){return void 0===e&&(e=null),this.throwIfDisposed(),sv.argMax(this,e)},e.prototype.cast=function(e){return this.throwIfDisposed(),sv.cast(this,e)},e.prototype.add=function(e){return this.throwIfDisposed(),sv.add(this,e)},e.prototype.addStrict=function(e){return this.throwIfDisposed(),sv.addStrict(this,e)},e.prototype.atan2=function(e){return this.throwIfDisposed(),sv.atan2(this,e)},e.prototype.sub=function(e){return this.throwIfDisposed(),sv.sub(this,e)},e.prototype.subStrict=function(e){return this.throwIfDisposed(),sv.subStrict(this,e)},e.prototype.pow=function(e){return this.throwIfDisposed(),sv.pow(this,e)},e.prototype.powStrict=function(e){return this.throwIfDisposed(),sv.powStrict(this,e)},e.prototype.mul=function(e){return this.throwIfDisposed(),sv.mul(this,e)},e.prototype.mulStrict=function(e){return this.throwIfDisposed(),sv.mulStrict(this,e)},e.prototype.div=function(e){return this.throwIfDisposed(),sv.div(this,e)},e.prototype.divNoNan=function(e){return this.throwIfDisposed(),sv.divNoNan(this,e)},e.prototype.floorDiv=function(e){return this.throwIfDisposed(),sv.floorDiv(this,e)},e.prototype.divStrict=function(e){return this.throwIfDisposed(),sv.divStrict(this,e)},e.prototype.minimum=function(e){return this.throwIfDisposed(),sv.minimum(this,e)},e.prototype.minimumStrict=function(e){return this.throwIfDisposed(),sv.minimumStrict(this,e)},e.prototype.maximum=function(e){return this.throwIfDisposed(),sv.maximum(this,e)},e.prototype.maximumStrict=function(e){return this.throwIfDisposed(),sv.maximumStrict(this,e)},e.prototype.mod=function(e){return this.throwIfDisposed(),sv.mod(this,e)},e.prototype.modStrict=function(e){return this.throwIfDisposed(),sv.modStrict(this,e)},e.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),sv.squaredDifferenceStrict(this,e)},e.prototype.transpose=function(e){return this.throwIfDisposed(),sv.transpose(this,e)},e.prototype.notEqual=function(e){return this.throwIfDisposed(),sv.notEqual(this,e)},e.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),sv.notEqualStrict(this,e)},e.prototype.less=function(e){return this.throwIfDisposed(),sv.less(this,e)},e.prototype.lessStrict=function(e){return this.throwIfDisposed(),sv.lessStrict(this,e)},e.prototype.equal=function(e){return this.throwIfDisposed(),sv.equal(this,e)},e.prototype.equalStrict=function(e){return this.throwIfDisposed(),sv.equalStrict(this,e)},e.prototype.lessEqual=function(e){return this.throwIfDisposed(),sv.lessEqual(this,e)},e.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),sv.lessEqualStrict(this,e)},e.prototype.greater=function(e){return this.throwIfDisposed(),sv.greater(this,e)},e.prototype.greaterStrict=function(e){return this.throwIfDisposed(),sv.greaterStrict(this,e)},e.prototype.greaterEqual=function(e){return this.throwIfDisposed(),sv.greaterEqual(this,e)},e.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),sv.greaterEqualStrict(this,e)},e.prototype.logicalAnd=function(e){return this.throwIfDisposed(),sv.logicalAnd(this,e)},e.prototype.logicalOr=function(e){return this.throwIfDisposed(),sv.logicalOr(this,e)},e.prototype.logicalNot=function(){return this.throwIfDisposed(),sv.logicalNot(this)},e.prototype.logicalXor=function(e){return this.throwIfDisposed(),sv.logicalXor(this,e)},e.prototype.where=function(e,t){return this.throwIfDisposed(),sv.where(e,this,t)},e.prototype.neg=function(){return this.throwIfDisposed(),sv.neg(this)},e.prototype.ceil=function(){return this.throwIfDisposed(),sv.ceil(this)},e.prototype.floor=function(){return this.throwIfDisposed(),sv.floor(this)},e.prototype.sign=function(){return this.throwIfDisposed(),sv.sign(this)},e.prototype.isNaN=function(){return this.throwIfDisposed(),sv.isNaN(this)},e.prototype.isInf=function(){return this.throwIfDisposed(),sv.isInf(this)},e.prototype.isFinite=function(){return this.throwIfDisposed(),sv.isFinite(this)},e.prototype.exp=function(){return this.throwIfDisposed(),sv.exp(this)},e.prototype.expm1=function(){return this.throwIfDisposed(),sv.expm1(this)},e.prototype.log=function(){return this.throwIfDisposed(),sv.log(this)},e.prototype.log1p=function(){return this.throwIfDisposed(),sv.log1p(this)},e.prototype.sqrt=function(){return this.throwIfDisposed(),sv.sqrt(this)},e.prototype.rsqrt=function(){return this.throwIfDisposed(),sv.rsqrt(this)},e.prototype.square=function(){return this.throwIfDisposed(),sv.square(this)},e.prototype.reciprocal=function(){return this.throwIfDisposed(),sv.reciprocal(this)},e.prototype.abs=function(){return this.throwIfDisposed(),sv.abs(this)},e.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),sv.clipByValue(this,e,t)},e.prototype.relu=function(){return this.throwIfDisposed(),sv.relu(this)},e.prototype.relu6=function(){return this.throwIfDisposed(),sv.relu6(this)},e.prototype.elu=function(){return this.throwIfDisposed(),sv.elu(this)},e.prototype.selu=function(){return this.throwIfDisposed(),sv.selu(this)},e.prototype.leakyRelu=function(e){return void 0===e&&(e=.2),this.throwIfDisposed(),sv.leakyRelu(this,e)},e.prototype.prelu=function(e){return this.throwIfDisposed(),sv.prelu(this,e)},e.prototype.sigmoid=function(){return this.throwIfDisposed(),sv.sigmoid(this)},e.prototype.logSigmoid=function(){return this.throwIfDisposed(),sv.logSigmoid(this)},e.prototype.softplus=function(){return this.throwIfDisposed(),sv.softplus(this)},e.prototype.zerosLike=function(){return this.throwIfDisposed(),sv.zerosLike(this)},e.prototype.onesLike=function(){return this.throwIfDisposed(),sv.onesLike(this)},e.prototype.sin=function(){return this.throwIfDisposed(),sv.sin(this)},e.prototype.cos=function(){return this.throwIfDisposed(),sv.cos(this)},e.prototype.tan=function(){return this.throwIfDisposed(),sv.tan(this)},e.prototype.asin=function(){return this.throwIfDisposed(),sv.asin(this)},e.prototype.acos=function(){return this.throwIfDisposed(),sv.acos(this)},e.prototype.atan=function(){return this.throwIfDisposed(),sv.atan(this)},e.prototype.sinh=function(){return this.throwIfDisposed(),sv.sinh(this)},e.prototype.cosh=function(){return this.throwIfDisposed(),sv.cosh(this)},e.prototype.tanh=function(){return this.throwIfDisposed(),sv.tanh(this)},e.prototype.asinh=function(){return this.throwIfDisposed(),sv.asinh(this)},e.prototype.acosh=function(){return this.throwIfDisposed(),sv.acosh(this)},e.prototype.atanh=function(){return this.throwIfDisposed(),sv.atanh(this)},e.prototype.erf=function(){return this.throwIfDisposed(),sv.erf(this)},e.prototype.round=function(){return this.throwIfDisposed(),sv.round(this)},e.prototype.step=function(e){return void 0===e&&(e=0),this.throwIfDisposed(),sv.step(this,e)},e.prototype.softmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),sv.softmax(this,e)},e.prototype.logSoftmax=function(e){return void 0===e&&(e=-1),this.throwIfDisposed(),sv.logSoftmax(this,e)},e.prototype.resizeBilinear=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),sv.image.resizeBilinear(this,e,t)},e.prototype.resizeNearestNeighbor=function(e,t){return void 0===t&&(t=!1),this.throwIfDisposed(),sv.image.resizeNearestNeighbor(this,e,t)},e.prototype.conv1d=function(e,t,n,r,i,o){return void 0===r&&(r="NWC"),void 0===i&&(i=1),this.throwIfDisposed(),sv.conv1d(this,e,t,n,r,i,o)},e.prototype.conv2d=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),sv.conv2d(this,e,t,n,r,i,o)},e.prototype.conv2dTranspose=function(e,t,n,r,i){return this.throwIfDisposed(),sv.conv2dTranspose(this,e,t,n,r,i)},e.prototype.depthwiseConv2D=function(e,t,n,r,i,o){return void 0===r&&(r="NHWC"),void 0===i&&(i=[1,1]),this.throwIfDisposed(),sv.depthwiseConv2d(this,e,t,n,r,i,o)},e.prototype.separableConv2d=function(e,t,n,r,i,o){return void 0===i&&(i=[1,1]),void 0===o&&(o="NHWC"),this.throwIfDisposed(),sv.separableConv2d(this,e,t,n,r,i,o)},e.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),sv.avgPool(this,e,t,n,r)},e.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),sv.maxPool(this,e,t,n,r)},e.prototype.localResponseNormalization=function(e,t,n,r){return void 0===e&&(e=5),void 0===t&&(t=1),void 0===n&&(n=1),void 0===r&&(r=.5),sv.localResponseNormalization(this,e,t,n,r)},e.prototype.pool=function(e,t,n,r,i){return this.throwIfDisposed(),sv.pool(this,e,t,n,r,i)},e.prototype.variable=function(e,t,n){return void 0===e&&(e=!0),this.throwIfDisposed(),av().makeVariable(this,e,t,n)},e.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),sv.unsortedSegmentSum(this,e,t)},e.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),sv.batchToSpaceND(this,e,t)},e.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),sv.spaceToBatchND(this,e,t)},e.prototype.topk=function(e,t){return void 0===e&&(e=1),void 0===t&&(t=!0),this.throwIfDisposed(),sv.topk(this,e,t)},e.prototype.stridedSlice=function(e,t,n,r,i,o,a,s){return void 0===r&&(r=0),void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),this.throwIfDisposed(),sv.stridedSlice(this,e,t,n,r,i,o,a,s)},e.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),sv.depthToSpace(this,e,t)},e.prototype.fft=function(){return this.throwIfDisposed(),sv.spectral.fft(this)},e.prototype.ifft=function(){return this.throwIfDisposed(),sv.spectral.ifft(this)},e.prototype.rfft=function(){return this.throwIfDisposed(),sv.spectral.rfft(this)},e.prototype.irfft=function(){return this.throwIfDisposed(),sv.spectral.irfft(this)},e}();Object.defineProperty(cv,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.dataId&&null!=e.shape&&null!=e.dtype}});var lv,hv,fv,dv,pv,vv,mv=function(e){function t(t,n,r,i){var o=e.call(this,t.shape,t.dtype,t.dataId,i)||this;return o.trainable=n,o.name=r,o}return $d(t,e),t.prototype.assign=function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value ("+e.dtype+") and previous value ("+this.dtype+") must match");if(!_p(e.shape,this.shape))throw new Error("shape of the new value ("+e.shape+") and previous value ("+this.shape+") must match");av().disposeTensor(this),this.dataId=e.dataId,av().incRef(this,null)},t.prototype.dispose=function(){av().disposeVariable(this),this.isDisposedInternal=!0},t}(cv);Object.defineProperty(mv,Symbol.hasInstance,{value:function(e){return e instanceof cv&&null!=e.assign&&e.assign instanceof Function}}),(vv=lv||(lv={})).R0="R0",vv.R1="R1",vv.R2="R2",vv.R3="R3",vv.R4="R4",vv.R5="R5",vv.R6="R6",function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(hv||(hv={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(fv||(fv={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(dv||(dv={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(pv||(pv={}));var gv={float32:dv,int32:hv,bool:fv,complex64:pv};function yv(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast "+e+" with "+t)}return gv[e][t]}function bv(e){return yv(e,"int32")}function _v(e,t){if(e.dtype===t.dtype)return[e,t];var n=yv(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function wv(e,t){vp(e.dtype===t.dtype,(function(){return"The dtypes of the first("+e.dtype+") and second("+t.dtype+") input must match"}))}function xv(e){var t=[];return function e(t,n,r){if(null!=t)if(t instanceof cv)n.push(t);else if(i=t,Array.isArray(i)||"object"==typeof i){var i,o=t;for(var a in o){var s=o[a];r.has(s)||(r.add(s),e(s,n,r))}}}(e,t,new Set),t}Object.freeze({makeTypesMatch:_v,assertTypesMatch:wv,isTensorInList:function(e,t){return t.some((function(t){return t.id===e.id}))},getTensorsInContainer:xv});var kv,Cv=function(){function e(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return e.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},e}(),Ev=function(){function e(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Cv}return e.prototype.ready=function(){return Zd(this,void 0,void 0,(function(){var e,t,n;return Jd(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];e=this.getSortedBackends(),t=0,r.label=1;case 1:return t<e.length?[4,this.initializeBackend(n=e[t]).success]:[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(e.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),e.prototype.backendNames=function(){return Object.keys(this.registryFactory)},e.prototype.findBackend=function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]},e.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},e.prototype.registerBackend=function(e,t,n){return void 0===n&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},e.prototype.setBackend=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r;return Jd(this,(function(i){switch(i.label){case 0:if(null==this.registryFactory[e])throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,null!=this.registry[e]?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return r=i.sent(),[3,3];case 2:r=n,i.label=3;case 3:if(!r)return[2,!1];i.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ev(this.backendInstance),[2,!0]}}))}))},e.prototype.setupRegisteredKernels=function(){var e=this;sp(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))},e.prototype.disposeRegisteredKernels=function(e){var t=this;sp(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))},e.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var i=++this.pendingBackendInitId,o=r.then((function(n){return!(i<t.pendingBackendInitId||(t.registry[e]=n,t.pendingBackendInit=null,0))})).catch((function(n){return!(i<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}return this.registry[e]=r,{success:!0,asyncInit:!1}}catch(t){return console.warn("Initialization of backend "+e+" failed"),console.warn(t.stack||t.message),{success:!1,asyncInit:!1}}},e.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},e.prototype.getSortedBackends=function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},e.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),i=r.asyncInit;if(i||r.success)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")},e.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,i=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},e.prototype.tidy=function(e,t){var n,r=this,i=null;if(null==t){if("function"!=typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!=typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");i=e}return this.scopedRun((function(){return r.startScope(i)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},e.prototype.scopedRun=function(e,t,n){e();try{var r=n();return t(),r}catch(e){throw t(),e}},e.prototype.nextTensorId=function(){return e.nextTensorId++},e.prototype.nextVariableId=function(){return e.nextVariableId++},e.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype);return this.addTapeNode(this.state.activeScope.name,{x:e},[t],(function(e){return{x:function(){return e.toFloat()}}}),[]),t},e.prototype.runKernel=function(e,t,n,r,i){return this.runKernelFunc(null,t,null,e,n,r,i)},e.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},e.prototype.checkKernelForMemLeak=function(e,t,n){var r=this.backend.numDataIds(),i=0;n.forEach((function(e){i+="complex64"===e.dtype?3:1}));var o=r-t-i-this.state.numDataMovesStack[this.state.numDataMovesStack.length-1];if(o>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+o+" data ids) after running '"+e+"'")},e.prototype.runKernelFunc=function(e,t,n,r,i,o,a){var s,u=this;void 0===o&&(o=[]),void 0===a&&(a=[]);var c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))},d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var v,m=ap(r,this.backendName);return h=null!=m?function(){var e=u.backend.numDataIds();v=m.kernelFunc({inputs:t,attrs:i,backend:u.backend});var n=Array.isArray(v)?v:[v];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){return u.makeTensorFromDataId(e.dataId,e.shape,e.dtype)})),c=s.filter((function(e,t){return a[t]}));return f((o||[]).slice().concat(c)),s}:function(){var t=u.backend.numDataIds();v=u.tidy((function(){return e(u.backend,f)}));var n=Array.isArray(v)?v:[v];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n},this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,t,(function(){return h()})):h()})),l&&this.addTapeNode(r,t,s,n,c),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return t[e].shape})),outputShapes:s.map((function(e){return e.shape}))}),Array.isArray(v)?s:s[0]},e.prototype.makeTensor=function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");r=r||this.backend;var i=e;"string"===(n=n||"float32")&&Lp(e[0])&&(i=e.map((function(e){return Yp(e)})));var o=r.write(i,t,n),a=new cv(t,n,o,this.nextTensorId());if(this.incRef(a,r),"string"===n){var s=this.state.tensorInfo.get(o),u=Mp(i);this.state.numBytes+=u-s.bytes,s.bytes=u}return a},e.prototype.makeTensorFromDataId=function(e,t,n,r){var i=new cv(t,n=n||"float32",e,this.nextTensorId());return this.incRef(i,r),i},e.prototype.makeVariable=function(e,t,n,r){void 0===t&&(t=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.asType(r));var i=new mv(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error("Variable with name "+i.name+" was already registered");return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i},e.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Pp(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof mv||this.track(e)},e.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},e.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables)this.disposeVariable(this.state.registeredVariables[e])},e.prototype.disposeVariable=function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]},e.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},e.prototype.profile=function(e){return Zd(this,void 0,void 0,(function(){var t,n;return Jd(this,(function(r){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},e.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},e.prototype.addTapeNode=function(e,t,n,r,i){var o=this,a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:i},s=function(e){return op.get(e)}(e);null!=s&&(r=s.gradFunc),null!=r&&(a.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],i=Kp(r.size,r.dtype);return o.makeTensor(i,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],i)}),this.state.activeTape.push(a)},e.prototype.keep=function(e){return e.kept=!0,e},e.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},e.prototype.endTape=function(){this.state.gradientDepth--},e.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},e.prototype.endScope=function(e){for(var t=this,n=xv(e),r=new Set(n.map((function(e){return e.id}))),i=0;i<this.state.activeScope.track.length;i++){var o=this.state.activeScope.track[i];o.kept||r.has(o.id)||o.dispose()}var a=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==a.id||t.track(e)}))},e.prototype.gradients=function(e,t,n,r){var i=this;if(void 0===r&&(r=!1),vp(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var o=this.scopedRun((function(){return i.startTape()}),(function(){return i.endTape()}),(function(){return i.tidy("forward",e)}));vp(o instanceof cv,(function(){return"The result y returned by f() must be a tensor."}));var a=function(e,t,n){for(var r={},i={},o=0;o<t.length;o++)r[t[o].id]=!0;for(o=0;o<e.length;o++){var a=(p=e[o]).inputs;for(var s in a){for(var u=a[s],c=!1,l=0;l<t.length;l++)if(r[u.id]){p.outputs.forEach((function(e){return r[e.id]=!0})),c=!0,i[p.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var f={};for(o=e.length-1;o>=0;o--)for(a=(p=e[o]).inputs,l=0;l<p.outputs.length;l++)if(h[p.outputs[l].id]){for(var s in a)h[a[s].id]=!0,f[p.id]=!0;break}var d=[];for(o=0;o<e.length;o++){var p;if(i[(p=e[o]).id]&&f[p.id]){var v={};for(var s in p.inputs){var m=p.inputs[s];r[m.id]&&(v[s]=m)}var g=Object.assign({},p);g.inputs=v,g.outputs=p.outputs,d.push(g)}}return d}(this.state.activeTape,t,o);if(!r&&0===a.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e,r,s={};s[o.id]=null==n?(r=Gp(bp(e=o.shape),"float32"),Sv.makeTensor(r,e,"float32")):n,function(e,t,n){for(var r=function(r){var i=t[r],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];o.push(null!=n?n:null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+i.kernelName+".");var a=i.gradient(o),s=function(t){if(!(t in a))throw new Error("Cannot backprop through input "+t+". Available gradients found: "+Object.keys(a)+".");var r=n((function(){return a[t]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input "+t+" must have 'float32' dtype, but has '"+r.dtype+"'");var o=i.inputs[t];if(!_p(r.shape,o.shape))throw new Error("Error in gradient for op "+i.kernelName+". The gradient of input '"+t+"' has shape '"+r.shape+"', which does not match the shape of the input '"+o.shape+"'");if(null==e[o.id])e[o.id]=r;else{var s=e[o.id];e[o.id]=s.add(r),s.dispose()}};for(var u in i.inputs)s(u)},i=t.length-1;i>=0;i--)r(i)}(s,a,(function(e){return i.tidy(e)}));var u=t.map((function(e){return s[e.id]}));return 0===i.state.gradientDepth&&(i.state.activeTape.forEach((function(e){for(var t=0,n=e.saved;t<n.length;t++)n[t].dispose()})),i.state.activeTape=null),{value:o,grads:u}}))},e.prototype.customGrad=function(e){var t=this;return vp(zp(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];vp(r.every((function(e){return e instanceof cv})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,i){return vp((n=e.apply(void 0,r.concat([i]))).value instanceof cv,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),vp(zp(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),o,(function(e,t){var i=n.gradFunc(e,t),o=Array.isArray(i)?i:[i];vp(o.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),vp(o.every((function(e){return e instanceof cv})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var a={};return o.forEach((function(e,t){a[t]=function(){return e}})),a}))}},e.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},e.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},e.prototype.time=function(e){return Zd(this,void 0,void 0,(function(){var t,n;return Jd(this,(function(r){switch(r.label){case 0:return t=Xp(),[4,this.backend.time(e)];case 1:return(n=r.sent()).wallMs=Xp()-t,[2,n]}}))}))},e.prototype.track=function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(e.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),e.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Cv,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},e.nextTensorId=0,e.nextVariableId=0,e}(),Sv=function(){var e=function(){if(null==kv){var e=void 0;if("undefined"!=typeof window)e=window;else if("undefined"!=typeof global)e=global;else if("undefined"!=typeof process)e=process;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}kv=e}return kv}();if(null==e._tfengine){var t=new ep(e);e._tfengine=new Ev(t)}return function(e){rp=e}(e._tfengine.ENV),av=function(){return e._tfengine},e._tfengine}();function Iv(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Rv=np();Rv.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Rv.registerFlag("IS_BROWSER",(function(){return Iv()})),Rv.registerFlag("IS_NODE",(function(){return"undefined"!=typeof process&&void 0!==process.versions&&void 0!==process.versions.node})),Rv.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Rv.registerFlag("PROD",(function(){return!1})),Rv.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Rv.getBool("DEBUG")})),Rv.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Rv.registerFlag("IS_TEST",(function(){return!1}));var Tv,Av,Dv,Nv={},Ov={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Fv(e,t){Nv[e]=t}function Pv(e){e in Nv||(Nv[e]=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!=typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);return t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Nv[e]}),!1),1===e?t.getContext("webgl",Ov)||t.getContext("experimental-webgl",Ov):t.getContext("webgl2",Ov)}(e));var t=Nv[e];return t.isContextLost()?(delete Nv[e],Pv(e)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Nv[e])}function Mv(e,t){return[t,e]}function Lv(e){var t=bp(e);return kp(Math.ceil(t/4))}function Bv(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Uv(e,t){var n,r,i,o,a,s,u,c,l,h=e;return 2===np().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,i=e.RGBA,o=h.RGBA,a=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Wv(e,t,n){var r=n();return t&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+Vv(e,t))}(e),r}function zv(e){return!!(np().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Vv(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+t}}function jv(e,t,n){return fm(e,t,(function(){return e.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function Hv(e,t,n){var r=fm(e,t,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Wv(e,t,(function(){return e.shaderSource(r,n)})),Wv(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function qv(e,t,n){var r=fm(e,t,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Wv(e,t,(function(){return e.shaderSource(r,n)})),Wv(e,t,(function(){return e.compileShader(r)})),!1===e.getShaderParameter(r,e.COMPILE_STATUS))throw function(e,t){var n=Xv.exec(t);if(null==n)return console.log("Couldn't parse line number in error: "+t),void console.log(e);for(var r=+n[1],i=e.split("\n"),o=i.length.toString().length+2,a=i.map((function(e,t){return Cp((t+1).toString(),o)+e})),s=0,u=0;u<a.length;u++)s=Math.max(a[u].length,s);var c=a.slice(0,r-1),l=a.slice(r-1,r),h=a.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c "+Cp(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,e.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(Tv||(Tv={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(Av||(Av={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(Dv||(Dv={}));var Gv,Kv,Xv=/ERROR: [0-9]+:([0-9]+):/g;function Qv(e,t){return fm(e,t,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}function Yv(e,t,n){if(Wv(e,t,(function(){return e.linkProgram(n)})),!1===e.getProgramParameter(n,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function $v(e,t,n){if(Wv(e,t,(function(){return e.validateProgram(n)})),!1===e.getProgramParameter(n,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function Zv(e,t,n){var r=fm(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Wv(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Wv(e,t,(function(){return e.bufferData(e.ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function Jv(e,t,n){var r=fm(e,t,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Wv(e,t,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r)})),Wv(e,t,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,n,e.STATIC_DRAW)})),r}function em(e,t){return fm(e,t,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}function tm(e,t){var n=np().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="["+e+"x"+t+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n)throw r="["+e+"x"+t+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function nm(e,t){return fm(e,t,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function rm(e,t,n,r,i,o,a,s){var u=e.getAttribLocation(n,r);return-1!==u&&(Wv(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,i)})),Wv(e,t,(function(){return e.vertexAttribPointer(u,o,e.FLOAT,!1,a,s)})),Wv(e,t,(function(){return e.enableVertexAttribArray(u)})),!0)}function im(e,t,n,r){dm(e,r),Wv(e,t,(function(){return e.activeTexture(e.TEXTURE0+r)})),Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)}))}function om(e,t,n,r){return fm(e,t,(function(){return e.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function am(e,t,n){return e.getUniformLocation(t,n)}function sm(e,t,n,r,i,o){Wv(e,t,(function(){return im(e,t,r,o)})),Wv(e,t,(function(){return e.uniform1i(i,o)}))}function um(e,t,n,r){Wv(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,r)})),Wv(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}))}function cm(e,t,n){Wv(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Wv(e,t,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function lm(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+hm(e,t))}function hm(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+t}}function fm(e,t,n,r){var i=Wv(e,t,(function(){return n()}));if(null==i)throw new Error(r);return i}function dm(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function pm(e,t){return void 0===t&&(t=2),bp(e.slice(0,e.length-t))}function vm(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function mm(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[pm(e)].concat(vm(e))),t}function gm(e,t){var n;void 0===t&&(t=!1);var r=np().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(r*=2,1===(e=e.map((function(t,n){return n>=e.length-2?dp(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var i=Rp(e);e=i.newShape}var o=bp(e);if(e.length<=1&&o<=r)return[1,o];if(2===e.length&&e[0]<=r&&e[1]<=r)return e;if(3===e.length&&e[0]*e[1]<=r&&e[2]<=r)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=r&&e[1]*e[2]<=r)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=r&&e[3]<=r)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=r&&e[1]*e[2]*e[3]<=r)return[e[0],e[1]*e[2]*e[3]];if(t){var a=pm(e),s=2,u=2;return e.length&&(s=(n=vm(e))[0],u=n[1]),kp(o=a*(s/2)*(u/2)).map((function(e){return 2*e}))}return kp(o)}function ym(e){return e%2==0}function bm(e,t){if(_p(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(ym(n)&&ym(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&ym(e[0])&&ym(t[0])}function _m(e){if(null==Gv){var t=Pv(e);Gv=t.getParameter(t.MAX_TEXTURE_SIZE)}return Gv}function wm(e){if(null==Kv){var t=Pv(e);Kv=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Kv)}function xm(e){if(0===e)return 0;var t=Pv(e);return km(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:km(t,"EXT_disjoint_timer_query")?1:0}function km(e,t){return null!=e.getExtension(t)}function Cm(e){try{if(null!=Pv(e))return!0}catch(e){return!1}return!1}function Em(e){if(0===e)return!1;var t=Pv(e);if(1===e){if(!km(t,"OES_texture_float"))return!1}else if(!km(t,"EXT_color_buffer_float"))return!1;return Im(t)}function Sm(e){if(0===e)return!1;var t=Pv(e);if(1!==e){if(km(t,"EXT_color_buffer_float"))return Im(t);if(km(t,"EXT_color_buffer_half_float")){var n=t.getExtension("EXT_color_buffer_half_float");return function(e,t){var n=Uv(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var o=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(i),o}(t,n)}return!1}return!!km(t,"OES_texture_float")&&!!km(t,"WEBGL_color_buffer_float")&&Im(t)}function Im(e){var t=Uv(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var i=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),i}function Rm(e){return 2===e&&null!=Pv(e).fenceSync}var Tm=Object.freeze({callAndCheck:Wv,canBeRepresented:zv,getWebGLErrorMessage:Vv,getExtensionOrThrow:jv,createVertexShader:Hv,createFragmentShader:qv,createProgram:Qv,linkProgram:Yv,validateProgram:$v,createStaticVertexBuffer:Zv,createStaticIndexBuffer:Jv,getNumChannels:function(){return 2===np().getNumber("WEBGL_VERSION")?1:4},createTexture:em,validateTextureSize:tm,createFramebuffer:nm,bindVertexBufferToProgramAttribute:rm,bindTextureUnit:im,unbindTextureUnit:function(e,t,n){dm(e,n),Wv(e,t,(function(){return e.activeTexture(e.TEXTURE0+n)})),Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:om,getProgramUniformLocation:am,bindTextureToProgramUniformSampler:sm,bindCanvasToFramebuffer:function(e,t){Wv(e,t,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),Wv(e,t,(function(){return e.viewport(0,0,e.canvas.width,e.canvas.height)})),Wv(e,t,(function(){return e.scissor(0,0,e.canvas.width,e.canvas.height)}))},bindColorTextureToFramebuffer:um,unbindColorTextureFromFramebuffer:cm,validateFramebuffer:lm,getFramebufferErrorMessage:hm,getBatchDim:pm,getRowsCols:vm,getShapeAs3D:mm,getTextureShapeFromLogicalShape:gm,isReshapeFree:bm,getWebGLMaxTextureSize:_m,resetMaxTextureSize:function(){Gv=null},resetMaxTexturesInShader:function(){Kv=null},getMaxTexturesInShader:wm,getWebGLDisjointQueryTimerVersion:xm,hasExtension:km,isWebGLVersionEnabled:Cm,isCapableOfRenderingToFloatTexture:Em,isDownloadFloatTextureEnabled:Sm,isWebGLFenceEnabled:Rm}),Am=np();function Dm(e){np().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Nm(e,t){return Sv.tidy(e,t)}function Om(e){xv(e).forEach((function(e){return e.dispose()}))}function Fm(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];np().getBool("IS_TEST")||console.warn.apply(console,e)}function Pm(e,t){var n=e;if(Fp(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||Fp(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&np().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function e(t,n,r){if(r=r||[],Array.isArray(t)||Fp(t)){vp(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+t.length+" elements"})),vp(t.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+t.length+" elements"}));for(var i=n.slice(1),o=0;o<t.length;++o)e(t[o],i,r.concat(o))}else vp(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(e,r,[]),r}function Mm(e,t,n,r){if(null!=e&&("numeric"!==e&&e!==t||"numeric"===e&&"string"===t))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+e+" tensor, but got "+t+" tensor")}function Lm(e,t,n,r){if(void 0===r&&(r="numeric"),e instanceof cv)return Mm(r,e.dtype,t,n),e;var i=Wp(e);if("string"!==i&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),Mm(r,i,t,n),null==e||!Fp(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("Argument '"+t+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+(null==e?"null":e.constructor.name)+"'");var o=Pm(e,i);Fp(e)||Array.isArray(e)||(e=[e]);var a="string"!==i?Hp(e,i,np().getBool("DEBUG")):yp(e,[],!0);return Sv.makeTensor(a,o,i)}function Bm(e,t,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(e))throw new Error("Argument "+t+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return e.map((function(e,r){return Lm(e,t+"["+r+"]",n)}),r)}function Um(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Wm(e,t,n){for(var r=e.length+t.length,i=[],o=0,a=0,s=0;s<r;s++)-1===n.indexOf(s)?i.push(e[o++]):i.push(t[a++]);return i}function zm(e,t){for(var n=[],r=e.length,i=0;i<r;i++)-1===t.indexOf(i)&&n.push(e[i]);return[n,t.map((function(t){return e[t]}))]}function Vm(e,t){return Wm(e,t.map((function(e){return 1})),t)}function jm(e,t,n){vp(Um(t,n),(function(){return e+" supports only inner-most axes for now. Got axes "+t+" and rank-"+n+" input."}))}function Hm(e,t){if(Um(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function qm(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Gm(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}function Km(e,t){var n=e[0].length;e.forEach((function(e,t){vp(e.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+t+"] must be the same as the rank of the rest ("+n+")"}))})),vp(t>=0&&t<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=e[0];e.forEach((function(e,i){for(var o=0;o<n;o++)vp(o===t||e[o]===r[o],(function(){return"Error in concat"+n+"D: Shape of tensors["+i+"] ("+e+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+i+"."}))}))}function Xm(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Qm(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+t.length+" keys.");var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Sv.startScope(n);try{var i=r.apply(void 0,e);return i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),Sv.endScope(i),i}catch(e){throw Sv.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}Am.registerFlag("HAS_WEBGL",(function(){return Am.getNumber("WEBGL_VERSION")>0})),Am.registerFlag("WEBGL_VERSION",(function(){return Cm(2)?2:Cm(1)?1:0})),Am.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===Am.get("WEBGL_VERSION")})),Am.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),Am.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),Am.registerFlag("WEBGL_PACK",(function(){return Am.getBool("HAS_WEBGL")})),Am.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_CLIP",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),Am.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_PACK_REDUCE",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_CONV_IM2COL",(function(){return Am.getBool("WEBGL_PACK")})),Am.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return _m(Am.getNumber("WEBGL_VERSION"))})),Am.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return wm(Am.getNumber("WEBGL_VERSION"))})),Am.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=Am.getNumber("WEBGL_VERSION");return 0===e?0:xm(e)})),Am.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return Am.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(e=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))));var e})),Am.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Em(Am.getNumber("WEBGL_VERSION"))})),Am.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!Am.getBool("WEBGL_FORCE_F16_TEXTURES")&&Am.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),Am.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return Sm(Am.getNumber("WEBGL_VERSION"))})),Am.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Rm(Am.getNumber("WEBGL_VERSION"))})),Am.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return Am.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),uv=Dm;var Ym=Qm({complex_:function(e,t){var n=Lm(e,"real","complex"),r=Lm(t,"imag","complex");return mp(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),Sv.runKernelFunc((function(e){return e.complex(n,r)}),{$real:n,$imag:r})}}),$m=Qm({real_:function(e){var t=Lm(e,"input","real");return Sv.runKernelFunc((function(e){return e.real(t)}),{$input:t})}}),Zm=Qm({imag_:function(e){var t=Lm(e,"input","imag");return Sv.runKernelFunc((function(e){return e.imag(t)}),{$input:t})}});function Jm(e,t,n){return eg(e,t,Pm(e,n),n)}function eg(e,t,n,r){if(null==r&&(r=Wp(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Fp(e)&&!Array.isArray(e)&&"number"!=typeof e&&"boolean"!=typeof e&&"string"!=typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Qp(t);var i=bp(t),o=bp(n);vp(i===o,(function(){return"Based on the provided shape, ["+t+"], the tensor should have "+i+" values but has "+o}));for(var a=0;a<n.length;++a){var s=a!==n.length-1||n[a]!==bp(t.slice(a));vp(n[a]===t[a]||!s,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+t+"). "}))}}return Fp(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Hp(e,r,np().getBool("DEBUG")):yp(e,[],!0),Sv.makeTensor(e,t,r)}function tg(e,t){if((Fp(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&Fp(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eg(e,[],[],t)}function ng(e,t){gp(e);var n=Pm(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eg(e,null,n,t)}function rg(e,t,n){if(gp(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Pm(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eg(e,t,r,n)}function ig(e,t,n){if(gp(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Pm(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return eg(e,t,r,n)}function og(e,t,n){if(gp(e),null!=t&&4!==t.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Pm(e,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return eg(e,t,r,n)}function ag(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=ag(e,"float32"),r=sg(e,"float32");return Ym(n,r)}var i=Gp(bp(e),t);return Sv.makeTensor(i,e,t)}function sg(e,t){if(void 0===t&&(t="float32"),"complex64"===t){var n=sg(e,"float32"),r=sg(e,"float32");return Ym(n,r)}var i=Kp(bp(e),t);return Sv.makeTensor(i,e,t)}function ug(e,t,n){return Sv.runKernelFunc((function(r){return r.fill(e,t,n)}),{})}function cg(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(e===t||e<t&&n<0||t<e&&n>1)return sg([0],r);var i=Kp(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return ng(i,r)}var lg=Qm({onesLike_:function(e){var t=Lm(e,"x","onesLike");if("complex64"===t.dtype){var n=lg($m(t)),r=hg(Zm(t));return Ym(n,r)}return Sv.runKernelFunc((function(e){return e.onesLike(t)}),{$x:t},(function(e,t){return{$x:function(){return hg(e)}}}))}}),hg=Qm({zerosLike_:function(e){var t=Lm(e,"x","zerosLike");return Sv.runKernelFunc((function(e){return e.zerosLike(t)}),{$x:t},(function(e,t){return{$x:function(){return hg(e)}}}))}}),fg=Qm({concat_:function(e,t){void 0===t&&(t=0),vp(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Bm(e,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+e.dtype+". ")})),t=Ip(t,n[0].shape)[0];var r=Xm(n.map((function(e){return e.shape})),t);if(0===bp(r))return Jm([],r);if(1===(n=n.filter((function(e){return e.size>0}))).length)return n[0];var i=n.map((function(e){return e.shape}));return Km(i,t),Sv.runKernelFunc((function(e){return e.concat(n,t)}),n,(function(e){var n=i.map((function(e){return e[t]}));return gg(e,n,t).map((function(e){return function(){return e}}))}),"Concat",{axis:t})}}),dg=Qm({concat1d_:function(e){return fg(e,0)}}),pg=Qm({concat2d_:function(e,t){return fg(e,t)}}),vg=Qm({concat3d_:function(e,t){return fg(e,t)}}),mg=Qm({concat4d_:function(e,t){return fg(e,t)}}),gg=Qm({split_:function(e,t,n){void 0===n&&(n=0);var r,i=Lm(e,"x","split");return n=Ip(n,i.shape)[0],"number"==typeof t?(vp(i.shape[n]%t==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(i.shape[n]/t)):(vp(i.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t),Sv.runKernelFunc((function(e){return e.split(i,r,n)}),{$x:i},(function(e){return{$x:function(){return fg(e,n)}}}))}});function yg(e,t){return e(t={exports:{}},t.exports),t.exports}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var bg=yg((function(e){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=e.toString();for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)});n.next=function(){var e=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1),r=null}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.alea=o}(0,e)})),_g=yg((function(e){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.xor128=o}(0,e)})),wg=yg((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.xorwow=o}(0,e)})),xg=yg((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],n=(e^=e>>>7)^e<<24,n^=(e=r[i+1&7])^e>>>10,n^=(e=r[i+3&7])^e>>>3,n^=(e=r[i+4&7])^e<<7,e=r[i+7&7],n^=(e^=e<<13)^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n&&(r[7]=-1),e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.x&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.xorshift7=o}(0,e)})),kg=yg((function(e){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n=i[o]=(n^=n>>>15)^(e^=e>>>12),t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,a,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),i=0,o=-32;o<u;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(i=0==(n=s[127&o]^=r+(a=a+1640531527|0))?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,s[i]=(r^=r>>>15)^(n^=n>>>12);e.w=a,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&(o.X&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.xor4096=o}(0,e)})),Cg=yg((function(e){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:this.tychei=o}(0,e)})),Eg=yg((function(e){!function(t,r){var i,o=this,a=256,s=r.pow(a,6),u=r.pow(2,52),c=2*u,l=255;function h(e,n,l){var h=[],m=p(function e(t,n){var r,i=[],o=typeof t;if(n&&"object"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==o?t:t+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[e,v(t)]:null==e?function(){try{var e;return i&&(e=i.randomBytes)?e=e(a):(e=new Uint8Array(a),(o.crypto||o.msCrypto).getRandomValues(e)),v(e)}catch(e){var n=o.navigator,r=n&&n.plugins;return[+new Date,o,r,o.screen,v(t)]}}():e,3),h),g=new f(h),y=function(){for(var e=g.g(6),t=s,n=0;e<u;)e=(e+n)*a,t*=a,n=g.g(1);for(;e>=c;)e/=2,t/=2,n>>>=1;return(e+n)/t};return y.int32=function(){return 0|g.g(4)},y.quick=function(){return g.g(4)/4294967296},y.double=y,p(v(g.S),t),(n.pass||l||function(e,t,n,i){return i&&(i.S&&d(i,g),e.state=function(){return d(g,{})}),n?(r.random=e,t):e})(y,m,"global"in n?n.global:this==r,n.state)}function f(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,s=r.S=[];for(n||(e=[n++]);i<a;)s[i]=i++;for(i=0;i<a;i++)s[i]=s[o=l&o+e[i%n]+(t=s[i])],s[o]=t;(r.g=function(e){for(var t,n=0,i=r.i,o=r.j,s=r.S;e--;)t=s[i=l&i+1],n=n*a+s[l&(s[i]=s[o=l&o+t])+(s[o]=t)];return r.i=i,r.j=o,n})(a)}function d(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function p(e,t){for(var n,r=e+"",i=0;i<r.length;)t[l&i]=l&(n^=19*t[l&i])+r.charCodeAt(i++);return v(t)}function v(e){return String.fromCharCode.apply(0,e)}if(r.seedrandom=h,p(r.random(),t),e.exports){e.exports=h;try{i=n(1)}catch(e){}}}([],Math)}));Eg.alea=bg,Eg.xor128=_g,Eg.xorwow=wg,Eg.xorshift7=xg,Eg.xor4096=kg,Eg.tychei=Cg;var Sg=Eg.alea,Ig=function(){function e(e,t,n,r,i){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=Sg(o.toString())}return e.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var i=void 0,o=void 0,a=void 0;do{a=(i=2*this.random()-1)*i+(o=2*this.random()-1)*o}while(a>=1||0===a);var s=Math.sqrt(-2*Math.log(a)/a);t=this.mean+this.stdDev*i*s,n=this.mean+this.stdDev*o*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},e.prototype.convertValue=function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)},e.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},e}(),Rg=function(){function e(e,t,n,r){this.alpha=e,this.beta=1/t,this.dtype=n;var i=r||Math.random();this.randu=Sg(i.toString()),this.randn=new Ig(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return e.prototype.nextValue=function(){for(var e,t,n,r,i,o;;){do{r=this.randn.nextValue(),o=1+this.c*r}while(o<=0);if(t=1-.331*(e=r*r)*e,n=.5*e+this.d*(1-(o*=o*o)+Math.log(o)),(i=this.randu())<t||Math.log(i)<n)break}return o*=1/this.beta*this.d,this.alpha<1&&(o*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(o)},e.prototype.convertValue=function(e){return"float32"===this.dtype?e:Math.round(e)},e}(),Tg=function(){function e(e,t,n,r){var i=this;if(void 0===e&&(e=0),void 0===t&&(t=1),this.canReturnFloat=function(){return null==i.dtype||"float32"===i.dtype},this.min=e,this.range=t-e,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=Sg(r)}return e.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},e.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},e}();function Ag(e,t,n){return void 0===t&&(t="float32"),t=t||"float32",Qp(e),new ov(e,t,n)}var Dg=Qm({batchToSpaceND_:function(e,t,n){var r=Lm(e,"x","batchToSpaceND"),i=t.reduce((function(e,t){return e*t}));return vp(r.rank>=1+t.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+t.length})),vp(n.length===t.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+t.length})),vp(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+t.join(" * ")+" === "+i})),Sv.runKernelFunc((function(e){return e.batchToSpaceND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.spaceToBatchND(t,n)}}}))}}),Ng=Qm({broadcastTo_:function(e,t){var n=Lm(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+t+"].");if(t.length<n.rank)throw new Error("broadcastTo(): shape.length="+t.length+" < input.rank="+n.rank+".");if(t.length>n.rank){for(var i=n.shape.slice();i.length<t.length;)i.unshift(1);n=n.reshape(i)}for(var o=Array.from(t),a=t.length-1;a>=0;a--)if(n.shape[a]===t[a])o[a]=1;else if(1!==n.shape[a])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+t+"].");var s=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));return 0===s.length?n.clone():Sv.runKernelFunc((function(e){return e.tile(n,o)}),{input:n},(function(e){return{input:function(){return e.sum(s,!0)}}}))}}),Og=Qm({cast_:function(e,t){var n=Lm(e,"x","cast");if(!Np(t))throw new Error("Failed to cast to unknown dtype "+t);if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");return Sv.runKernelFunc((function(e){return e.cast(n,t)}),{x:n},(function(e){return{x:function(){return e.clone()}}}),"Cast",{dtype:t})}}),Fg=Qm({clone_:function(e){var t=Lm(e,"x","clone",null);return Sv.runKernelFunc((function(){return Sv.makeTensorFromDataId(t.dataId,t.shape,t.dtype)}),{$x:t},(function(e){return{$x:function(){return e.toFloat()}}}))}}),Pg=Qm({cumsum_:function(e,t,n,r){void 0===t&&(t=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var i=Lm(e,"x","cumsum"),o=Hm([t|=0],i.rank),a=i;null!=o&&(a=i.transpose(o));var s=Gm(1,i.rank)[0],u=Sv.runKernelFunc((function(e){return e.cumsum(a,s,n,r)}),{permutedX:a},(function(e){return{permutedX:function(){return e.cumsum(t,n,!r)}}}));return null!=o&&(u=u.transpose(o)),u}}),Mg=Qm({depthToSpace_:function(e,t,n){void 0===n&&(n="NHWC");var r=Lm(e,"x","depthToSpace"),i="NHWC"===n?r.shape[1]:r.shape[2],o="NHWC"===n?r.shape[2]:r.shape[3],a="NHWC"===n?r.shape[3]:r.shape[1];return vp(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+i+" and "+t+"  for depthToSpace with input shape\n      "+r.shape})),vp(o*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+t+" for depthToSpace with input shape\n          "+r.shape})),vp(a%(t*t)==0,(function(){return"Dimension size must be evenly divisible by "+t*t+" but is "+a+" for depthToSpace with input shape "+r.shape})),Sv.runKernelFunc((function(e){return e.depthToSpace(r,t,n)}),{$x:r})}}),Lg=Qm({expandDims_:function(e,t){void 0===t&&(t=0);var n=Lm(e,"x","expandDims",null);vp(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return t<0&&(vp(-(n.rank+1)<=t,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),t=n.rank+t+1),r.splice(t,0,1),Yg(n,r)}}),Bg=Qm({eye_:function(e,t,n,r){void 0===r&&(r="float32"),null==t&&(t=e);for(var i=Ag([e,t],r),o=e<=t?e:t,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(e,t);if(null==n)return s;if(1===n.length)return ey(Lg(s,0),[n[0],1,1]);if(2===n.length)return ey(Lg(Lg(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return ey(Lg(Lg(Lg(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),Ug=Qm({multinomial_:function(e,t,n,r){void 0===r&&(r=!1);var i=Lm(e,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);n=n||Math.random();var s=1===a?i.as2D(1,-1):i,u=Sv.runKernelFunc((function(e){return e.multinomial(s,r,t,n)}),{logits2D:s});return 1===a?u.as1D():u}}),Wg=Qm({oneHot_:function(e,t,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),t<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+t);var i=Lm(e,"indices","oneHot","int32"),o=i.shape.concat([t]);return i=i.flatten(),Sv.runKernelFunc((function(e){return e.oneHot(i,t,n,r)}),{$indices:i},(function(e){return{$indices:function(){return sg(i.shape,"float32")}}})).reshape(o)}}),zg=Qm({pad_:function(e,t,n){void 0===n&&(n=0);var r=Lm(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");return Sv.runKernelFunc((function(e){return e.pad(r,t,n)}),{x:r},(function(e){var n=t.map((function(e){return e[0]}));return{x:function(){return e.slice(n,r.shape)}}}),"PadV2",{paddings:t,constantValue:n})}}),Vg=Qm({pad1d_:function(e,t,n){return void 0===n&&(n=0),vp(2===t.length,(function(){return"Invalid number of paddings. Must be length of 2."})),zg(e,[t],n)}}),jg=Qm({pad2d_:function(e,t,n){return void 0===n&&(n=0),vp(2===t.length&&2===t[0].length&&2===t[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),zg(e,t,n)}}),Hg=Qm({pad3d_:function(e,t,n){return void 0===n&&(n=0),vp(3===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),zg(e,t,n)}}),qg=Qm({pad4d_:function(e,t,n){return void 0===n&&(n=0),vp(4===t.length&&2===t[0].length&&2===t[1].length&&2===t[2].length&&2===t[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),zg(e,t,n)}}),Gg=Qm({rand_:function(e,t,n){var r=bp(e),i=null;if(null==n||"float32"===n)i=new Float32Array(r);else if("int32"===n)i=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=t();return Sv.makeTensor(i,e,n)}}),Kg=Qm({randomNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Ig(t,n,r,!1,i),a=Ag(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Xg=Qm({randomGamma_:function(e,t,n,r,i){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var o=new Rg(t,n,r,i),a=Ag(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Qg=Qm({randomUniform_:function(e,t,n,r,i){void 0===t&&(t=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var o=Ag(e,r),a=new Tg(t,n,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Yg=Qm({reshape_:function(e,t){var n=Lm(e,"x","reshape",null);return t=Sp(t,n.size),vp(n.size===bp(t),(function(){return"new shape and old shape must have the same number of elements."})),Sv.runKernelFunc((function(e){return e.reshape(n,t)}),{x:n},(function(e){return{x:function(){return e.reshape(n.shape)}}}),"Reshape",{shape:t})}}),$g=Qm({spaceToBatchND_:function(e,t,n){var r=Lm(e,"x","spaceToBatchND");return vp(r.rank>=1+t.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+t.length})),vp(n.length===t.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+t.length})),vp(r.shape.reduce((function(e,r,i){return i>0&&i<=t.length?e&&(r+n[i-1][0]+n[i-1][1])%t[i-1]==0:e}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+t.toString()})),Sv.runKernelFunc((function(e){return e.spaceToBatchND(r,t,n)}),{$x:r},(function(e){return{$x:function(){return e.batchToSpaceND(t,n)}}}))}}),Zg=Qm({squeeze_:function(e,t){var n=Lm(e,"x","squeeze");return Yg(n,Rp(n.shape,t).newShape)}}),Jg=Qm({stack_:function(e,t){void 0===t&&(t=0);var n=Bm(e,"tensors","stack");if(vp(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(t);var r=n[0].shape,i=n[0].dtype;vp(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(e){mp(r,e.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(e){vp(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=n.map((function(e){return e.expandDims(t)}));return fg(o,t)}}),ey=Qm({tile_:function(e,t){var n=Lm(e,"x","tile",null);return vp(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+t+"."})),Sv.runKernelFunc((function(e,r){var i=e.tile(n,t);return r([n]),i}),{x:n},(function(e,n){var r=n[0];return{x:function(){var n=hg(r);if(1===r.rank)for(var i=0;i<t[0];++i)n=n.add(e.slice([i*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(i=0;i<t[0];++i)for(var o=0;o<t[1];++o)n=n.add(e.slice([i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(i=0;i<t[0];++i)for(o=0;o<t[1];++o)for(var a=0;a<t[2];++a)n=n.add(e.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(i=0;i<t[0];++i)for(o=0;o<t[1];++o)for(a=0;a<t[2];++a)for(var s=0;s<t[3];++s)n=n.add(e.slice([i*r.shape[0],o*r.shape[1],a*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return n}}}),"Tile",{reps:t},[n])}}),ty=Qm({truncatedNormal_:function(e,t,n,r,i){if(void 0===t&&(t=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var o=new Ig(t,n,r,!0,i),a=Ag(e,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),ny=Qm({unstack_:function(e,t){void 0===t&&(t=0),t=t||0;var n=Lm(e,"x","unstack");return vp(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = "+t+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),t<0&&(t+=n.shape.length),Sv.runKernelFunc((function(e){return e.unstack(n,t)}),{x:n},(function(e){return{x:function(){return Jg(e,t)}}}),"Unpack",{axis:t})}});function ry(e,t,n,r){void 0===r&&(r=!0);var i=[];if(r)(i=i.concat(t.slice(0))).push(e[0]/n),i=i.concat(e.slice(1));else{i=i.concat(e[0]);for(var o=t.length,a=0;a<o;++a)i=i.concat([e[a+1]/t[a],t[a]]);i=i.concat(e.slice(o+1))}return i}function iy(e,t,n){void 0===n&&(n=!0);var r=[];if(n){r.push(t);for(var i=t+1;i<e;++i)i<=2*t?(r.push(i),r.push(i-(t+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<e;++i)i>=2*t+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function oy(e,t,n,r){void 0===r&&(r=!0);var i=[];i.push(r?e[0]/n:e[0]*n);for(var o=1;o<e.length;++o)i.push(o<=t.length?r?t[o-1]*e[o]:e[o]/t[o-1]:e[o]);return i}function ay(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function sy(e,t,n){for(var r=e.slice(0,1),i=0;i<n;++i)r.push(e[i+1]-t[i][0]-t[i][1]);return r}function uy(e,t){if(e.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.shape[t.rank-1]>e.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+t.shape[t.rank-1]+" vs. "+e.rank);if(0===e.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+e.shape+".");for(var n=t.shape,r=n[n.length-1],i=1,o=0;o<n.length-1;++o)i*=n[o];var a=e.shape,s=n.slice();s.pop();var u=1;for(o=r;o<e.rank;++o)u*=a[o],s.push(a[o]);var c=jp(e.shape).map((function(e){return e/u})).concat([1]).slice(0,r);return[s,i,u,c]}function cy(e){return e<=30?e:Vp(e,Math.floor(Math.sqrt(e)))}function ly(e,t,n){var r=t.rank>1?t.shape[t.rank-1]:1,i=t.rank>1?t.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+t.shape+", shape: "+e+", sliceDim: "+r+", and batchDim: "+i+".";if(n.rank<i)throw new Error(o+" update.rank < "+i+". ");if(e.length<r+(n.rank-i))throw new Error(o+" Output shape length < "+(r+(n.rank-i)));if(n.rank!==i+e.length-r)throw new Error(o+" update.rank != "+(i+e.length-r));for(var a=0;a<i;++a)if(n.shape[a]!==t.shape[a])throw new Error(o+" updates.shape["+a+"] ("+n.shape[a]+") != indices.shape["+a+"] ("+t.shape[a]+").");for(a=0;a<n.rank-i;++a)if(n.shape[a+i]!==e[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+n.shape[a+i]+") != shape["+(a+i)+"] ("+e[a+i]+")")}function hy(e,t,n){if(t.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==t.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+t.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===t.size)throw new Error("Indices specified for empty output. indices shape: "+t.shape);if(0===e.size)throw new Error("Updates specified for empty output. updates shape: "+e.shape)}ly(n,t,e)}function fy(e,t,n){for(var r=t.shape.length,i=r>1?t.shape[r-1]:1,o=n.length,a=1,s=i;s<o;++s)a*=n[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:bp(t.shape)/u,sliceSize:a,strides:jp(n.slice(0,i)).concat([1]),outputSize:bp(n)}}function dy(e,t,n){vp(e.rank===t.length,(function(){return"Error in slice"+e.rank+"D: Length of begin "+t+" must match the rank of the array ("+e.rank+")."})),vp(e.rank===n.length,(function(){return"Error in slice"+e.rank+"D: Length of size "+n+" must match the rank of the array ("+e.rank+")."}));for(var r=function(r){vp(t[r]+n[r]<=e.shape[r],(function(){return"Error in slice"+e.rank+"D: begin["+r+"] + size["+r+"] ("+(t[r]+n[r])+") would overflow input.shape["+r+"] ("+e.shape[r]+")"}))},i=0;i<e.rank;++i)r(i)}function py(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function vy(e,t,n){for(var r=[],i=0;i<e.length;i++)r[i]=Math.ceil((t[i]-e[i])/n[i]);return r}function my(e,t,n,r,i){var o=t[i];(e&1<<i||null==o)&&(o=(n[i]||1)>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var a=r[i];return o<0&&(o+=a),fp(0,o,a-1)}function gy(e,t,n,r,i){var o=t[i],a=n[i]||1;(e&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),a>0?fp(0,o,s):fp(-1,o,s-1)}function yy(e,t,n){for(var r=n.length,i=0;i<n.length;i++)if(n[i]>1){r=i;break}for(i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function by(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function _y(e){return Sv.customGrad(e)}Object.freeze({prepareAndValidate:uy}),Object.freeze({validateUpdateShape:ly,validateInput:hy,calculateShapes:fy}),Object.freeze({assertParamsValid:dy,maskToAxes:py,computeOutShape:vy,startForAxis:my,stopForAxis:gy,isSliceContinous:yy,computeFlatOffset:by});var wy=Qm({softmax_:function(e,t){void 0===t&&(t=-1);var n=Lm(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+t);return Sv.runKernelFunc((function(e,r){var i=e.softmax(n,t);return r([i]),i}),{logits:n},(function(e,n){var r=n[0],i=e.mul(r);return{logits:function(){return i.sub(i.sum([t],!0).mul(r))}}}),"Softmax",{dim:t},[],[!0])}}),xy=Qm({logSoftmax_:function(e,t){void 0===t&&(t=-1);var n=Lm(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+t);return _y((function(e,n){var r=e.max(t,!0),i=e.sub(r),o=i.toFloat().sub(i.exp().sum(t,!0).log());return n([o]),{value:o,gradFunc:function(e,n){var r=n[0].exp();return e.sub(e.sum(t,!0).mul(r))}}}))(n)}}),ky=function(){function e(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return e.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},e.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},e.prototype.has=function(e){return this.data.has(e)},e.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},e.prototype.numDataIds=function(){return this.dataIdsCount},e}(),Cy=function(){function e(){}return e.prototype.time=function(e){return Ey("time")},e.prototype.read=function(e){return Ey("read")},e.prototype.readSync=function(e){return Ey("readSync")},e.prototype.numDataIds=function(){return Ey("numDataIds")},e.prototype.disposeData=function(e){return Ey("disposeData")},e.prototype.write=function(e,t,n){return Ey("write")},e.prototype.move=function(e,t,n,r){return Ey("move")},e.prototype.memory=function(){return Ey("memory")},e.prototype.floatPrecision=function(){return Ey("floatPrecision")},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.batchMatMul=function(e,t,n,r){return Ey("batchMatMul")},e.prototype.fusedBatchMatMul=function(e){return Ey("fusedBatchMatMul")},e.prototype.slice=function(e,t,n){return Ey("slice")},e.prototype.stridedSlice=function(e,t,n,r){return Ey("stridedSlice")},e.prototype.unstack=function(e,t){return Ey("unstack")},e.prototype.reverse=function(e,t){return Ey("reverse")},e.prototype.concat=function(e,t){return Ey("concat")},e.prototype.neg=function(e){return Ey("neg")},e.prototype.add=function(e,t){return Ey("add")},e.prototype.addN=function(e){return Ey("addN")},e.prototype.subtract=function(e,t){return Ey("subtract")},e.prototype.multiply=function(e,t){return Ey("multiply")},e.prototype.realDivide=function(e,t){return Ey("realDivide")},e.prototype.floorDiv=function(e,t){return Ey("floorDiv")},e.prototype.sum=function(e,t){return Ey("sum")},e.prototype.prod=function(e,t){return Ey("prod")},e.prototype.unsortedSegmentSum=function(e,t,n){return Ey("unsortedSegmentSum")},e.prototype.argMin=function(e,t){return Ey("argMin")},e.prototype.argMax=function(e,t){return Ey("argMax")},e.prototype.equal=function(e,t){return Ey("equal")},e.prototype.notEqual=function(e,t){return Ey("notEqual")},e.prototype.less=function(e,t){return Ey("less")},e.prototype.lessEqual=function(e,t){return Ey("lessEqual")},e.prototype.greater=function(e,t){return Ey("greater")},e.prototype.greaterEqual=function(e,t){return Ey("greaterEqual")},e.prototype.logicalNot=function(e){return Ey("logicalNot")},e.prototype.logicalAnd=function(e,t){return Ey("logicalAnd")},e.prototype.logicalOr=function(e,t){return Ey("logicalOr")},e.prototype.where=function(e){return Ey("where")},e.prototype.select=function(e,t,n){return Ey("select")},e.prototype.topk=function(e,t,n){return Ey("topk")},e.prototype.min=function(e,t){return Ey("min")},e.prototype.minimum=function(e,t){return Ey("minimum")},e.prototype.mod=function(e,t){return Ey("mod")},e.prototype.max=function(e,t){return Ey("max")},e.prototype.maximum=function(e,t){return Ey("maximum")},e.prototype.all=function(e,t){return Ey("all")},e.prototype.any=function(e,t){return Ey("any")},e.prototype.squaredDifference=function(e,t){return Ey("squaredDifference")},e.prototype.ceil=function(e){return Ey("ceil")},e.prototype.floor=function(e){return Ey("floor")},e.prototype.round=function(e){return Ey("round")},e.prototype.sign=function(e){return Ey("sign")},e.prototype.isNaN=function(e){return Ey("isNaN")},e.prototype.isInf=function(e){return Ey("isInf")},e.prototype.isFinite=function(e){return Ey("isFinite")},e.prototype.pow=function(e,t){return Ey("pow")},e.prototype.exp=function(e){return Ey("exp")},e.prototype.expm1=function(e){return Ey("expm1")},e.prototype.softmax=function(e,t){return Ey("softmax")},e.prototype.log=function(e){return Ey("log")},e.prototype.log1p=function(e){return Ey("log1p")},e.prototype.sqrt=function(e){return Ey("sqrt")},e.prototype.rsqrt=function(e){return Ey("rsqrt")},e.prototype.square=function(e){return Ey("square")},e.prototype.reciprocal=function(e){return Ey("reciprocal")},e.prototype.relu=function(e){return Ey("relu")},e.prototype.relu6=function(e){return Ey("relu6")},e.prototype.prelu=function(e,t){return Ey("prelu")},e.prototype.elu=function(e){return Ey("elu")},e.prototype.eluDer=function(e,t){return Ey("eluDer")},e.prototype.selu=function(e){return Ey("selu")},e.prototype.int=function(e){return Ey("int")},e.prototype.clip=function(e,t,n){return Ey("clip")},e.prototype.abs=function(e){return Ey("abs")},e.prototype.complexAbs=function(e){return Ey("complexAbs")},e.prototype.sigmoid=function(e){return Ey("sigmoid")},e.prototype.softplus=function(e){return Ey("softplus")},e.prototype.sin=function(e){return Ey("sin")},e.prototype.cos=function(e){return Ey("cos")},e.prototype.tan=function(e){return Ey("tan")},e.prototype.asin=function(e){return Ey("asin")},e.prototype.acos=function(e){return Ey("acos")},e.prototype.atan=function(e){return Ey("atan")},e.prototype.atan2=function(e,t){return Ey("atan2")},e.prototype.sinh=function(e){return Ey("sinh")},e.prototype.cosh=function(e){return Ey("cosh")},e.prototype.tanh=function(e){return Ey("tanh")},e.prototype.asinh=function(e){return Ey("asinh")},e.prototype.acosh=function(e){return Ey("acosh")},e.prototype.atanh=function(e){return Ey("atanh")},e.prototype.erf=function(e){return Ey("erf")},e.prototype.step=function(e,t){return Ey("step")},e.prototype.fusedConv2d=function(e){return Ey("fusedConv2d")},e.prototype.conv2d=function(e,t,n){return Ey("conv2d")},e.prototype.conv2dDerInput=function(e,t,n){return Ey("conv2dDerInput")},e.prototype.conv2dDerFilter=function(e,t,n){return Ey("conv2dDerFilter")},e.prototype.fusedDepthwiseConv2D=function(e){return Ey("fusedDepthwiseConv2D")},e.prototype.depthwiseConv2D=function(e,t,n){return Ey("depthwiseConv2D")},e.prototype.depthwiseConv2DDerInput=function(e,t,n){return Ey("depthwiseConv2DDerInput")},e.prototype.depthwiseConv2DDerFilter=function(e,t,n){return Ey("depthwiseConv2DDerFilter")},e.prototype.conv3d=function(e,t,n){return Ey("conv3d")},e.prototype.conv3dDerInput=function(e,t,n){return Ey("conv3dDerInput")},e.prototype.conv3dDerFilter=function(e,t,n){return Ey("conv3dDerFilter")},e.prototype.maxPool=function(e,t){return Ey("maxPool")},e.prototype.maxPoolBackprop=function(e,t,n,r){return Ey("maxPoolBackprop")},e.prototype.avgPool=function(e,t){return Ey("avgPool")},e.prototype.avgPoolBackprop=function(e,t,n){return Ey("avgPoolBackprop")},e.prototype.avgPool3d=function(e,t){return Ey("avgPool3d")},e.prototype.avgPool3dBackprop=function(e,t,n){return Ey("avgPool3dBackprop")},e.prototype.maxPool3d=function(e,t){return Ey("maxPool3d")},e.prototype.maxPool3dBackprop=function(e,t,n,r){return Ey("maxPool3dBackprop")},e.prototype.reshape=function(e,t){return Ey("reshape")},e.prototype.cast=function(e,t){return Ey("cast")},e.prototype.tile=function(e,t){return Ey("tile")},e.prototype.pad=function(e,t,n){return Ey("pad")},e.prototype.transpose=function(e,t){return Ey("transpose")},e.prototype.gather=function(e,t,n){return Ey("gather")},e.prototype.gatherND=function(e,t){return Ey("gatherND")},e.prototype.scatterND=function(e,t,n){return Ey("scatterND")},e.prototype.batchToSpaceND=function(e,t,n){return Ey("batchToSpaceND")},e.prototype.spaceToBatchND=function(e,t,n){return Ey("spaceToBatchND")},e.prototype.resizeBilinear=function(e,t,n,r){return Ey("resizeBilinear")},e.prototype.resizeBilinearBackprop=function(e,t,n){return Ey("resizeBilinearBackprop")},e.prototype.resizeNearestNeighbor=function(e,t,n,r){return Ey("resizeNearestNeighbor")},e.prototype.resizeNearestNeighborBackprop=function(e,t,n){return Ey("resizeNearestNeighborBackprop")},e.prototype.batchNormalization=function(e,t,n,r,i,o){return Ey("batchNormalization")},e.prototype.localResponseNormalization4D=function(e,t,n,r,i){return Ey("localResponseNormalization4D")},e.prototype.LRNGrad=function(e,t,n,r,i,o,a){return Ey("LRNGrad")},e.prototype.multinomial=function(e,t,n,r){return Ey("multinomial")},e.prototype.oneHot=function(e,t,n,r){return Ey("oneHot")},e.prototype.cumsum=function(e,t,n,r){return Ey("cumsum")},e.prototype.nonMaxSuppression=function(e,t,n,r,i){return Ey("nonMaxSuppression")},e.prototype.fft=function(e){return Ey("fft")},e.prototype.ifft=function(e){return Ey("ifft")},e.prototype.complex=function(e,t){return Ey("complex")},e.prototype.real=function(e){return Ey("real")},e.prototype.imag=function(e){return Ey("imag")},e.prototype.cropAndResize=function(e,t,n,r,i,o){return Ey("cropAndResize")},e.prototype.depthToSpace=function(e,t,n){return Ey("depthToSpace")},e.prototype.split=function(e,t,n){return Ey("split")},e.prototype.sparseToDense=function(e,t,n,r){return Ey("sparseToDense")},e.prototype.diag=function(e){return Ey("diag")},e.prototype.fill=function(e,t,n){return Ey("fill")},e.prototype.onesLike=function(e){return Ey("onesLike")},e.prototype.zerosLike=function(e){return Ey("zerosLike")},e.prototype.linspace=function(e,t,n){return Ey("linspace")},e.prototype.dispose=function(){return Ey("dispose")},e}();function Ey(e){throw new Error("'"+e+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Sy(e,t){for(var n=e.length,r=[],i=0;i<n;i++){var o=n-1-i;(t[t.length-1-i]||1)>1&&1===(e[o]||1)&&r.unshift(o)}return r}function Iy(e,t){for(var n=[],r=0;r<t.length;r++){var i=e[e.length-r-1],o=t.length-r-1;(null==i||1===i&&t[o]>1)&&n.unshift(o)}return n}function Ry(e,t){for(var n=[],r=Math.max(e.length,t.length),i=0;i<r;i++){var o=e[e.length-i-1];null==o&&(o=1);var a=t[t.length-i-1];if(null==a&&(a=1),1===o)n.unshift(a);else if(1===a)n.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+e+" and "+t+".");n.unshift(o)}}return n}function Ty(e,t,n,r,i,o,a){void 0===a&&(a="channelsLast");var s,u=Fy(t),c=u[0],l=u[1];if("channelsLast"===a)s=[c,l,e[3],e[3]];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);s=[c,l,e[1],e[1]]}return Dy(e,s,n,r,i,o,!1,a)}function Ay(e,t,n,r,i,o,a){void 0===a&&(a="NDHWC");var s,u,c=Py(t),l=c[0],h=c[1],f=c[2];if("NDHWC"===a)u="channelsLast",s=[l,h,f,e[4],e[4]];else{if("NCDHW"!==a)throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[l,h,f,e[1],e[1]]}return Ny(e,s,n,r,i,!1,u,o)}function Dy(e,t,n,r,i,o,a,s){void 0===a&&(a=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],f=u[3];if("channelsLast"===s)c=e[0],l=e[1],h=e[2],f=e[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=e[0],f=e[1],l=e[2],h=e[3]}var d,p=t[0],v=t[1],m=t[3],g=Fy(n),y=g[0],b=g[1],_=Fy(r),w=_[0],x=_[1],k=My(p,w),C=My(v,x),E=function(e,t,n,r,i,o,a,s){var u,c,l;if("number"==typeof e){u={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var h=function(e,t,n,r,i){null==r&&(r=Oy(e,t,n));var o=e[1],a=Ly((e[0]-t+2*r)/n+1,i);vp(wp(a),(function(){return"The output # of rows ("+a+") must be an integer. Change the stride and/or zero pad parameters"}));var s=Ly((o-t+2*r)/n+1,i);return vp(wp(s),(function(){return"The output # of columns ("+s+") must be an integer. Change the stride and/or zero pad parameters"})),[a,s]}([t,n],o,r,e,s);c=h[0],l=h[1]}else if("same"===e){c=Math.ceil(t/r),l=Math.ceil(n/i);var f=Math.max(0,(c-1)*r+o-t),d=Math.max(0,(l-1)*i+a-n),p=Math.floor(f/2),v=f-p,m=Math.floor(d/2);u={top:p,bottom:v,left:m,right:d-m,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((t-o+1)/r),l=Math.ceil((n-a+1)/i)}return{padInfo:u,outHeight:c,outWidth:l}}(i,l,h,y,b,k,C,o),S=E.outHeight,I=E.outWidth,R=a?m*f:m;return"channelsFirst"===s?d=[c,R,S,I]:"channelsLast"===s&&(d=[c,S,I,R]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:f,outHeight:S,outWidth:I,outChannels:R,padInfo:E.padInfo,strideHeight:y,strideWidth:b,filterHeight:p,filterWidth:v,effectiveFilterHeight:k,effectiveFilterWidth:C,dilationHeight:w,dilationWidth:x,inShape:e,outShape:d,filterShape:t}}function Ny(e,t,n,r,i,o,a,s){void 0===o&&(o=!1),void 0===a&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],f=u[3],d=u[4];if("channelsLast"===a)c=e[0],l=e[1],h=e[2],f=e[3],d=e[4];else{if("channelsFirst"!==a)throw new Error("Unknown dataFormat "+a);c=e[0],d=e[1],l=e[2],h=e[3],f=e[4]}var p,v=t[0],m=t[1],g=t[2],y=t[4],b=Py(n),_=b[0],w=b[1],x=b[2],k=Py(r),C=k[0],E=k[1],S=k[2],I=My(v,C),R=My(m,E),T=My(g,S),A=function(e,t,n,r,i,o,a,s,u,c,l){var h,f,d,p;if("number"==typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,i,o){null==i&&(i=Oy(e,t,r));var a=e[1],s=e[2],u=Ly((e[0]-t+2*i)/r+1,o);vp(wp(u),(function(){return"The output # of depths ("+u+") must be an integer. Change the stride and/or zero pad parameters"}));var c=Ly((a-t+2*i)/r+1,o);vp(wp(c),(function(){return"The output # of rows ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=Ly((s-t+2*i)/r+1,o);return vp(wp(l),(function(){return"The output # of columns ("+l+") must be an integer. Change the stride and/or zero pad parameters"})),[u,c,l,1]}([t,n,r,1],s,0,i,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/i))-1)*i+s-t,g=((d=Math.ceil(n/o))-1)*o+u-n,y=((p=Math.ceil(r/a))-1)*a+c-r,b=Math.floor(m/2),_=m-b,w=Math.floor(g/2),x=g-w,k=Math.floor(y/2);h={top:w,bottom:x,left:k,right:y-k,front:b,back:_,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: "+e);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/i),d=Math.ceil((n-u+1)/o),p=Math.ceil((r-c+1)/a)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}(i,l,h,f,_,w,x,I,R,T,s),D=A.outDepth,N=A.outHeight,O=A.outWidth,F=o?y*d:y;return"channelsFirst"===a?p=[c,F,D,N,O]:"channelsLast"===a&&(p=[c,D,N,O,F]),{batchSize:c,dataFormat:a,inDepth:l,inHeight:h,inWidth:f,inChannels:d,outDepth:D,outHeight:N,outWidth:O,outChannels:F,padInfo:A.padInfo,strideDepth:_,strideHeight:w,strideWidth:x,filterDepth:v,filterHeight:m,filterWidth:g,effectiveFilterDepth:I,effectiveFilterHeight:R,effectiveFilterWidth:T,dilationDepth:C,dilationHeight:E,dilationWidth:S,inShape:e,outShape:p,filterShape:t}}function Oy(e,t,n,r){void 0===r&&(r=1);var i=My(t,r);return Math.floor((e[0]*(n-1)-n+i)/2)}function Fy(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Py(e){return"number"==typeof e?[e,e,e]:e}function My(e,t){return t<=1?e:e+(e-1)*(t-1)}function Ly(e,t){if(!t)return e;switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode "+t)}}function By(e){var t=Fy(e);return 1===t[0]&&1===t[1]&&1===t[2]}function Uy(e,t){return By(e)||By(t)}function Wy(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat "+e)}function zy(e,t,n){if("complex64"===t){if("complex64"===e.dtype)return e.clone();var r=sg(e.shape),i=e.toFloat(),o=n.complex(i,r);return r.dispose(),i.dispose(),o}if(!Op(e.dtype,t))return Sv.makeTensorFromDataId(e.dataId,e.shape,t);if("complex64"===e.dtype){var a=n.real(e);return o=a.cast(t),a.dispose(),o}if("int32"===t)return n.int(e);if("bool"===t){var s=tg(0,e.dtype);return o=n.notEqual(e,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+e.dtype+" to "+t)}function Vy(e,t){return Sv.makeTensorFromDataId(e.dataId,t,e.dtype)}function jy(e,t,n){var r=(t-e)/(n-1),i=Kp(n,"float32");i[0]=e;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return ng(i,"float32")}function Hy(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+e.length+", imag: "+t.length+".");for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function qy(e,t){return{real:e[2*t],imag:e[2*t+1]}}function Gy(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function Ky(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function Xy(e,t,n){var r=function(e,t,n){return function(e,t,n){for(var r=0,i=e.length,o=0,a=!1;r<i;){var s=n(t,e[o=r+(i-r>>>1)]);s>0?r=o+1:(i=o,a=!s)}return a?r:-r-1}(e,t,n||Qy)}(e,t,n);e.splice(r<0?-(r+1):r,0,t)}function Qy(e,t){return e>t?1:e<t?-1:0}function Yy(e,t,n,r,i){return Zy(e,t,n,r,i,0).selectedIndices}function $y(e,t,n,r,i,o){var a=Zy(e,t,n,r,i,o,!0);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function Zy(e,t,n,r,i,o,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);for(var u=Array.from(t).map((function(e,t){return{score:e,boxIndex:t,suppressBeginIndex:0}})).filter((function(e){return e.score>i})).sort(tb),c=o>0?-.5/o:0,l=[],h=[];l.length<n&&u.length>0;){var f=u.pop(),d=f.score,p=f.boxIndex,v=f.suppressBeginIndex;if(d<i)break;for(var m=!1,g=l.length-1;g>=v;--g){var y=Jy(e,p,l[g]);if(y>=r){m=!0;break}if(f.score=f.score*eb(r,c,y),f.score<=i)break}f.suppressBeginIndex=l.length,m||(f.score===d?(l.push(p),h.push(f.score)):f.score>i&&Xy(u,f,tb))}var b=l.length;return s&&(l.fill(0,b),h.fill(0,b)),{selectedIndices:ng(l,"int32"),selectedScores:ng(h,"float32"),numValidOutputs:tg(b,"int32")}}function Jy(e,t,n){var r=e.subarray(4*t,4*t+4),i=e.subarray(4*n,4*n+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),d=(s-o)*(u-a),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(o,c),m=Math.max(a,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function eb(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function tb(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function nb(e,t,n){var r=new Array(e.rank).fill(0),i=e.shape.slice();return t.map((function(t){i[n]=t;var o=e.slice(r,i);return r[n]+=t,o}))}function rb(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];var i=Ag(n,e.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(e.rank),s=0;s<a.length;s++)a[s]=o[s]%e.shape[s];var u=e.locToIndex(a);i.values[r]=e.values[u]}return i.toTensor()}function ib(e,t,n,r,i){for(var o=t[t.length-1],a=[e.length/o,o],s=a[0],u=a[1],c=Tp(n,s*r),l=Tp("int32",s*r),h=0;h<s;h++){for(var f=h*u,d=e.subarray(f,f+u),p=[],v=0;v<d.length;v++)p.push({value:d[v],index:v});p.sort((function(e,t){return t.value-e.value}));var m=h*r,g=c.subarray(m,m+r),y=l.subarray(m,m+r);for(v=0;v<r;v++)g[v]=p[v].value,y[v]=p[v].index}var b=t.slice();return b[b.length-1]=r,[Jm(c,b,n),Jm(l,b,"int32")]}function ob(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);var i=Ag(e,"int32"),o=Ag([n.length,e.length],"int32");for(r=0;r<n.length;r++){var a=i.indexToLoc(n[r]);o.values.set(a,r*e.length)}return o.toTensor()}Object.freeze({castTensor:zy,reshapeTensor:Vy,linspaceImpl:jy,upcastType:yv,axesAreInnerMostDims:Um,combineLocations:Wm,computeOutAndReduceShapes:zm,expandShapeToKeepDim:Vm,assertAxesAreInnerMostDims:jm,getAxesPermutation:Hm,getUndoAxesPermutation:qm,getInnerMostAxes:Gm,getBroadcastDims:Sy,getReductionAxes:Iy,assertAndGetBroadcastShape:Ry,assertParamsConsistent:Km,computeOutShape:Xm,computePool2DInfo:Ty,computePool3DInfo:Ay,computeConv2DInfo:Dy,computeConv3DInfo:Ny,computeDefaultPad:Oy,tupleValuesAreOne:By,eitherStridesOrDilationsAreOne:Uy,convertConv2DDataFormat:Wy,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:cy});var ab=function(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("float v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},sb=function(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((function(e,t){return"T"+t}));var n=[];this.variableNames.forEach((function(e){n.push("vec4 v"+e+" = get"+e+"AtOutCoords();")}));var r=this.variableNames.map((function(e){return"v"+e})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},ub=function(e,t,n){this.variableNames=["A"];var r=e.windowSize,i=e.batchSize,o=Math.ceil(e.inSize/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+(n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));")+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+("max"===t?">":"<")+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function cb(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return e+"."+t}))}function lb(e,t){return 1===t?[e]:cb(e,t)}function hb(){var e,t,n,r,i,o,a,s,u,c;return 2===np().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function fb(e,t,n){void 0===n&&(n="index");var r=jp(t);return r.map((function(t,i){return"int "+e[i]+" = "+n+" / "+t+"; "+(i===r.length-1?"int "+e[i+1]+" = "+n+" - "+e[i]+" * "+t:"index -= "+e[i]+" * "+t)+";"})).join("")}function db(e){var t=jp(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+t[0]+" + coords.y * "+t[1]+" + coords.z;\n  }\n"}var pb="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function vb(e){return"offset"+e}function mb(e){var t=e.name,n=bp(e.shapeInfo.logicalShape);return n<2?"return "+t+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+t+"[i];\n      }\n    }\n  "}function gb(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank "+e+" is not yet supported")}function yb(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function bb(e,t){return t.map((function(t){return e[t]})).join(", ")}var _b=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,vp(e.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var i=Math.ceil(e[e.length-1]/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");var o,a,s=this.outputShape,u=s.length,c=gb(u),l=lb("coords",u);if(1===i){var h=gb(a=u+1);o="\n        "+h+" sourceLocR = "+h+"("+l.join()+", 0);\n        ++"+l[u-1]+";\n        "+h+" sourceLocG = "+h+"("+l.join()+", 0);\n        ++"+l[u-2]+";\n        "+h+" sourceLocA = "+h+"("+l.join()+", 0);\n        --"+l[u-1]+";\n        "+h+" sourceLocB = "+h+"("+l.join()+", 0);\n        --"+l[u-2]+";"}else a=u,o="\n        "+c+" sourceLocR = coords;\n        ++"+l[u-1]+";\n        "+c+" sourceLocG = coords;\n        ++"+l[u-2]+";\n        "+c+" sourceLocA = coords;\n        --"+l[u-1]+";\n        "+c+" sourceLocB = coords;\n        --"+l[u-2]+";";var f=["x","y","z","w","u","v"].slice(0,a),d="."+f[a-1],p=f.map((function(e){return"int "+e})),v=lb("sourceLocR",a-1).concat("inIdx.r"),m=lb("sourceLocG",a-1).concat("inIdx.g"),g=lb("sourceLocB",a-1).concat("inIdx.b"),y=lb("sourceLocA",a-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",_=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+m.join()+"),\n                             getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+y.join()+")));",w="vec4(\n            getAChannel("+v.join()+"),\n            hasNextCol ? getAChannel("+m.join()+") : 0.,\n            hasNextRow ? getAChannel("+g.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+y.join()+") : 0.)",x=r?"":"\n      float getBestIndicesAChannel("+p.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+p.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+x+"\n      void main() {\n        "+c+" coords = getOutputCoords();\n        bool hasNextCol = "+l[u-1]+" < "+(s[u-1]-1)+";\n        bool hasNextRow = "+l[u-2]+" < "+(s[u-2]-1)+";\n        "+o+"\n        ivec4 srcIdx = ivec4(sourceLocR"+d+", sourceLocG"+d+",\n          sourceLocB"+d+", sourceLocA"+d+") * "+t+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+w+";\n\n        for (int i = 0; i < "+t+"; i++) {\n          inIdx = srcIdx;\n          "+_+"\n          vec4 candidate = "+w+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},wb=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n      const float avgMultiplier = float("+1/(e.filterHeight*e.filterWidth)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n            wR += "+e.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+";\n            wC+= "+e.dilationWidth+") {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},xb=function(e){this.variableNames=["dy"],this.outputShape=e.inShape;var t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n      const float avgMultiplier = float("+1/(e.filterDepth*e.filterHeight*e.filterWidth)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n            wD += "+e.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+e.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+e.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+e.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},kb=function(e,t,n,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],Ry(e,t),Ry(e,n);var a="0.0";null!=r&&(Ry(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";null!=i&&(Ry(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+a+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+o+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Cb=function(e,t,n,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ry(e,t),Ry(e,n);var a="vec4(0.0)";null!=r&&(Ry(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=i&&(Ry(e,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=e,this.userCode="\n      void main() {\n        vec4 offset = "+a+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+o+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},Eb=function(e,t,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ry(t,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+e+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Sb="return a + b;",Ib="return a * b;",Rb="return (a < 0.) ? b * a : a;",Tb=function(e,t,n){this.variableNames=["A","B"],this.outputShape=Ry(t,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+e+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Ab="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Db=function(e,t,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ry(t,n);var i=this.outputShape.length,o="";if(r)if(0===i||1===bp(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(o="\n          "+gb(i)+" coords = getOutputCoords();\n        ",1===i)o+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var a=lb("coords",i);o+="\n            bool nextRowOutOfBounds =\n              ("+a[i-2]+" + 1) >= "+this.outputShape[i-2]+";\n            bool nextColOutOfBounds =\n              ("+a[i-1]+" + 1) >= "+this.outputShape[i-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+o+"\n\n        setOutput(result);\n      }\n    "},Nb=function(){function e(e){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Ob=function(){function e(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(r,i){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(i,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(i,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}},e}(),Fb=function(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Pb=function(e){this.outputShape=[],this.outputShape=Xm(e,1),this.variableNames=e.map((function(e,t){return"T"+t}));var t=new Array(e.length-1);t[0]=e[0][1];for(var n=1;n<t.length;n++)t[n]=t[n-1]+e[n][1];var r=["if (yC < "+t[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<t.length;n++)r.push("else if (yC < "+t[n]+") setOutput(getT"+n+"(yR, yC-"+t[n-1]+"));");r.push("else setOutput(getT"+t.length+"(yR, yC-"+t[t.length-1]+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Mb=function(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Xm(e,t);var n=this.outputShape,r=n.length,i=gb(r),o=lb("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((function(e,t){return"T"+t}));var s=new Array(e.length-1);s[0]=e[0][t];for(var u=1;u<s.length;u++)s[u]=s[u-1]+e[u][t];var c=a[t],l=a.slice(-2),h=a.join(),f="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var d=s[u-1];f+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+Lb(a,c,d)+"),\n            vec2("+Lb(l,c,d)+"));\n        }"}var p=s[s.length-1];f+="\n        return getChannel(\n          getT"+s.length+"("+Lb(a,c,p)+"),\n          vec2("+Lb(l,c,p)+"));",this.userCode="\n      float getValue("+a.map((function(e){return"int "+e}))+") {\n        "+f+"\n      }\n\n      void main() {\n        "+i+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+o+"), 0., 0., 0.);\n\n        "+o[r-1]+" = "+o[r-1]+" + 1;\n        if ("+o[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+o+");\n        }\n\n        "+o[r-2]+" = "+o[r-2]+" + 1;\n        if ("+o[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+o+");\n        }\n\n        "+o[r-1]+" = "+o[r-1]+" - 1;\n        if ("+o[r-2]+" < "+n[r-2]+" &&\n            "+o[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+o+");\n        }\n        setOutput(result);\n      }\n    "};function Lb(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?e+" - "+n:e})).join()}var Bb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              if ("+("channelsLast"===e.dataFormat)+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ub=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r="channelsLast"===e.dataFormat;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+(r?3:1)+"];\n\n        ivec2 dyCorner = ivec2(coords["+(r?1:2)+"], coords["+(r?2:3)+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n\n              if ("+r+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Wb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yF = 0; yF < "+e.outDepth+"; yF++) {\n            int xF = wF + yF * "+e.strideDepth+" - "+e.padInfo.front+";\n\n            if (xF < 0 || xF >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n              int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n                int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},zb=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterDepth,n=e.filterHeight,r=e.filterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+t+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+e.strideDepth+".0;\n\n          if (dyF < 0.0 || dyF >= "+e.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+t+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+e.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Vb=function(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+e.outChannels/e.inChannels+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+e.batchSize+"; b++) {\n          for (int yR = 0; yR < "+e.outHeight+"; yR++) {\n            int xR = wR + yR * "+e.strideHeight+" - "+e.padInfo.top+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+e.outWidth+"; yC++) {\n              int xC = wC + yC * "+e.strideWidth+" - "+e.padInfo.left+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},jb=function(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;var t=e.filterHeight,n=e.filterWidth,r=e.outChannels/e.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+t+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+t+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+r+"; dm++) {\n              int d2 = d1 * "+r+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Hb=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.padInfo.top,o=e.padInfo.left,a=e.strideHeight,s=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterHeight,h=e.filterWidth,f=4*Math.floor(e.inChannels/4),d=e.inChannels%4,p="channelsLast"===e.dataFormat,v=p?1:2,m=p?2:3,g=p?3:1,y="",b="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",b="result = activation(result);");var _=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+a+", "+s+");\n      const ivec2 pads = ivec2("+i+", "+o+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+g+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+v+"], coords["+m+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+e.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===d)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+f+") *\n                    getW(wR, wC, "+f+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+f+", xR, xC) *\n                    getW(wR, wC, "+f+", d2);\n              }\n\n            } else if ("+(2===d)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===d)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+f+", d2),\n                getW(wR, wC, "+f+" + 1, d2),\n                getW(wR, wC, "+f+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+f+"),\n                  getX(batch, xR, xC, "+f+" + 1),\n                  getX(batch, xR, xC, "+f+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+f+", xR, xC),\n                  getX(batch, "+f+" + 1, xR, xC),\n                  getX(batch, "+f+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+_+"\n        "+b+"\n        setOutput(result);\n      }\n    "},qb=function(e){this.variableNames=["x","W"],this.outputShape=e.outShape;var t=e.padInfo.front,n=e.padInfo.top,r=e.padInfo.left,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.filterDepth,h=e.filterHeight,f=e.filterWidth,d=4*Math.floor(e.inChannels/4),p=e.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+t+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+f+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+d+") *\n                  getW(wF, wR, wC, "+d+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+d+"),\n                  getX(batch, xF, xR, xC, "+d+" + 1),\n                  getX(batch, xF, xR, xC, "+d+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+d+", d2),\n                  getW(wF, wR, wC, "+d+" + 1, d2),\n                  getW(wF, wR, wC, "+d+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Gb=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=e.outShape;var i=e.inHeight,o=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=e.outChannels/e.inChannels,v="",m="";n&&(v=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",m="result = activation(result);");var g=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+v+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+f+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+i+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+d+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+o+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+g+"\n        "+m+"\n        setOutput(result);\n      }\n    "},Kb=function(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.outShape;for(var i=e.inHeight,o=e.inWidth,a=e.padInfo.top,s=e.padInfo.left,u=e.strideHeight,c=e.strideWidth,l=e.dilationHeight,h=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,p=d,v="int xR; int xC; int xCOffset;",m=0;m<f;m++)for(var g=0;g<d;g++)v+="\n          vec4 xTexelR"+m+"C"+2*g+" = vec4(0.);\n          vec4 wR"+m+"C"+g+" = vec4(0.);\n          vec4 xR"+m+"C"+g+" = vec4(0.);";for(m=0;m<f;m++)for(var y=0;y<p;y++){if(v+="\n          xR = xRCorner + "+m*l+";\n          xC = xCCorner + "+(g=2*y)*h+";\n        ",1===c){if(g<d&&(v+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    xTexelR"+m+"C"+g+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+i+" && xCOffset >= 0 && xCOffset < "+o+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+o+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+".xy);\n                } else {\n                  xR"+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+i+" && xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = xTexelR"+m+"C"+g+";\n              ",g+1<d)){var b=s%2==0?dp(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(v+="\n                  xCOffset = xC + "+s%2+" + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(v+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+i+" &&\n                      xCOffset >= 0 && xCOffset < "+o+") {\n                      xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+m+"C"+g+" = vec4(0.);\n                    }\n                  "),v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".xy);\n                "):v+="\n                  xCOffset = xC + "+b+";\n\n                  if(xR >= 0 && xR < "+i+" &&\n                    xCOffset >= 0 && xCOffset < "+o+") {\n                    xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+";\n                "}}else g<d&&(v+="\n              if(xR >= 0 && xR < "+i+") {\n            ",s%2==1?(v+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+o+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n              ",g+1<d&&(v+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+o+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+".xy, final.xy);\n                ")):(v+="\n                if(xC >= 0 && xC < "+o+") {\n                  xTexelR"+m+"C"+g+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+m+"C"+g+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+o+") {\n                  xTexelR"+m+"C"+(g+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+m+"C"+(g+2)+" = vec4(0.);\n                }\n\n                xR"+m+"C"+g+" = vec4(\n                  xTexelR"+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+".xy);\n              ",g+1<d&&(v+="\n                  xR"+m+"C"+(g+1)+" = vec4(\n                    xTexelR"+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+".zw);\n                ")),v+="}");g<d&&(v+="\n            vec4 wTexelR"+m+"C"+g+" = getW("+m+", "+g+", d1, q);\n            wR"+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+".xz);\n          ",g+1<d&&(v+="\n              vec4 wTexelR"+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+", d1, q);\n              wR"+m+"C"+(g+1)+" =\n                vec4(wTexelR"+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<f;m++)for(g=0;g<d;g++)v+="dotProd += xR"+m+"C"+g+" * wR"+m+"C"+g+";";var _="",w="";n&&(_=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",w="result = activation(result);");var x=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+_+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+a+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+v+"\n\n        vec4 result = dotProd;\n        "+x+"\n        "+w+"\n        setOutput(result);\n      }\n    "},Xb=function(e,t,n,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=e[0],a=e[1],s=e[2],u=n[0],c=n[1];this.outputShape=[t[0],u,c,e[3]];var l=[a-1+".0",s-1+".0"],h=l[0],f=l[1],d=u>1?[""+(a-1)/(u-1),"(y2-y1) * height_ratio","y1*"+h+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+h],p=c>1?[""+(s-1)/(c-1),"(x2-x1) * width_ratio","x1*"+f+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+f];this.userCode="\n      const float height_ratio = float("+d[0]+");\n      const float width_ratio = float("+p[0]+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+o+") {\n          return;\n        }\n\n        float height_scale = "+d[1]+";\n        float width_scale = "+p[1]+";\n\n        float in_y = "+d[2]+";\n        if( in_y < 0.0 || in_y > "+h+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n        float in_x = "+p[2]+";\n        if( in_x < 0.0 || in_x > "+f+" ) {\n          setOutput(float("+i+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+("bilinear"===r?1:0)+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},Qb=function(e,t,n){this.variableNames=["x"],this.outputShape=e;var r=e.length,i=e[e.length-1],o=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+i+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+gb(r)+" coords = getOutputCoords();\n        int end = "+Yb(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+i+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+o+" end) {\n            continue;\n          }\n          if (idx == end && "+t+") {\n            continue;\n          }\n          "+Yb(r,"coords")+" = idx;\n          val += getX("+function(e,t){if(1===e)return""+t;if(2===e)return t+".x, "+t+".y";if(3===e)return t+".x, "+t+".y, "+t+".z";if(4===e)return t+".x, "+t+".y, "+t+".z, "+t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function Yb(e,t){if(1===e)return""+t;if(2===e)return t+".y";if(3===e)return t+".z";if(4===e)return t+".w";throw Error("Cumulative sum for rank "+e+" is not yet supported")}var $b=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Tv.DENSE;var t=Lv(e),n=hb();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fb(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},Zb=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Tv.DENSE;var t=Lv(e),n=hb();this.outputShape=e,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fb(["r","c","d"],e)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+t[0]+", "+t[1]+"));\n        int index = 4 * (resTexRC.x * "+t[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},Jb=function(){function e(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+t+";\n      int offset_h = imod(h, "+t+");\n      int in_w = w / "+t+";\n      int offset_w = imod(w, "+t+");\n      int offset_d = (offset_h * "+t+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return e.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},e.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},e.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},e.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},e.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},e}(),e_=function(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},t_=function(e){this.variableNames=["A"],this.outTexUsage=Av.DOWNLOAD;var t=hb();this.outputShape=e,this.userCode="\n      "+pb+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+t.output+" = encode_float(x);\n      }\n    "},n_=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Av.DOWNLOAD;var t=hb();this.outputShape=e,this.userCode="\n      "+pb+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+t.output+" = encode_float(x);\n      }\n    "},r_=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=hb(),i=t[0],o=t[1];this.outputShape=e;var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      "+db(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+o+";\n        int c = imod(flatIndex, "+o+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+a+", 0., 0., 0.);\n      }\n    "},i_=function(e,t,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=hb(),i=t[0],o=t[1];this.outputShape=e;var a="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;a+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+e[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+e[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+o+";\n              c = imod(flatIndex, "+o+");\n              uv = (vec2(c, r) + halfCR) / vec2("+o+".0, "+i+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+db(e)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+a+"\n\n        "+r.output+" = "+s+";\n      }\n    "},o_=function(e,t,n){this.variableNames=["real","imag"];var r=t[1];this.outputShape=t;var i=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI;this.userCode="\n      const float exponentMultiplier = "+i+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+e+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+(n?r+".0":"1.0")+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},a_=function(){function e(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}},e}(),s_=function(e,t,n){this.variableNames=["A","indices"];var r=e.slice();r[n]=t,this.outputShape=r,this.rank=r.length;var i=gb(this.rank),o=function(e,t){var n=e.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],o=0;o<e.length;o++)i.push(o===t?"int(getIndices("+r[o]+"))":""+r[o]);return i.join()}(e,n);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},u_=function(e,t,n){this.sliceDim=e,this.strides=t,this.variableNames=["x","indices"],this.outputShape=n;var r=gb(t.length),i=gb(n.length);this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+i+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+(this.sliceDim>1?"strides[j]":"strides")+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function c_(e,t){var n=hb();return Hv(e,t,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function l_(e,t){return Zv(e,t,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function h_(e,t){return Jv(e,t,new Uint16Array([0,1,2,2,1,3]))}function f_(e,t,n,r,i,o,a){tm(n,r);var s=em(e,t),u=e.TEXTURE_2D;return Wv(e,t,(function(){return e.bindTexture(u,s)})),Wv(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Wv(e,t,(function(){return e.texParameteri(u,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Wv(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Wv(e,t,(function(){return e.texParameteri(u,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Wv(e,t,(function(){return e.texImage2D(u,0,i,n,r,0,o,a,null)})),Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),s}function d_(e,t,n,r,i){var o=Mv(n,r);return f_(e,t,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,e.FLOAT)}function p_(e,t,n,r,i){var o=Mv(n,r);return f_(e,t,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function v_(e,t,n,r,i){var o=Mv(n,r);return f_(e,t,o[0],o[1],e.RGBA,e.RGBA,e.UNSIGNED_BYTE)}function m_(e,t,n,r,i){var o=Bv(n,r);return f_(e,t,o[0],o[1],i.internalFormatPackedFloat,e.RGBA,e.FLOAT)}function g_(e,t,n,r,i){var o=Bv(n,r);return f_(e,t,o[0],o[1],i.internalFormatPackedHalfFloat,e.RGBA,i.textureTypeHalfFloat)}function y_(e,t,n,r){return Wv(e,t,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),rm(e,t,n,"clipSpacePos",r,3,20,0)&&rm(e,t,n,"uv",r,2,20,12)}function b_(e,t,n,r,i,o,a){var s,u,c;Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=e.UNSIGNED_BYTE,c=e.RGBA):(s=new Float32Array(r*i*4),u=e.FLOAT,c=a.internalFormatPackedFloat),s.set(o),Wv(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,c,r,i,0,e.RGBA,u,s)})),Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function __(e,t,n,r){Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,n)})),r.data instanceof Uint8Array?Wv(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r.width,r.height,0,e.RGBA,e.UNSIGNED_BYTE,r.data)})):Wv(e,t,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)})),Wv(e,t,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}function w_(e,t,n,r,i){var o=e.createBuffer();Wv(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,o)}));var a=16*n*r;return Wv(e,t,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,a,e.STREAM_READ)})),Wv(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,0)})),Wv(e,t,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),o}function x_(e,t,n){var r=e,i=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function k_(e,t,n,r,i){var o=Mv(n,r),a=o[0],s=o[1],u=new Uint8Array(n*r*4);return Wv(e,t,(function(){return e.readPixels(0,0,a,s,i.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function C_(e,t,n,r,i,o,a,s){var u=e,c=new Float32Array(function(e,t){var n=Bv(e,t);return n[0]*n[1]*4}(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function E_(e,t,n,r){var i=new Float32Array(n*r*4);return Wv(e,t,(function(){return e.readPixels(0,0,r,n,e.RGBA,e.FLOAT,i)})),i}var S_=Object.freeze({createVertexShader:c_,createVertexBuffer:l_,createIndexBuffer:h_,createFloat32MatrixTexture:d_,createFloat16MatrixTexture:p_,createUnsignedBytesMatrixTexture:v_,createPackedMatrixTexture:m_,createFloat16PackedMatrixTexture:g_,bindVertexProgramAttributeStreams:y_,uploadDenseMatrixToTexture:b_,uploadPixelDataToTexture:__,createBufferFromOutputTexture:w_,downloadFloat32MatrixFromBuffer:x_,downloadByteEncodedFloatMatrixFromOutputTexture:k_,downloadPackedMatrixFromBuffer:C_,downloadMatrixFromPackedOutputTexture:E_}),I_=function(){function e(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=np().getNumber("WEBGL_VERSION");null!=e?(this.gl=e,Fv(t,e)):this.gl=Pv(t);var n="WEBGL_color_buffer_float";if(1===np().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=jv(this.gl,this.debug,"OES_texture_float"),km(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=jv(this.gl,this.debug,"OES_texture_half_float");else if(np().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),km(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=jv(this.gl,this.debug,"EXT_color_buffer_half_float");else if(np().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(km(this.gl,n="EXT_color_buffer_float"))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!km(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=l_(this.gl,this.debug),this.indexBuffer=h_(this.gl,this.debug),this.framebuffer=nm(this.gl,this.debug),this.textureConfig=Uv(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(e.prototype,"debug",{get:function(){return np().getBool("DEBUG")},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Wv(t,this.debug,(function(){return t.finish()})),Wv(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Wv(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),Wv(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Wv(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Wv(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},e.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),d_(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),p_(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),v_(this.gl,this.debug,e,t)},e.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),__(this.gl,this.debug,e,t)},e.prototype.uploadDenseMatrixToTexture=function(e,t,n,r){this.throwIfDisposed(),b_(this.gl,this.debug,e,t,n,r,this.textureConfig)},e.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),g_(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),m_(this.gl,this.debug,e,t,this.textureConfig)},e.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(cm(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Wv(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},e.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return k_(r.gl,r.debug,t,n,r.textureConfig)}))},e.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,r,i,o){return C_(this.gl,e,0,0,0,i,o)},e.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return x_(this.gl,e,t)},e.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var r=w_(this.gl,this.debug,t,n);return this.unbindTextureToFrameBuffer(),r},e.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},e.prototype.createFence=function(e){var t,n,r=this;if(np().getBool("WEBGL_FENCE_API_ENABLED")){var i=e,o=i.fenceSync(i.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=i.clientWaitSync(o,0,0);return e===i.ALREADY_SIGNALED||e===i.CONDITION_SATISFIED},t=o}else np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},e.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return E_(r.gl,r.debug,t,n)}))},e.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=qv(t,this.debug,e),r=c_(t,this.debug),i=Qv(t,this.debug);return Wv(t,this.debug,(function(){return t.attachShader(i,r)})),Wv(t,this.debug,(function(){return t.attachShader(i,n)})),Yv(t,this.debug,i),this.debug&&$v(t,this.debug,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=y_(t,this.debug,this.program,this.vertexBuffer)),i},e.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Wv(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},e.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&$v(this.gl,this.debug,this.program),Wv(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},e.prototype.getUniformLocation=function(e,t,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?om(this.gl,this.debug,e,t):am(this.gl,e,t)},e.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Wv(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},e.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},e.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),sm(this.gl,this.debug,0,e,t,n)},e.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},e.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var r=Bv(t,n);this.setOutputMatrixTextureDriver(e,r[0],r[1])},e.prototype.setOutputMatrixWriteRegion=function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)},e.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},e.prototype.debugValidate=function(){null!=this.program&&$v(this.gl,this.debug,this.program),lm(this.gl)},e.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Wv(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},e.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Wv(this.gl,this.debug,(function(){return e.gl.finish()}))},e.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=jv(this.gl,this.debug,2===np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},e.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},e.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},e.prototype.beginQuery=function(){if(2===np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),i=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,i),i},e.prototype.endQuery=function(){if(2!==np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},e.prototype.waitForQueryAndGetTime=function(e){return Zd(this,void 0,void 0,(function(){var t=this;return Jd(this,(function(n){switch(n.label){case 0:return[4,Ep((function(){return t.disposed||t.isQueryAvailable(e,np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},e.prototype.getQueryTime=function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6},e.prototype.isQueryAvailable=function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),i=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint}return i=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),i&&!this.disjoint},e.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},e.prototype.pollItems=function(){for(var e=function(e){for(var t=0;t<e.length&&e[t]();++t);return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},e.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Ep((function(){return n.pollItems(),0===n.itemsToPoll.length}))},e.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),um(this.gl,this.debug,e,this.framebuffer),this.debug&&lm(this.gl)},e.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(um(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&lm(this.gl)):cm(this.gl,this.debug,this.framebuffer)},e.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},e.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var r=this.gl;um(r,this.debug,e,this.framebuffer),this.debug&&lm(r),this.outputTexture=e,Wv(r,this.debug,(function(){return r.viewport(0,0,t,n)})),Wv(r,this.debug,(function(){return r.scissor(0,0,t,n)}))},e.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,r){var i=this;this.throwIfDisposed(),Wv(this.gl,this.debug,(function(){return i.gl.scissor(e,t,n,r)}))},e.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},e.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},e}();function R_(e,t){if(e.length!==t.length)throw Error("Binary was compiled with "+e.length+" inputs, but was executed with "+t.length+" inputs");e.forEach((function(e,n){var r=e.logicalShape,i=t[n],o=i.shape;if(!_p(r,o))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+o+" must match");if(!e.isUniform||!i.isUniform){var a=e.texShape,s=i.isUniform?null:i.texData.texShape;if(!_p(a,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+a+" and "+s+" must match")}}))}var T_=function(e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var r=n.inChannels,i=n.strideWidth,o=n.strideHeight,a=n.padInfo,s=n.outWidth,u=n.dilationWidth,c=n.dilationHeight,l=n.dataFormat,h=a.left,f=a.top,d=r*n.filterWidth,p=hb(),v="channelsLast"===l,m=v?0:1,g=v?1:2,y="",b=0;b<=1;b++)for(var _=0;_<=1;_++)y+="\n          blockIndex = rc.y + "+_+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+e[1]+" && pos < "+e[0]+") {\n            offsetY = int(blockIndex / ("+s+")) * "+o+" - "+f+";\n            d0 = offsetY + "+c+" * (pos / "+d+");\n\n            if(d0 < "+t[m]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+s+".) * "+i+". - "+h+".);\n              d1 = offsetX + "+u+" * (int(mod(float(pos), "+d+".) / "+r+".));\n\n              if(d1 < "+t[g]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+r+".));\n\n                if ("+v+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+_)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+_)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+y+"\n\n        "+p.output+" = result;\n      }\n    "},A_=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[];var o=t,a=e[3]-1;this.outputShape=e;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+o+"; j <= "+o+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+a+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+(.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));")+";\n        setOutput(val);\n      }\n    "},D_=function(e,t,n,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=n,this.alpha=r,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+t+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+t+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+i+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+i+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},N_=function(e,t,n,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o=t,a=e[3]-1;this.outputShape=e;var s="float("+n+") + float("+r+") * sum";this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+o+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+o+"; j <= "+o+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+a+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+(.5===i?"inversesqrt("+s+")":1===i?"1.0/("+s+")":"exp(log("+s+") * float(-"+i+"));")+";\n        setOutput(result);\n      }\n    "},O_=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.effectiveFilterHeight,n=e.effectiveFilterWidth;this.userCode="\n      const ivec2 pads = ivec2("+(t-1-e.padInfo.top)+", "+(n-1-e.padInfo.left)+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+t+";\n          wR += "+e.dilationHeight+") {\n          float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n          if (dyR < 0.0 || dyR >= "+e.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n            if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+(t*n-1)+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+n+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},F_=function(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;var t=e.effectiveFilterDepth,n=e.effectiveFilterHeight,r=e.effectiveFilterWidth;this.userCode="\n      const ivec3 pads = ivec3("+(t-1-e.padInfo.front)+", "+(n-1-e.padInfo.top)+", "+(r-1-e.padInfo.left)+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+t+";\n           wD += "+e.dilationDepth+") {\n          float dyD = float(dyDCorner + wD) / "+e.strideDepth+".0;\n\n          if (dyD < 0.0 || dyD >= "+e.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+n+";\n              wR += "+e.dilationHeight+") {\n            float dyR = float(dyRCorner + wR) / "+e.strideHeight+".0;\n\n            if (dyR < 0.0 || dyR >= "+e.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+r+";\n                wC += "+e.dilationWidth+") {\n              float dyC = float(dyCCorner + wC) / "+e.strideWidth+".0;\n\n              if (dyC < 0.0 || dyC >= "+e.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+(t*n*r-1)+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+n+" * "+r+" +\n                  wR * "+r+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},P_=function(e,t,n,r,i,o,a){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=null),void 0===a&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;var s=Math.ceil((n?e[1]:e[2])/2),u=n?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",l=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",d="";o&&(f=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+o+"\n        }":"vec4 activation(vec4 x) {\n          "+o+"\n        }",d="result = activation(result);");var p=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+s+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+s+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+u+");\n          vec4 b = getMatrixB(rc.x, "+c+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+l[0]+" * "+h[0]+");\n          result += ("+l[1]+" * "+h[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+p+"\n\n        "+d+"\n\n        setOutput(result);\n      }\n    "},M_=function(){function e(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(t-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(t-1)+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}},e}(),L_=function(e,t,n,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},B_=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e;var t=e.length;if(0===t)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=lb("rc",t),r=gb(t),i=function(e,t,n){if(1===e)return"rc > "+t[0];for(var r="",i=e-2;i<e;i++)r+=n[i]+" >= "+t[i],i<e-1&&(r+="||");return r}(t,e,n),o=function(e,t,n,r){if(1===e)return"";var i=r.slice(-2);return"\n    int r = "+i[0]+";\n    int c = "+i[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+t+";\n    bool rEdge = rp1 >= "+n+";\n  "}(t,e[e.length-1],e[e.length-2],n),a=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var i=0;i<=1;i++){for(var o=(0===r?"r":"rp1")+", "+(0===i?"c":"cp1"),a=2;a<e;a++)o=t[t.length-1-a]+","+o;n.push(o)}return n}(n,t);return 1===n?"getA(rc),\n            rc + 1 >= "+e[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(e,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+i+") {\n            setOutput(vec4(0));\n          } else {\n            "+o+"\n\n            setOutput(vec4("+a+"));\n          }\n        }\n      "}},U_=function(e,t,n){this.variableNames=["x"],this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));var r=e.length,i=gb(r),o=t.map((function(e){return e[0]})).join(","),a=t.map((function(t,n){return t[0]+e[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+i+" start = "+i+"("+o+");\n      "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+i+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+o+";\n        int end = "+a+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},W_=function(e,t,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((function(t,n){return t[0]+e[n]+t[1]}));for(var r=e.length,i=gb(r),o=t.map((function(e){return e[0]})).join(","),a=t.map((function(t,n){return t[0]+e[n]})).join(","),s=lb("rc",r),u=lb("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],f=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",d="",p=0,v=1===r?2:4;p<v;p++)d+="\n        "+h[p]+"\n        if ("+f+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+i+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";this.userCode="\n      const "+i+" start = "+i+"("+o+");\n      const "+i+" end = "+i+"("+a+");\n\n      void main() {\n        "+i+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+(d+=1===r?"} ":"}}")+"\n        setOutput(result);\n      }\n    "},z_=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideHeight,o=e.strideWidth,a=e.dilationHeight,s=e.dilationWidth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,l=e.padInfo.top,h=e.padInfo.left;this.outputShape=e.outShape;var f="avg"===t,d="0.0";if(f||(d="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+o+");\n        const ivec2 pads = ivec2("+l+", "+h+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+s+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+e.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = wR * "+c+" + wC;\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var p=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(p="avgValue / count");var v=4*Math.floor(r/4),m=r%4,g="\n      if ("+f+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+o+");\n      const ivec2 pads = ivec2("+l+", "+h+");\n      const float initializationValue = "+d+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+d+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+u+";\n            wR += "+a+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+e.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+v+"; wC += 4) {\n            int xC = xCCorner + wC * "+s+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              getValue(batch, xR, xC + 3 * "+s+", d)\n            );\n\n            "+g+"\n          }\n\n          int xC = xCCorner + "+v+";\n          if ("+(1===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(2===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+g+"\n          } else if ("+(3===m)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+s+", d),\n              getValue(batch, xR, xC + 2 * "+s+", d),\n              initializationValue\n            );\n\n            "+g+"\n          }\n        }\n        setOutput("+p+");\n      }\n    "}},V_=function(e,t,n){if(this.variableNames=["x"],"avg"===t&&n)throw new Error("Cannot compute positions for average pool.");var r=e.filterWidth,i=e.strideDepth,o=e.strideHeight,a=e.strideWidth,s=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,l=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.front,p=e.padInfo.top,v=e.padInfo.left;this.outputShape=e.outShape;var m="avg"===t,g="0.0";if(m||(g="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+o+", "+a+");\n        const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+l+";\n              wD += "+s+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+e.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+h+";\n                wR += "+u+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+e.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+f+";\n                  wC += "+c+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+e.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition =\n                      wD * "+h+" * "+f+" +\n                      wR * "+f+" + wC;;\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===t&&(y="avgValue / count");var b=4*Math.floor(r/4),_=r%4,w="\n      if ("+m+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+o+", "+a+");\n      const ivec3 pads = ivec3("+d+", "+p+", "+v+");\n      const float initializationValue = "+g+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+e.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+g+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+e.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+";\n            wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+e.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+b+"; wC += 4) {\n              int xC = xCCorner + wC * "+c+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+c+", ch)\n              );\n\n              "+w+"\n            }\n\n            int xC = xCCorner + "+b+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+w+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+c+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+c+", ch),\n                initializationValue\n              );\n\n              "+w+"\n            }\n          }\n          setOutput("+y+");\n        }\n      }\n    "}},j_=function(e,t){this.variableNames=["x"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=Math.ceil(i/n);this.outputShape=[r,o];var a="0.0",s="";"prod"===t?a="1.0":"min"===t?(a="1.0 / 1e-20",s="min"):"max"===t&&(a="-1.0 / 1e-20",s="max");var u=t+"("+t+"("+t+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===t?u="sumValue":"prod"===t?u="prodValue":"all"===t?u="allValue":"any"===t&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===t)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===t)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",f="vec4";"all"===t?(a="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",f="bvec4"):"any"===t&&(a="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",f="bvec4");var d="";i%n>0&&(d="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+a+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+d+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+a+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+f+" values = "+f+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},H_=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;for(var n="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),n+="\n        "+i+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+fb(["r","c","d"],t)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+db(e)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+e[1]+";\n        int cols = "+e[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},q_=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],c=[n&&s>1?i-1:i,n&&u>1?o-1:o],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],f=c[1]/l[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(i-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(o-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},G_=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[1],o=e[2];this.outputShape=[e[0],t,n,e[3]];var a=[r&&t>1?i-1:i,r&&n>1?o-1:o],s=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},K_=function(e,t,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=e[1],o=e[2],a=e[3];this.outputShape=[e[0],t,n,a];var s=[r&&t>1?i-1:i,r&&n>1?o-1:o],u=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+s[0]/u[0]+",\n          "+s[1]/u[1]+",\n          "+s[1]/u[1]+");\n      const vec3 inputShapeRC = vec3("+i+".0, "+o+".0,\n                                     "+o+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(a-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},X_=function(e,t,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t.shape;var r=t.shape,i=r[1],o=r[2],a=e.shape,s=a[1],u=a[2],c=[n&&s>1?i-1:i,n&&u>1?o-1:o],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],f=c[1]/l[1],d=1/h,p=1/f,v=2*Math.ceil(d)+2,m=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+f+");\n\n        const float invHeightScale = float("+d+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+v+");\n        const int winWidth = int("+m+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+i+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},Q_=function(e,t,n,r){this.variableNames=["A"],this.outputShape=[];var i=e[1],o=e[2];this.outputShape=[e[0],t,n,e[3]];var a=[r&&t>1?i-1:i,r&&n>1?o-1:o],s=[r&&t>1?t-1:t,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+a[0]/s[0]+",\n          "+a[1]/s[1]+");\n      const vec2 inputShapeRC = vec2("+i+".0, "+o+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+(r?"0.5":"0.0")+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},Y_=function(e,t){this.variableNames=["x"];var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=e,1!==n){var r=e.map((function(n,r){return function(n){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),i=gb(n);this.userCode="\n      void main() {\n        "+i+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+e[0]+" - coord - 1));\n        }\n      "},$_=function(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=e.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=e;var r=lb("rc",n),i=r[n-1]+" + 1 < "+this.outputShape[n-1],o=r[n-2]+" + 1 < "+this.outputShape[n-2],a=gb(n);function s(n){var r=e.map((function(r,i){return function(n,r){return-1!==t.indexOf(n)&&1!==e[n]?e[n]+" - "+r[n]+" - 1":""+r[n]}(i,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+e[0]+" - rc - 1),\n            "+e[0]+" - rc - 1);\n          if("+i+"){\n              result.g = getChannel(getX("+e[0]+" - (rc  + 1) - 1),\n                "+e[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+a+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(e){return s(e)}(r.slice())+";\n          if("+i+"){\n            result.g = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",s(e)}(r.slice())+";\n          }\n          if("+o+") {\n            result.b = "+function(e){return e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            if("+i+") {\n              result.a = "+function(e){return e[n-1]="("+e[n-1]+" + 1)",e[n-2]="("+e[n-2]+" + 1)",s(e)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},Z_=function(e,t,n,r,i,o,a){void 0===a&&(a=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=gb(i.length),u=gb(o.length),c="";1===n?c="i":2===n&&(c="i, j");var l="";1===r?l="i":2===r&&(l="i, coords[1]"),this.userCode="\n        "+s+" strides = "+s+"("+i+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+e+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+t+"; j++) {\n              int index = round(getIndices("+c+"));\n              flattenedIndex += index * "+(t>1?"strides[j]":"strides")+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += getUpdates("+l+");\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},J_=function(e,t){this.variableNames=["x","segmentIds"];var n=e.windowSize,r=e.batchSize,i=e.inSize,o=e.numSegments,a=o*Math.ceil(i/n);this.outputShape=[r,a];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";i%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return initializationValue;\n        }\n      ");var h="";i%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+i+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+o+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+o+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},ew=function(e,t,n){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=t,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<t.length;u++)s.push(""+o[u]),u<e&&a.push(""+o[u]);r=a.join(),i=s.join()}var c=gb(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+i+"));\n        } else {\n          setOutput(getB("+i+"));\n        }\n      }\n    "},tw=function(){function e(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=gb(this.rank),r="uniform int start["+this.rank+"];",i=function(e){if(1===e)return"sourceLoc";if(e<=6)return nw.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank "+e+" is not yet supported")}(this.rank);t="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+e.map((function(e,t){return"sourceLoc."+nw[t]+" = start["+t+"] + coords."+nw[t]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+t+"\n        setOutput(getSource("+i+"));\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),nw=["x","y","z","w","u","v"],rw=function(){function e(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=gb(this.rank),n=lb("coords",this.rank),r=lb("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",o="getChannel(getSource("+r.join()+"), "+i+")",a="\n      result.x = "+o+";\n      if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+o+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+e[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+o+";\n        if (++"+n[this.rank-1]+" < "+e[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+o+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+t+"("+e.map((function(e,t){return"start["+t+"]"})).join()+");":e.map((function(e,t){return r[t]+" = "+n[t]+" + start["+t+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+t+" coords = getOutputCoords();\n        "+t+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+a+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return e.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}},e}(),iw=function(e,t,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=gb(n.length),o=gb(n.length),a="";if(1===r)a="coords * strides + begin";else{var s=0;a=n.map((function(e,t){return s++,1===n.length?"coords * strides["+t+"] + begin["+t+"]":"coords["+(s-1)+"] * strides["+t+"] + begin["+t+"]"})).join(",")}this.userCode="\n      "+i+" begin = "+i+"("+e+");\n      "+i+" strides = "+i+"("+t+");\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+a+"));\n      }\n    "},ow=function(){function e(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return e.prototype.acquireTexture=function(e,t,n){var r,i=aw(t,n),o=sw(e,i,n);if(o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]),this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var a=this.freeTextures[o].shift();return this.usedTextures[o].push(a),a}return this.numUsedTextures++,this.log(),i===Dv.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):i===Dv.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):i===Dv.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):i===Dv.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):i===Dv.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(r),r},e.prototype.releaseTexture=function(e,t,n,r){if(null!=this.freeTextures){var i=sw(t,aw(n,r),r);i in this.freeTextures||(this.freeTextures[i]=[]),this.freeTextures[i].push(e),this.numFreeTextures++,this.numUsedTextures--;var o=this.usedTextures[i],a=o.indexOf(e);if(a<0)throw new Error("Cannot release a texture that was never provided by this texture manager");o.splice(a,1),this.log()}},e.prototype.log=function(){this.logEnabled&&console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+(this.numFreeTextures+this.numUsedTextures)+")")},e.prototype.getNumUsedTextures=function(){return this.numUsedTextures},e.prototype.getNumFreeTextures=function(){return this.numFreeTextures},e.prototype.dispose=function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},e}();function aw(e,t){if(e===Av.UPLOAD)return Dv.PACKED_2X2_FLOAT32;if(e===Av.RENDER||null==e)return function(e){return np().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?Dv.PACKED_2X2_FLOAT32:Dv.UNPACKED_FLOAT32:e?Dv.PACKED_2X2_FLOAT16:Dv.UNPACKED_FLOAT16}(t);if(e===Av.DOWNLOAD||e===Av.PIXELS)return Dv.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+e)}function sw(e,t,n){return e[0]+"_"+e[1]+"_"+t+"_"+n}var uw=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[r]*t[r];this.outputShape=n,this.rank=n.length;var i=gb(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank "+t+" is not yet supported");if(1===t)return"imod(resRC, "+e[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],i=0;i<e.length;i++)r.push("imod("+n[i]+", "+e[i]+")");return r.join()}(e);this.userCode="\n      void main() {\n        "+i+" resRC = getOutputCoords();\n        setOutput(getA("+o+"));\n      }\n    "},cw=function(e,t){this.variableNames=["A"];for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];this.outputShape=n,this.rank=n.length;var i=gb(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank "+t+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),i=0;i<e.length;i++)r[e[i]]=n[i];return r.join()}(t);this.userCode="\n    void main() {\n      "+i+" resRC = getOutputCoords();\n      setOutput(getA("+o+"));\n    }\n    "},lw=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e[t[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=gb(this.rank),o=cb("rc",this.rank),a=new Array(this.rank);for(r=0;r<t.length;r++)a[t[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+a.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+i+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+o[this.rank-1]+";\n      if(++"+o[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},hw=function(e,t){this.variableNames=["A"],this.outputShape=e,this.userCode="\n      float unaryOperation(float x) {\n        "+t+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},fw="if (isnan(x)) return x;",dw="return abs(x);",pw=fw+"\n  return (x < 0.0) ? 0.0 : x;\n",vw=fw+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",mw="return (x >= 0.0) ? x : (exp(x) - 1.0);",gw="return -x;",yw="return ceil(x);",bw="return floor(x);",_w="return exp(x);",ww="return exp(x) - 1.0;",xw="return x;",kw="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Cw="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ew="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Sw=function(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Iw=function(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e;var t=e.length,n=lb("rc",t),r=gb(t),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(t,n),o=n.slice(-2),a=t<=1?"rc":"vec2("+o.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+i+");\n\n        setOutput(getChannel(packedInput, "+a+"));\n      }\n    "},Rw={};function Tw(e,t){if(void 0===t&&(t=!1),"linear"===e)return"return x;";if("relu"===e)return t?kw:pw;if("elu"===e)return t?Ew:mw;if("relu6"===e)return t?Cw:vw;if("prelu"===e)return t?Ab:Rb;throw new Error("Activation "+e+" has not been implemented for the WebGL backend.")}var Aw=function(e){function t(t){var n,r=e.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!np().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){var i=Pv(np().getNumber("WEBGL_VERSION"));r.binaryCache=((n=np().getNumber("WEBGL_VERSION"))in Rw||(Rw[n]={}),Rw[n]),r.gpgpu=new I_(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=t,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=t.gl.canvas;return r.textureManager=new ow(r.gpgpu),r.numMBBeforeWarning=null==np().global.screen?1024:np().global.screen.height*np().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new ky(r,Sv),r}return $d(t,e),t.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},t.prototype.write=function(e,t,n){if(np().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:Av.UPLOAD}),r},t.prototype.move=function(e,t,n,r){if(np().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:Av.UPLOAD})},t.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,i=t.complexTensors,o=t.shape;if(null!=t.slice){var a;a=t.isPacked?new Sw(o,xw):new hw(o,xw);var s=this.runWebGLProgram(a,[{dataId:e,shape:o,dtype:r}],r),u=this.readSync(s.dataId);return this.disposeData(s.dataId),u}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var c,l,h=null!=this.activeTimers;return h&&(c=Xp()),l="complex64"===r?Hy(i.real.dataSync(),i.imag.dataSync()):this.getValuesFromTexture(e),h&&(this.downloadWaitMs+=Xp()-c),this.convertAndCacheOnCPU(e,l)},t.prototype.read=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,g,y,b;return Jd(this,(function(_){switch(_.label){case 0:if(this.pendingRead.has(e))return t=this.pendingRead.get(e),[2,new Promise((function(e){return t.push(e)}))];if(n=this.texData.get(e),r=n.values,i=n.shape,o=n.dtype,a=n.complexTensors,s=n.isPacked,null!=n.slice)return u=s?new Sw(i,xw):new hw(i,xw),c=this.runWebGLProgram(u,[{dataId:e,shape:i,dtype:o}],o),l=this.read(c.dataId),this.disposeData(c.dataId),[2,l];if(null!=r)return[2,this.convertAndCacheOnCPU(e)];if(!np().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===np().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return h=null,"complex64"!==o&&np().get("WEBGL_BUFFER_SUPPORTED")&&(f=this.decode(e),d=this.texData.get(f.dataId),h=(b=this.gpgpu).createBufferFromTexture.apply(b,[d.texture].concat(Lv(i)))),this.pendingRead.set(e,[]),"complex64"===o?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:_.sent(),_.label=2;case 2:return"complex64"!==o?[3,4]:[4,Promise.all([a.real.data(),a.imag.data()])];case 3:return v=_.sent(),p=Hy(v[0],v[1]),[3,5];case 4:null==h?p=this.getValuesFromTexture(e):(m=bp(i),p=this.gpgpu.downloadFloat32MatrixFromBuffer(h,m)),_.label=5;case 5:return null!=f&&this.disposeData(f.dataId),g=this.convertAndCacheOnCPU(e,p),y=this.pendingRead.get(e),this.pendingRead.delete(e),y.forEach((function(e){return e(g)})),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e),this.pendingDeletes--),[2,g]}}))}))},t.prototype.checkNumericalProblems=function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!zv(n)){if(np().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},t.prototype.getValuesFromTexture=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,o=n.isPacked,a=bp(r);if(np().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var s=this.decode(e),u=this.texData.get(s.dataId),c=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[u.texture].concat(Lv(r))).subarray(0,a);return this.disposeData(s.dataId),c}var l=np().getBool("WEBGL_PACK")&&!0===o,h=l?mm(r):r,f=l?new n_(h):new t_(h),d=this.runWebGLProgram(f,[{shape:h,dtype:i,dataId:e}],"float32"),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,a);return this.disposeData(d.dataId),v},t.prototype.time=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return Jd(this,(function(u){switch(u.label){case 0:return t=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,e(),i=yp(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=yp(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=t,r&&(this.programTimersStack=null),a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(i)]:[3,2];case 1:return s=u.sent(),a.kernelMs=pp(s),a.getExtraProfileInfo=function(){return s.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return e.name+": "+e.ms})).join(", ")},[3,3];case 2:a.kernelMs={error:"WebGL query timers are not supported in this environment."},u.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,a]}}))}))},t.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},t.prototype.startTimer=function(){return np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Xp(),endMs:null}},t.prototype.endTimer=function(e){return np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Xp(),e)},t.prototype.getQueryTime=function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){return np().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]}))}))},t.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},t.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,i=t.texShape,o=t.usage,a=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(i,r),this.textureManager.releaseTexture(n,i,o,a)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},t.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},t.prototype.getDataInfo=function(e){return this.texData.get(e)},t.prototype.getCPUBackend=function(){return np().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=Sv.findBackend("cpu")),this.cpuBackend):null},t.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return void 0===t&&(t=128),null!=this.getCPUBackend()&&e.every((function(e){return null==n.texData.get(e.dataId).texture&&e.size<t}))},t.prototype.getGPGPUContext=function(){return this.gpgpu},t.prototype.complex=function(e,t){var n=this.makeOutput(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:Sv.keep(e.clone()),imag:Sv.keep(t.clone())},n},t.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(0===bp(n))return Jm([],n,e.dtype);var r=this.texData.get(e.dataId).isPacked,i=yy(e.shape,t,n);if(r||!i){var o=np().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new rw(n):new tw(n),a=o.getCustomSetupFunc(t);return this.compileAndRun(o,[e],null,a)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},t.prototype.shallowSlice=function(e,t,n){var r=this.texData.get(e.dataId),i=this.makeOutput(n,e.dtype),o=this.texData.get(i.dataId);Object.assign(o,r),o.shape=n,o.dtype=e.dtype;var a=by(t,e.strides);r.slice&&(a+=r.slice.flatOffset),o.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||e.dataId};var s=this.dataRefCount.get(o.slice.origDataId)||1;return this.dataRefCount.set(o.slice.origDataId,s+1),i},t.prototype.stridedSlice=function(e,t,n,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,r);var i=vy(t,n,r);if(i.some((function(e){return 0===e})))return Jm([],i);var o=new iw(t,r,i);return this.compileAndRun(o,[e])},t.prototype.reverse=function(e,t){var n=np().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $_(e.shape,t):new Y_(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.concat=function(e,t){if("complex64"===e[0].dtype){var n=e.map((function(e){return $m(e)})),r=e.map((function(e){return Zm(e)}));return Ym(this.concat(n,t),this.concat(r,t))}if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(1===e.length)return e[0];if(e.length>np().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(e.length/2),o=this.concat(e.slice(0,i),t),a=this.concat(e.slice(i),t);return this.concat([o,a],t)}if(np().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var s=new Mb(e.map((function(e){return e.shape})),t);return this.compileAndRun(s,e)}var u=Xm(e.map((function(e){return e.shape})),t),c=e.map((function(e){return e.as2D(-1,bp(e.shape.slice(t)))})),l=new Pb(c.map((function(e){return e.shape})));return this.compileAndRun(l,c).reshape(u)},t.prototype.neg=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.neg(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,gw,e.dtype);var t=new hw(e.shape,gw);return this.compileAndRun(t,[e])},t.prototype.batchMatMul=function(e,t,n,r){var i=n?e.shape[2]:e.shape[1],o=r?t.shape[1]:t.shape[2],a=n?e.shape[1]:e.shape[2],s=e.shape[0];if((1===i||1===o)&&a>1e3){n&&(e=e.transpose([0,2,1])),r&&(t=t.transpose([0,2,1]));var u=1===o?e:e.as3D(s,a,1),c=1===o?2:1,l=1===o?t.as3D(s,1,a):t;return this.multiply(u,l).sum(c,!0)}var h=yv(e.dtype,t.dtype),f=new P_(e.shape,[s,i,o],n,r);return this.compileAndRun(f,[e,t],h)},t.prototype.fusedBatchMatMul=function(e){var t=e.a,n=e.b,r=e.transposeA,i=e.transposeB,o=e.bias,a=e.activation,s=e.preluActivationWeights,u=r?t.shape[2]:t.shape[1],c=i?n.shape[1]:n.shape[2],l=t.shape[0],h=yv(t.dtype,n.dtype),f=null!=o,d=null!=s,p=a?Tw(a,!0):null,v=new P_(t.shape,[l,u,c],r,i,f,p,d),m=[t,n];return o&&m.push(o),s&&m.push(s),this.compileAndRun(v,m,h)},t.prototype.multiply=function(e,t){if("complex64"===e.dtype){var n=this.texData.get(e.dataId),r=this.texData.get(t.dataId),i=new Eb("return areal * breal - aimag * bimag;",e.shape,t.shape),o=new Eb("return areal * bimag + aimag * breal;",e.shape,t.shape),a=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag),this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),c=this.complex(s,u);return s.dispose(),u.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ib,e.dtype);var l=new Tb(Ib,e.shape,t.shape);return this.compileAndRun(l,[e,t],e.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,o){var a=[e,t,n],s=null;null!=o&&(s=o.shape,a.push(o));var u=null;if(null!=i&&(u=i.shape,a.push(i)),np().getBool("WEBGL_PACK_NORMALIZATION")){var c=new Cb(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(c,a)}var l=new kb(e.shape,t.shape,n.shape,s,u,r);return this.compileAndRun(l,a)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){var o=np().getBool("WEBGL_PACK_NORMALIZATION")?new N_(e.shape,t,n,r,i):new A_(e.shape,t,n,r,i);return this.compileAndRun(o,[e])},t.prototype.LRNGrad=function(e,t,n,r,i,o,a){var s=new D_(t.shape,r,i,o,a);return this.compileAndRun(s,[t,n,e])},t.prototype.tile=function(e,t){if("string"===e.dtype){var n=this.readSync(e.dataId).map((function(e){return $p(e)}));return rb(Ag(e.shape,e.dtype,n),t)}var r=new uw(e.shape,t);return this.compileAndRun(r,[e])},t.prototype.pad=function(e,t,n){var r=np().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new W_(e.shape,t,n):new U_(e.shape,t,n);return this.compileAndRun(r,[e])},t.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=np().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new lw(e.shape,t):new cw(e.shape,t);return this.compileAndRun(n,[e])},t.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var r=new s_(e.shape,t.size,n);return this.compileAndRun(r,[e,t])},t.prototype.batchToSpaceND=function(e,t,n){vp(e.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=ry(e.shape,t,r),o=iy(i.length,t.length),a=oy(e.shape,t,r),s=ay(n,t.length),u=sy(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){vp(e.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=ry(a.shape,t,r,!1),u=iy(s.length,t.length,!1),c=oy(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.reduce=function(e,t,n){var r=e.shape[0],i=e.shape[1],o=cy(i),a=new j_({windowSize:o,inSize:i,batchSize:r},t),s=this.compileAndRun(a,[e],n);return 1===s.shape[1]?s:this.reduce(s,t,n)},t.prototype.argReduce=function(e,t,n){void 0===n&&(n=null);var r=e.shape[0],i=e.shape[1];null!=n&&(r=n.shape[0],i=n.shape[1]);var o=cy(i),a=new ub({windowSize:o,inSize:i,batchSize:r},t,null==n),s=[e];null!=n&&s.push(n);var u=this.compileAndRun(a,s,"int32");return 1===u.shape[1]?u:this.argReduce(e,t,u)},t.prototype.argReducePacked=function(e,t,n){void 0===n&&(n=null);var r=null!=n?n.shape:e.shape,i=cy(r[r.length-1]),o=new _b(r,i,t,null==n),a=this.compileAndRun(o,null==n?[e]:[e,n],"int32");return a.rank===e.rank?this.argReducePacked(e,t,a):a},t.prototype.sum=function(e,t){jm("sum",t,e.rank);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i),a=bv(e.dtype);return this.reduce(o,"sum",a).reshape(r)},t.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i),a=bv(e.dtype);return this.reduce(o,"prod",a).reshape(r)},t.prototype.unsortedSegmentSum=function(e,t,n){var r=0,i=Hm([r],e.rank),o=e;null!=i&&(o=e.transpose(i),r=Gm(1,e.rank)[0]);var a=function(e,t,n){for(var r=[],i=e.length,o=0;o<i;o++)r.push(o!==t?e[o]:n);return r}(o.shape,r,n),s=bp([o.shape[r]]),u=o.as2D(-1,s),c=bv(e.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",t,c,n).reshape(a);return null!=i&&(l=l.transpose(qm(i))),l},t.prototype.segOpCompute=function(e,t,n,r,i){var o=e.shape[0],a=e.shape[1],s=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Vp(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Vp(e,n+1);return n}(a,i),u=new J_({windowSize:s,inSize:a,batchSize:o,numSegments:i},t),c=this.compileAndRun(u,[e,n],r);return c.shape[1]===i?c:(n=cg(0,i).tile([a/s]),this.segOpCompute(c,t,n,r,i))},t.prototype.argMinMaxReduce=function(e,t,n){var r=[t];if(jm("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,e.rank),!np().getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var i=zm(e.shape,r),o=i[0],a=bp(i[1]),s=e.as2D(-1,a);return this.argReduce(s,n).reshape(o)}return this.argReducePacked(e,n)},t.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},t.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},t.prototype.cumsum=function(e,t,n,r){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var i=new Qb(e.shape,n,r);return this.compileAndRun(i,[e])},t.prototype.equal=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(equal(a, b));\n","bool");var n=new Tb("return float(a == b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.notEqual=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Tb("return float(a != b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Tb("return float(a < b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.lessEqual=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Tb("return float(a <= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Tb("return float(a > b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.greaterEqual=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Tb("return float(a >= b);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalNot=function(e){var t=new hw(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},t.prototype.logicalAnd=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Tb("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.logicalOr=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Tb("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t],"bool")},t.prototype.select=function(e,t,n){var r=new ew(e.rank,t.shape,t.rank);return this.compileAndRun(r,[e,t,n],yv(t.dtype,n.dtype))},t.prototype.where=function(e){Fm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return ob(e.shape,t)},t.prototype.topk=function(e,t,n){return ib(e.dataSync(),e.shape,e.dtype,t)},t.prototype.min=function(e,t){jm("min",t,e.rank);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i);return this.reduce(o,"min",o.dtype).reshape(r)},t.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Tb("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.mod=function(e,t){var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Tb("if (b == 0.0) return NAN;\n  return mod(a, b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);jm("max",t,e.rank);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i);return this.reduce(o,"max",o.dtype).reshape(r)},t.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Tb("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.all=function(e,t){jm("all",t,e.rank);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i);return this.reduce(o,"all",o.dtype).reshape(r)},t.prototype.any=function(e,t){jm("any",t,e.rank);var n=zm(e.shape,t),r=n[0],i=bp(n[1]),o=e.as2D(-1,i);return this.reduce(o,"any",o.dtype).reshape(r)},t.prototype.realDivide=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n","float32",!0);var n=new Tb("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",e.shape,t.shape);return this.compileAndRun(n,[e,t],"float32")},t.prototype.floorDiv=function(e,t){if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Tb("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",e.shape,t.shape);return this.compileAndRun(n,[e,t],"int32")},t.prototype.add=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,Sb);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=yv(e.dtype,t.dtype);if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Sb,n);var r=new Tb(Sb,e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.packedUnaryOp=function(e,t,n){var r=new Sw(e.shape,t);return this.compileAndRun(r,[e],n)},t.prototype.packedBinaryOp=function(e,t,n,r,i){void 0===i&&(i=!1);var o=new Db(n,e.shape,t.shape,i);return this.compileAndRun(o,[e,t],r)},t.prototype.complexSeparableBinaryOp=function(e,t,n){var r=this,i=this.texData.get(e.dataId),o=this.texData.get(t.dataId),a=[[i.complexTensors.real,o.complexTensors.real],[i.complexTensors.imag,o.complexTensors.imag]].map((function(i){var o=i[0],a=i[1],s=r.makeComplexComponentTensorInfo(e,o),u=r.makeComplexComponentTensorInfo(t,a),c=new Tb(n,e.shape,t.shape);return r.compileAndRun(c,[s,u],yv(o.dtype,a.dtype))})),s=a[0],u=a[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},t.prototype.makeComplexComponentTensorInfo=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},t.prototype.addN=function(e){if(1===e.length)return e[0];if(e.length>np().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),r=this.addN(e.slice(t));return this.addN([n,r])}var i=e.map((function(e){return e.dtype})).reduce((function(e,t){return yv(e,t)})),o=e.map((function(e){return e.shape})),a=np().getBool("WEBGL_PACK")?new sb(e[0].shape,o):new ab(e[0].shape,o);return this.compileAndRun(a,e,i)},t.prototype.subtract=function(e,t){if("complex64"===e.dtype&&"complex64"===t.dtype)return this.complexSeparableBinaryOp(e,t,"return a - b;");if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=yv(e.dtype,t.dtype);if(np().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,"return a - b;",e.dtype);var r=new Tb("return a - b;",e.shape,t.shape);return this.compileAndRun(r,[e,t],n)},t.prototype.pow=function(e,t){var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Tb("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",e.shape,t.shape),r=yv(e.dtype,t.dtype);return this.compileAndRun(n,[e,t],r)},t.prototype.ceil=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.ceil(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,yw,e.dtype);var t=new hw(e.shape,yw);return this.compileAndRun(t,[e])},t.prototype.floor=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.floor(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,bw,e.dtype);var t=new hw(e.shape,bw);return this.compileAndRun(t,[e])},t.prototype.sign=function(e){var t=new hw(e.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(t,[e])},t.prototype.isNaN=function(e){var t=new hw(e.shape,"return float(isnan(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isInf=function(e){var t=new hw(e.shape,"return float(isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.isFinite=function(e){var t=new hw(e.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(t,[e],"bool")},t.prototype.round=function(e){var t=new hw(e.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(t,[e])},t.prototype.exp=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.exp(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,_w,e.dtype);var t=new hw(e.shape,_w);return this.compileAndRun(t,[e])},t.prototype.expm1=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.expm1(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,ww,e.dtype);var t=new hw(e.shape,ww);return this.compileAndRun(t,[e])},t.prototype.softmax=function(e,t){var n=Ip([t],e.shape),r=this.max(e,n),i=Vm(r.shape,n),o=this.subtract(e,r.reshape(i)),a=this.exp(o),s=this.sum(a,n).reshape(i);return this.realDivide(a,s)},t.prototype.log=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.log(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",e.dtype);var t=new hw(e.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(t,[e])},t.prototype.log1p=function(e){var t=new hw(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},t.prototype.sqrt=function(e){var t=new hw(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},t.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new hw(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},t.prototype.reciprocal=function(e){var t=new hw(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},t.prototype.relu=function(e){var t;return t=np().getBool("WEBGL_PACK")?new Sw(e.shape,kw):new hw(e.shape,pw),this.compileAndRun(t,[e])},t.prototype.relu6=function(e){var t;return t=np().getBool("WEBGL_PACK")?new Sw(e.shape,Cw):new hw(e.shape,vw),this.compileAndRun(t,[e])},t.prototype.prelu=function(e,t){var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db(Ab,e.shape,t.shape):new Tb(Rb,e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.elu=function(e){if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ew,e.dtype);var t=new hw(e.shape,mw);return this.compileAndRun(t,[e])},t.prototype.eluDer=function(e,t){var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",e.shape,t.shape):new Tb("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.selu=function(e){var t=new hw(e.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(t,[e])},t.prototype.int=function(e){var t=new hw(e.shape,"return float(int(x));");return this.compileAndRun(t,[e],"int32")},t.prototype.clip=function(e,t,n){var r,i=(r=np().getBool("WEBGL_PACK_CLIP")?new Ob(e.shape):new Nb(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(r,[e],null,i)},t.prototype.abs=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.abs(e);if(np().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,dw,e.dtype);var t=new hw(e.shape,dw);return this.compileAndRun(t,[e])},t.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new Fb(e.shape),r=[this.makeComplexComponentTensorInfo(e,t.complexTensors.real),this.makeComplexComponentTensorInfo(e,t.complexTensors.imag)];return this.compileAndRun(n,r)},t.prototype.sigmoid=function(e){var t=new hw(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},t.prototype.softplus=function(e){var t=new hw(e.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(t,[e])},t.prototype.sin=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(t,[e])},t.prototype.cos=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(t,[e])},t.prototype.tan=function(e){var t=new hw(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},t.prototype.asin=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(t,[e])},t.prototype.acos=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(t,[e])},t.prototype.atan2=function(e,t){var n=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",e.shape,t.shape):new Tb("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",e.shape,t.shape);return this.compileAndRun(n,[e,t])},t.prototype.sinh=function(e){var t=new hw(e.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.cosh=function(e){var t=new hw(e.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(t,[e])},t.prototype.tanh=function(e){var t=new hw(e.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(t,[e])},t.prototype.asinh=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},t.prototype.acosh=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(t,[e])},t.prototype.atanh=function(e){var t=new hw(e.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(t,[e])},t.prototype.erf=function(e){var t=new hw(e.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(t,[e])},t.prototype.step=function(e,t){var n=new hw(e.shape,function(e){return void 0===e&&(e=0),fw+"\n    return x > 0.0 ? 1.0 : float("+e+");\n  "}(t));return this.compileAndRun(n,[e])},t.prototype.conv2dByMatMul=function(e,t,n,r,i,o){var a=e.shape,s=this.texData.get(e.dataId),u="channelsLast"===n.dataFormat,c=a[2]%2!=0&&!!s.isPacked;if((1==a[0]*a[1]*a[2]||1===n.outChannels)&&n.inChannels>1e3||!np().getBool("WEBGL_LAZILY_UNPACK")||!np().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){var l=this.reshape(e,[1,u?a[0]*a[1]*a[2]:a[0]*a[2]*a[3],n.inChannels]),h=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:l,b:h,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),n.outShape)}var f={dataId:e.dataId,shape:[1,u?a[0]*a[1]*(a[2]+1):a[0]*a[2]*(a[3]+1),n.inChannels],dtype:e.dtype},d=s.shape;s.shape=s.shape.slice(),s.shape[s.shape.length-2]++,vp(bm(s.shape,f.shape),(function(){return"packed reshape "+s.shape+" to "+f.shape+" isn't free"}));var p=this.reshape(t,[1,n.inChannels,n.outChannels]),v=this.fusedBatchMatMul({a:f,b:p,transposeA:!1,transposeB:!1,bias:r,activation:i,preluActivationWeights:o}),m=this.texData.get(v.dataId);return vp(m.isPacked,(function(){return"batchMatMul result is expected to be packed"})),s.shape=d,m.shape=n.outShape,Sv.makeTensorFromDataId(v.dataId,n.outShape,v.dtype)},t.prototype.conv2dWithIm2Row=function(e,t,n,r,i,o){var a=n.outWidth,s=n.outHeight,u="channelsLast"===n.dataFormat,c=n.filterWidth*n.filterHeight*n.inChannels,l=s*a,h=[c,l],f=e.squeeze([0]),d=t.reshape([1,c,-1]),p=new T_(h,f.shape,n),v=this.compileAndRun(p,[f]).reshape([1,h[0],h[1]]),m=null!=r,g=null!=o,y=i?Tw(i,!0):null,b=new P_(v.shape,[1,l,n.outChannels],!0,!1,m,y,g),_=[v,d];return r&&_.push(r),g&&_.push(o),this.compileAndRun(b,_).reshape(u?[1,s,a,n.outChannels]:[1,n.outChannels,s,a])},t.prototype.fusedConv2d=function(e){var t=e.input,n=e.filter,r=e.convInfo,i=e.bias,o=e.activation,a=e.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(t,n,r,i,o,a);if(np().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,n,r,i,o,a);var s=null!=i,u=null!=a,c=o?Tw(o,!1):null,l=new Hb(r,s,c,u),h=[t,n];return i&&h.push(i),a&&h.push(a),this.compileAndRun(l,h)},t.prototype.conv2d=function(e,t,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(e,t,n);if(np().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,t,n);var r=new Hb(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerInput=function(e,t,n){var r=new Ub(n);return this.compileAndRun(r,[e,t])},t.prototype.conv2dDerFilter=function(e,t,n){var r=new Bb(n);return this.compileAndRun(r,[e,t])},t.prototype.fusedDepthwiseConv2D=function(e){var t,n=e.input,r=e.filter,i=e.convInfo,o=e.bias,a=e.activation,s=e.preluActivationWeights,u=np().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1,c=a?Tw(a,u):null,l=[n,r],h=null!=o,f=null!=s;return h&&l.push(o),f&&l.push(s),u?(t=new Kb(i,h,c,f),this.compileAndRun(t,l)):(t=new Gb(i,h,c,f),this.compileAndRun(t,l))},t.prototype.depthwiseConv2D=function(e,t,n){var r;return np().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new Kb(n),this.compileAndRun(r,[e,t])):(r=new Gb(n),this.compileAndRun(r,[e,t]))},t.prototype.depthwiseConv2DDerInput=function(e,t,n){var r=new jb(n);return this.compileAndRun(r,[e,t])},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){var r=new Vb(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3d=function(e,t,n){var r=new qb(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerInput=function(e,t,n){var r=new zb(n);return this.compileAndRun(r,[e,t])},t.prototype.conv3dDerFilter=function(e,t,n){var r=new Wb(n);return this.compileAndRun(r,[e,t])},t.prototype.maxPool=function(e,t){var n=new z_(t,"max",!1);return this.compileAndRun(n,[e])},t.prototype.avgPool=function(e,t){var n=new z_(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPoolBackprop=function(e,t,n,r){var i=new z_(r,"max",!0),o=this.compileAndRun(i,[t]),a=new O_(r),s=this.compileAndRun(a,[e,o],t.dtype);return o.dispose(),s},t.prototype.avgPoolBackprop=function(e,t,n){var r=new wb(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.cast=function(e,t){return zy(e,t,this)},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,o=0;o<e.rank;o++)o!==t&&(r[i++]=e.shape[o]);var a=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(o=0;o<u.length;o++)a[t]=o,u[o]=this.slice(e,a,s).reshape(r);return u},t.prototype.avgPool3d=function(e,t){var n=new V_(t,"avg",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.avgPool3dBackprop=function(e,t,n){var r=new xb(n);return this.compileAndRun(r,[e],t.dtype)},t.prototype.maxPool3d=function(e,t){var n=new V_(t,"max",!1);return this.compileAndRun(n,[e],"float32")},t.prototype.maxPool3dBackprop=function(e,t,n,r){var i=new V_(r,"max",!0),o=this.compileAndRun(i,[t]),a=new F_(r),s=this.compileAndRun(a,[e,o],t.dtype);return o.dispose(),s},t.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);if(n.isPacked&&!bm(e.shape,t)&&(null===n.texture||!bm(n.shape,t))){var r=this.packedReshape(e,t);return Sv.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Vy(e,t)},t.prototype.resizeBilinear=function(e,t,n,r){var i=np().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new K_(e.shape,t,n,r):new G_(e.shape,t,n,r);return this.compileAndRun(i,[e],"float32")},t.prototype.resizeBilinearBackprop=function(e,t,n){var r=new q_(e,t,n);return this.compileAndRun(r,[e])},t.prototype.resizeNearestNeighbor=function(e,t,n,r){var i=new Q_(e.shape,t,n,r);return this.compileAndRun(i,[e])},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){var r=new X_(e,t,n);return this.compileAndRun(r,[e])},t.prototype.multinomial=function(e,t,n,r){var i=t?e:wy(e),o=new M_(i.shape[0],i.shape[1],n),a=o.getCustomSetupFunc(r);return this.compileAndRun(o,[i],"int32",a)},t.prototype.oneHot=function(e,t,n,r){var i=new L_(e.size,t,n,r);return this.compileAndRun(i,[e])},t.prototype.diag=function(e){var t=new e_(e.size);return this.compileAndRun(t,[e])},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return Fm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Yy(e.dataSync(),t.dataSync(),n,r,i)},t.prototype.cropAndResize=function(e,t,n,r,i,o){var a=new Xb(e.shape,t.shape,r,i,o);return this.compileAndRun(a,[e,t,n],"float32")},t.prototype.depthToSpace=function(e,t,n){vp(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));var r=e.shape[0],i=("NHWC"===n?e.shape[1]:e.shape[2])*t,o=("NHWC"===n?e.shape[2]:e.shape[3])*t,a=("NHWC"===n?e.shape[3]:e.shape[1])/(t*t),s=new Jb("NHWC"===n?[r,i,o,a]:[r,a,i,o],t,n);return this.compileAndRun(s,[e])},t.prototype.split=function(e,t,n){return nb(e,t,n)},t.prototype.scatterND=function(e,t,n){var r=fy(0,e,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/a,a],l=e.reshape([o,i]),h=t.reshape([o,a]);if(0===u)return Vy(Jm([]),n);var f=tg(0),d=new Z_(o,i,l.rank,h.rank,s,c);return this.compileAndRun(d,[h,l,f]).reshape(n)},t.prototype.sparseToDense=function(e,t,n,r){var i=fy(0,e,n),o=new Z_(i.numUpdates,i.sliceRank,e.rank,t.rank,i.strides,[i.outputSize,1],!1);return this.compileAndRun(o,[t,e,r]).reshape(n)},t.prototype.fft=function(e){return this.fftImpl(e,!1)},t.prototype.ifft=function(e){return this.fftImpl(e,!0)},t.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),r=new o_("return real * expR - imag * expI;",e.shape,t),i=new o_("return real * expI + imag * expR;",e.shape,t),o=[this.makeComplexComponentTensorInfo(e,n.complexTensors.real),this.makeComplexComponentTensorInfo(e,n.complexTensors.imag)],a=this.compileAndRun(r,o),s=this.compileAndRun(i,o),u=this.complex(a,s).as2D(e.shape[0],e.shape[1]);return a.dispose(),s.dispose(),u},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=uy(e,t),o=i[0],a=i[1],s=i[2],u=i[3],c=t.reshape([a,r]),l=e.reshape([e.size/s,s]),h=new u_(r,u,[a,s]);return this.compileAndRun(h,[l,c]).reshape(o)},t.prototype.fill=function(e,t,n){if("string"===(n=n||Wp(t))){var r=Ap(n,bp(e));return r.fill(t),Sv.makeTensor(r,e,n,this)}var i=new a_(e,t),o=i.getCustomSetupFunc(t);return this.compileAndRun(i,[],n,o)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){return this.fill(e.shape,"string"===e.dtype?"":0,e.dtype)},t.prototype.linspace=function(e,t,n){return jy(e,t,n)},t.prototype.makeTensorInfo=function(e,t){var n=this.write(null,e,t);return this.texData.get(n).usage=null,{dataId:n,shape:e,dtype:t}},t.prototype.makeOutput=function(e,t){var n=this.makeTensorInfo(e,t).dataId;return Sv.makeTensorFromDataId(n,e,t,this)},t.prototype.unpackTensor=function(e){var t=new Iw(e.shape);return this.runWebGLProgram(t,[e],e.dtype)},t.prototype.packTensor=function(e){var t=new B_(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)},t.prototype.packedReshape=function(e,t){var n=[pm(e.shape)].concat(vm(e.shape)),r={dtype:e.dtype,shape:n,dataId:e.dataId},i=[pm(t)].concat(vm(t)),o=new H_(i,n),a=this.runWebGLProgram(o,[r],e.dtype,null,!0);return{dataId:a.dataId,shape:t,dtype:a.dtype}},t.prototype.decode=function(e){var t,n=this.texData.get(e),r=n.isPacked,i=n.shape,o=n.dtype,a=mm(i);return t=r?new Zb(a):new $b(a),{dtype:o,shape:i,dataId:this.runWebGLProgram(t,[{shape:a,dtype:o,dataId:e}],o,null,!0).dataId}},t.prototype.runWebGLProgram=function(e,t,n,r,i){var o=this;void 0===i&&(i=!1);var a=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(a.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===Tv.DENSE){var u=Lv(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===bp(a.shape))return s.values=Tp(a.dtype,0),a;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=o.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&bp(t.shape)<=np().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!=!!e.packedInputs)t=n.isPacked?o.unpackTensor(t):o.packTensor(t),c.push(t),n=o.texData.get(t.dataId);else if(n.isPacked&&!bm(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=o.packedReshape(t,i),c.push(t),n=o.texData.get(t.dataId),r.shape=i}return o.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(a.dataId);var h,f={shape:a.shape,texData:s,isUniform:!1},d=function(e,t,n){var r="";return t.concat(n).forEach((function(e){r+=e.shape+"_"+(e.isUniform?"uniform":e.texData.texShape)+"_"+(null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0)})),e.constructor.name+"_"+r+"_"+e.userCode}(e,l,f),p=this.getAndSaveBinary(d,(function(){return function(e,t,n,r){var i=t.userCode,o=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),a=o.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=function(e,t,n,r){var i=[];e.forEach((function(e){var t=bp(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?i.push("uniform float "+e.name+(t>1?"["+t+"]":"")+";"):(i.push("uniform sampler2D "+e.name+";"),i.push("uniform int offset"+e.name+";"))}));var o,a,s=i.join("\n"),u=e.map((function(e){return function(e,t,n){void 0===n&&(n=!1);var r="";return r+=n?function e(t){var n;switch(t.shapeInfo.logicalShape.length){case 0:return"\n    vec4 get"+(n=t.name).charAt(0).toUpperCase()+n.slice(1)+"() {\n      return "+hb().texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],o=hb();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+i[0]+", "+i[1]+", index);\n      return "+o.texture2D+"("+t+", uv);\n    }\n  "}(t);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e.shapeInfo.texShape,o=i[0],a=i[1],s=hb();if(null!=i&&_p(t,i))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+a+".0, "+o+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(t[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(1===n[0]){var s=yb(t,n.slice(1));return"\n        "+e(s)+"\n        vec4 "+i+"(int b, int row, int col) {\n          return "+i+"("+bb(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],c=a[1],l=Math.ceil(n[2]/2);return"\n    vec4 "+i+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+c+", "+l*Math.ceil(n[1]/2)+", "+l+", b, row, col);\n      return "+hb().texture2D+"("+r+", uv);\n    }\n  "}(t);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e.shapeInfo.texShape,a=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],s=a[0],u=a[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * "+l+" + (row / 2) * "+c+" + (col / 2)",d=2;d<n-1;d++)h="int b"+d+", "+h,f="b"+d+" * "+(l*=t[n-d-1])+" + "+f;return"\n    vec4 "+i+"("+h+") {\n      int index = "+f+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+hb().texture2D+"("+r+", uv);\n    }\n  "}(t)}}(e):function e(t){var n=t.shapeInfo.logicalShape;switch(n.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float "+n+"() {return "+t+";}";var r=e.shapeInfo.texShape;if(1===r[0]&&1===r[1])return"\n      float "+n+"() {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var i=e.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+vb(t)+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+mb(e)+"\n      }\n    ";var r=e.shapeInfo.texShape,i=r[0],o=r[1];if(1===o&&1===i)return"\n      float "+n+"(int index) {\n        return sampleTexture("+t+", halfCR);\n      }\n    ";var a=vb(t);return 1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+a+") + 0.5) / "+i+".0);\n        return sampleTexture("+t+", uv);\n      }\n    ":1===i?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+a+") + 0.5) / "+o+".0, 0.5);\n        return sampleTexture("+t+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+i+", "+o+", index + "+a+");\n      return sampleTexture("+t+", uv);\n    }\n  "}(t);case 2:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape;if(null!=o&&_p(n,o))return"\n    float "+i+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+o[1]+".0, "+o[0]+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ";var a=Rp(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var c=yb(t,s);return"\n      "+e(c)+"\n      float "+i+"(int row, int col) {\n        return "+i+"("+bb(["row","col"],u)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+mb(t)+"\n      }\n    ";var l=o[0],h=o[1],f=vb(r);return 1===h?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+l+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===l?"\n    float "+i+"(int row, int col) {\n      float index = dot(vec3(row, col, "+f+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+h+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+i+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+f+";\n    vec2 uv = uvFromFlat("+l+", "+h+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(t);case 3:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[1]*n[2],a=n[2],s=Rp(n),u=s.newShape,c=s.keptDims;if(u.length<n.length){var l=yb(t,u);return"\n        "+e(l)+"\n        float "+i+"(int row, int col, int depth) {\n          return "+i+"("+bb(["row","col","depth"],c)+");\n        }\n      "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+o+", "+a+", 1)));\n        "+mb(t)+"\n      }\n    ";var h=t.shapeInfo.texShape,f=h[0],d=h[1],p=t.shapeInfo.flatOffset;return d===o&&null==p?"\n        float "+i+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+d+".0, "+f+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":d===a&&null==p?"\n    float "+i+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+d+".0, "+f+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+i+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+o+" + col * "+a+" + depth + "+vb(r)+";\n        vec2 uv = uvFromFlat("+f+", "+d+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(t);case 4:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[3],a=n[2]*o,s=n[1]*a,u=Rp(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=yb(t,c);return"\n      "+e(h)+"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        return "+i+"("+bb(["row","col","depth","depth2"],l)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+s+", "+a+", "+o+", 1)));\n        "+mb(t)+"\n      }\n    ";var f=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],v=d[1];return v===s&&null==f?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===o&&null==f?"\n      float "+i+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+a+" +\n          depth * "+o+" + depth2;\n      vec2 uv = uvFromFlat("+p+", "+v+", index + "+vb(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 5:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=n[4],a=n[3]*o,s=n[2]*a,u=n[1]*s,c=Rp(n),l=c.newShape,h=c.keptDims;if(l.length<n.length){var f=yb(t,l);return"\n      "+e(f)+"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+i+"("+bb(["row","col","depth","depth2","depth3"],h)+");\n      }\n    "}if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+u+", "+s+", "+a+", "+o+")) +\n          depth3;\n        "+mb(t)+"\n      }\n    ";var d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,v=p[0],m=p[1];return m===u&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+s+", "+a+", "+o+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":m===o&&null==d?"\n      float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+m+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+u+" + col * "+s+" + depth * "+a+" +\n          depth2 * "+o+" + depth3 + "+vb(r)+";\n      vec2 uv = uvFromFlat("+v+", "+m+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);case 6:return function(t){var n=t.shapeInfo.logicalShape,r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1),o=Rp(n),a=o.newShape,s=o.keptDims;if(a.length<n.length){var u=yb(t,a);return"\n      "+e(u)+"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+i+"("+bb(["row","col","depth","depth2","depth3","depth4"],s)+");\n      }\n    "}var c=n[5],l=n[4]*c,h=n[3]*l,f=n[2]*h,d=n[1]*f;if(t.shapeInfo.isUniform)return"\n      float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+d+", "+f+", "+h+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+c+", 1)));\n        "+mb(t)+"\n      }\n    ";var p=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,m=v[0],g=v[1];return g===d&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+f+", "+h+", "+l+", "+c+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===c&&null==p?"\n      float "+i+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+i+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+d+" + col * "+f+" + depth * "+h+" +\n          depth2 * "+l+" + depth3 * "+c+" + depth4 + "+vb(r)+";\n      vec2 uv = uvFromFlat("+m+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(t);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(e),e.shapeInfo.logicalShape.length<=t.logicalShape.length&&(r+=n?function(e,t){var n,r,i=e.name,o=i.charAt(0).toUpperCase()+i.slice(1),a="get"+o+"AtOutCoords",s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length,c=Sy(e.shapeInfo.logicalShape,t.logicalShape),l=gb(u),h=u-s,f=["x","y","z","w","u","v"];n=0===s?"":u<2&&c.length>=1?"coords = 0;":c.map((function(e){return"coords."+f[e+h]+" = 0;"})).join("\n"),r=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+f[t+h]})).join(", ");var d="return outputValue;",p=1===bp(e.shapeInfo.logicalShape),v=1===bp(t.logicalShape);if(1!==s||p||v){if(p&&!v)d=1===u?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(c.length){var m=s-2,g=s-1;c.indexOf(m)>-1&&c.indexOf(g)>-1?d="return vec4(outputValue.x);":c.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":c.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+l+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+r+");\n      "+d+"\n    }\n  "}(e,t):function(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),i="get"+r+"AtOutCoords",o=e.shapeInfo.logicalShape.length,a=t.logicalShape.length;if(!e.shapeInfo.isUniform&&o===a&&null==e.shapeInfo.flatOffset&&_p(e.shapeInfo.texShape,t.texShape))return"\n      float "+i+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var s=gb(a),u=Sy(e.shapeInfo.logicalShape,t.logicalShape),c=a-o,l=["x","y","z","w","u","v"];return"\n    float "+i+"() {\n      "+s+" coords = getOutputCoords();\n      "+(0===o?"":a<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords."+l[e+c]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(a<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords."+l[t+c]})).join(", "))+");\n    }\n  "}(e,t)),r}(e,t,r)})).join("\n"),c=t.texShape,l=hb(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+e.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),f=function(e){return e.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+e.varyingFs+" vec2 resultUV;\n    "+e.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+e.defineSpecialNaN+"\n    "+e.defineSpecialInf+"\n    "+e.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    \nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n    \nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n\n  "}(l);return t.isPacked?(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(_p(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=e,r=t,i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=(o=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+i[0]+", "+i[1]+"));\n      int index = resTexRC.x * "+i[1]+" + resTexRC.y;\n\n      int b = index / "+a+";\n      index -= b * "+a+";\n\n      int r = 2 * (index / "+o+");\n      int c = imod(index, "+o+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),i=r*Math.ceil(e[e.length-2]/2),o=i,a="",s="b, r, c",u=2;u<e.length-1;u++)a="\n      int b"+u+" = index / "+(o*=e[e.length-u-1])+";\n      index -= b"+u+" * "+o+";\n    "+a,s="b"+u+", "+s;return"\n    ivec"+e.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+a+"\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+e.length+"("+s+");\n    }\n  "}(e,t)}var n,r,i,o,a}(t.logicalShape,c),a=function(e){return"\n    void setOutput(vec4 val) {\n      "+e.output+" = val;\n    }\n  "}(l)):(o=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){return 1===t[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+t[1]+".0);\n      }\n    ":1===t[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+t[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      return resTexRC.x * "+t[1]+" + resTexRC.y;\n    }\n  "}(0,t);case 2:return function(e,t){return _p(e,t)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+t[0]+", "+t[1]+"));\n      }\n    ":1===e[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===e[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+t[0]+", "+t[1]+"));\n        int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      int r = index / "+e[1]+";\n      int c = index - r * "+e[1]+";\n      return ivec2(r, c);\n    }\n  "}(e,t);case 3:return n=t,r=fb(["r","c","d"],e),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(e,t){var n=fb(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(e,t);case 5:return function(e,t){var n=fb(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+t[0]+",\n                             "+t[1]+"));\n\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(e,t);case 6:return function(e,t){var n=fb(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+t[0]+", "+t[1]+"));\n      int index = resTexRC.x * "+t[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(e,t);default:throw new Error(e.length+"-D output sampling is not yet supported")}var n,r}(t.logicalShape,c),a=function(e){return"\n    void setOutput(float val) {\n      "+e.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(f+="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n"),[f,h,a,s,o,u,n].join("\n")}(o,s,i,t.packedInputs),c=e.createProgram(u),l=null,h=e.getUniformLocation(c,"NAN",!1);1===np().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var f={},d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];f[p]=e.getUniformLocation(c,p,!1),f["offset"+p]=e.getUniformLocation(c,"offset"+p,!1)}return{program:t,source:u,webGLProgram:c,uniformLocations:f,inShapeInfos:a,outShapeInfo:s,infLoc:l,nanLoc:h}}(o.gpgpu,e,l,f)})),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),function(e,t,n,r,i){R_(t.inShapeInfos,n),R_([t.outShapeInfo],[r]);var o=r.texData.texture,a=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(o,a[0],a[1]):e.setOutputMatrixTexture(o,a[0],a[1]),e.setProgram(t.webGLProgram),1===np().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var i=t.program.variableNames[r],o=t.uniformLocations[i],a=t.uniformLocations["offset"+i];if(null!=o)if(n.isUniform)if(bp(n.shape)<2)e.gl.uniform1f(o,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(o,s)}else null!=n.texData.slice&&null!=a&&e.gl.uniform1i(a,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,o,r)})),null!=i&&i(e,t.webGLProgram),e.executeProgram()}(this.gpgpu,p,l,f,r),c.forEach((function(e){return o.disposeData(e.dataId)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!np().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var m=this.unpackTensor(a);return this.disposeData(a.dataId),m}return a},t.prototype.compileAndRun=function(e,t,n,r,i){void 0===i&&(i=!1);var o=this.runWebGLProgram(e,t,n=n||t[0].dtype,r,i);return Sv.makeTensorFromDataId(o.dataId,o.shape,o.dtype)},t.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},t.prototype.getTextureManager=function(){return this.textureManager},t.prototype.dispose=function(){var e=this;this.disposed||(np().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},t.prototype.floatPrecision=function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=Nm((function(){if(!np().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=np().getBool("DEBUG");np().set("DEBUG",!1);var n=e.abs(tg(1e-8)).dataSync()[0];if(np().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),r=n.shape,i=n.dtype,o=n.values,a=n.usage,s=n.isPacked;if(null==n.texture){var u,c=null!=this.activeTimers;c&&(u=Xp());var l=n.texShape;if(null==l&&(l=gm(r,s),n.texShape=l),null!=o){var h=mm(r),f=void 0,d=l[1],p=l[0],v=o instanceof Uint8Array;s?(d=(t=Bv(l[0],l[1]))[0],f=new i_(h,[p=t[1],d],v)):f=new r_(h,[p,d],v);var m=this.makeTensorInfo([p,d],i);this.texData.get(m.dataId).usage=v?Av.PIXELS:Av.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(m.dataId),d,p,o);var g=this.runWebGLProgram(f,[m],i,null,!0),y=this.texData.get(g.dataId);n.texture=y.texture,n.texShape=y.texShape,n.isPacked=y.isPacked,n.usage=y.usage,this.disposeData(m.dataId),this.texData.delete(g.dataId),n.values=null,c&&(this.uploadWaitMs+=Xp()-u)}else{var b=this.acquireTexture(l,a,i,s);n.texture=b}}},t.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype "+t)}(t,r)),n.values},t.prototype.acquireTexture=function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var i=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+i+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)},t.prototype.computeBytes=function(e,t){return e[0]*e[1]*Pp(t)},t}(Cy);Iv()&&Sv.registerBackend("webgl",(function(){return new Aw}),2);var Dw=Qm({square_:function(e){var t=Lm(e,"x","square");return Sv.runKernelFunc((function(e,n){return n([t]),e.square(t)}),{x:t},null,"Square",{},[t],[])}}),Nw="SquaredDifference",Ow=Qm({squaredDifference_:function(e,t){var n,r=Lm(e,"a","squaredDifference"),i=Lm(t,"b","squaredDifference");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e,t){var n=e.squaredDifference(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=tg(2);return{a:function(){return e.mul(n.sub(r).mul(i))},b:function(){return e.mul(r.sub(n).mul(i))}}}),Nw,{},[r,i],[])}}),Fw=Qm({abs_:function(e){var t=Lm(e,"x","abs");return"complex64"===t.dtype?Sv.runKernelFunc((function(e){return e.complexAbs(t)}),{$x:t}):Sv.runKernelFunc((function(e,n){var r=e.abs(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().step(-1))}}}),"Abs")}}),Pw=Qm({acos_:function(e){var t=Lm(e,"x","acos");return Sv.runKernelFunc((function(e,n){var r=e.acos(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(tg(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),Mw=Qm({acosh_:function(e){var t=Lm(e,"x","acosh");return Sv.runKernelFunc((function(e,n){var r=e.acosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),Lw=Qm({asin_:function(e){var t=Lm(e,"x","asin");return Sv.runKernelFunc((function(e,n){var r=e.asin(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(tg(1).sub(n.toFloat().square()).sqrt())}}}))}}),Bw=Qm({asinh_:function(e){var t=Lm(e,"x","asinh");return Sv.runKernelFunc((function(e,n){var r=e.asinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.divStrict(tg(1).add(n.toFloat().square()).sqrt())}}}))}}),Uw=Qm({atan_:function(e){var t=Lm(e,"x","atan");return Sv.runKernelFunc((function(e,n){var r=e.atan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().square().add(1))}}}))}}),Ww=Qm({atanh_:function(e){var t=Lm(e,"x","atanh");return Sv.runKernelFunc((function(e,n){var r=e.atanh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(tg(1).sub(n.toFloat().square()))}}}))}}),zw=Qm({ceil_:function(e){var t=Lm(e,"x","ceil");return Sv.runKernelFunc((function(e){return e.ceil(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),Vw=Qm({clipByValue_:function(e,t,n){var r=Lm(e,"x","clipByValue");return vp(t<=n,(function(){return"Error in clip: min ("+t+") must be less than or equal to max ("+n+")."})),Sv.runKernelFunc((function(e,i){var o=e.clip(r,t,n);return i([r]),o}),{x:r},(function(e,r){var i=r[0];return{x:function(){return e.where(i.greaterEqual(t).logicalAnd(i.lessEqual(n)),hg(e))}}}),"ClipByValue",{min:t,max:n},[r])}}),jw=Qm({cos_:function(e){var t=Lm(e,"x","cos");return Sv.runKernelFunc((function(e,n){var r=e.cos(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().sin().neg().mul(e)}}}),"Cos",{},[t])}}),Hw=Qm({cosh_:function(e){var t=Lm(e,"x","cosh");return Sv.runKernelFunc((function(e,n){var r=e.cosh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().sinh().mulStrict(e)}}}))}}),qw=Qm({erf_:function(e){var t=Lm(e,"x","erf");return vp("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=t.toFloat()),Sv.runKernelFunc((function(e,n){var r=e.erf(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),Gw=Qm({exp_:function(e){var t=Lm(e,"x","exp");return Sv.runKernelFunc((function(e,n){var r=e.exp(t);return n([r]),r}),{x:t},(function(e,t){return{x:function(){return e.mulStrict(t[0])}}}),"Exp",{},[],[!0])}}),Kw=Qm({expm1_:function(e){var t=Lm(e,"x","expm1");return Sv.runKernelFunc((function(e,n){var r=e.expm1(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.exp())}}}))}}),Xw=Qm({floor_:function(e){var t=Lm(e,"x","floor");return Sv.runKernelFunc((function(e){return e.floor(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),Qw=Qm({log_:function(e){var t=Lm(e,"x","log");return Sv.runKernelFunc((function(e,n){var r=e.log(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.toFloat())}}}),"Log",{},[t])}}),Yw=Qm({log1p_:function(e){var t=Lm(e,"x","log1p");return Sv.runKernelFunc((function(e,n){var r=e.log1p(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.add(1))}}}))}}),$w=Qm({logSigmoid_:function(e){var t=Lm(e,"x","logSigmoid");return Sv.runKernelFunc((function(e,n){var r=e.softplus(t.neg()).neg();return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.neg().sigmoid())}}}))}}),Zw=Qm({neg_:function(e){var t=Lm(e,"x","neg");return Sv.runKernelFunc((function(e){return e.neg(t)}),{x:t},(function(e){return{x:function(){return e.neg()}}}),"Neg",{},[t])}}),Jw=Qm({reciprocal_:function(e){var t=Lm(e,"x","reciprocal");return Sv.runKernelFunc((function(e,n){var r=e.reciprocal(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.square().neg())}}}))}}),ex=Qm({round_:function(e){var t=Lm(e,"x","round");return Sv.runKernelFunc((function(e){return e.round(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),tx=Qm({rsqrt_:function(e){var t=Lm(e,"x","rsqrt");return Sv.runKernelFunc((function(e,n){var r=e.rsqrt(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},[t])}}),nx=Qm({sigmoid_:function(e){var t=Lm(e,"x","sigmoid");return Sv.runKernelFunc((function(e,n){var r=e.sigmoid(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mul(n.mul(tg(1).sub(n)))}}}),"Sigmoid")}}),rx=Qm({sign_:function(e){var t=Lm(e,"x","sign");return Sv.runKernelFunc((function(e){return e.sign(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),ix=Qm({isNaN_:function(e){var t=Lm(e,"x","isNaN");return Sv.runKernelFunc((function(e){return e.isNaN(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),ox=Qm({isInf_:function(e){var t=Lm(e,"x","isInf");return Sv.runKernelFunc((function(e){return e.isInf(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),ax=Qm({isFinite_:function(e){var t=Lm(e,"x","isFinite");return Sv.runKernelFunc((function(e){return e.isFinite(t)}),{$x:t},(function(e){return{$x:function(){return hg(e)}}}))}}),sx=Qm({sin_:function(e){var t=Lm(e,"x","sin");return Sv.runKernelFunc((function(e,n){var r=e.sin(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return n.toFloat().cos().mul(e)}}}),"Sin",{},[t])}}),ux=Qm({sinh_:function(e){var t=Lm(e,"x","sinh");return Sv.runKernelFunc((function(e,n){var r=e.sinh(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return n.toFloat().cosh().mulStrict(e)}}}))}}),cx=Qm({softplus_:function(e){var t=Lm(e,"x","softplus");return Sv.runKernelFunc((function(e,n){var r=e.softplus(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.mul(n.sigmoid())}}}))}}),lx=Qm({sqrt_:function(e){var t=Lm(e,"x","sqrt");return Sv.runKernelFunc((function(e,n){var r=e.sqrt(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.toFloat().sqrt().mul(2))}}}))}}),hx=Qm({step_:function(e,t){void 0===t&&(t=0);var n=Lm(e,"x","step");return Sv.runKernelFunc((function(e){return e.step(n,t)}),{$x:n},(function(e){return{$x:function(){return hg(e)}}}))}}),fx=Qm({tan_:function(e){var t=Lm(e,"x","tan");return Sv.runKernelFunc((function(e,n){var r=e.tan(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return e.div(n.cos().square())}}}))}}),dx=Qm({tanh_:function(e){var t=Lm(e,"x","tanh");return Sv.runKernelFunc((function(e,n){var r=e.tanh(t);return n([r]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return tg(1).sub(n.square()).mulStrict(e)}}}),"Tanh",{},null,[!0])}});function px(e,t,n,r,i,o){var a,s,u=Lm(e,"x","batchNorm"),c=Lm(t,"mean","batchNorm"),l=Lm(n,"variance","batchNorm");return null!=i&&(a=Lm(i,"scale","batchNorm")),null!=r&&(s=Lm(r,"offset","batchNorm")),vp(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),vp(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),vp(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=a&&vp(2===a.rank||1===a.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),null!=s&&vp(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),gx(u,c,l,s,a,o)}function vx(e,t,n,r,i,o){var a,s,u=Lm(e,"x","batchNorm"),c=Lm(t,"mean","batchNorm"),l=Lm(n,"variance","batchNorm");return null!=i&&(a=Lm(i,"scale","batchNorm")),null!=r&&(s=Lm(r,"offset","batchNorm")),vp(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),vp(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),vp(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=a&&vp(3===a.rank||1===a.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),null!=s&&vp(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),gx(u,c,l,s,a,o)}function mx(e,t,n,r,i,o){var a,s,u=Lm(e,"x","batchNorm"),c=Lm(t,"mean","batchNorm"),l=Lm(n,"variance","batchNorm");return null!=i&&(a=Lm(i,"scale","batchNorm")),null!=r&&(s=Lm(r,"offset","batchNorm")),vp(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),vp(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),vp(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=a&&vp(4===a.rank||1===a.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),null!=s&&vp(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),gx(u,c,l,s,a,o)}function gx(e,t,n,r,i,o){null==o&&(o=.001);var a,s,u,c=Lm(e,"x","batchNorm"),l=Lm(t,"mean","batchNorm"),h=Lm(n,"variance","batchNorm");return null!=i&&(a=Lm(i,"scale","batchNorm")),null!=r&&(s=Lm(r,"offset","batchNorm")),vp(l.rank===h.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),vp(null==s||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),vp(null==a||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),u=0===c.rank||1===c.rank?c.as4D(1,1,1,c.size):2===c.rank?c.as4D(1,1,c.shape[0],c.shape[1]):3===c.rank?c.as4D(1,c.shape[0],c.shape[1],c.shape[2]):c,Sv.runKernelFunc((function(e,t){var n=e.batchNormalization(u,yx(l),yx(h),o,yx(a),yx(s));return t([c,l,h,a]),n}),{x:c,mean:l,variance:h,scale:a,offset:s},(function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],s=null==a?tg(1):a,c=Iy(r.shape,u.shape),l=[];if(1===r.rank){for(var h=0;h<u.shape.length-1;++h)l.push(u.shape[h]);l.push(1)}var f=n.sub(r),d=e.mul(s),p=tx(i.add(tg(o))),v=p.mul(p).mul(p).mul(tg(-.5));return{x:function(){return 1===r.rank?e.mul(ey(p.as4D(1,1,1,r.shape[0]),l)).mul(s).reshape(n.shape):e.mul(p).mul(s).reshape(n.shape)},mean:function(){var e=p.mul(tg(-1)).mul(d);return 1===r.rank&&(e=e.sum(c)),e.reshape(r.shape)},variance:function(){var e=v.mul(f).mul(d);return 1===r.rank&&(e=e.sum(c)),e.reshape(r.shape)},scale:function(){var t=f.mul(p),n=e.mul(t);return 1===r.rank&&(n=n.sum(c)),n.reshape(r.shape)},offset:function(){var t=e;return 1===r.rank&&(t=t.sum(c)),t.reshape(r.shape)}}}),"BatchNormalization",{varianceEpsilon:o},[c,l,h,a]).reshape(c.shape)}function yx(e){return null==e?null:0===e.rank?e.as1D():1===e.rank?e:2===e.rank?e.as4D(1,1,e.shape[0],e.shape[1]):3===e.rank?e.as4D(1,e.shape[0],e.shape[1],e.shape[2]):e}function bx(){Dm("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var _x=Qm({batchNormalization2d_:function(e,t,n,r,i,o){return void 0===r&&(r=.001),bx(),px(e,t,n,o,i,r)}}),wx=Qm({batchNormalization3d_:function(e,t,n,r,i,o){return void 0===r&&(r=.001),bx(),vx(e,t,n,o,i,r)}}),xx=Qm({batchNormalization4d_:function(e,t,n,r,i,o){return void 0===r&&(r=.001),bx(),mx(e,t,n,o,i,r)}}),kx=Qm({batchNormalization_:function(e,t,n,r,i,o){return void 0===r&&(r=.001),bx(),gx(e,t,n,o,i,r)}}),Cx=Qm({batchNorm_:gx}),Ex=Qm({batchNorm2d_:px}),Sx=Qm({batchNorm3d_:vx}),Ix=Qm({batchNorm4d_:mx}),Rx=Qm({logicalAnd_:function(e,t){var n=Lm(e,"a","logicalAnd","bool"),r=Lm(t,"b","logicalAnd","bool");return Ry(n.shape,r.shape),Sv.runKernelFunc((function(e){return e.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),Tx=Qm({logicalNot_:function(e){var t=Lm(e,"x","logicalNot","bool");return Sv.runKernelFunc((function(e){return e.logicalNot(t)}),{$x:t})}}),Ax=Qm({logicalOr_:function(e,t){var n=Lm(e,"a","logicalOr","bool"),r=Lm(t,"b","logicalOr","bool");return Ry(n.shape,r.shape),Sv.runKernelFunc((function(e){return e.logicalOr(n,r)}),{$a:n,$b:r})}}),Dx=Qm({logicalXor_:function(e,t){var n=Lm(e,"a","logicalXor","bool"),r=Lm(t,"b","logicalXor","bool");return Ry(n.shape,r.shape),Ax(e,t).logicalAnd(Rx(e,t).logicalNot())}}),Nx=Qm({where_:function(e,t,n){var r=Lm(t,"a","where"),i=Lm(n,"b","where"),o=Lm(e,"condition","where","bool");return mp(r.shape,i.shape,"Error in where: "),1===o.rank?vp(o.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):mp(o.shape,i.shape,"Error in where: "),Sv.runKernelFunc((function(e,t){var n=e.select(o,r,i);return t([o]),n}),{$condition:o,$a:r,$b:i},(function(e,t){var n=t[0];return{$condition:function(){return hg(n).toFloat()},$a:function(){return e.mul(n.cast(e.dtype))},$b:function(){return e.mul(n.logicalNot().cast(e.dtype))}}}))}}),Ox=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r;return Jd(this,(function(i){switch(i.label){case 0:return[4,(t=Lm(e,"condition","whereAsync","bool")).data()];case 1:return n=i.sent(),r=ob(t.shape,n),e!==t&&t.dispose(),[2,r]}}))}))},Fx=Qm({add_:function(e,t){var n,r=Lm(e,"a","add"),i=Lm(t,"b","add");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e){return e.add(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=Iy(r.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Iy(i.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(i.shape)}}}),"Add")}}),Px=Qm({addN_:function(e){vp(Array.isArray(e),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),vp(e.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+e.length}));var t=e.map((function(e,t){return Lm(e,"tensors"+t,"addN")})),n=t[0];return t.forEach((function(e){if(e.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),t.forEach((function(e){if(!_p(e.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")})),Sv.runKernelFunc((function(e){return e.addN(t)}),t,(function(e){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}),"AddN")}}),Mx=Qm({addStrict_:function(e,t){var n=Lm(e,"a","addStrict"),r=Lm(t,"b","addStrict");return mp(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Lx=Qm({atan2_:function(e,t){var n,r=Lm(e,"a","atan2"),i=Lm(t,"b","atan2");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e,t){var n=e.atan2(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Fx(n.square(),r.square()),i=e.mul(r.div(t)),a=Iy(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},$b:function(){var t=Fx(n.square(),r.square()),i=Zw(e.mul(n.div(t))),a=Iy(r.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(r.shape)}}}))}}),Bx=Qm({div_:function(e,t){var n,r=Lm(e,"a","div"),i=Lm(t,"b","div");if(n=_v(r,i),i=n[1],"int32"===(r=n[0]).dtype&&"int32"===i.dtype)return zx(r,i);var o=Ry(r.shape,i.shape);return Sv.runKernelFunc((function(e,t){var n=e.realDivide(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=Iy(n.shape,o);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Iy(r.shape,o);i.length>0&&(t=t.sum(i).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}}),"Div")}}),Ux=Qm({divNoNan_:function(e,t){var n,r=Lm(e,"a","div"),i=Lm(t,"b","div");r=(n=_v(r,i))[0];var o=Bx(r,i=n[1]),a=hg(o),s=i.equal(a);return Nx(s,a,o)}}),Wx=Qm({divStrict_:function(e,t){var n=Lm(e,"a","div"),r=Lm(t,"b","div");return mp(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),zx=Qm({floorDiv_:function(e,t){var n,r=Lm(e,"a","floorDiv"),i=Lm(t,"b","floorDiv");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e,t){var n=e.floorDiv(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.div(r.toFloat()),i=Iy(n.shape,o);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Iy(r.shape,o);i.length>0&&(t=t.sum(i).reshape(r.shape));var a=r.square();return t.div(a.toFloat()).neg()}}}),"FloorDiv")}}),Vx=Qm({maximum_:function(e,t){var n,r=Lm(e,"a","maximum"),i=Lm(t,"b","maximum");return n=_v(r,i),i=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),i=i.toInt()),Ry(r.shape,i.shape),Sv.runKernelFunc((function(e,t){var n=e.maximum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.greaterEqual(r).toFloat())},b:function(){return e.mul(n.less(r).toFloat())}}}),"Maximum")}}),jx=Qm({maximumStrict_:function(e,t){var n=Lm(e,"a","maximumStrict"),r=Lm(t,"b","maximumStrict");return mp(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Hx=Qm({minimum_:function(e,t){var n,r=Lm(e,"a","minimum"),i=Lm(t,"b","minimum");return n=_v(r,i),i=n[1],"bool"===(r=n[0]).dtype&&(r=r.toInt(),i=i.toInt()),Ry(r.shape,i.shape),Sv.runKernelFunc((function(e,t){var n=e.minimum(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return e.mul(n.lessEqual(r).toFloat())},b:function(){return e.mul(n.greater(r).toFloat())}}}),"Minimum")}}),qx=Qm({minimumStrict_:function(e,t){var n=Lm(e,"a","minimumStrict"),r=Lm(t,"b","minimumStrict");return mp(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Gx=Qm({mod_:function(e,t){var n,r=Lm(e,"a","mod"),i=Lm(t,"b","mod");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e,t){var n=e.mod(r,i);return t([r,i]),n}),{$a:r,$b:i},(function(e,t){var n=t[0],r=t[1];return{$a:function(){var t=Iy(n.shape,o);return t.length>0?e.sum(t).reshape(n.shape):e},$b:function(){var t=e.mul(n.div(r).floor().neg()),i=Iy(r.shape,o);return i.length>0?t.sum(i).reshape(r.shape):t}}}))}}),Kx=Qm({modStrict_:function(e,t){var n=Lm(e,"a","modStrict"),r=Lm(t,"b","modStrict");return mp(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Xx=Qm({mul_:function(e,t){var n,r=Lm(e,"a","mul"),i=Lm(t,"b","mul");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e,t){var n=e.multiply(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){var t=e.mul(r.toFloat()),i=Iy(n.shape,o);return i.length>0?t.sum(i).reshape(n.shape):t},b:function(){var t=e.mul(n.toFloat()),i=Iy(r.shape,o);return i.length>0?t.sum(i).reshape(r.shape):t}}}),"Mul")}}),Qx=Qm({mulStrict_:function(e,t){var n=Lm(e,"a","mul"),r=Lm(t,"b","mul");return mp(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),Yx=Qm({pow_:function(e,t){var n,r=Lm(e,"base","pow"),i=Lm(t,"exp","pow");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e,t){var n=e.pow(r,i);return t([r,i,n]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1],i=t[2];return{a:function(){var t=r.toFloat(),i=e.mul(t.mul(n.pow(t.sub(tg(1))))),a=Iy(n.shape,o);return a.length>0&&(i=i.sum(a)),i.reshape(n.shape)},b:function(){var t=n.greater(0),a=n.log().where(t,hg(n)),s=e.mul(i.mul(a)),u=Iy(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},[r,i],[!0])}}),$x=Qm({powStrict_:function(e,t){return mp(e.shape,t.shape,"Error in powStrict: "),e.pow(t)}}),Zx=Qm({squaredDifferenceStrict_:function(e,t){var n=Lm(e,"a","squaredDifferenceStrict"),r=Lm(t,"b","squaredDifferenceStrict");return mp(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),Jx=Qm({sub_:function(e,t){var n,r=Lm(e,"a","sub"),i=Lm(t,"b","sub");n=_v(r,i);var o=Ry((r=n[0]).shape,(i=n[1]).shape);return Sv.runKernelFunc((function(e){return e.subtract(r,i)}),{a:r,b:i},(function(e){return{a:function(){var t=e,n=Iy(r.shape,o);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},b:function(){var t=e,n=Iy(i.shape,o);return n.length>0&&(t=t.sum(n)),t.neg().reshape(i.shape)}}}),"Sub")}}),ek=Qm({subStrict_:function(e,t){var n=Lm(e,"a","subStrict"),r=Lm(t,"b","subStrict");return mp(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),tk=Qm({equal_:function(e,t){var n,r=Lm(e,"a","equal"),i=Lm(t,"b","equal");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e){return e.equal(r,i)}),{$a:r,$b:i})}}),nk=Qm({equalStrict_:function(e,t){var n=Lm(e,"a","equalStrict"),r=Lm(t,"b","equalStrict");return mp(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),rk=Qm({greater_:function(e,t){var n,r=Lm(e,"a","greater"),i=Lm(t,"b","greater");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e){return e.greater(r,i)}),{a:r,b:i},null,"Greater")}}),ik=Qm({greaterEqual_:function(e,t){var n,r=Lm(e,"a","greaterEqual"),i=Lm(t,"b","greaterEqual");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e,t){var n=e.greaterEqual(r,i);return t([r,i]),n}),{a:r,b:i},(function(e,t){var n=t[0],r=t[1];return{a:function(){return hg(n)},b:function(){return hg(r)}}}),"GreaterEqual")}}),ok=Qm({greaterEqualStrict_:function(e,t){var n=Lm(e,"a","greaterEqualStrict"),r=Lm(t,"b","greaterEqualStrict");return mp(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),ak=Qm({greaterStrict_:function(e,t){var n=Lm(e,"a","greaterStrict"),r=Lm(t,"b","greaterStrict");return mp(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),sk=Qm({less_:function(e,t){var n,r=Lm(e,"a","less"),i=Lm(t,"b","less");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e){return e.less(r,i)}),{a:r,b:i},null,"Less")}}),uk=Qm({lessEqual_:function(e,t){var n,r=Lm(e,"a","lessEqual"),i=Lm(t,"b","lessEqual");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e,t){var n=e.lessEqual(r,i);return t([r,i]),n}),{a:r,b:i},null,"LessEqual")}}),ck=Qm({lessEqualStrict_:function(e,t){var n=Lm(e,"a","lessEqualStrict"),r=Lm(t,"b","lessEqualStrict");return mp(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),lk=Qm({lessStrict_:function(e,t){var n=Lm(e,"a","lessStrict"),r=Lm(t,"b","lessStrict");return mp(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),hk=Qm({notEqual_:function(e,t){var n,r=Lm(e,"a","notEqual"),i=Lm(t,"b","notEqual");return n=_v(r,i),Ry((r=n[0]).shape,(i=n[1]).shape),Sv.runKernelFunc((function(e){return e.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),fk=Qm({notEqualStrict_:function(e,t){var n=Lm(e,"a","notEqualStrict"),r=Lm(t,"b","notEqualStrict");return mp(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function dk(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function pk(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var vk=Qm({gather_:function(e,t,n){void 0===n&&(n=0);var r=Lm(e,"x","gather"),i=Lm(t,"indices","gather","int32");n=Ip(n,r.shape)[0];var o=function(e,t,n){for(var r=e.shape[n],i=[],o=1,a=1,s=0;s<n;s++)i.push(e.shape[s]),o*=e.shape[s];for(s=0;s<t.rank;s++)i.push(t.shape[s]);for(s=n+1;s<e.rank;s++)i.push(e.shape[s]),a*=e.shape[s];return{batchSize:o,sliceSize:a,dimSize:r,outputShape:i}}(r,i,n);return Sv.runKernelFunc((function(e,t){var o=e.gather(r,i.flatten(),n);return t([i]),o}),{x:r,indices:i},(function(e,t){var i=t[0];return{x:function(){var t=r.shape,o=i.size,a=t.slice(0,n),s=a.length,u=t.slice(n,t.length).slice(1),c=u.length,l=dk(0,s),h=dk(s+1,s+1+c),f=pk([a,[o],u]),d=e.reshape(f),p=i.reshape([o]),v=pk([[s],l,h]),m=d.transpose(v),g=mk(m,p,r.shape[n]),y=qm(v);return g.transpose(y)},indices:function(){return i}}}),"Gather",{axis:n}).reshape(o.outputShape)}}),mk=Qm({unsortedSegmentSum_:function(e,t,n){var r=Lm(e,"x","unsortedSegmentSum"),i=Lm(t,"segmentIds","unsortedSegmentSum","int32");return vp(wp(n),(function(){return"numSegments must be of dtype int"})),Sv.runKernelFunc((function(e,t){var o=e.unsortedSegmentSum(r,i,n);return t([i]),o}),{$x:r},(function(e,t){var n=t[0];return{$x:function(){return function(e,t){for(var n=Vx(t,hg(t)),r=vk(e,n),i=ik(t,tg(0,"int32")),o=r.rank-i.rank,a=0;a<o;++a)i=Lg(i,a+1);i=Rx(i,ag(r.shape,"bool"));var s=hg(r);return Nx(i,r,s)}(e,n)}}}))}});function gk(e,t,n,r,i,o,a){void 0===o&&(o="NHWC"),vp(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]),s=[1,e[0],e[1],e[2]]),vp(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),vp(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),vp(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===o?s[3]:s[1],h="NHWC"===o?u.shape[3]:u.shape[1];vp(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),vp(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),null!=a&&vp(wp(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var f=Wy(o),d=Dy(s,n.shape,r,1,i,a,!1,f),p=Sv.runKernelFunc((function(e,t){var r=e.conv2dDerInput(u,n,d);return t([n,u]),r}),{dy4D:u,filter:n},(function(e,t){var n=t[0],s=t[1];return{dy4D:function(){return wk(e,n,r,i,o,1,a)},filter:function(){return kk(e,s,n.shape,r,i,o,a)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function yk(e){var t=function(e){return"number"==typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}(e);return 1===t[0]&&1===t[1]&&1===t[2]}function bk(e,t,n,r,i){vp(e.length===t.rank,(function(){return"Length of inShape ("+e.length+") and rank of dy ("+t.rank+") must match"}));var o=e,a=t,s=!1;4===t.rank&&(s=!0,a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]),o=[1,e[0],e[1],e[2],e[3]]);var u=o[4],c=a.shape[4];vp(5===o.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),vp(5===a.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),vp(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),vp(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),vp(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=Ny(o,n.shape,r,1,i),h=Sv.runKernelFunc((function(e){return e.conv3dDerInput(a,n,l)}),{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var _k=Qm({conv1d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NWC"),void 0===o&&(o=1);var s=Lm(e,"x","conv1d"),u=Lm(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),vp(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),vp(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=a&&vp(wp(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."})),vp(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),vp(Uy(n,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+o+"'"})),vp("NWC"===i,(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),d=wk(f,h,[1,n],r,"NHWC",[1,o],a);return l?d.as2D(d.shape[2],d.shape[3]):d.as3D(d.shape[0],d.shape[2],d.shape[3])}}),wk=Qm({conv2d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=Lm(e,"x","conv2d"),u=Lm(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),vp(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),vp(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=a&&vp(wp(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var h="NHWC"===i?c.shape[3]:c.shape[1];vp(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),vp(Uy(n,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"}));var f=Wy(i),d=Dy(c.shape,u.shape,n,o,r,a,!1,f),p=Sv.runKernelFunc((function(e,t){var n=e.conv2d(c,u,d);return t([u,c]),n}),{x:c,filter:u},(function(e,t){var a=t[0],s=t[1];return vp(By(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return Ck(s.shape,e,a,n,r,i)},filter:function(){return kk(s,e,a.shape,n,r,i)}}}),"Conv2D",d,[u,c]);return l?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}}),xk=Qm({conv3d_:function(e,t,n,r,i,o){void 0===i&&(i="NDHWC"),void 0===o&&(o=[1,1,1]);var a=Lm(e,"x","conv3d"),s=Lm(t,"filter","conv3d"),u=a,c=!1;4===a.rank&&(c=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),vp(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),vp(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),vp(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),vp(function(e,t){return yk(e)||yk(t)}(n,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),vp("NDHWC"===i,(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var l=Ny(u.shape,s.shape,n,o,r),h=Sv.runKernelFunc((function(e,t){var n=e.conv3d(u,s,l);return t([u,s]),n}),{x:u,$filter:s},(function(e,t){vp(yk(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var i=t[0],a=t[1];return{x:function(){return bk(i.shape,e,a,n,r)},$filter:function(){return function(e,t,n,r,i){var o=e;4===e.rank&&(o=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]));var a=t;4===a.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3])),vp(5===o.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+o.shape+"."})),vp(5===a.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+a.shape+"."})),vp(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),vp(o.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+o.shape[4]+") must match input depth in filter ("+n[3]+"."})),vp(a.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+a.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Ny(o.shape,n,r,1,i);return Sv.runKernelFunc((function(e){return e.conv3dDerFilter(o,a,s)}),{x5D:o,dy5D:a})}(i,e,a.shape,n,r)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),kk=Qm({conv2dDerFilter_:function(e,t,n,r,i,o,a){void 0===o&&(o="NHWC");var s=e;3===e.rank&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var u=t;3===u.rank&&(u=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),vp(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),vp(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),vp(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===o?s.shape[3]:s.shape[1],l="NHWC"===o?u.shape[3]:u.shape[1];vp(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),vp(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=a&&vp(wp(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=Wy(o),f=Dy(s.shape,n,r,1,i,a,!1,h);return Sv.runKernelFunc((function(e){return e.conv2dDerFilter(s,u,f)}),{x4D:s,dy4D:u})}}),Ck=Qm({conv2dDerInput_:gk}),Ek=Qm({depthwiseConv2d_:function(e,t,n,r,i,o,a){void 0===i&&(i="NHWC"),void 0===o&&(o=[1,1]);var s=Lm(e,"x","depthwiseConv2d"),u=Lm(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),vp(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),vp(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),vp(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==o&&(o=[1,1]),vp(Uy(n,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+o+"'"})),null!=a&&vp(wp(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var h=Dy(c.shape,u.shape,n,o,r,a,!0),f=Sv.runKernelFunc((function(e,t){var n=e.depthwiseConv2D(c,u,h);return t([c,u]),n}),{x:c,filter:u},(function(e,t){vp(By(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var n=t[0],r=t[1];return{x:function(){return Sk(n.shape,e,r,h)},filter:function(){return Ik(n,e,r.shape,h)}}}),"DepthwiseConv2dNative",h,[c,u]);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),Sk=Qm({depthwiseConv2dDerInput_:function(e,t,n,r){var i=t,o=!1;3===t.rank&&(o=!0,i=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=Sv.runKernelFunc((function(e){return e.depthwiseConv2DDerInput(i,n,r)}),{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),Ik=Qm({depthwiseConv2dDerFilter_:function(e,t,n,r){var i=e;3===e.rank&&(i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var o=t;return 3===o.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2])),Sv.runKernelFunc((function(e){return e.depthwiseConv2DDerFilter(i,o,r)}),{x4D:i,dy4D:o})}}),Rk=Qm({separableConv2d_:function(e,t,n,r,i,o,a){void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC");var s=Lm(e,"x","separableConv2d"),u=Lm(t,"depthwiseFilter","separableConv2d"),c=Lm(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===a)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");vp(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),vp(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),vp(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),vp(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),vp(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var f=u.shape[2],d=u.shape[3];vp(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*d+", but got "+c.shape[2]+"."}));var p=Ek(l,u,r,i,a,o),v=wk(p,c,1,"valid",a);return h?v.as3D(v.shape[1],v.shape[2],v.shape[3]):v}}),Tk=Qm({conv2dTranspose_:function(e,t,n,r,i,o){return gk(n,Lm(e,"x","conv2dTranspose"),Lm(t,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),Ak=Qm({conv3dTranspose_:function(e,t,n,r,i){return bk(n,Lm(e,"x","conv3dTranspose"),Lm(t,"filter","conv3dTranspose"),r,i)}}),Dk=Qm({matMul_:function(e,t,n,r){var i;void 0===n&&(n=!1),void 0===r&&(r=!1);var o=Lm(e,"a","matMul"),a=Lm(t,"b","matMul");i=_v(o,a),o=i[0],a=i[1];var s=n?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],c=n?o.shape[o.rank-1]:o.shape[o.rank-2],l=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),f=a.shape.slice(0,-2),d=bp(h),p=bp(f);vp(o.rank>=2&&a.rank>=2&&o.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."})),vp(_p(h,f),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."})),vp(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var v=o.shape.slice(0,-2).concat([c,l]),m=n?o.as3D(d,s,c):o.as3D(d,c,s),g=r?a.as3D(p,l,u):a.as3D(p,u,l);return Sv.runKernelFunc((function(e,t){var i=e.batchMatMul(m,g,n,r);return t([m,g]),i}),{a:m,b:g},(function(e,t){var i=t[0],o=t[1];return n||r?!n&&r?{a:function(){return e.matMul(o,!1,!1)},b:function(){return e.matMul(i,!0,!1)}}:n&&!r?{a:function(){return o.matMul(e,!1,!0)},b:function(){return i.matMul(e,!1,!1)}}:{a:function(){return o.matMul(e,!0,!0)},b:function(){return e.matMul(i,!0,!0)}}:{a:function(){return e.matMul(o,!1,!0)},b:function(){return i.matMul(e,!0,!1)}}}),"BatchMatMul",{transposeA:n,transposeB:r}).reshape(v)}}),Nk=Qm({dot_:function(e,t){var n=Lm(e,"t1","dot"),r=Lm(t,"t2","dot");vp(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var i=1===n.rank?n.size:n.shape[1],o=1===r.rank?r.size:r.shape[0];return vp(i===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Ok=Qm({outerProduct_:function(e,t){var n=Lm(e,"v1","outerProduct"),r=Lm(t,"v2","outerProduct");return vp(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),Fk=Qm({reverse_:function(e,t){var n=Lm(e,"x","reverse");if(0===n.rank)return n.clone();var r=Ip(t,n.shape);return Sv.runKernelFunc((function(e){return e.reverse(n,r)}),{$x:n},(function(e){return{$x:function(){return e.reverse(r)}}})).reshapeAs(n)}}),Pk=Qm({reverse1d_:function(e){var t=Lm(e,"x","reverse");return vp(1===t.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+t.rank+"."})),Fk(t,0)}}),Mk=Qm({reverse2d_:function(e,t){var n=Lm(e,"x","reverse");return vp(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),Fk(n,t)}}),Lk=Qm({reverse3d_:function(e,t){var n=Lm(e,"x","reverse");return vp(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),Fk(n,t)}}),Bk=Qm({reverse4d_:function(e,t){var n=Lm(e,"x","reverse");return vp(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),Fk(n,t)}});function Uk(e,t,n,r,i,o){var a=Lm(e,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),null==r&&(r=[1,1]),vp(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),vp(Uy(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=o&&vp(wp(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var c=Ty(s.shape,t,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&_p(c.inShape,c.outShape))return a.clone();var l=Sv.runKernelFunc((function(e,t){var n=e.maxPool(s,c);return t([s,n]),n}),{x:s},(function(e,o){var a=o[0],s=o[1];return{x:function(){return function(e,t,n,r,i,o,a,s){var u=Lm(e,"dy","maxPoolBackprop"),c=Lm(t,"input","maxPoolBackprop"),l=Lm(n,"output","maxPoolBackprop");vp(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==o&&(o=[1,1]),vp(Uy(i,o),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"})),vp(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),vp(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var h=Ty(c.shape,r,i,o,a,void 0);return Sv.runKernelFunc((function(e){return e.maxPoolBackprop(u,c,l,h)}),{$dy:u,$input:c})}(e,a,s,t,n,r,i)}}}),"MaxPool",c,[s]);return u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}function Wk(e,t,n,r,i,o){var a=Lm(e,"x","avgPool","float32");null==r&&(r=[1,1]),vp(Uy(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),vp(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=o&&vp(wp(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var c=Ty(s.shape,t,n,r,i,o);if(1===c.filterWidth&&1===c.filterHeight&&_p(c.inShape,c.outShape))return a.clone();var l=Sv.runKernelFunc((function(e){return e.avgPool(s,c)}),{x:s},(function(e){return{x:function(){return function(e,t,n,r,i,o){var a=Lm(e,"dy","avgPoolBackprop"),s=Lm(t,"input","avgPoolBackprop");vp(s.rank===a.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+a.rank+")"})),null==i&&(i=[1,1]),vp(Uy(r,i),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"}));var u=s,c=a,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),vp(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),vp(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var h=Ty(u.shape,n,r,i,o),f=Sv.runKernelFunc((function(e){return e.avgPoolBackprop(c,u,h)}),{dy4D:c,input4D:u});return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}(e,s,t,n,r,i)}}}),"AvgPool",c);return l=l.cast(a.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var zk=Qm({maxPool_:function(e,t,n,r,i){return Uk(e,t,n,1,r,i)}}),Vk=Qm({avgPool_:function(e,t,n,r,i){return Wk(e,t,n,1,r,i)}}),jk=Qm({pool_:function(e,t,n,r,i,o){null==i&&(i=[1,1]),null==o&&(o=1),0===r&&(r="valid");var a=Lm(e,"x","maxPool"),s=a,u=!1;3===a.rank&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),vp(Uy(o,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}));var c,l=Ty(s.shape,t,o,i,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),i=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],i[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var f=1===h[0]&&1===h[1],d=function(e,t,n){var r=n.map((function(e){return e[0]})),i=n.map((function(e){return e[1]})),o=e.concat(r,i),a=t.map((function(e,t){return(e-o[t]%e)%e})),s=i.map((function(e,t){return e+a[t]}));return[t.map((function(e,t){return[r[t],s[t]]})),t.map((function(e,t){return[0,a[t]]}))]}([l.inHeight,l.inWidth],h,c),p=d[1],v=f?r:"valid",m=f?s:$g(s,h,d[0]),g=("avg"===n?function(){return Wk(m,t,o,1,v)}:function(){return Uk(m,t,o,1,v)})(),y=f?g:Dg(g,h,p);return u?y.as3D(y.shape[1],y.shape[2],y.shape[3]):y}}),Hk=Qm({maxPool3d_:function(e,t,n,r,i,o,a){void 0===o&&(o="NDHWC");var s=Lm(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),vp(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),vp("NDHWC"===o,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),vp(Uy(n,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=i&&vp(wp(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=Ay(u.shape,t,n,a,r,i,o),h=Sv.runKernelFunc((function(e,t){var n=e.maxPool3d(u,l);return t([u,n]),n}),{x:u},(function(e,o){var s=o[0],u=o[1];return{x:function(){return function(e,t,n,r,i,o,a,s){var u=Lm(e,"dy","maxPool3dBackprop"),c=Lm(t,"input","maxPool3dBackprop"),l=Lm(n,"output","maxPool3dBackprop"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),f=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),d=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),vp(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),vp(5===f.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+f.rank+"."})),vp(5===d.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+d.rank+"."})),null==o&&(o=[1,1,1]),vp(Uy(i,o),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+i+" and dilations '"+o+"'"})),null!=s&&vp(wp(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+a+"."}));var v=Ay(f.shape,r,i,o,a,s),m=Sv.runKernelFunc((function(e){return e.maxPool3dBackprop(h,f,d,v)}),{dy5D:h,input5D:f});return p?m.as4D(m.shape[1],m.shape[2],m.shape[3],m.shape[4]):m}(e,s,u,t,n,a,r,i)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),qk=Qm({avgPool3d_:function(e,t,n,r,i,o,a){void 0===o&&(o="NDHWC");var s=Lm(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==a&&(a=[1,1,1]),vp(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),vp("NDHWC"===o,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),vp(Uy(n,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=i&&vp(wp(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var l=Ay(u.shape,t,n,a,r,i,o),h=Sv.runKernelFunc((function(e){return e.avgPool3d(u,l)}),{x:u},(function(e){return{x:function(){return function(e,t,n,r,i,o,a){var s=Lm(e,"dy","avgPool3dBackprop"),u=Lm(t,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),vp(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),vp(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==i&&(i=[1,1,1]),vp(Uy(r,i),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+i+"'"})),null!=a&&vp(wp(o),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var f=Ay(l.shape,n,r,i,o,a),d=Sv.runKernelFunc((function(e){return e.avgPool3dBackprop(c,l,f)}),{dy5D:c,input5D:l});return h?d.as4D(d.shape[1],d.shape[2],d.shape[3],d.shape[4]):d}(e,u,t,n,a,r,i)}}}));return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Gk=Qm({slice_:function(e,t,n){var r,i,o=Lm(e,"x","slice");if(0===o.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof t?[t].concat(new Array(o.rank-1).fill(0)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(0)):t.slice()).forEach((function(e){vp(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=null==n?new Array(o.rank).fill(-1):"number"==typeof n?[n].concat(new Array(o.rank-1).fill(-1)):n.length<o.rank?n.concat(new Array(o.rank-n.length).fill(-1)):n).map((function(e,t){return e>=0?e:(vp(-1===e,(function(){return"Negative size values should be exactly -1 but got "+e+" for the slice() size at index "+t+"."})),o.shape[t]-r[t])})),dy(o,r,i);var a=o.shape;return Sv.runKernelFunc((function(e){return e.slice(o,r,i)}),{x:o},(function(e){for(var t=[],n=0;n<e.rank;n++)t.push([r[n],a[n]-r[n]-i[n]]);return{x:function(){return e.pad(t)}}}),"Slice",{begin:r,size:i})}}),Kk=Qm({slice1d_:function(e,t,n){var r=Lm(e,"x","slice1d");return vp(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Gk(r,[t],[n])}}),Xk=Qm({slice2d_:function(e,t,n){var r=Lm(e,"x","slice2d");return vp(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Gk(r,t,n)}}),Qk=Qm({slice3d_:function(e,t,n){var r=Lm(e,"x","slice3d");return vp(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Gk(r,t,n)}}),Yk=Qm({slice4d_:function(e,t,n){var r=Lm(e,"x","slice4d");return vp(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Gk(r,t,n)}});function $k(e,t,n,r,i){return t.rank<n.rank&&(t=t.reshape(Vm(t.shape,r))),e.rank<n.rank&&(e=e.reshape(Vm(e.shape,r))),{x:function(){var r=e.mul(n.equal(t).cast(e.dtype));return null==i?r:r.transpose(i)}}}var Zk=Qm({all_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","all","bool"),i=Ip(t,r.shape),o=i,a=Hm(o,r.rank);null!=a&&(r=r.transpose(a),o=Gm(o.length,r.rank));var s=Sv.runKernelFunc((function(e){return e.all(r,o)}),{$x:r});if(n){var u=Vm(s.shape,i);return s.reshape(u)}return s}}),Jk=Qm({any_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","any","bool"),i=Ip(t,r.shape),o=i,a=Hm(o,r.rank);null!=a&&(r=r.transpose(a),o=Gm(o.length,r.rank));var s=Sv.runKernelFunc((function(e){return e.any(r,o)}),{$x:r});if(n){var u=Vm(s.shape,i);return s.reshape(u)}return s}}),eC=Qm({argMax_:function(e,t){void 0===t&&(t=0);var n=Lm(e,"x","argMax");null==t&&(t=0);var r=Ip(t,n.shape),i=Hm(r,n.rank);return null!=i&&(n=n.transpose(i),r=Gm(r.length,n.rank)),Sv.runKernelFunc((function(e,t){var i=e.argMax(n,r[0]);return t([n]),i}),{x:n},(function(e,t){var n=t[0];return{x:function(){return hg(n)}}}),"ArgMax",{axis:r[0]},[n])}}),tC=Qm({argMin_:function(e,t){void 0===t&&(t=0);var n=Lm(e,"x","argMin");null==t&&(t=0);var r=Ip(t,n.shape),i=Hm(r,n.rank);return null!=i&&(n=n.transpose(i),r=Gm(r.length,n.rank)),Sv.runKernelFunc((function(e,t){var i=e.argMin(n,r[0]);return t([n]),i}),{$x:n},(function(e,t){var n=t[0];return{$x:function(){return hg(n)}}}))}}),nC=Qm({logSumExp_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","logSumExp"),i=Ip(t,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(n){var u=Vm(s.shape,i);return s.reshape(u)}return s}}),rC=Qm({max_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","max"),i=r,o=Ip(t,r.shape),a=o,s=Hm(a,r.rank);null!=s&&(r=r.transpose(s),a=Gm(a.length,r.rank));var u=Sv.runKernelFunc((function(e,t){var n=e.max(r,a);return t([i,n]),n}),{x:r},(function(e,t){return $k(e,t[1],t[0],o,s)}),"Max",{axes:a},[r],[!0]);if(n){var c=Vm(u.shape,o);u=u.reshape(c)}return u}}),iC=Qm({mean_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","mean"),i=Ip(t,r.shape),o=bp(zm(r.shape,i)[1]);return _y((function(e){var r=tg(o);return{value:(r.dtype===e.dtype?e:e.cast(r.dtype)).div(r).sum(t,n),gradFunc:function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(ag(e.shape,"float32")).div(o)}}}))(r)}}),oC=Qm({min_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","min"),i=r,o=Ip(t,r.shape),a=o,s=Hm(a,r.rank);null!=s&&(r=r.transpose(s),a=Gm(a.length,r.rank));var u=Sv.runKernelFunc((function(e,t){var n=e.min(r,a);return t([i,n]),n}),{x:r},(function(e,t){return $k(e,t[1],t[0],o,s)}),"Min",{axes:a},[r],[!0]);if(n){var c=Vm(u.shape,o);u=u.reshape(c)}return u}}),aC=Qm({moments_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Ip(t,(e=Lm(e,"x","moments")).shape),i=e.mean(r,n),o=i.shape;n||(o=Vm(i.shape,r));var a=e.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,n)}}}),sC=Qm({sum_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","sum");"bool"===r.dtype&&(r=r.toInt());var i=Ip(t,r.shape);return _y((function(e){var t=Hm(i,e.rank),r=i,o=e;null!=t&&(o=e.transpose(t),r=Gm(r.length,e.rank));var a=function(t){var n=e.shape.slice();return i.forEach((function(e){n[e]=1})),t.reshape(n).mul(ag(e.shape,"float32"))},s=Sv.runKernelFunc((function(e){return e.sum(o,r)}),{x:o},(function(e){return{x:function(){return a(e)}}}),"Sum",{axes:r});if(n){var u=Vm(s.shape,i);s=s.reshape(u)}return{value:s,gradFunc:a}}))(r)}}),uC=Qm({prod_:function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=!1);var r=Lm(e,"x","prod");"bool"===r.dtype&&(r=r.toInt());var i=Ip(t,r.shape),o=Hm(i,r.rank),a=i,s=r;null!=o&&(s=r.transpose(o),a=Gm(a.length,r.rank));var u=Sv.runKernelFunc((function(e){return e.prod(s,a)}),{permutedX:s});if(n){var c=Vm(u.shape,i);u=u.reshape(c)}return u}}),cC=Qm({elu_:function(e){var t=Lm(e,"x","elu");return Sv.runKernelFunc((function(e,n){var r=e.elu(t);return n([r]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){return Sv.runKernelFunc((function(t){return t.eluDer(e,n)}),{dy:e,y:n})}}}))}}),lC=Qm({leakyRelu_:function(e,t){void 0===t&&(t=.2);var n=Lm(e,"x","leakyRelu");return Vx(tg(t).mul(n),n)}}),hC=Qm({prelu_:function(e,t){var n=Lm(e,"x","prelu"),r=Lm(t,"alpha","prelu");return Sv.runKernelFunc((function(e,t){var i=e.prelu(n,r);return t([n,r]),i}),{x:n,alpha:r},(function(e,t){var n=t[0],r=t[1],i=n.greater(0);return{x:function(){return Nx(i,e,e.mul(r))},alpha:function(){var t=Nx(i,hg(e),e.mul(n)),o=Iy(r.shape,e.shape);return o.length>0&&(t=t.sum(o)),t.reshape(r.shape)}}}),"Prelu")}}),fC=Qm({relu_:function(e){var t=Lm(e,"x","relu");return"bool"===t.dtype?t.toInt():Sv.runKernelFunc((function(e,n){var r=e.relu(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0];return{x:function(){return e.mulStrict(n.step().toFloat())}}}),"Relu")}}),dC=Qm({relu6_:function(e){var t=Lm(e,"x","relu6");return"bool"===t.dtype?t.toInt():Sv.runKernelFunc((function(e,n){var r=e.relu6(t);return n([t]),r}),{x:t},(function(e,t){var n=t[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return e.mulStrict(r.toFloat())}}}),"Relu6")}}),pC=Qm({selu_:function(e){var t=Lm(e,"x","selu");return Sv.runKernelFunc((function(e,n){var r=e.selu(t);return n([t]),r}),{$x:t},(function(e,t){var n=t[0];return{$x:function(){var t=n.greater(tg(0)),r=tg(1.7580993408473768),i=tg(1.0507009873554805),o=e.mul(i),a=e.mul(r).mul(n.toFloat().exp());return Nx(t,o,a)}}}))}}),vC=Qm({transpose_:function(e,t){var n=Lm(e,"x","transpose");return null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),vp(n.rank===t.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+t+"."})),t.forEach((function(e){vp(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+t}))})),n.rank<=1?n.clone():Sv.runKernelFunc((function(e){return e.transpose(n,t)}),{x:n},(function(e){var n=qm(t);return{x:function(){return e.transpose(n)}}}),"Transpose",{perm:t})}}),mC=Qm({localResponseNormalization_:function(e,t,n,r,i){void 0===t&&(t=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===i&&(i=.5);var o=Lm(e,"x","localResponseNormalization");vp(4===o.rank||3===o.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+o.rank+"."})),vp(wp(t),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+t+"."}));var a=o,s=!1;3===o.rank&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=Sv.runKernelFunc((function(e,o){var s=e.localResponseNormalization4D(a,t,n,r,i);return o([a,s]),s}),{x4D:a},(function(e,o){var a=o[0],s=o[1];return{x4D:function(){return Sv.runKernelFunc((function(o){return o.LRNGrad(e,a,s,t,n,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),gC=Qm({norm_:function(e,t,n,r){void 0===t&&(t="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var i=function e(t,n,r){if(void 0===r&&(r=null),0===t.rank)return t.abs();if(1!==t.rank&&null===r)return e(t.reshape([-1]),n,r);if(1===t.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return t.abs().sum(r);if(n===1/0)return t.abs().max(r);if(n===-1/0)return t.abs().min(r);if("euclidean"===n||2===n)return t.abs().pow(tg(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return t.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return t.abs().sum(r[1]).max(r[0]);if(n===-1/0)return t.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return t.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(e=Lm(e,"x","norm"),t,n),o=i.shape;if(r){var a=Ip(n,e.shape);o=Vm(i.shape,a)}return i.reshape(o)}}),yC=Qm({basicLSTMCell_:function(e,t,n,r,i,o){var a=Lm(e,"forgetBias","basicLSTMCell"),s=Lm(t,"lstmKernel","basicLSTMCell"),u=Lm(n,"lstmBias","basicLSTMCell"),c=Lm(r,"data","basicLSTMCell"),l=Lm(i,"c","basicLSTMCell"),h=Lm(o,"h","basicLSTMCell"),f=c.concat(h,1).matMul(s).add(u),d=f.shape[1]/4,p=[f.shape[0],d],v=f.slice([0,0],p),m=f.slice([0,d],p),g=f.slice([0,2*d],p),y=f.slice([0,3*d],p),b=v.sigmoid().mulStrict(m.tanh()).addStrict(l.mulStrict(a.add(g).sigmoid())),_=b.tanh().mulStrict(y.sigmoid());return[b,_]}}),bC=Qm({multiRNNCell_:function(e,t,n,r){for(var i=Lm(t,"data","multiRNNCell"),o=Bm(n,"c","multiRNNCell"),a=Bm(r,"h","multiRNNCell"),s=i,u=[],c=0;c<e.length;c++){var l=e[c](s,o[c],a[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],f=[];for(c=0;c<u.length;c+=2)h.push(u[c]),f.push(u[c+1]);return[h,f]}}),_C=Qm({movingAverage_:function(e,t,n,r,i){void 0===i&&(i=!0);var o=Lm(e,"v","movingAverage"),a=Lm(t,"x","movingAverage"),s=Lm(n,"decay","movingAverage");wv(o,a),vp(_p(o.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=tg(1),c=u.sub(s),l=a.sub(o).mul(c);if(i){vp(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=Lm(r,"step","movingAverage");l=l.div(u.sub(Yx(s,h)))}return o.add(l)}}),wC=Qm({stridedSlice_:function(e,t,n,r,i,o,a,s,u){if(void 0===i&&(i=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(t.length)),0!==a)throw new Error("ellipsis mask is not yet supported");var c=Lm(e,"x","stridedSlice"),l=py(s),h=c.shape.slice();l.forEach((function(e){t[e]=0,n[e]=1,h.splice(e,0,1)})),c=c.reshape(h);for(var f=0;f<c.rank;f++)t[f]=my(i,t,r,c.shape,f),n[f]=gy(o,n,r,c.shape,f),r[f]=r[f]||1;var d=py(u);d.forEach((function(e){n[e]=t[e]+1,r[e]=1}));var p=vy(t,n,r),v=p.filter((function(e,t){return-1===d.indexOf(t)}));return r.every((function(e){return 1===e}))?Gk(c,t,p).reshape(v):Sv.runKernelFunc((function(e){return e.stridedSlice(c,t,n,r)}),{$x:c}).reshape(v)}}),xC=Qm({topk_:function(e,t,n){void 0===t&&(t=1),void 0===n&&(n=!0);var r=Lm(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(t>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+t);var o=Sv.runKernelFunc((function(e){return e.topk(r,t,n)}),{$x:r});return{values:o[0],indices:o[1]}}}),kC=Qm({scatterND_:function(e,t,n){var r=Lm(e,"indices","scatterND","int32"),i=Lm(t,"updates","scatterND");return hy(i,r,n),Sv.runKernelFunc((function(e){return e.scatterND(r,i,n)}),{indices:r,updates:i},null,"ScatterNd",{shape:n})}}),CC=Qm({fft_:function(e){vp("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return Sv.runKernelFunc((function(e){return e.fft(n)}),{input:e}).reshape(e.shape)}}),EC=Qm({ifft_:function(e){vp("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+e.dtype+"."}));var t=e.shape[e.shape.length-1],n=e.as2D(e.size/t,t);return Sv.runKernelFunc((function(e){return e.ifft(n)}),{input:e}).reshape(e.shape)}}),SC=Qm({rfft_:function(e,t){vp("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got "+e.dtype}));var n,r=e.shape[e.shape.length-1],i=e.size/r;if(null!=t&&t<r){var o=e.shape.map((function(e){return 0})),a=e.shape.map((function(e){return e}));a[e.shape.length-1]=t,n=e.slice(o,a),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=e.concat(sg(s),e.shape.length-1),r=t}else n=e;var u=n.zerosLike(),c=Ym(n,u).as2D(i,r),l=CC(c),h=Math.floor(r/2)+1,f=$m(l),d=Zm(l),p=f.split([h,r-h],f.shape.length-1),v=d.split([h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,Ym(p[0],v[0]).reshape(m)}}),IC=Qm({irfft_:function(e){var t=e.shape[e.shape.length-1],n=e.size/t;if(t<=2){var r=e.as2D(n,t),i=EC(r);return $m(i)}var o=[n,2*(t-1)],a=$m(e).as2D(n,t),s=Zm(e).as2D(n,t),u=a.slice([0,1],[n,t-2]).reverse(1),c=s.slice([0,1],[n,t-2]).reverse(1).mul(tg(-1)),l=a.concat(u,1),h=s.concat(c,1);return r=Ym(l,h).as2D(o[0],o[1]),i=EC(r),$m(i)}}),RC=Object.freeze({fft:CC,ifft:EC,rfft:SC,irfft:IC}),TC=Qm({sparseToDense_:function(e,t,n,r){void 0===r&&(r=0);var i=Lm(e,"sparseIndices","sparseToDense","int32"),o=Lm(t,"sparseValues","sparseToDense"),a=Lm(r,"defaultValue","sparseToDense",o.dtype);return function(e,t,n,r){if("int32"!==e.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+e.shape+".");var i=e.rank>0?e.shape[0]:1,o=e.rank>1?e.shape[1]:1;if(n.length!==o)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+o+".");if(0!==t.rank&&(1!==t.rank||t.size!==i))throw new Error("sparseValues has incorrect shape "+t.shape+", should be [] or ["+i+"]");if(t.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(i,o,n,a),Sv.runKernelFunc((function(e){return e.sparseToDense(i,o,n,a)}),{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),AC=Qm({gatherND_:function(e,t){var n=Lm(t,"indices","gatherND","int32"),r=Lm(e,"x","gatherND");return Sv.runKernelFunc((function(e){return e.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),DC=Qm({diag_:function(e){var t=Lm(e,"x","diag").flatten(),n=e.shape.concat(e.shape);return Sv.runKernelFunc((function(e){return e.diag(t)}),{$x:t}).reshape(n)}}),NC=Qm({dropout_:function(e,t,n,r){var i=Lm(e,"x","dropout");if(vp("float32"===i.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),vp(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got "+t+"."})),0===t)return e instanceof cv?i.clone():i;var o=function(e,t){if(null==t)return e.shape.slice();if(_p(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)n.push(null==t[r]&&null!=e.shape[r]?e.shape[r]:t[r]);return n}return t}(i,n),a=1-t,s=Qg(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function OC(e,t,n){for(var r=1-e%2,i=new Float32Array(e),o=0;o<e;++o){var a=2*Math.PI*o/(e+r-1);i[o]=t-n*Math.cos(a)}return ng(i,"float32")}var FC,PC=Qm({hannWindow_:function(e){return OC(e,.5,.5)}}),MC=Qm({hammingWindow_:function(e){return OC(e,.54,.46)}}),LC=Qm({frame_:function(e,t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=0);for(var o=0,a=[];o+t<=e.size;)a.push(Gk(e,o,t)),o+=n;if(r)for(;o<e.size;){var s=o+t-e.size,u=fg([Gk(e,o,t-s),ug([s],i)]);a.push(u),o+=n}return 0===a.length?rg([],[0,t]):fg(a).as2D(a.length,t)}}),BC=Qm({stft_:function(e,t,n,r,i){void 0===i&&(i=PC),null==r&&(r=Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2)))));for(var o=LC(e,t,n),a=Xx(o,i(t)),s=[],u=0;u<o.shape[0];u++)s.push(SC(a.slice([u,0],[1,t]),r));return fg(s)}}),UC=Object.freeze({hannWindow:PC,hammingWindow:MC,frame:LC,stft:BC});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(FC||(FC={}));var WC=Qm({absoluteDifference_:function(e,t,n,r){void 0===r&&(r=FC.SUM_BY_NONZERO_WEIGHTS);var i=Lm(e,"labels","absoluteDifference"),o=Lm(t,"predictions","absoluteDifference"),a=null;null!=n&&(a=Lm(n,"weights","absoluteDifference")),mp(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return zC(s,a,r)}}),zC=Qm({computeWeightedLoss_:function(e,t,n){void 0===n&&(n=FC.SUM_BY_NONZERO_WEIGHTS);var r=Lm(e,"losses","computeWeightedLoss"),i=null;null!=t&&(i=Lm(t,"weights","computeWeightedLoss"));var o=null==i?r:r.mul(i);if(n===FC.NONE)return o;if(n===FC.SUM)return o.sum();if(n===FC.MEAN){if(null==i)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(tg(a)):s}if(n===FC.SUM_BY_NONZERO_WEIGHTS){if(null==i)return o.sum().div(tg(r.size));var u=i.mul(ag(r.shape)).notEqual(tg(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+n)}}),VC=Qm({cosineDistance_:function(e,t,n,r,i){void 0===i&&(i=FC.SUM_BY_NONZERO_WEIGHTS);var o=Lm(e,"labels","cosineDistance"),a=Lm(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Lm(r,"weights","cosineDistance")),mp(o.shape,a.shape,"Error in cosineDistance: ");var u=tg(1).sub(o.mul(a).sum(n,!0));return zC(u,s,i)}}),jC=Qm({hingeLoss_:function(e,t,n,r){void 0===r&&(r=FC.SUM_BY_NONZERO_WEIGHTS);var i=Lm(e,"labels","hingeLoss"),o=Lm(t,"predictions","hingeLoss"),a=null;null!=n&&(a=Lm(n,"weights","hingeLoss")),mp(i.shape,o.shape,"Error in hingeLoss: ");var s=tg(1);i=tg(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return zC(u,a,r)}}),HC=Qm({huberLoss_:function(e,t,n,r,i){void 0===r&&(r=1),void 0===i&&(i=FC.SUM_BY_NONZERO_WEIGHTS);var o=Lm(e,"labels","huberLoss"),a=Lm(t,"predictions","huberLoss"),s=null;null!=n&&(s=Lm(n,"weights","huberLoss")),mp(o.shape,a.shape,"Error in huberLoss: ");var u=tg(r),c=a.sub(o).abs(),l=Hx(c,u),h=c.sub(l),f=tg(.5).mul(l.square()).add(u.mul(h));return zC(f,s,i)}}),qC=Qm({logLoss_:function(e,t,n,r,i){void 0===r&&(r=1e-7),void 0===i&&(i=FC.SUM_BY_NONZERO_WEIGHTS);var o=Lm(e,"labels","logLoss"),a=Lm(t,"predictions","logLoss"),s=null;null!=n&&(s=Lm(n,"weights","logLoss")),mp(o.shape,a.shape,"Error in logLoss: ");var u=tg(1),c=tg(r),l=o.mul(a.add(c).log()).neg().sub(u.sub(o).mul(u.sub(a).add(c).log()));return zC(l,s,i)}}),GC=Qm({meanSquaredError_:function(e,t,n,r){void 0===r&&(r=FC.SUM_BY_NONZERO_WEIGHTS);var i=Lm(e,"labels","meanSquaredError"),o=Lm(t,"predictions","meanSquaredError"),a=null;null!=n&&(a=Lm(n,"weights","meanSquaredError")),mp(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return zC(s,a,r)}}),KC=Qm({sigmoidCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=FC.SUM_BY_NONZERO_WEIGHTS);var o=Lm(e,"multiClassLabels","sigmoidCrossEntropy"),a=Lm(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Lm(n,"weights","sigmoidCrossEntropy")),mp(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=tg(r),c=tg(1),l=tg(.5);o=o.mul(c.sub(u)).add(l.mul(u))}var h=function(e,t){var n=Lm(e,"labels","sigmoidCrossEntropyWithLogits"),r=Lm(t,"logits","sigmoidCrossEntropyWithLogits");mp(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var i=r.relu(),o=r.mul(n),a=r.abs().neg().exp().log1p();return i.sub(o).add(a)}(o,a);return zC(h,s,i)}}),XC=Qm({softmaxCrossEntropy_:function(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=FC.SUM_BY_NONZERO_WEIGHTS);var o=Lm(e,"onehotLabels","softmaxCrossEntropy"),a=Lm(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Lm(n,"weights","softmaxCrossEntropy")),mp(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=tg(r),c=tg(1),l=tg(o.shape[1]);o=o.mul(c.sub(u)).add(u.div(l))}var h=function(e,t,n){if(void 0===n&&(n=-1),-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+t.rank+" and dim was "+n);return _y((function(e,t,r){var i=t.logSumExp([n],!0),o=t.toFloat().sub(i);return r([e,o]),{value:o.mul(e).neg().sum([n]),gradFunc:function(e,t){var r=t[0],i=t[1],o=Vm(e.shape,[n]);return[e.reshape(o).mul(r.toFloat().sub(i.exp())),e.reshape(o).mul(i.exp().sub(r.toFloat()))]}}}))(e,t)}(o,a);return zC(h,s,i)}}),QC=Object.freeze({get Reduction(){return FC},absoluteDifference:WC,computeWeightedLoss:zC,cosineDistance:VC,hingeLoss:jC,huberLoss:HC,logLoss:qC,meanSquaredError:GC,sigmoidCrossEntropy:KC,softmaxCrossEntropy:XC});function YC(e,t){return void 0===t&&(t=!1),Sv.tidy((function(){if(2!==e.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+e.shape.length+"D Tensor.");for(var n=e.shape[0],r=e.shape[1],i=Bg(n),o=e.clone(),a=rg([[1]],[1,1]),s=a.clone(),u=n>=r?r:n,c=function(e){var t,u=o,c=s,l=i;t=Sv.tidy((function(){var t=o.slice([e,e],[n-e,1]),u=t.norm(),c=o.slice([e,e],[1,1]),l=rg([[-1]]).where(c.greater(0),rg([[1]])),h=c.sub(l.mul(u)),f=t.div(h);s=1===f.shape[0]?a.clone():a.concat(f.slice([1,0],[f.shape[0]-1,f.shape[1]]),0);var d=l.matMul(h).div(u).neg(),p=o.slice([e,0],[n-e,r]),v=d.mul(s);if(0===e)o=p.sub(v.matMul(s.transpose().matMul(p)));else{var m=p.sub(v.matMul(s.transpose().matMul(p)));o=o.slice([0,0],[e,r]).concat(m,0)}var g=i.slice([0,e],[n,i.shape[1]-e]);if(0===e)i=g.sub(g.matMul(s).matMul(v.transpose()));else{var y=g.sub(g.matMul(s).matMul(v.transpose()));i=i.slice([0,0],[n,e]).concat(y,1)}return[s,o,i]})),s=t[0],o=t[1],i=t[2],Om([u,c,l])},l=0;l<u;++l)c(l);return!t&&n>r&&(i=i.slice([0,0],[n,r]),o=o.slice([0,0],[r,r])),[i,o]}))}var $C=Qm({bandPart_:function(e,t,n){if(t%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+t+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=Lm(e,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(t<=a))throw new Error("bandPart(): numLower ("+t+") must not be greater than the number of rows ("+a+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");t<0&&(t=a),n<0&&(n=s);var u=cg(0,a,1,"int32").reshape([-1,1]),c=cg(0,s,1,"int32"),l=Jx(u,c),h=Rx(l.lessEqual(tg(+t,"int32")),l.greaterEqual(tg(-n,"int32"))),f=sg([a,s],r.dtype);return Jg(ny(r.reshape([-1,a,s])).map((function(e){return Nx(h,e,f)}))).reshape(i)}}),ZC=Qm({gramSchmidt_:function(e){var t;if(Array.isArray(e)){t=!1,vp(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){vp(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+e[t].shape[0]+" vs. "+n+")"}))},i=1;i<e.length;++i)r(i)}else t=!0,e=gg(e,e.shape[0],0).map((function(e){return Zg(e,[0])}));vp(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+e.length+") exceeds number of dimensions ("+e[0].shape[0]+")."}));var o=[],a=e,s=function(e){o.push(Sv.tidy((function(){var t=a[e];if(e>0)for(var n=0;n<e;++n){var r=sC(o[n].mulStrict(t)).mul(o[n]);t=t.sub(r)}return t.div(gC(t,"euclidean"))})))};for(i=0;i<e.length;++i)s(i);return t?Jg(o,0):o}}),JC=Qm({qr_:function(e,t){if(void 0===t&&(t=!1),e.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+e.rank);if(2===e.rank)return YC(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=ny(e.reshape([n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),i=[],o=[];return r.forEach((function(e){var n=YC(e,t),r=n[1];i.push(n[0]),o.push(r)})),[Jg(i,0).reshape(e.shape),Jg(o,0).reshape(e.shape)]}}),eE=Object.freeze({bandPart:$C,gramSchmidt:ZC,qr:JC});function tE(e,t,n,r,i,o){null==r&&(r=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==o&&(o=0);var a=e.shape[0];return n=Math.min(n,a),vp(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),vp(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+e.rank+"'"})),vp(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+e.shape[1]})),vp(1===t.rank,(function(){return"scores must be a 1D tensor"})),vp(t.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+t.shape[0]})),vp(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var nE=Qm({resizeBilinear_:function(e,t,n){void 0===n&&(n=!1);var r=Lm(e,"images","resizeBilinear");vp(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),vp(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+t+"."}));var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=Sv.runKernelFunc((function(e,t){return t([i]),e.resizeBilinear(i,a,s,n)}),{x:i},(function(e,t){return{x:function(){return Sv.runKernelFunc((function(r){return r.resizeBilinearBackprop(e,t[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),rE=Qm({resizeNearestNeighbor_:function(e,t,n){void 0===n&&(n=!1);var r=Lm(e,"images","resizeNearestNeighbor");vp(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),vp(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+t+"."})),vp("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,o=!1;3===r.rank&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=t[0],s=t[1],u=Sv.runKernelFunc((function(e,t){return t([i]),e.resizeNearestNeighbor(i,a,s,n)}),{batchImages:i},(function(e,t){return{batchImages:function(){return Sv.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(e,t[0],n)}),{})}}}));return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),iE=Qm({nonMaxSuppression_:function(e,t,n,r,i){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY);var o=Lm(e,"boxes","nonMaxSuppression"),a=Lm(t,"scores","nonMaxSuppression"),s=tE(o,a,n,r,i);return Sv.runKernelFunc((function(e){return e.nonMaxSuppression(o,a,n,r,i)}),{boxes:o,scores:a},null,"NonMaxSuppressionV3",{maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:i=s.scoreThreshold})}}),oE=Qm({nonMaxSuppressionWithScore_:function(e,t,n,r,i,o){void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0);var a=Lm(e,"boxes","nonMaxSuppression"),s=Lm(t,"scores","nonMaxSuppression"),u=tE(a,s,n,r,i,o),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},l=Sv.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),aE=Qm({cropAndResize_:function(e,t,n,r,i,o){var a=Lm(e,"image","cropAndResize"),s=Lm(t,"boxes","cropAndResize","float32"),u=Lm(n,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var c=s.shape[0];return vp(4===a.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),vp(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),vp(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),vp(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),vp(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),vp("bilinear"===i||"nearest"===i,(function(){return"method must be bilinear or nearest, but was "+i})),Sv.runKernelFunc((function(e,t){return e.cropAndResize(a,s,u,r,i,o)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),sE=Object.freeze({resizeBilinear:nE,resizeNearestNeighbor:rE,nonMaxSuppression:iE,nonMaxSuppressionAsync:function(e,t,n,r,i){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),Zd(this,void 0,void 0,(function(){var o,a,s,u,c;return Jd(this,(function(l){switch(l.label){case 0:return o=Lm(e,"boxes","nonMaxSuppressionAsync"),a=Lm(t,"scores","nonMaxSuppressionAsync"),s=tE(o,a,n,r,i),n=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=l.sent(),c=Yy(u[0],u[1],n,r,i),o!==e&&o.dispose(),a!==t&&a.dispose(),[2,c]}}))}))},nonMaxSuppressionWithScore:oE,nonMaxSuppressionWithScoreAsync:function(e,t,n,r,i,o){return void 0===r&&(r=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===o&&(o=0),Zd(this,void 0,void 0,(function(){var a,s,u,c,l;return Jd(this,(function(h){switch(h.label){case 0:return a=Lm(e,"boxes","nonMaxSuppressionAsync"),s=Lm(t,"scores","nonMaxSuppressionAsync"),u=tE(a,s,n,r,i,o),n=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return c=h.sent(),l=$y(c[0],c[1],n,r,i,o),a!==e&&a.dispose(),s!==t&&s.dispose(),[2,l]}}))}))},cropAndResize:aE}),uE=function(e,t){return!(e>0)||"linear"===t},cE=function(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return e.mul(t.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},lE=function(e,t){var n=t,r=Iy(e.shape,t.shape);return r.length>0&&(n=n.sum(r)),n.reshape(e.shape)},hE=function(e,t,n){if("linear"===t)return e;if("relu"===t)return fC(e);if("elu"===t)return cC(e);if("relu6"===t)return dC(e);if("prelu"===t)return hC(e,n);throw new Error("Unknown fused activation "+t+".")},fE=Qm({fusedMatMul_:function(e){var t,n=e.a,r=e.b,i=e.transposeA,o=void 0!==i&&i,a=e.transposeB,s=void 0!==a&&a,u=e.bias,c=e.activation,l=void 0===c?"linear":c,h=e.preluActivationWeights;if(!1===uE(Sv.state.gradientDepth,l)){var f=Dk(n,r,o,s);return null!=u&&(f=Fx(f,u)),hE(f,l,h)}var d=Lm(n,"a","fused matMul"),p=Lm(r,"b","fused matMul");t=_v(d,p),d=t[0],p=t[1];var v=o?d.shape[d.rank-2]:d.shape[d.rank-1],m=s?p.shape[p.rank-1]:p.shape[p.rank-2],g=o?d.shape[d.rank-1]:d.shape[d.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],b=d.shape.slice(0,-2),_=p.shape.slice(0,-2),w=bp(b),x=bp(_);vp(d.rank>=2&&p.rank>=2&&d.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+d.rank+" and "+p.rank+"."})),vp(_p(b,_),(function(){return"Error in fused matMul: outer dimensions ("+b+") and ("+_+") of Tensors with shapes "+d.shape+" and "+p.shape+" must match."})),vp(v===m,(function(){return"Error in fused matMul: inner shapes ("+v+") and ("+m+") of Tensors with shapes "+d.shape+" and "+p.shape+" and transposeA="+o+" and transposeB="+s+" must match."}));var k,C,E=d.shape.slice(0,-2).concat([g,y]),S=o?d.as3D(w,v,g):d.as3D(w,g,v),I=s?p.as3D(x,y,m):p.as3D(x,m,y);null!=u&&Ry(E,(k=_v(k=Lm(u,"bias","fused matMul"),d)[0]).shape),null!=h&&(C=Lm(h,"prelu weights","fused matMul"));var R={a:S,b:I};return null!=u&&(R.bias=k),null!=h&&(R.preluActivationWeights=C),Sv.runKernelFunc((function(e,t){var n=e.fusedBatchMatMul({a:S,b:I,transposeA:o,transposeB:s,bias:k,activation:l,preluActivationWeights:C});return t([S,I,n]),n}),R,(function(e,t){var n=t[0],r=t[1],i=cE(e,t[2],l),a={};return null!=u&&(a={bias:function(){return lE(k,i)}}),Object.assign(o||s?!o&&s?{a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}}:o&&!s?{a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}}:{a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}}:{a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},a)}),"_FusedMatMul",{transposeA:o,transposeB:s,activation:l},[S,I],[!0]).reshape(E)}}),dE=Qm({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,o=e.dataFormat,a=void 0===o?"NHWC":o,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,f=void 0===h?"linear":h,d=e.preluActivationWeights;if(!1===uE(Sv.state.gradientDepth,f=f||"linear")){var p=wk(t,n,r,i,a,u,c);return null!=l&&(p=Fx(p,l)),hE(p,f,d)}var v=Lm(t,"x","conv2d"),m=Lm(n,"filter","conv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),vp(4===g.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+g.rank+"."})),vp(4===m.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+m.rank+"."})),null!=c&&vp(wp(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+i+"."})),vp(g.shape[3]===m.shape[2],(function(){return"Error in conv2d: depth of input ("+g.shape[3]+") must match input depth for filter "+m.shape[2]+"."})),vp(Uy(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),vp("NHWC"===a,(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var b,_,w=Dy(g.shape,m.shape,r,u,i,c);null!=l&&(b=_v(b=Lm(l,"bias","fused conv2d"),v)[0],Ry(w.outShape,b.shape)),null!=d&&(_=Lm(d,"prelu weights","fused conv2d"));var x={x:g,filter:m};null!=l&&(x.bias=b),null!=d&&(x.preluActivationWeights=_);var k=Sv.runKernelFunc((function(e,t){var n=e.fusedConv2d({input:g,filter:m,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return t([m,g,n]),n}),x,(function(e,t){var n=t[0],o=t[1],a=cE(e,t[2],f);vp(By(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var s={};return null!=l&&(s={bias:function(){return lE(b,a)}}),Object.assign({x:function(){return Ck(o.shape,a,n,r,i)},filter:function(){return kk(o,a,n.shape,r,i)}},s)}),"FusedConv2D",{convInfo:w,activation:f},[m,g],[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),pE=Qm({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,i=e.pad,o=e.dataFormat,a=void 0===o?"NHWC":o,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,f=void 0===h?"linear":h,d=e.preluActivationWeights;if(!1===uE(Sv.state.gradientDepth,f)){var p=Ek(t,n,r,i,a,u,c);return null!=l&&(p=Fx(p,l)),hE(p,f,d)}var v=Lm(t,"x","depthwiseConv2d"),m=Lm(n,"filter","depthwiseConv2d"),g=v,y=!1;3===v.rank&&(y=!0,g=v.as4D(1,v.shape[0],v.shape[1],v.shape[2])),vp(4===g.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+g.rank+"."})),vp(4===m.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+m.rank+"."})),vp(g.shape[3]===m.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+g.shape[3]+") must match the inChannels dimension in filter "+m.shape[2]+"."})),null==u&&(u=[1,1]),vp(Uy(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&vp(wp(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+i+"."}));var b,_,w=Dy(g.shape,m.shape,r,u,i,c,!0);null!=l&&(b=_v(b=Lm(l,"bias","fused conv2d"),v)[0],Ry(w.outShape,b.shape)),null!=d&&(_=Lm(d,"prelu weights","fused depthwiseConv2d"));var x={x:g,filter:m};null!=l&&(x.bias=b),null!=d&&(x.preluActivationWeights=_);var k=Sv.runKernelFunc((function(e,t){var n=e.fusedDepthwiseConv2D({input:g,filter:m,convInfo:w,bias:b,activation:f,preluActivationWeights:_});return t([m,g,n]),n}),x,(function(e,t){vp(By(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=t[0],r=t[1],i=cE(e,t[2],f),o={};return null!=l&&(o={bias:function(){return lE(b,i)}}),Object.assign({x:function(){return Sk(r.shape,i,n,w)},filter:function(){return Ik(r,i,n.shape,w)}},o)}),"FusedDepthwiseConv2D",{convInfo:w,activation:f},[m,g],[!0]);return y?k.as3D(k.shape[1],k.shape[2],k.shape[3]):k}}),vE=Object.freeze({matMul:fE,conv2d:dE,depthwiseConv2d:pE}),mE=Object.freeze({image:sE,linalg:eE,losses:QC,spectral:RC,fused:vE,signal:UC,square:Dw,squaredDifference:Ow,conv1d:_k,conv2d:wk,conv3d:xk,depthwiseConv2d:Ek,separableConv2d:Rk,conv2dTranspose:Tk,conv3dTranspose:Ak,op:Qm,batchNormalization2d:_x,batchNormalization3d:wx,batchNormalization4d:xx,batchNormalization:kx,batchNorm:Cx,batchNorm2d:Ex,batchNorm3d:Sx,batchNorm4d:Ix,booleanMaskAsync:function(e,t,n){return Zd(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l,h,f,d,p,v;return Jd(this,(function(m){switch(m.label){case 0:for(r=Lm(e,"tensor","boolMask"),i=Lm(t,"mask","boolMask","bool"),o=null==n?0:n,s=r.shape,vp((a=i.rank)>0,(function(){return"mask cannot be scalar"})),mp(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,c=o;c<o+a;c++)u*=s[c];return l=s.slice(0,o).concat([u],s.slice(o+a)),h=r.reshape(l),f=i.reshape([-1]),[4,Ox(f)];case 1:return d=m.sent(),p=d.squeeze([1]),v=vk(h,p,o),e!==r&&r.dispose(),t!==i&&i.dispose(),p.dispose(),h.dispose(),f.dispose(),d.dispose(),[2,v]}}))}))},complex:Ym,real:$m,imag:Zm,concat:fg,concat1d:dg,concat2d:pg,concat3d:vg,concat4d:mg,split:gg,matMul:Dk,dot:Nk,outerProduct:Ok,reverse:Fk,reverse1d:Pk,reverse2d:Mk,reverse3d:Lk,reverse4d:Bk,maxPool:zk,avgPool:Vk,pool:jk,maxPool3d:Hk,avgPool3d:qk,slice:Gk,slice1d:Kk,slice2d:Xk,slice3d:Qk,slice4d:Yk,abs:Fw,acos:Pw,acosh:Mw,asin:Lw,asinh:Bw,atan:Uw,atanh:Ww,ceil:zw,clipByValue:Vw,cos:jw,cosh:Hw,erf:qw,exp:Gw,expm1:Kw,floor:Xw,log:Qw,log1p:Yw,logSigmoid:$w,neg:Zw,reciprocal:Jw,round:ex,rsqrt:tx,sigmoid:nx,sign:rx,isNaN:ix,isInf:ox,isFinite:ax,sin:sx,sinh:ux,softplus:cx,sqrt:lx,step:hx,tan:fx,tanh:dx,all:Zk,any:Jk,argMax:eC,argMin:tC,logSumExp:nC,max:rC,mean:iC,min:oC,moments:aC,sum:sC,prod:uC,equal:tk,equalStrict:nk,greater:rk,greaterEqual:ik,greaterEqualStrict:ok,greaterStrict:ak,less:sk,lessEqual:uk,lessEqualStrict:ck,lessStrict:lk,notEqual:hk,notEqualStrict:fk,add:Fx,addN:Px,addStrict:Mx,atan2:Lx,div:Bx,divNoNan:Ux,divStrict:Wx,floorDiv:zx,maximum:Vx,maximumStrict:jx,minimum:Hx,minimumStrict:qx,mod:Gx,modStrict:Kx,mul:Xx,mulStrict:Qx,pow:Yx,powStrict:$x,squaredDifferenceStrict:Zx,sub:Jx,subStrict:ek,elu:cC,leakyRelu:lC,prelu:hC,relu:fC,relu6:dC,selu:pC,logicalAnd:Rx,logicalNot:Tx,logicalOr:Ax,logicalXor:Dx,where:Nx,whereAsync:Ox,buffer:Ag,print:function(e,t){void 0===t&&(t=!1),console.log(e.toString(t))},batchToSpaceND:Dg,broadcastTo:Ng,cast:Og,clone:Fg,cumsum:Pg,depthToSpace:Mg,expandDims:Lg,eye:Bg,multinomial:Ug,oneHot:Wg,pad:zg,pad1d:Vg,pad2d:jg,pad3d:Hg,pad4d:qg,rand:Gg,randomNormal:Kg,randomGamma:Xg,randomUniform:Qg,reshape:Yg,spaceToBatchND:$g,squeeze:Zg,stack:Jg,tile:ey,truncatedNormal:ty,unstack:ny,setdiff1dAsync:function(e,t){return Zd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,h;return Jd(this,(function(f){switch(f.label){case 0:return n=Lm(e,"x","setdiff1d"),r=Lm(t,"y","setdiff1d"),vp(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),vp(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),vp(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,l=0;l<i.length;l++)a.has(i[l])||s++;for(u=new ov([s],n.dtype),c=new ov([s],"int32"),l=0,h=0;l<i.length;l++)a.has(i[l])||(u.values[h]=i[l],c.values[h]=l,h++);return[2,[u.toTensor(),c.toTensor()]]}}))}))},fill:ug,linspace:function(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");return Sv.runKernelFunc((function(r){return r.linspace(e,t,n)}),{})},ones:ag,range:cg,scalar:tg,tensor:Jm,tensor1d:ng,tensor2d:rg,tensor3d:ig,tensor4d:og,tensor5d:function(e,t,n){if(gp(e),null!=t&&5!==t.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Pm(e,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return eg(e,t,r,n)},tensor6d:function(e,t,n){if(gp(e),null!=t&&6!==t.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Pm(e,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return eg(e,t=t||r,r,n)},variable:function(e,t,n,r){return void 0===t&&(t=!0),Sv.makeVariable(e,t,n,r)},zeros:sg,onesLike:lg,zerosLike:hg,transpose:vC,softmax:wy,logSoftmax:xy,localResponseNormalization:mC,norm:gC,gather:vk,unsortedSegmentSum:mk,basicLSTMCell:yC,multiRNNCell:bC,movingAverage:_C,stridedSlice:wC,topk:xC,scatterND:kC,fft:CC,ifft:EC,rfft:SC,irfft:IC,sparseToDense:TC,gatherND:AC,diag:DC,dropout:NC,hannWindow:PC,hammingWindow:MC,frame:LC,stft:BC,inTopKAsync:function(e,t,n){return void 0===n&&(n=1),Zd(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l,h,f,d,p,v,m;return Jd(this,(function(g){switch(g.label){case 0:return r=Lm(e,"predictions","inTopK"),i=Lm(t,"targets","inTopK"),vp(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),vp(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),mp(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],vp(n>0&&n<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+n})),[4,r.data()];case 1:return a=g.sent(),[4,i.data()];case 2:for(s=g.sent(),l=(u=[a.length/o,o])[1],h=Tp("bool",c=u[0]),f=0;f<c;f++){for(p=a.subarray(d=f*l,d+l),v=[],m=0;m<p.length;m++)v.push({value:p[m],index:m});for(v.sort((function(e,t){return t.value-e.value})),h[f]=0,m=0;m<n;m++)if(v[m].index===s[f]){h[f]=1;break}}return e!==r&&r.dispose(),t!==i&&i.dispose(),[2,Jm(h,i.shape,"bool")]}}))}))}});function gE(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&vp("complex64"!==e.dtype,(function(){return t+" does not support complex64 tensors."}))}))}function yE(e,t,n,r){if("linear"===n)return e.linear(t);if("relu"===n)return e.relu(t);if("elu"===n)return e.elu(t);if("relu6"===n)return e.relu6(t);if("prelu"===n)return e.prelu(t,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var bE=function(e){function t(){var t=e.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new ky(t,Sv),t}return $d(t,e),t.prototype.write=function(e,t,n){this.firstUse&&(this.firstUse=!1,np().get("IS_NODE")&&Fm("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n}),r},t.prototype.move=function(e,t,n,r){this.data.set(e,{values:t,dtype:r})},t.prototype.numDataIds=function(){return this.data.numDataIds()},t.prototype.read=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){return[2,this.readSync(e)]}))}))},t.prototype.readSync=function(e){var t=this.data.get(e),n=t.complexTensors;return"complex64"===t.dtype?Hy(this.readSync(n.real.dataId),this.readSync(n.imag.dataId)):this.data.get(e).values},t.prototype.bufferSync=function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return $p(e)}))}catch(e){throw new Error("Failed to decode encoded string bytes into utf-8")}return Ag(e.shape,e.dtype,n)},t.prototype.makeOutput=function(e,t,n){var r=this.write(e,t,n);return Sv.makeTensorFromDataId(r,t,n,this)},t.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;null!=t&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},t.prototype.time=function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){return t=Xp(),e(),[2,{kernelMs:Xp()-t}]}))}))},t.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},t.prototype.complex=function(e,t){var n=this.makeOutput(null,e.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:Sv.keep(e.clone()),imag:Sv.keep(t.clone())},n},t.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},t.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},t.prototype.slice=function(e,t,n){if(gE(e,"slice"),yy(e.shape,t,n)){var r=by(t,e.strides),i=bp(n);return Jm(this.readSync(e.dataId).subarray(r,r+i),n,e.dtype)}for(var o=Ag(n,e.dtype),a=this.bufferSync(e),s=0;s<o.size;++s){var u=o.indexToLoc(s).map((function(e,n){return e+t[n]}));o.values[s]=a.get.apply(a,u)}return o.toTensor()},t.prototype.stridedSlice=function(e,t,n,r){gE(e,"stridedSlice");var i=vy(t,n,r);if(i.some((function(e){return 0===e})))return Jm([],i);for(var o=Ag(i,e.dtype),a=this.bufferSync(e),s=0;s<o.size;s++){for(var u=o.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+t[l];o.set.apply(o,[a.get.apply(a,c)].concat(u))}return o.toTensor()},t.prototype.diag=function(e){for(var t=this.readSync(e.dataId),n=Ag([e.size,e.size],e.dtype),r=n.values,i=0;i<t.length;i++)r[i*e.size+i]=t[i];return n.toTensor()},t.prototype.unstack=function(e,t){for(var n=e.shape[t],r=new Array(e.rank-1),i=0,o=0;o<e.rank;o++)o!==t&&(r[i++]=e.shape[o]);var a=new Array(e.rank).fill(0),s=e.shape.slice();s[t]=1;var u=new Array(n);for(o=0;o<u.length;o++)a[t]=o,u[o]=this.slice(e,a,s).reshape(r);return u},t.prototype.reverse=function(e,t){gE(e,"reverse");for(var n=Ag(e.shape,e.dtype),r=this.bufferSync(e),i=function(i){var o=n.indexToLoc(i),a=o.slice();t.forEach((function(t){return a[t]=e.shape[t]-1-a[t]})),n.set.apply(n,[r.get.apply(r,a)].concat(o))},o=0;o<n.size;o++)i(o);return n.toTensor()},t.prototype.concat=function(e,t){var n=this;if("complex64"===e[0].dtype){var r=e.map((function(e){return $m(e)})),i=e.map((function(e){return Zm(e)}));return Ym(this.concat(r,t),this.concat(i,t))}var o=e.map((function(e){var n=bp(e.shape.slice(t));return e.as2D(-1,n)})),a=Xm(o.map((function(e){return e.shape})),1),s=Ag(a,e[0].dtype).values;if(1===o[0].shape[0]){var u=0;o.forEach((function(e){s.set(n.readSync(e.dataId),u),u+=e.size}))}else{var c=0;o.forEach((function(e){for(var t=n.readSync(e.dataId),r=0,i=0;i<e.shape[0];++i)for(var o=i*a[1]+c,u=0;u<e.shape[1];++u)s[o+u]=t[r++];c+=e.shape[1]}))}var l=Xm(e.map((function(e){return e.shape})),t);return Jm(s,l,e[0].dtype)},t.prototype.neg=function(e){return gE(e,"neg"),this.multiply(tg(-1),e)},t.prototype.add=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e+n,imag:t+r}})):this.broadcastedBinaryOp(e,t,yv(e.dtype,t.dtype),(function(e,t){return e+t}))},t.prototype.addN=function(e){var t=this;gE(e,"addN");for(var n=e.map((function(e){return t.readSync(e.dataId)})),r=Ag(e[0].shape,e[0].dtype),i=r.values,o=0;o<e.length;o++)for(var a=n[o],s=0;s<i.length;s++)i[s]+=a[s];return r.toTensor()},t.prototype.softmax=function(e,t){var n=Ip([t],e.shape),r=this.max(e,n),i=Vm(r.shape,n),o=this.subtract(e,r.reshape(i)),a=this.exp(o),s=this.sum(a,n).reshape(i);return this.realDivide(a,s)},t.prototype.subtract=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e-n,imag:t-r}})):this.broadcastedBinaryOp(e,t,yv(e.dtype,t.dtype),(function(e,t){return e-t}))},t.prototype.pow=function(e,t){return gE([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.pow(e,t)}))},t.prototype.batchMatMul=function(e,t,n,r){gE([e,t],"matMul");for(var i=n?e.shape[1]:e.shape[2],o=n?e.shape[2]:e.shape[1],a=r?t.shape[1]:t.shape[2],s=e.shape[0],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],h=l[0],f=l[1],d=l[2],p=r?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=p[0],m=p[1],g=p[2],y=o*a,b=Ag([s,o,a],e.dtype),_=b.values,w=this.blockSize,x=0;x<s;x++)for(var k=0;k<o;k+=w)for(var C=0;C<a;C+=w)for(var E=0;E<i;E+=w)for(var S=Math.min(k+w,o),I=Math.min(C+w,a),R=Math.min(E+w,i),T=k;T<S;T++)for(var A=C;A<I;A++){for(var D=0,N=E;N<R;N++)D+=u[x*h+T*f+N*d]*c[N*v+A*m+x*g];_[x*y+(T*a+A)]+=D}return b.toTensor()},t.prototype.fusedBatchMatMul=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.batchMatMul(e.a,e.b,e.transposeA,e.transposeB);return t&&(i=this.add(i,t)),n&&(i=yE(this,i,n,r)),i},t.prototype.multiply=function(e,t){return"complex64"===e.dtype||"complex64"===t.dtype?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),(function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})):this.broadcastedBinaryOp(e,t,yv(e.dtype,t.dtype),(function(e,t){return e*t}))},t.prototype.realDivide=function(e,t){return gE([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",(function(e,t){return e/t}))},t.prototype.floorDiv=function(e,t){return gE([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",(function(e,t){return Math.floor(e/t)}))},t.prototype.sum=function(e,t){gE(e,"sum"),jm("sum",t,e.rank);for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],yv(e.dtype,"int32")),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=0,h=0;h<o;++h)l+=s[c+h];a[u]=l}return i},t.prototype.prod=function(e,t){gE(e,"sum");for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],yv(e.dtype,"int32")),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=1,h=0;h<o;++h)l*=s[c+h];a[u]=l}return i},t.prototype.unsortedSegmentSum=function(e,t,n){gE(e,"unsortedSegmentSum");for(var r=[],i=e.rank-t.rank,o=0;o<i;++o)t=t.expandDims(o+1);for(o=0;o<n;++o){var a=tg(o,"int32"),s=tk(a,t).asType("float32").mul(e).sum(0);r.push(s)}return Jg(r)},t.prototype.argMin=function(e,t){gE(e,"argMin");var n=[t];jm("argMin",n,e.rank);for(var r=zm(e.shape,n),i=r[1],o=sg(r[0],"int32"),a=bp(i),s=this.readSync(o.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],f=0,d=0;d<a;++d){var p=u[l+d];p<h&&(h=p,f=d)}s[c]=f}return o},t.prototype.argMax=function(e,t){gE(e,"argMax");var n=[t];jm("argMax",n,e.rank);for(var r=zm(e.shape,n),i=r[1],o=sg(r[0],"int32"),a=bp(i),s=this.readSync(o.dataId),u=this.readSync(e.dataId),c=0;c<s.length;++c){for(var l=c*a,h=u[l],f=0,d=0;d<a;++d){var p=u[l+d];p>h&&(h=p,f=d)}s[c]=f}return o},t.prototype.cumsum=function(e,t,n,r){if(gE(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var i=yv(e.dtype,"int32"),o=sg(e.shape,i),a=this.readSync(o.dataId),s=this.readSync(e.dataId),u=e.shape[e.rank-1],c=r?function(e,t){return e+u-t-1}:function(e,t){return e+t},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var f=c(l,h);if(0===h)a[f]=n?0:s[f];else{var d=c(l,h-1);a[f]=n?s[d]+a[d]:s[f]+a[d]}}return o},t.prototype.equal=function(e,t){return gE([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e===t?1:0}))},t.prototype.notEqual=function(e,t){return gE([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e!==t?1:0}))},t.prototype.less=function(e,t){return gE([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<t?1:0}))},t.prototype.lessEqual=function(e,t){return gE([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e<=t?1:0}))},t.prototype.greater=function(e,t){return gE([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>t?1:0}))},t.prototype.greaterEqual=function(e,t){return gE([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e>=t?1:0}))},t.prototype.logicalNot=function(e){gE(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)n[r]=t[r]?0:1;return this.makeOutput(n,e.shape,"bool")},t.prototype.logicalAnd=function(e,t){return gE([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e&&t}))},t.prototype.logicalOr=function(e,t){return gE([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",(function(e,t){return e||t}))},t.prototype.select=function(e,t,n){gE([e,t,n],"select");for(var r=this.readSync(e.dataId),i=this.readSync(t.dataId),o=this.readSync(n.dataId),a=sg(t.shape,yv(t.dtype,n.dtype)),s=this.readSync(a.dataId),u=0,c=0===e.rank||e.rank>1||1===t.rank?1:bp(t.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)s[u++]=1===r[l]?i[l]:o[l];return a},t.prototype.where=function(e){gE([e],"where");var t=this.readSync(e.dataId);return ob(e.shape,t)},t.prototype.topk=function(e,t,n){return gE(e,"topk"),ib(this.readSync(e.dataId),e.shape,e.dtype,t)},t.prototype.min=function(e,t){gE(e,"min"),jm("min",t,e.rank);for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],e.dtype),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=s[c],h=0;h<o;++h){var f=s[c+h];f<l&&(l=f)}a[u]=l}return i},t.prototype.minimum=function(e,t){return gE([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.min(e,t)}))},t.prototype.mod=function(e,t){return gE([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t}))},t.prototype.max=function(e,t){gE(e,"max"),jm("max",t,e.rank);for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],e.dtype),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=s[c],h=0;h<o;++h){var f=s[c+h];f>l&&(l=f)}a[u]=l}return i},t.prototype.maximum=function(e,t){return gE([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.max(e,t)}))},t.prototype.all=function(e,t){gE(e,"all"),jm("all",t,e.rank);for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],e.dtype),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=s[c],h=0;h<o;++h)l=l&&s[c+h];a[u]=l}return i},t.prototype.any=function(e,t){gE(e,"any"),jm("any",t,e.rank);for(var n=zm(e.shape,t),r=n[1],i=sg(n[0],e.dtype),o=bp(r),a=this.readSync(i.dataId),s=this.readSync(e.dataId),u=0;u<a.length;++u){for(var c=u*o,l=s[c],h=0;h<o;++h)l=l||s[c+h];a[u]=l}return i},t.prototype.squaredDifference=function(e,t){return gE([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){var n=e-t;return n*n}))},t.prototype.ceil=function(e){gE(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.ceil(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.floor=function(e){gE(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.floor(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sign=function(e){gE(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=t[r]<0?-1:t[r]>0?1:0;return this.makeOutput(n,e.shape,"float32")},t.prototype.isNaN=function(e){gE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isNaN(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isInf=function(e){gE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Math.abs(t[r])===1/0&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.isFinite=function(e){gE(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),r=0;r<t.length;++r)Number.isFinite(t[r])&&(n[r]=1);return this.makeOutput(n,e.shape,"bool")},t.prototype.round=function(e){gE(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r){var i=Math.floor(t[r]);n[r]=t[r]-i<.5?Math.floor(t[r]):t[r]-i>.5?Math.ceil(t[r]):i%2==0?i:i+1}return this.makeOutput(n,e.shape,"float32")},t.prototype.exp=function(e){gE(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.exp(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.expm1=function(e){gE(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.expm1(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log=function(e){gE(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.log1p=function(e){gE(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.log1p(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.sqrt=function(e){gE(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.rsqrt=function(e){gE(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/Math.sqrt(t[r]);return this.makeOutput(n,e.shape,"float32")},t.prototype.reciprocal=function(e){gE(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),r=0;r<t.length;++r)n[r]=1/t[r];return this.makeOutput(n,e.shape,"float32")},t.prototype.linear=function(e){return e},t.prototype.relu=function(e){gE(e,"relu");for(var t=sg(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.max(0,r[i]);return t},t.prototype.relu6=function(e){gE(e,"relu");for(var t=sg(e.shape,e.dtype),n=this.readSync(t.dataId),r=this.readSync(e.dataId),i=0;i<r.length;++i)n[i]=Math.min(Math.max(0,r[i]),6);return t},t.prototype.prelu=function(e,t){return gE([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return e<0?t*e:e}))},t.prototype.elu=function(e){gE(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?i:Math.exp(i)-1}return this.makeOutput(t,e.shape,"float32")},t.prototype.eluDer=function(e,t){gE([e,t],"eluDer");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<r.length;++o){var a=r[o];n[o]=a>=1?i[o]:i[o]*(a+1)}return this.makeOutput(n,t.shape,"float32")},t.prototype.selu=function(e){gE(e,"selu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=n[r];t[r]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(t,e.shape,"float32")},t.prototype.clip=function(e,t,n){gE(e,"clip");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>n?n:a<t?t:a}return this.makeOutput(r,e.shape,"float32")},t.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.abs(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<e.size;++r)t[r]=Math.hypot(n[2*r],n[2*r+1]);return this.makeOutput(t,e.shape,"float32")},t.prototype.int=function(e){gE(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=n[r];return this.makeOutput(t,e.shape,"int32")},t.prototype.sigmoid=function(e){gE(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(t,e.shape,"float32")},t.prototype.softplus=function(e){gE(e,"softplus");for(var t=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o,a=r[i]>-t,s=r[i]<t,u=Math.exp(r[i]);o=s?u:a?r[i]:Math.log(1+u),n[i]=o}return this.makeOutput(n,e.shape,"float32")},t.prototype.sin=function(e){gE(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cos=function(e){gE(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tan=function(e){gE(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.tan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asin=function(e){gE(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asin(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acos=function(e){gE(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acos(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan=function(e){gE(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atan(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atan2=function(e,t){return gE([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,(function(e,t){return Math.atan2(e,t)}))},t.prototype.sinh=function(e){gE(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.sinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.cosh=function(e){gE(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.cosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.tanh=function(e){gE(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=xp(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.asinh=function(e){gE(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.asinh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.acosh=function(e){gE(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.acosh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.atanh=function(e){gE(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r)t[r]=Math.atanh(n[r]);return this.makeOutput(t,e.shape,"float32")},t.prototype.erf=function(e){gE(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),r=0;r<n.length;++r){var i=Math.sign(n[r]),o=Math.abs(n[r]),a=1/(1+.3275911*o);t[r]=i*(1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o))}return this.makeOutput(t,e.shape,"float32")},t.prototype.step=function(e,t){void 0===t&&(t=0),gE(e,"step");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];n[i]=isNaN(o)?NaN:o>0?1:t}return this.makeOutput(n,e.shape,"float32")},t.prototype.fusedConv2d=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.conv2d(e.input,e.filter,e.convInfo);return t&&(i=this.add(i,t)),n&&(i=yE(this,i,n,r)),i},t.prototype.conv2d=function(e,t,n){gE([e,t],"conv2d");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=Ag(n.outShape,e.dtype),h=e.strides[0],f=c?e.strides[1]:e.strides[2],d=c?e.strides[2]:1,p=c?1:e.strides[1],v=l.strides[0],m=c?l.strides[1]:l.strides[2],g=c?l.strides[2]:1,y=c?1:l.strides[1],b=this.readSync(e.dataId),_=this.readSync(t.dataId),w=l.values,x=0;x<n.batchSize;++x)for(var k=x*h,C=x*v,E=0;E<n.outHeight;++E)for(var S=C+E*m,I=E*n.strideHeight-u,R=0;R<r;R++){var T=I+R*o;if(!(T<0||T>=n.inHeight))for(var A=R*t.strides[0],D=k+T*f,N=0;N<n.outWidth;++N)for(var O=S+N*g,F=N*n.strideWidth-s,P=0;P<i;P++){var M=F+P*a;if(!(M<0||M>=n.inWidth))for(var L=D+M*d,B=A+P*t.strides[1],U=0;U<n.inChannels;++U){for(var W=b[L+U*p],z=0;z<n.outChannels;++z)w[O+z*y]+=W*_[B+z];B+=n.outChannels}}}return l.toTensor()},t.prototype.conv3d=function(e,t,n){for(var r=n.filterDepth,i=n.filterHeight,o=n.filterWidth,a=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,f=Ag(n.outShape,e.dtype),d=this.readSync(e.dataId),p=this.readSync(t.dataId),v=f.values,m=0;m<n.batchSize;++m)for(var g=m*e.strides[0],y=m*f.strides[0],b=0;b<n.outDepth;++b)for(var _=y+b*f.strides[1],w=b*n.strideDepth-c,x=0;x<r;x++){var k=w+x*a;if(!(k<0||k>=n.inDepth))for(var C=x*t.strides[0],E=g+k*e.strides[1],S=0;S<n.outHeight;++S)for(var I=_+S*f.strides[2],R=S*n.strideHeight-h,T=0;T<i;T++){var A=R+T*s;if(!(A<0||A>=n.inHeight))for(var D=C+T*t.strides[1],N=E+A*e.strides[2],O=0;O<n.outWidth;++O)for(var F=I+O*n.outChannels,P=O*n.strideWidth-l,M=0;M<o;M++){var L=P+M*u;if(!(L<0||L>=n.inWidth))for(var B=N+L*n.inChannels,U=D+M*t.strides[2],W=0;W<n.inChannels;++W){for(var z=d[B+W],V=0;V<n.outChannels;++V)v[F+V]+=z*p[U+V];U+=n.outChannels}}}}return f.toTensor()},t.prototype.conv2dDerInput=function(e,t,n){gE([e,t],"conv2dDerInput");for(var r=Ag(n.inShape,"float32"),i=r.values,o=this.readSync(e.dataId),a=this.readSync(t.dataId),s=t.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,f=n.filterHeight,d=n.filterWidth,p=n.inChannels,v=n.inHeight,m=n.inWidth,g=n.outChannels,y=n.outHeight,b=n.outWidth,_=n.strideHeight,w=n.strideWidth,x=f-1-n.padInfo.top,k=d-1-n.padInfo.left,C="channelsLast"===n.dataFormat,E=r.strides[0],S=C?r.strides[1]:r.strides[2],I=C?r.strides[2]:1,R=C?1:r.strides[1],T=e.strides[0],A=C?e.strides[1]:e.strides[2],D=C?e.strides[2]:1,N=C?1:e.strides[1],O=0;O<h;++O)for(var F=0;F<p;++F)for(var P=0;P<v;++P)for(var M=P-x,L=Math.max(0,Math.ceil(M/_)),B=Math.min(y,(f+M)/_),U=0;U<m;++U){for(var W=U-k,z=Math.max(0,Math.ceil(W/w)),V=Math.min(b,(d+W)/w),j=0,H=L;H<B;++H)for(var q=H*_-M,G=z;G<V;++G)for(var K=T*O+A*H+D*G,X=u*(f-1-q)+c*(d-1-(G*w-W))+l*F,Q=0;Q<g;++Q)j+=o[K+N*Q]*a[X+Q];i[E*O+S*P+I*U+R*F]=j}return r.toTensor()},t.prototype.conv3dDerInput=function(e,t,n){for(var r=Ag(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],c=o[3],l=this.readSync(e.dataId),h=e.strides,f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],_=g[2],w=g[3],x=n.batchSize,k=n.filterDepth,C=n.filterHeight,E=n.filterWidth,S=n.inChannels,I=n.inDepth,R=n.inHeight,T=n.inWidth,A=n.outChannels,D=n.outDepth,N=n.outHeight,O=n.outWidth,F=n.strideDepth,P=n.strideHeight,M=n.strideWidth,L=k-1-n.padInfo.front,B=C-1-n.padInfo.top,U=E-1-n.padInfo.left,W=0;W<x;++W)for(var z=0;z<S;++z)for(var V=0;V<I;++V)for(var j=V-L,H=Math.max(0,Math.ceil(j/F)),q=Math.min(D,(k+j)/F),G=0;G<R;++G)for(var K=G-B,X=Math.max(0,Math.ceil(K/P)),Q=Math.min(N,(C+K)/P),Y=0;Y<T;++Y){for(var $=Y-U,Z=Math.max(0,Math.ceil($/M)),J=Math.min(O,(E+$)/M),ee=0,te=H;te<q;++te)for(var ne=te*F-j,re=X;re<Q;++re)for(var ie=re*P-K,oe=Z;oe<J;++oe)for(var ae=f*W+d*te+p*re+v*oe,se=y*(k-1-ne)+b*(C-1-ie)+_*(E-1-(oe*M-$))+w*z,ue=0;ue<A;++ue)ee+=l[ae+ue]*m[se+ue];i[a*W+s*V+u*G+c*Y+z]=ee}return r.toTensor()},t.prototype.conv2dDerFilter=function(e,t,n){gE([e,t],"conv2dDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s="channelsLast"===n.dataFormat,u=Ag(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),d=0;d<o;++d)for(var p=Math.max(0,Math.ceil((l-d)/r)),v=Math.min(n.outHeight,(n.inHeight+l-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((c-m)/i)),y=Math.min(n.outWidth,(n.inWidth+c-m)/i),b=0;b<n.inChannels;++b)for(var _=0;_<n.outChannels;++_){for(var w=0,x=0;x<n.batchSize;++x)for(var k=p;k<v;++k)for(var C=d+k*r-l,E=g;E<y;++E){var S=m+E*i-c;w+=s?h.get(x,C,S,b)*f.get(x,k,E,_):h.get(x,b,C,S)*f.get(x,_,k,E)}u.set(w,d,m,b,_)}return u.toTensor()},t.prototype.conv3dDerFilter=function(e,t,n){for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=Ag(n.filterShape,"float32"),l=c.values,h=c.strides,f=h[0],d=h[1],p=h[2],v=h[3],m=this.readSync(t.dataId),g=t.strides,y=g[0],b=g[1],_=g[2],w=g[3],x=this.readSync(e.dataId),k=e.strides,C=k[0],E=k[1],S=k[2],I=k[3],R=n.padInfo.front,T=n.padInfo.left,A=n.padInfo.top,D=0;D<a;++D)for(var N=Math.max(0,Math.ceil((R-D)/r)),O=Math.min(n.outDepth,(n.inDepth+R-D)/r),F=D*f,P=0;P<s;++P)for(var M=Math.max(0,Math.ceil((A-P)/i)),L=Math.min(n.outHeight,(n.inHeight+A-P)/i),B=P*d+F,U=0;U<u;++U)for(var W=Math.max(0,Math.ceil((T-U)/o)),z=Math.min(n.outWidth,(n.inWidth+T-U)/o),V=U*p+B,j=0;j<n.inChannels;++j)for(var H=j*v+V,q=0;q<n.outChannels;++q){for(var G=0,K=0;K<n.batchSize;++K)for(var X=K*C,Q=K*y,Y=N;Y<O;++Y)for(var $=(D+Y*r-R)*E+X,Z=Y*b+Q,J=M;J<L;++J)for(var ee=(P+J*i-A)*S+$,te=J*_+Z,ne=W;ne<z;++ne)G+=x[(U+ne*o-T)*I+ee+j]*m[ne*w+te+q];l[H+q]=G}return c.toTensor()},t.prototype.fusedDepthwiseConv2D=function(e){var t=e.bias,n=e.activation,r=e.preluActivationWeights,i=this.depthwiseConv2D(e.input,e.filter,e.convInfo);return t&&(i=this.add(i,t)),n&&(i=yE(this,i,n,r)),i},t.prototype.depthwiseConv2D=function(e,t,n){gE([e,t],"depthwiseConv2D");for(var r=n.filterHeight,i=n.filterWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=Ag(n.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),d=l.values,p=0;p<n.batchSize;++p)for(var v=p*e.strides[0],m=p*l.strides[0],g=0;g<n.outHeight;++g)for(var y=m+g*l.strides[1],b=g*n.strideHeight-s,_=0;_<r;++_){var w=b+_*o;if(!(w<0||w>=n.inHeight))for(var x=_*t.strides[0],k=v+w*e.strides[1],C=0;C<n.outWidth;++C)for(var E=y+C*l.strides[2],S=C*n.strideWidth-u,I=0;I<i;++I){var R=S+I*a;if(!(R<0||R>=n.inWidth))for(var T=k+R*n.inChannels,A=E,D=x+I*t.strides[1],N=0;N<n.inChannels;++N){for(var O=h[T+N],F=0;F<c;++F)d[A+F]+=O*f[D+F];A+=c,D+=c}}}return l.toTensor()},t.prototype.depthwiseConv2DDerInput=function(e,t,n){gE([e,t],"depthwiseConv2DDerInput");for(var r=Ag(n.inShape,"float32"),i=r.values,o=r.strides,a=o[0],s=o[1],u=o[2],c=this.readSync(e.dataId),l=e.strides,h=l[0],f=l[1],d=l[2],p=this.readSync(t.dataId),v=t.strides,m=v[0],g=v[1],y=v[2],b=n.batchSize,_=n.filterHeight,w=n.filterWidth,x=n.inChannels,k=n.inHeight,C=n.inWidth,E=n.outHeight,S=n.outWidth,I=n.strideHeight,R=n.strideWidth,T=_-1-n.padInfo.top,A=w-1-n.padInfo.left,D=n.outChannels/x,N=0;N<b;++N)for(var O=0;O<x;++O)for(var F=0;F<k;++F)for(var P=F-T,M=Math.max(0,Math.ceil(P/I)),L=Math.min(E,(_+P)/I),B=0;B<C;++B){for(var U=B-A,W=Math.max(0,Math.ceil(U/R)),z=Math.min(S,(w+U)/R),V=0,j=M;j<L;++j)for(var H=j*I-P,q=W;q<z;++q)for(var G=h*N+f*j+d*q,K=m*(_-1-H)+g*(w-1-(q*R-U))+y*O,X=0;X<D;++X)V+=c[G+(O*D+X)]*p[K+X];i[a*N+s*F+u*B+O]=V}return r.toTensor()},t.prototype.depthwiseConv2DDerFilter=function(e,t,n){gE([e,t],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=Ag(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(e),f=this.bufferSync(t),d=0;d<o;++d)for(var p=Math.max(0,Math.ceil((c-d)/r)),v=Math.min(n.outHeight,(n.inHeight+c-d)/r),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((u-m)/i)),y=Math.min(n.outWidth,(n.inWidth+u-m)/i),b=0;b<n.outChannels;++b){for(var _=Math.trunc(b/l),w=b%l,x=0,k=0;k<n.batchSize;++k)for(var C=p;C<v;++C)for(var E=d+C*r-c,S=g;S<y;++S)x+=h.get(k,E,m+S*i-u,_)*f.get(k,C,S,b);s.set(x,d,m,_,w)}return s.toTensor()},t.prototype.tile=function(e,t){return gE(e,"tile"),rb(this.bufferSync(e),t)},t.prototype.pad=function(e,t,n){gE(e,"pad");var r=t.map((function(t,n){return t[0]+e.shape[n]+t[1]})),i=t.map((function(e){return e[0]})),o=this.bufferSync(e),a=Ag(r,e.dtype);0!==n&&a.values.fill(n);for(var s=0;s<e.size;s++){var u=o.indexToLoc(s),c=u.map((function(e,t){return e+i[t]}));a.set.apply(a,[o.get.apply(o,u)].concat(c))}return a.toTensor()},t.prototype.transpose=function(e,t){gE(e,"transpose");for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[t[r]];var i=this.readSync(e.dataId),o=Ag(n,e.dtype),a=this.bufferSync(e);for(r=0;r<e.size;++r){for(var s=a.indexToLoc(r),u=new Array(s.length),c=0;c<u.length;c++)u[c]=s[t[c]];var l=o.locToIndex(u);o.values[l]=i[r]}return o.toTensor()},t.prototype.gather=function(e,t,n){gE([e,t],"gather");var r=e.shape.slice(),i=this.readSync(t.dataId);r[n]=i.length;for(var o=Ag(r,e.dtype),a=this.bufferSync(e),s=0;s<o.size;++s){var u=o.indexToLoc(s),c=u.slice();c[n]=i[u[n]];var l=a.locToIndex(c);o.values[s]=a.values[l]}return o.toTensor()},t.prototype.batchToSpaceND=function(e,t,n){gE([e],"batchToSpaceND");var r=t.reduce((function(e,t){return e*t})),i=ry(e.shape,t,r),o=iy(i.length,t.length),a=oy(e.shape,t,r),s=ay(n,t.length),u=sy(a,n,t.length);return e.reshape(i).transpose(o).reshape(a).slice(s,u)},t.prototype.spaceToBatchND=function(e,t,n){gE([e],"spaceToBatchND");var r=t.reduce((function(e,t){return e*t})),i=[[0,0]];i.push.apply(i,n);for(var o=1+t.length;o<e.shape.length;++o)i.push([0,0]);var a=e.pad(i),s=ry(a.shape,t,r,!1),u=iy(s.length,t.length,!1),c=oy(a.shape,t,r,!1);return a.reshape(s).transpose(u).reshape(c)},t.prototype.pool=function(e,t,n){gE(e,"pool");for(var r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,h="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,f=this.readSync(e.dataId),d=Ag(t.outShape,e.dtype),p=d.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],m=t.outShape[2]*t.outShape[3],g=t.outShape[3],y=0;y<t.batchSize;++y)for(var b=y*v,_=y*e.strides[0],w=0;w<t.inChannels;++w)for(var x=0;x<t.outHeight;++x)for(var k=x*r-c,C=Math.max(0,k),E=Math.min(t.inHeight,s+k),S=b+x*m,I=0;I<t.outWidth;++I){for(var R=I*i-l,T=Math.max(0,R),A=Math.min(t.inWidth,u+R),D=h,N=0,O=0,F=C;F<E;F+=o){for(var P=_+F*e.strides[1],M=T;M<A;M+=a){var L=f[P+M*e.strides[2]+w];"max"===n&&L>D?D=L:"avg"===n&&(N+=L,O++)}if(isNaN(D))break}p[S+I*g+w]="avg"===n?N/O:D}return d.toTensor()},t.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},t.prototype.maxPoolPositions=function(e,t){for(var n=Ag(t.outShape,"int32"),r=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,a=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=t.padInfo.top,l=t.padInfo.left,h=this.bufferSync(e),f=0;f<t.batchSize;++f)for(var d=0;d<t.inChannels;++d)for(var p=0;p<t.outHeight;++p){for(var v=p*r-c,m=v;m<0;)m+=o;for(var g=Math.min(t.inHeight,s+v),y=0;y<t.outWidth;++y){for(var b=y*i-l,_=b;_<0;)_+=a;for(var w=Math.min(t.inWidth,u+b),x=Number.NEGATIVE_INFINITY,k=-1,C=m;C<g;C+=o)for(var E=C-v,S=_;S<w;S+=a){var I=S-b,R=h.get(f,C,S,d);R>x&&(x=R,k=E*u+I)}n.set(k,f,p,y,d)}}return n.toTensor()},t.prototype.maxPoolBackprop=function(e,t,n,r){gE([t,n],"maxPoolBackprop");for(var i=this.maxPoolPositions(t,r),o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,c=r.effectiveFilterHeight,l=r.effectiveFilterWidth,h=l-1-r.padInfo.left,f=c-1-r.padInfo.top,d=Ag(t.shape,"float32"),p=this.bufferSync(i),v=this.bufferSync(e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.inHeight;++y)for(var b=0;b<r.inWidth;++b){for(var _=y-f,w=b-h,x=0,k=0;k<c;k+=s){var C=(_+k)/o;if(!(C<0||C>=r.outHeight||Math.floor(C)!==C))for(var E=0;E<l;E+=u){var S=(w+E)/a;if(!(S<0||S>=r.outWidth||Math.floor(S)!==S)){var I=c*l-1-p.get(m,C,S,g)===k*l+E?1:0;0!==I&&(x+=v.get(m,C,S,g)*I)}}}d.set(x,m,y,b,g)}return d.toTensor()},t.prototype.avgPoolBackprop=function(e,t,n){gE([e,t],"avgPoolBackprop");for(var r=n.strideHeight,i=n.strideWidth,o=n.filterHeight,a=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,f=c-1-n.padInfo.top,d=Ag(t.shape,"float32"),p=1/(o*a),v=this.bufferSync(e),m=0;m<n.batchSize;++m)for(var g=0;g<n.inChannels;++g)for(var y=0;y<n.inHeight;++y)for(var b=0;b<n.inWidth;++b){for(var _=y-f,w=b-h,x=0,k=0;k<c;k+=s){var C=(_+k)/r;if(!(C<0||C>=n.outHeight||Math.floor(C)!==C))for(var E=0;E<l;E+=u){var S=(w+E)/i;S<0||S>=n.outWidth||Math.floor(S)!==S||(x+=v.get(m,C,S,g))}}d.set(x*p,m,y,b,g)}return d.toTensor()},t.prototype.pool3d=function(e,t,n){gE(e,"pool3d");for(var r=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=Ag(t.outShape,e.dtype),y=g.values,b=t.outShape[1]*t.outShape[2]*t.outShape[3]*t.outShape[4],_=t.outShape[2]*t.outShape[3]*t.outShape[4],w=t.outShape[3]*t.outShape[4],x=t.outShape[4],k=0;k<t.batchSize;++k)for(var C=k*b,E=k*e.strides[0],S=0;S<t.inChannels;++S)for(var I=0;I<t.outDepth;++I){for(var R=I*r-f,T=R;T<0;)T+=a;for(var A=Math.min(t.inDepth,c+R),D=C+I*_,N=0;N<t.outHeight;++N){for(var O=N*i-d,F=O;F<0;)F+=s;for(var P=Math.min(t.inHeight,l+O),M=D+N*w,L=0;L<t.outWidth;++L){for(var B=L*o-p,U=B;U<0;)U+=u;for(var W=Math.min(t.inWidth,h+B),z=M+L*x,V=v,j=0,H=0,q=T;q<A;q+=a){for(var G=E+q*e.strides[1],K=F;K<P;K+=s){for(var X=G+K*e.strides[2],Q=U;Q<W;Q+=u){var Y=m[X+Q*e.strides[3]+S];if("max"===n&&Y>V?V=Y:"avg"===n&&(j+=Y,H++),isNaN(V))break}if(isNaN(V))break}if(isNaN(V))break}y[z+S]="avg"===n?j/H:V}}}return g.toTensor()},t.prototype.avgPool3d=function(e,t){return gE(e,"avgPool3d"),this.pool3d(e,t,"avg").toFloat()},t.prototype.avgPool3dBackprop=function(e,t,n){gE([e,t],"avgPool3dBackprop");for(var r=n.strideDepth,i=n.strideHeight,o=n.strideWidth,a=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,v=f-1-n.padInfo.front,m=p-1-n.padInfo.left,g=d-1-n.padInfo.top,y=Ag(t.shape,"float32"),b=1/(a*s*u),_=this.bufferSync(e),w=0;w<n.batchSize;++w)for(var x=0;x<n.inChannels;++x)for(var k=0;k<n.inDepth;++k)for(var C=0;C<n.inHeight;++C)for(var E=0;E<n.inWidth;++E){for(var S=k-v,I=C-g,R=E-m,T=0,A=0;A<f;A+=c){var D=(S+A)/r;if(!(D<0||D>=n.outDepth||Math.floor(D)!==D))for(var N=0;N<d;N+=l){var O=(I+N)/i;if(!(O<0||O>=n.outHeight||Math.floor(O)!==O))for(var F=0;F<p;F+=h){var P=(R+F)/o;P<0||P>=n.outWidth||Math.floor(P)!==P||(T+=_.get(w,D,O,P,x))}}}y.set(T*b,w,k,C,E,x)}return y.toTensor()},t.prototype.maxPool3d=function(e,t){return gE(e,"maxPool3d"),this.pool3d(e,t,"max").toFloat()},t.prototype.maxPool3dPositions=function(e,t){for(var n=Ag(t.outShape,"int32"),r=t.strideDepth,i=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var y=0;y<t.outDepth;++y){for(var b=y*r-f,_=b;_<0;)_+=a;for(var w=Math.min(t.inDepth,c+b),x=0;x<t.outHeight;++x){for(var k=x*i-d,C=k;C<0;)C+=s;for(var E=Math.min(t.inHeight,l+k),S=0;S<t.outWidth;++S){for(var I=S*o-p,R=I;R<0;)R+=u;for(var T=Math.min(t.inWidth,h+I),A=Number.NEGATIVE_INFINITY,D=-1,N=_;N<w;N+=a)for(var O=N-b,F=C;F<E;F+=s)for(var P=F-k,M=R;M<T;M+=u){var L=M-I,B=v.get(m,N,F,M,g);B>=A&&(A=B,D=O*l*h+P*l+L)}n.set(D,m,y,x,S,g)}}}return n.toTensor()},t.prototype.maxPool3dBackprop=function(e,t,n,r){gE([t,n],"maxPool3dBackprop");for(var i=this.maxPool3dPositions(t,r),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,d=r.effectiveFilterWidth,p=h-1-r.padInfo.front,v=d-1-r.padInfo.left,m=f-1-r.padInfo.top,g=Ag(t.shape,"float32"),y=this.bufferSync(i),b=this.bufferSync(e),_=0;_<r.batchSize;++_)for(var w=0;w<r.inChannels;++w)for(var x=0;x<r.inDepth;++x)for(var k=0;k<r.inHeight;++k)for(var C=0;C<r.inWidth;++C){for(var E=x-p,S=k-m,I=C-v,R=0,T=0;T<h;T+=u){var A=(E+T)/o;if(!(A<0||A>=r.outDepth||Math.floor(A)!==A))for(var D=0;D<f;D+=c){var N=(S+D)/a;if(!(N<0||N>=r.outHeight||Math.floor(N)!==N))for(var O=0;O<d;O+=l){var F=(I+O)/s;if(!(F<0||F>=r.outWidth||Math.floor(F)!==F)){var P=h*f*d-1-y.get(_,A,N,F,w)===T*f*d+D*d+O?1:0;0!==P&&(R+=b.get(_,A,N,F,w)*P)}}}}g.set(R,_,x,k,C,w)}return g.toTensor()},t.prototype.cast=function(e,t){return zy(e,t,this)},t.prototype.reshape=function(e,t){return Vy(e,t)},t.prototype.avgPool=function(e,t){return gE(e,"avgPool"),this.pool(e,t,"avg").toFloat()},t.prototype.resizeBilinear=function(e,t,n,r){gE(e,"resizeBilinear");for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(bp([o,t,n,u])),h=[r&&t>1?a-1:a,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=0,p=h[0]/f[0],v=h[1]/f[1],m=0;m<o;m++)for(var g=0;g<t;g++)for(var y=p*g,b=Math.floor(y),_=y-b,w=Math.min(a-1,Math.ceil(y)),x=m*e.strides[0]+b*e.strides[1],k=m*e.strides[0]+w*e.strides[1],C=0;C<n;C++)for(var E=v*C,S=Math.floor(E),I=E-S,R=Math.min(s-1,Math.ceil(E)),T=x+S*e.strides[2],A=k+S*e.strides[2],D=x+R*e.strides[2],N=k+R*e.strides[2],O=0;O<u;O++){var F=c[T+O],P=c[A+O],M=F+(c[D+O]-F)*I;l[d++]=M+(P+(c[N+O]-P)*I-M)*_}return Jm(l,[o,t,n,u])},t.prototype.resizeBilinearBackprop=function(e,t,n){gE([e,t],"resizeBilinearBackprop");for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],h=new Float32Array(i*o*a*s),f=[n&&c>1?o-1:o,n&&l>1?a-1:a],d=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=f[0]/d[0],v=f[1]/d[1],m=this.readSync(e.dataId),g=0,y=0;y<i;y++)for(var b=y*t.strides[0],_=0;_<c;_++)for(var w=_*p,x=Math.floor(w),k=Math.min(Math.ceil(w),o-1),C=b+x*t.strides[1],E=b+k*t.strides[1],S=w-x,I=1-S,R=0;R<l;R++)for(var T=R*v,A=Math.floor(T),D=Math.min(Math.ceil(T),a-1),N=T-A,O=1-N,F=C+A*t.strides[2],P=C+D*t.strides[2],M=E+A*t.strides[2],L=E+D*t.strides[2],B=I*O,U=I*N,W=S*O,z=S*N,V=0;V<s;V++){var j=m[g++];h[F+V]+=j*B,h[P+V]+=j*U,h[M+V]+=j*W,h[L+V]+=j*z}return og(h,[i,a,o,s],t.dtype)},t.prototype.resizeNearestNeighbor=function(e,t,n,r){gE(e,"resizeNearestNeighbor");for(var i=e.shape,o=i[0],a=i[1],s=i[2],u=i[3],c=this.readSync(e.dataId),l=new Float32Array(o*t*n*u),h=[r&&t>1?a-1:a,r&&n>1?s-1:s],f=[r&&t>1?t-1:t,r&&n>1?n-1:n],d=h[0]/f[0],p=h[1]/f[1],v=0,m=0;m<o;m++)for(var g=m*e.strides[0],y=0;y<t;y++)for(var b=d*y,_=g+Math.min(a-1,r?Math.round(b):Math.floor(b))*e.strides[1],w=0;w<n;w++)for(var x=p*w,k=_+Math.min(s-1,r?Math.round(x):Math.floor(x))*e.strides[2],C=0;C<u;C++)l[v++]=c[k+C];return Jm(l,[o,t,n,u],e.dtype)},t.prototype.resizeNearestNeighborBackprop=function(e,t,n){gE([e,t],"resizeNearestNeighborBackprop");for(var r=t.shape,i=r[0],o=r[1],a=r[2],s=r[3],u=e.shape,c=u[1],l=u[2],h=new Float32Array(i*o*a*s),f=this.readSync(e.dataId),d=[n&&c>1?o-1:o,n&&l>1?a-1:a],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],v=d[0]/p[0],m=d[1]/p[1],g=1/v,y=1/m,b=2*Math.ceil(g)+2,_=2*Math.ceil(y)+2,w=0;w<i;w++)for(var x=w*t.strides[0],k=0;k<o;k++)for(var C=x+k*t.strides[1],E=Math.floor(k*g),S=Math.floor(E-b/2),I=0;I<a;I++)for(var R=C+I*t.strides[2],T=Math.floor(I*y),A=Math.floor(T-_/2),D=0;D<s;D++){for(var N=0,O=0;O<b;O++){var F=O+S;if(!(F<0||F>=c)){var P=x+F*e.strides[1],M=F*v;if(k===Math.min(o-1,n?Math.round(M):Math.floor(M)))for(var L=0;L<_;L++){var B=L+A;if(!(B<0||B>=l)){var U=P+B*e.strides[2],W=B*m;I===Math.min(a-1,n?Math.round(W):Math.floor(W))&&(N+=f[U+D])}}}}h[R+D]=N}return og(h,t.shape,t.dtype)},t.prototype.batchNormalization=function(e,t,n,r,i,o){gE([e,t,n,i,o],"batchNorm");for(var a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=this.readSync(n.dataId),c=i?this.readSync(i.dataId):new Float32Array([1]),l=o?this.readSync(o.dataId):new Float32Array([0]),h=new Float32Array(a.length),f=l.length,d=c.length,p=u.length,v=s.length,m=0,g=0,y=0,b=0,_=0;_<a.length;++_)h[_]=l[m++]+(a[_]-s[g++])*c[y++]/Math.sqrt(u[b++]+r),m>=f&&(m=0),g>=v&&(g=0),y>=d&&(y=0),b>=p&&(b=0);return og(h,e.shape)},t.prototype.localResponseNormalization4D=function(e,t,n,r,i){gE(e,"localResponseNormalization4D");var o=e.shape[3],a=o-1,s=this.readSync(e.dataId),u=e.size,c=new Float32Array(u);function l(e){for(var n=e%o,r=e-n+Math.max(0,n-t),i=e-n+Math.min(n+t,a),u=0;r<=i;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var f=l(h),d=s[h]*Math.pow(n+r*f,-i);c[h]=d}return og(c,e.shape)},t.prototype.LRNGrad=function(e,t,n,r,i,o,a){gE(e,"LRNGrad");for(var s=e.shape[3],u=this.readSync(e.dataId),c=this.readSync(t.dataId),l=this.readSync(n.dataId),h=new Float32Array(e.size),f=e.size,d=0;d<f;d++){for(var p=d%s,v=d-p+Math.max(0,p-r),m=d-p+Math.min(s,p+r+1),g=0,y=v;y<m;y++)g+=Math.pow(c[y],2);for(g=o*g+i,y=v;y<m;y++){var b=-2*o*a*c[y]*l[d]/g;d===y&&(b+=Math.pow(g,-a)),h[y]+=b*=u[d]}}return og(h,e.shape)},t.prototype.multinomial=function(e,t,n,r){gE(e,"multinomial");for(var i=t?e:wy(e),o=i.shape[0],a=i.shape[1],s=sg([o,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(i.dataId),l=0;l<o;++l){var h=l*a,f=new Float32Array(a-1);f[0]=c[h];for(var d=1;d<f.length;++d)f[d]=f[d-1]+c[h+d];for(var p=Sg(r.toString()),v=l*n,m=0;m<n;++m){var g=p();u[v+m]=f.length;for(var y=0;y<f.length;y++)if(g<f[y]){u[v+m]=y;break}}}return s},t.prototype.oneHot=function(e,t,n,r){gE(e,"oneHot");var i=new Float32Array(e.size*t);i.fill(r);for(var o=this.readSync(e.dataId),a=0;a<e.size;++a)o[a]>=0&&o[a]<t&&(i[a*t+o[a]]=n);return rg(i,[e.size,t],"int32")},t.prototype.nonMaxSuppression=function(e,t,n,r,i){return gE(e,"nonMaxSuppression"),Yy(this.readSync(e.dataId),this.readSync(t.dataId),n,r,i)},t.prototype.fft=function(e){return this.fftBatch(e,!1)},t.prototype.ifft=function(e){return this.fftBatch(e,!0)},t.prototype.fftBatch=function(e,t){for(var n=e.shape[0],r=e.shape[1],i=Ag(e.shape,"float32"),o=Ag(e.shape,"float32"),a=$m(e).as2D(n,r),s=Zm(e).as2D(n,r),u=0;u<n;u++)for(var c=a.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=Ym(c,l),f=this.readSync(this.fftImpl(h,t).dataId),d=0;d<r;d++){var p=qy(f,d);i.values[u*r+d]=p.real,o.values[u*r+d]=p.imag}return Ym(i.toTensor(),o.toTensor()).as2D(n,r)},t.prototype.fftImpl=function(e,t){var n=e.as1D(),r=n.size;if(this.isExponentOf2(r)){var i=this.fftRadix2(n,r,t).as2D(e.shape[0],e.shape[1]);return t&&(i=Ym($m(i).div(tg(r)),Zm(i).div(tg(r)))),i}var o=this.readSync(e.dataId),a=function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(this.fourierTransformByMatmul(o,r,t));return Ym(a.real,a.imag).as2D(e.shape[0],e.shape[1])},t.prototype.isExponentOf2=function(e){return 0==(e&e-1)},t.prototype.fftRadix2=function(e,t,n){if(1===t)return e;var r=this.readSync(e.dataId),i=t/2,o=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=0;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),a=Ym(o.real,o.imag).as1D(),s=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),i=2;i<e.length;i+=4)n[Math.floor(i/4)]=e[i],r[Math.floor(i/4)]=e[i+1];return{real:n,imag:r}}(r),u=Ym(s.real,s.imag).as1D();a=this.fftRadix2(a,i,n),u=this.fftRadix2(u,i,n);var c=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),i=0;i<Math.ceil(e/2);i++){var o=(t?2:-2)*Math.PI*(i/e);n[i]=Math.cos(o),r[i]=Math.sin(o)}return{real:n,imag:r}}(t,n),l=Ym(c.real,c.imag).mul(u),h=a.add(l),f=a.sub(l),d=$m(h).concat($m(f)),p=Zm(h).concat(Zm(f));return Ym(d,p).as1D()},t.prototype.fourierTransformByMatmul=function(e,t,n){for(var r=new Float32Array(2*t),i=0;i<t;i++){for(var o=0,a=0,s=0;s<t;s++){var u=Ky(i*s,t,n),c=qy(e,s);o+=c.real*u.real-c.imag*u.imag,a+=c.real*u.imag+c.imag*u.real}n&&(o/=t,a/=t),Gy(r,o,a,i)}return r},t.prototype.depthToSpace=function(e,t,n){vp("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),vp(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+t}));for(var r=e.shape[0],i=e.shape[1],o=e.shape[2],a=e.shape[3],s=i*t,u=o*t,c=a/(t*t),l=this.readSync(e.dataId),h=new Float32Array(r*s*u*c),f=0,d=0;d<r;++d)for(var p=0;p<s;++p)for(var v=Math.floor(p/t),m=p%t,g=0;g<u;++g)for(var y=Math.floor(g/t),b=(m*t+g%t)*c,_=0;_<c;++_)h[f++]=l[_+b+a*(y+o*(v+i*d))];return og(h,[r,s,u,c])},t.prototype.broadcastedBinaryOp=function(e,t,n,r){var i=Ry(e.shape,t.shape),o=Ag(i,n),a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Sy(e.shape,i),c=Sy(t.shape,i),l=o.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(a[h%a.length],s[h%s.length]);else{var f=this.bufferSync(e),d=this.bufferSync(t),p=function(n){var i=o.indexToLoc(n),h=i.slice(-e.rank);u.forEach((function(e){return h[e]=0}));var p=f.locToIndex(h),v=i.slice(-t.rank);c.forEach((function(e){return v[e]=0}));var m=d.locToIndex(v);l[n]=r(a[p],s[m])};for(h=0;h<l.length;++h)p(h)}return o.toTensor()},t.prototype.broadcastedBinaryComplexOp=function(e,t,n){var r=Ry(e.shape,t.shape),i=Ag(r,"float32"),o=Ag(r,"float32"),a=this.readSync(e.dataId),s=this.readSync(t.dataId),u=Sy(e.shape,r),c=Sy(t.shape,r),l=i.values,h=o.values;if(u.length+c.length===0)for(var f=0;f<l.length;f++){var d=f%a.length,p=f%s.length,v=n(a[2*d],a[2*d+1],s[2*p],s[2*p+1]);l[f]=v.real,h[f]=v.imag}else{var m=this.bufferSync(this.data.get(e.dataId).complexTensors.real),g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),y=function(r){var o=i.indexToLoc(r),f=o.slice(-e.rank);u.forEach((function(e){return f[e]=0}));var d=m.locToIndex(f),p=o.slice(-t.rank);c.forEach((function(e){return p[e]=0}));var v=g.locToIndex(p),y=n(a[2*d],a[2*d+1],s[2*v],s[2*v+1]);l[r]=y.real,h[r]=y.imag};for(f=0;f<l.length;f++)y(f)}return this.complex(i.toTensor(),o.toTensor())},t.prototype.split=function(e,t,n){return nb(e,t,n)},t.prototype.dispose=function(){},t.prototype.floatPrecision=function(){return 32},t.prototype.epsilon=function(){return 1e-7},t.prototype.cropAndResize=function(e,t,n,r,i,o){for(var a=e.shape,s=a[0],u=a[1],c=a[2],l=a[3],h=t.shape[0],f=r[0],d=r[1],p=Ag([h,f,d,l],"float32"),v=this.readSync(t.dataId),m=this.readSync(n.dataId),g=this.readSync(e.dataId),y=e.strides,b=p.strides,_=0;_<h;_++){var w=4*_,x=v[w],k=v[w+1],C=v[w+2],E=v[w+3],S=m[_];if(!(S>=s))for(var I=f>1?(C-x)*(u-1)/(f-1):0,R=d>1?(E-k)*(c-1)/(d-1):0,T=0;T<f;T++){var A=f>1?x*(u-1)+T*I:.5*(x+C)*(u-1);if(A<0||A>u-1)for(var D=0;D<d;D++)for(var N=0;N<l;N++){var O=N+D*b[2]+T*b[1]+_*b[0];p.values[O]=o}else if("bilinear"===i){var F=Math.floor(A),P=Math.ceil(A),M=A-F;for(D=0;D<d;D++)if((q=d>1?k*(c-1)+D*R:.5*(k+E)*(c-1))<0||q>c-1)for(N=0;N<l;N++)p.values[O=N+D*b[2]+T*b[1]+_*b[0]]=o;else{var L=Math.floor(q),B=Math.ceil(q),U=q-L;for(N=0;N<l;N++){var W=g[O=N+L*y[2]+F*y[1]+S*y[0]],z=g[O=N+B*y[2]+F*y[1]+S*y[0]],V=g[O=N+L*y[2]+P*y[1]+S*y[0]],j=W+(z-W)*U,H=V+(g[O=N+B*y[2]+P*y[1]+S*y[0]]-V)*U;p.values[O=N+D*b[2]+T*b[1]+_*b[0]]=j+(H-j)*M}}}else for(D=0;D<d;++D){var q;if((q=d>1?k*(c-1)+D*R:.5*(k+E)*(c-1))<0||q>c-1)for(N=0;N<l;N++)p.values[O=N+D*b[2]+T*b[1]+_*b[0]]=o;else{var G=Math.round(q),K=Math.round(A);for(N=0;N<l;N++)p.values[N+D*b[2]+T*b[1]+_*b[0]]=g[N+G*y[2]+K*y[1]+S*y[0]]}}}}return p.toTensor()},t.prototype.sparseToDense=function(e,t,n,r){var i=fy(0,e,n);return this.scatter(e,t,n,i.outputSize,i.sliceSize,i.numUpdates,i.sliceRank,i.strides,r,!1)},t.prototype.gatherND=function(e,t){var n=t.shape,r=n[n.length-1],i=uy(e,t),o=i[0],a=i[1],s=i[2],u=i[3];if(0===a)return Jm([],o,e.dtype);for(var c=new ov([a,s],e.dtype),l=this.readSync(t.dataId),h=this.readSync(e.dataId),f=0;f<a;f++){for(var d=[],p=0,v=0;v<r;v++){var m=l[f*r+v];p+=m*u[v],d.push(m)}if(p<0||p>=e.size/s)throw new Error("Invalid indices: "+d+" does not index into "+e.shape);for(var g=0;g<s;g++)c.values[f*s+g]=h[p*s+g]}return c.toTensor().reshape(o)},t.prototype.scatterND=function(e,t,n){var r=fy(0,e,n),i=r.sliceRank,o=r.numUpdates,a=r.sliceSize,s=r.strides,u=r.outputSize,c=tg(0);return this.scatter(e,t,n,u,a,o,i,s,c,!0)},t.prototype.fill=function(e,t,n){var r=Ap(n=n||Wp(t),bp(e));return r.fill(t),Sv.makeTensor(r,e,n,this)},t.prototype.onesLike=function(e){if("string"===e.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},t.prototype.zerosLike=function(e){var t=Ap(e.dtype,bp(e.shape));return this.makeOutput(t,e.shape,e.dtype)},t.prototype.linspace=function(e,t,n){return jy(e,t,n)},t.prototype.scatter=function(e,t,n,r,i,o,a,s,u,c){var l=[r/i,i],h=this.readSync(e.dataId),f=this.readSync(t.dataId);if(0===r)return Jm([],n,t.dtype);var d=new ov(l,t.dtype);d.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<o;p++){for(var v=[],m=0,g=0;g<a;g++){var y=h[p*a+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/i)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var b=0;b<i;b++)c?d.values[m*i+b]+=f[p*i+b]:d.values[m*i+b]=0===t.rank?f[0]:f[p*i+b]}return d.toTensor().reshape(n)},t}(Cy);Sv.registerBackend("cpu",(function(){return new bE}),1);for(var _E=0,wE=[{kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=t.boxes,i=t.scores,o=n.maxOutputSize,a=n.iouThreshold,s=n.scoreThreshold,u=n.softNmsSigma,c=e.backend;gE(r,"NonMaxSuppressionWithScore");var l=$y(c.data.get(r.dataId).values,c.data.get(i.dataId).values,o,a,s,u);return[l.selectedIndices,l.selectedScores]}},{kernelName:"Square",backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;gE(t,"square");for(var r=n.data.get(t.dataId).values,i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=a*a}return{dataId:n.write(i,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}},{kernelName:Nw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=t.a,r=t.b,i=e.backend;gE([n,r],Nw);var o=i.data.get(n.dataId).values,a=i.data.get(r.dataId).values,s=function(e,t,n,r,i,o){var a=Ry(e,t),s=a.length,u=jp(a),c=Tp(i,bp(a)),l=e.length,h=t.length,f=jp(e),d=jp(t),p=Sy(e,a),v=Sy(t,a);if(p.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=o(n[m%n.length],r[m%r.length]);else{var g=function(e){var t=Jp(e,s,u),i=t.slice(-l);p.forEach((function(e){return i[e]=0}));var a=Zp(i,l,f),m=t.slice(-h);v.forEach((function(e){return m[e]=0}));var g=Zp(m,h,d);c[e]=o(n[a],r[g])};for(m=0;m<c.length;++m)g(m)}return[c,a]}(n.shape,r.shape,o,a,n.dtype,(function(e,t){var n=e-t;return n*n})),u=s[1];return{dataId:i.write(s[0],u,n.dtype),shape:u,dtype:n.dtype}}}];_E<wE.length;_E++)up(wE[_E]);for(var xE,kE=function(e){this.variableNames=["A"];var t=hb(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+t.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},CE=function(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var t=hb(),n=e[0],r=e[1];this.outputShape=e,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+t.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+t.output+" = result;\n      }\n    "},EE=0,SE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.inputs.pixels,r="undefined"!=typeof HTMLVideoElement&&n instanceof HTMLVideoElement,i="undefined"!=typeof HTMLImageElement&&n instanceof HTMLImageElement,o=r?[n.videoWidth,n.videoHeight]:[n.width,n.height],a=o[0],s=o[1],u=[s,a],c=[s,a,e.attrs.numChannels];(i||r)&&(null==xE&&(xE=document.createElement("canvas").getContext("2d")),xE.canvas.width=a,xE.canvas.height=s,xE.drawImage(n,0,0,a,s),n=xE.canvas);var l=t.makeTensorInfo(u,"int32");t.texData.get(l.dataId).usage=Av.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(l.dataId),n);var h=np().getBool("WEBGL_PACK")?new CE(c):new kE(c),f=t.runWebGLProgram(h,[l],"int32");return t.disposeData(l.dataId),f}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;Fm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=t.scores,o=r.maxOutputSize,a=r.iouThreshold,s=r.scoreThreshold,u=r.softNmsSigma,c=n,l=$y(c.readSync(t.boxes.dataId),c.readSync(i.dataId),o,a,s,u);return[l.selectedIndices,l.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(e){var t=e.inputs.x,n=e.backend,r=new hw(t.shape,"return x * x;");return n.runWebGLProgram(r,[t],t.dtype)}},{kernelName:Nw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=t.a,r=t.b,i=e.backend,o=np().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Db("return (a - b) * (a - b);",n.shape,r.shape):new Tb("return (a - b) * (a - b);",n.shape,r.shape);return i.compileAndRun(o,[n,r])}}];EE<SE.length;EE++)up(SE[EE]);for(var IE=0,RE=[{kernelName:"Square",gradFunc:function(e,t){var n=t[0];return{x:function(){return e.mul(n.toFloat().mul(2))}}}},{kernelName:Nw,gradFunc:function(e,t){var n=t[0],r=t[1],i=tg(2);return{a:function(){return Xx(e,Xx(i,Jx(n,r)))},b:function(){return Xx(e,Xx(i,Jx(r,n)))}}}}];IE<RE.length;IE++)cp(RE[IE]);var TE=function(){function e(){}return e.prototype.fetch=function(e,t){return fetch(e,t)},e.prototype.now=function(){return performance.now()},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got "+t);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},e}();np().get("IS_BROWSER")&&np().setPlatform("browser",new TE);var AE,DE=function(){function e(){this.util=n(3),this.textEncoder=new this.util.TextEncoder}return e.prototype.fetch=function(e,t){return null!=np().global.fetch?np().global.fetch(e,t):(null==AE&&(AE=n(2)),AE(e,t))},e.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},e.prototype.encode=function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},e.prototype.decode=function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)},e}();np().get("IS_NODE")&&np().setPlatform("node",new DE);var NE={float32:4,int32:4,uint16:2,uint8:1,bool:1};function OE(e,t){for(var n={},r=0,i=function(t){var i=t.name,o=t.dtype,a=t.shape,s=bp(a),u=void 0;if("quantization"in t){var c=t.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+t.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=NE[c.dtype],h=e.slice(r,r+s*l),f="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===o)u=Float32Array.from(f,(function(e){return e*c.scale+c.min}));else{if("int32"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=Int32Array.from(f,(function(e){return Math.round(e*c.scale+c.min)}))}r+=s*l}else if("string"===o){var d=bp(t.shape);u=[];for(var p=0;p<d;p++){var v=new Uint32Array(e.slice(r,r+4))[0];r+=4;var m=new Uint8Array(e.slice(r,r+v));u.push(m),r+=v}}else{var g=NE[o];if(h=e.slice(r,r+s*g),"float32"===o)u=new Float32Array(h);else if("int32"===o)u=new Int32Array(h);else{if("bool"!==o)throw new Error("Unsupported dtype in weight '"+i+"': "+o);u=new Uint8Array(h)}r+=s*g}n[i]=Jm(u,a,o)},o=0,a=t;o<a.length;o++)i(a[o]);return n}function FE(e){if(null===e)throw new Error("Invalid input value: "+JSON.stringify(e));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+e.constructor.name)}));var r=new Uint8Array(t),i=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),i),i+=e.byteLength})),r.buffer}var PE="undefined"!=typeof Buffer&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function ME(e){return PE?Buffer.byteLength(e):new Blob([e]).size}function LE(e){var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function BE(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function UE(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:ME(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:ME(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var WE=function(){function e(){this.saveRouters=[],this.loadRouters=[]}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerSaveRouter=function(t){e.getInstance().saveRouters.push(t)},e.registerLoadRouter=function(t){e.getInstance().loadRouters.push(t)},e.getSaveHandlers=function(t){return e.getHandlers(t,"save")},e.getLoadHandlers=function(t,n){return e.getHandlers(t,"load",n)},e.getHandlers=function(t,n,r){var i=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&i.push(n)})),i},e}(),zE="://",VE=function(){function e(){this.managers={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.registerManager=function(t,n){vp(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(zE)&&(t=t.slice(0,t.indexOf(zE))),vp(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();vp(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '"+t+"'."})),r.managers[t]=n},e.getManager=function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},e.getSchemes=function(){return Object.keys(this.getInstance().managers)},e}();function jE(e){if(-1===e.indexOf(zE))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+VE.getSchemes().join(","));return{scheme:e.split(zE)[0],path:e.split(zE)[1]}}function HE(e,t,n){return void 0===n&&(n=!1),Zd(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l,h;return Jd(this,(function(f){switch(f.label){case 0:return vp(e!==t,(function(){return"Old path and new path are the same: '"+e+"'"})),vp((r=WE.getLoadHandlers(e)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+e+"."})),vp(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+e+"."})),i=r[0],vp((o=WE.getSaveHandlers(t)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+t+"."})),vp(o.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+t+"."})),a=o[0],s=jE(e).scheme,u=jE(e).path,c=s===jE(e).scheme,[4,i.load()];case 1:return l=f.sent(),n&&c?[4,VE.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(l)];case 4:return h=f.sent(),!n||c?[3,6]:[4,VE.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var qE="models_store",GE="model_info_store";function KE(){if(!np().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e=window||self,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function XE(e){var t=e.result;t.createObjectStore(qE,{keyPath:"modelPath"}),t.createObjectStore(GE,{keyPath:"modelPath"})}var QE=function(){function e(e){if(this.indexedDB=KE(),null==e||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return e.prototype.save=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},e.prototype.load=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},e.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(e,r){var i=n.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return XE(i)},i.onsuccess=function(){var o=i.result;if(null==t){var a=o.transaction(qE,"readonly"),s=a.objectStore(qE).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return o.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return o.close(),r(s.error)},a.oncomplete=function(){return o.close()}}else{var u,c=UE(t),l=o.transaction(GE,"readwrite"),h=l.objectStore(GE),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var i=(u=o.transaction(qE,"readwrite")).objectStore(qE).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});i.onsuccess=function(){return e({modelArtifactsInfo:c})},i.onerror=function(e){var t=(h=l.objectStore(GE)).delete(n.modelPath);t.onsuccess=function(){return o.close(),r(i.error)},t.onerror=function(e){return o.close(),r(i.error)}}},f.onerror=function(e){return o.close(),r(f.error)},l.oncomplete=function(){null==u?o.close():u.oncomplete=function(){return o.close()}}}},i.onerror=function(e){return r(i.error)}}))},e.URL_SCHEME="indexeddb://",e}(),YE=function(e){return np().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(QE.URL_SCHEME)?(t=e.slice(QE.URL_SCHEME.length),new QE(t)):null;var t};WE.registerSaveRouter(YE),WE.registerLoadRouter(YE);var $E=function(){function e(){this.indexedDB=KE()}return e.prototype.listModels=function(){return Zd(this,void 0,void 0,(function(){var e=this;return Jd(this,(function(t){return[2,new Promise((function(t,n){var r=e.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return XE(r)},r.onsuccess=function(){var e=r.result,i=e.transaction(GE,"readonly"),o=i.objectStore(GE).getAll();o.onsuccess=function(){for(var e={},n=0,r=o.result;n<r.length;n++){var i=r[n];e[i.modelPath]=i.modelArtifactsInfo}t(e)},o.onerror=function(t){return e.close(),n(o.error)},i.oncomplete=function(){return e.close()}},r.onerror=function(e){return n(r.error)}}))]}))}))},e.prototype.removeModel=function(e){return Zd(this,void 0,void 0,(function(){var t=this;return Jd(this,(function(n){var r;return e=(r=e).startsWith(QE.URL_SCHEME)?r.slice(QE.URL_SCHEME.length):r,[2,new Promise((function(n,r){var i=t.indexedDB.open("tensorflowjs",1);i.onupgradeneeded=function(){return XE(i)},i.onsuccess=function(){var t,o=i.result,a=o.transaction(GE,"readwrite"),s=a.objectStore(GE),u=s.get(e);u.onsuccess=function(){if(null==u.result)return o.close(),r(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var i=s.delete(e),a=function(){var i=(t=o.transaction(qE,"readwrite")).objectStore(qE).delete(e);i.onsuccess=function(){return n(u.result.modelArtifactsInfo)},i.onerror=function(e){return r(u.error)}};i.onsuccess=a,i.onerror=function(e){return a(),o.close(),r(u.error)}},u.onerror=function(e){return o.close(),r(u.error)},a.oncomplete=function(){null==t?o.close():t.oncomplete=function(){return o.close()}}},i.onerror=function(e){return r(i.error)}}))]}))}))},e}();if(np().getBool("IS_BROWSER"))try{VE.registerManager(QE.URL_SCHEME,new $E)}catch(vv){}var ZE="/",JE="tensorflowjs_models",eS="info",tS="model_topology",nS="weight_specs",rS="weight_data",iS="model_metadata";function oS(e){return{info:[JE,e,eS].join(ZE),topology:[JE,e,tS].join(ZE),weightSpecs:[JE,e,nS].join(ZE),weightData:[JE,e,rS].join(ZE),modelMetadata:[JE,e,iS].join(ZE)}}function aS(e){var t=e.split(ZE);if(t.length<3)throw new Error("Invalid key format: "+e);return t.slice(1,t.length-1).join(ZE)}var sS=function(){function e(e){if(!np().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==e||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=oS(this.modelPath)}return e.prototype.save=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r;return Jd(this,(function(i){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),r=UE(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(e){if(PE)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,i=t.length;r<i;r++)n+=String.fromCharCode(t[r]);return btoa(n)}(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},e.prototype.load=function(){return Zd(this,void 0,void 0,(function(){var e,t,n,r,i,o,a;return Jd(this,(function(s){if(null==(e=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==e.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=r,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),t.format=o.format,t.generatedBy=o.generatedBy,t.convertedBy=o.convertedBy,t.userDefinedMetadata=o.userDefinedMetadata),null==(a=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=function(e){if(PE){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r.set([n.charCodeAt(i)],i);return r.buffer}(a),[2,t]}))}))},e.URL_SCHEME="localstorage://",e}(),uS=function(e){return np().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(sS.URL_SCHEME)?(t=e.slice(sS.URL_SCHEME.length),new sS(t)):null;var t};WE.registerSaveRouter(uS),WE.registerLoadRouter(uS);var cS=function(){function e(){vp(np().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),vp("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return e.prototype.listModels=function(){return Zd(this,void 0,void 0,(function(){var e,t,n,r,i,o;return Jd(this,(function(a){for(e={},t=JE+ZE,n=ZE+eS,r=0;r<this.LS.length;++r)(i=this.LS.key(r)).startsWith(t)&&i.endsWith(n)&&(o=aS(i),e[o]=JSON.parse(this.LS.getItem(i)));return[2,e]}))}))},e.prototype.removeModel=function(e){return Zd(this,void 0,void 0,(function(){var t,n;return Jd(this,(function(r){var i;if(e=(i=e).startsWith(sS.URL_SCHEME)?i.slice(sS.URL_SCHEME.length):i,t=oS(e),null==this.LS.getItem(t.info))throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},e}();if(np().getBool("IS_BROWSER"))try{VE.registerManager(sS.URL_SCHEME,new cS)}catch(vv){}function lS(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var hS=function(){function e(t){if(!np().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return e.prototype.save=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r,i;return Jd(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=window.URL.createObjectURL(new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}]})],{type:"application/json"})),(r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,r.href=n,[4,lS((function(){return r.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==e.weightData?[3,4]:((i=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,i.href=t,[4,lS((function(){return i.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:UE(e)}]}}))}))},e.URL_SCHEME="downloads://",e}(),fS=function(){function e(e){if(null==e||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return e.prototype.load=function(){return Zd(this,void 0,void 0,(function(){var e,t,n=this;return Jd(this,(function(r){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(r,i){var o=new FileReader;o.onload=function(o){var a=JSON.parse(o.target.result),s=a.modelTopology;if(null!=s){0===t.length&&r({modelTopology:s});var u=a.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,t)}catch(e){return void i(e)}var l=[],h=[],f=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),f.push(null)})),l.push.apply(l,e.weights)})),u.forEach((function(e){e.paths.forEach((function(e){var t=new FileReader;t.onload=function(t){var n=t.target.result,i=h.indexOf(e);f[i]=n,-1===f.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:LE(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy,userDefinedMetadata:a.userDefinedMetadata})},t.onerror=function(t){return i("Failed to weights data from file of path '"+e+"'.")},t.readAsArrayBuffer(c[e])}))}))}else i(new Error("weightManifest field is missing from file "+e.name))}else i(new Error("modelTopology field is missing from file "+e.name))},o.onerror=function(t){return i("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},o.readAsText(e)}))]}))}))},e.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],r=t.map((function(e){return BE(e.name)})),i={},o=0,a=e;o<a.length;o++)a[o].paths.forEach((function(e){var o=BE(e);if(-1!==n.indexOf(o))throw new Error("Duplicate file basename found in weights manifest: '"+o+"'");if(n.push(o),-1===r.indexOf(o))throw new Error("Weight file with basename '"+o+"' is not provided.");i[e]=t[r.indexOf(o)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return i},e}();function dS(e,t,n,r){!function(e){vp(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){vp(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+e})),vp(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+t})),vp(t>=e,(function(){return"startFraction must be no more than endFraction, but got startFraction "+e+" and endFraction "+t}))}(n=null==n?0:n,r=null==r?1:r);var i=0;return Promise.all(e.map((function(o){return o.then((function(o){var a=n+ ++i/e.length*(r-n);return t(a),o})),o})))}function pS(e,t){return Zd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l;return Jd(this,(function(h){switch(h.label){case 0:return null==t&&(t={}),n=null==t.fetchFunc?np().platform.fetch:t.fetchFunc,r=e.map((function(e){return n(e,t.requestInit,{isBinary:!0})})),i=0,o=.5,null!=t.onProgress?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,dS(r,t.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map((function(e){return e.arrayBuffer()})),u=.5,c=1,null!=t.onProgress?[3,6]:[4,Promise.all(s)];case 5:return l=h.sent(),[3,8];case 6:return[4,dS(s,t.onProgress,u,c)];case 7:l=h.sent(),h.label=8;case 8:return[2,l]}}))}))}function vS(e){var t=this;return function(n,r,i){return void 0===r&&(r=""),Zd(t,void 0,void 0,(function(){var t,o,a,s,u,c,l,h,f,d;return Jd(this,(function(p){switch(p.label){case 0:if(t=n.map((function(){return!1})),o={},a=null!=i?i.map((function(){return!1})):[],s=[],n.forEach((function(e,n){var r=0;e.weights.forEach((function(e){var u=NE["quantization"in e?e.quantization.dtype:e.dtype]*bp(e.shape),c=function(){t[n]=!0,null==o[n]&&(o[n]=[]),o[n].push({manifestEntry:e,groupOffset:r,sizeBytes:u})};null!=i?i.forEach((function(t,n){t===e.name&&(c(),a[n]=!0)})):c(),s.push(e.name),r+=u}))})),!a.every((function(e){return e})))throw u=i.filter((function(e,t){return!a[t]})),new Error("Could not find weights in manifest with names: "+u.join(", ")+". \nManifest JSON has weights with names: "+s.join(", ")+".");return c=t.reduce((function(e,t,n){return t&&e.push(n),e}),[]),l=[],c.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;l.push(t)}))})),[4,e(l)];case 1:return h=p.sent(),f={},d=0,c.forEach((function(e){for(var t=n[e].paths.length,r=0,i=0;i<t;i++)r+=h[d+i].byteLength;for(var a=new ArrayBuffer(r),s=new Uint8Array(a),u=0,c=0;c<t;c++){var l=new Uint8Array(h[d+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=OE(a.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)f[n]=t[n]})),d+=t})),[2,f]}}))}))}}WE.registerSaveRouter((function(e){return np().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(hS.URL_SCHEME)?function(e){return void 0===e&&(e="model"),new hS(e)}(e.slice(hS.URL_SCHEME.length)):null}));var mS=function(){function e(e,t){if(this.DEFAULT_METHOD="POST",null==t&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,null!=t.fetchFunc?(vp("function"==typeof t.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=np().platform.fetch,vp(null!=e&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&vp(2===e.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,null!=t.requestInit&&null!=t.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return e.prototype.save=function(e){return Zd(this,void 0,void 0,(function(){var t,n;return Jd(this,(function(r){switch(r.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,t.body.append("model.json",new Blob([JSON.stringify({modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:[{paths:["./model.weights.bin"],weights:e.weightSpecs}]})],{type:"application/json"}),"model.json"),null!=e.weightData&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((n=r.sent()).ok)return[2,{modelArtifactsInfo:UE(e),responses:[n]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+n.status+".")}}))}))},e.prototype.load=function(){return Zd(this,void 0,void 0,(function(){var e,t,n,r,i,o,a,s,u,c,l,h;return Jd(this,(function(f){switch(f.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=f.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");f.label=2;case 2:return f.trys.push([2,4,,5]),[4,e.json()];case 3:return t=f.sent(),[3,5];case 4:throw f.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.weightsManifest,o=t.generatedBy,a=t.convertedBy,s=t.format,u=t.userDefinedMetadata,null==(r=t.modelTopology)&&null==i)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==i?[3,7]:[4,this.loadWeights(i)];case 6:h=f.sent(),c=h[0],l=h[1],f.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:u,generatedBy:o,convertedBy:a,format:s}]}}))}))},e.prototype.loadWeights=function(e){return Zd(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c,l;return Jd(this,(function(h){switch(h.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=function(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}(t),r=n[0],i=n[1],o=this.weightPathPrefix||r,a=[],s=0,u=e;s<u.length;s++)a.push.apply(a,u[s].weights);return c=[],e.forEach((function(e){e.paths.forEach((function(e){c.push(o+e+i)}))})),[4,pS(c,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return l=h.sent(),[2,[a,LE(l)]]}}))}))},e.URL_SCHEME_REGEX=/^https?:\/\//,e}();function gS(e){return null!=e.match(mS.URL_SCHEME_REGEX)}var yS=function(e,t){return"undefined"==typeof fetch?null:(Array.isArray(e)?e.every((function(e){return gS(e)})):gS(e))?bS(e,{onProgress:t}):null};function bS(e,t){return new mS(e,t)}WE.registerSaveRouter(yS),WE.registerLoadRouter(yS);var _S,wS=function(){function e(e){this.modelArtifacts=e}return e.prototype.load=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){return[2,this.modelArtifacts]}))}))},e}(),xS=function(){function e(e){this.saveHandler=e}return e.prototype.save=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){return[2,this.saveHandler(e)]}))}))},e}(),kS=Object.freeze({browserFiles:function(e){return new fS(e)},browserHTTPRequest:function(e,t){return bS(e,t)},concatenateArrayBuffers:LE,decodeWeights:OE,encodeWeights:function(e,t){return Zd(this,void 0,void 0,(function(){var n,r,i,o,a,s=this;return Jd(this,(function(u){switch(u.label){case 0:for(n=[],r=[],i=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e),o=function(o){var a=i[o],u=Array.isArray(e)?e[o].tensor:e[a];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype)throw new Error("Unsupported dtype in weight '"+a+"': "+u.dtype);var c={name:a,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var l=new Promise((function(e){return Zd(s,void 0,void 0,(function(){var t,n,r,i,o,a,s;return Jd(this,(function(c){switch(c.label){case 0:return[4,u.bytes()];case 1:for(t=c.sent(),n=t.reduce((function(e,t){return e+t.length}),0)+4*t.length,r=new Uint8Array(n),i=0,o=0;o<t.length;o++)a=t[o],s=new Uint8Array(new Uint32Array([a.length]).buffer),r.set(s,i),r.set(a,i+=4),i+=a.length;return e(r),[2]}}))}))}));r.push(l)}else r.push(u.data());null!=t&&(c.group=t),n.push(c)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:FE(u.sent()),specs:n}]}}))}))},fromMemory:function(e,t,n,r){return 1===arguments.length?null!=e.modelTopology||null!=e.weightSpecs?new wS(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wS({modelTopology:e})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new wS({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r}))},getLoadHandlers:function(e,t){return WE.getLoadHandlers(e,t)},getModelArtifactsInfoForJSON:UE,getSaveHandlers:function(e){return WE.getSaveHandlers(e)},http:bS,isHTTPScheme:gS,loadWeights:function(e,t,n,r){return void 0===t&&(t=""),Zd(this,void 0,void 0,(function(){return Jd(this,(function(i){return[2,vS((function(e){return pS(e,{requestInit:r})}))(e,t,n)]}))}))},registerLoadRouter:function(e){return WE.registerLoadRouter(e)},registerSaveRouter:function(e){return WE.registerSaveRouter(e)},weightsLoaderFactory:vS,withSaveHandler:function(e){return new xS(e)},copyModel:function(e,t){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(n){return[2,HE(e,t,!1)]}))}))},listModels:function(){return Zd(this,void 0,void 0,(function(){var e,t,n,r,i,o,a;return Jd(this,(function(s){switch(s.label){case 0:e=VE.getSchemes(),t={},n=0,r=e,s.label=1;case 1:return n<r.length?[4,VE.getManager(i=r[n]).listModels()]:[3,4];case 2:for(a in o=s.sent())t[i+zE+a]=o[a];s.label=3;case 3:return n++,[3,1];case 4:return[2,t]}}))}))},moveModel:function(e,t){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(n){return[2,HE(e,t,!0)]}))}))},removeModel:function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){return t=jE(e),[2,VE.getManager(t.scheme).removeModel(t.path)]}))}))}}),CS=Qm({confusionMatrix_:function(e,t,n){var r=Lm(e,"labels","confusionMatrix"),i=Lm(t,"predictions","confusionMatrix");vp(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),vp(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),vp(1===i.rank,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),vp(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),vp(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var o=Wg(r.asType("int32"),n),a=Wg(i.asType("int32"),n);return o.transpose().matMul(a).asType("int32")}}),ES=(Object.freeze({confusionMatrix:CS}),Qm({fromPixels_:function(e,t){if(void 0===t&&(t=3),t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,i=!1,o=!1,a=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)i=!0;else if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)o=!0;else{if(null==e.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);a=!0}if(i&&i&&e.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=ap("FromPixels",Sv.backendName))return Sv.runKernel("FromPixels",{pixels:e},{numChannels:t});var s,u,c=i?[e.videoWidth,e.videoHeight]:[e.width,e.height],l=c[0],h=c[1];if(a?s=e.getContext("2d").getImageData(0,0,l,h).data:r||n?s=e.data:(o||i)&&(null==_S&&(_S=document.createElement("canvas").getContext("2d")),_S.canvas.width=l,_S.canvas.height=h,_S.drawImage(e,0,0,l,h),s=_S.getImageData(0,0,l,h).data),4===t)u=new Int32Array(s);else{var f=l*h;u=new Int32Array(f*t);for(var d=0;d<f;d++)for(var p=0;p<t;++p)u[d*t+p]=s[4*d+p]}return ig(u,[h,l,t],"int32")}})),SS=Object.freeze({toPixels:function(e,t){return Zd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,g,y,b,_,w,x;return Jd(this,(function(k){switch(k.label){case 0:if(n=Lm(e,"img","toPixels"),e instanceof cv||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),i=r[0],o=r[1],(a=2===n.rank?1:n.shape[2])>4||2===a)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,n.data()];case 1:return s=k.sent(),u=n.min(),c=n.max(),[4,Promise.all([u.data(),c.data()])];case 2:if(l=k.sent(),h=l[0][0],f=l[1][0],u.dispose(),c.dispose(),"float32"===n.dtype){if(h<0||f>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+h+" - "+f+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(h<0||f>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+h+" - "+f+"].")}for(d="float32"===n.dtype?255:1,p=new Uint8ClampedArray(o*i*4),v=0;v<i*o;++v)m=void 0,g=void 0,y=void 0,b=void 0,1===a?(m=s[v]*d,g=s[v]*d,y=s[v]*d,b=255):3===a?(m=s[3*v]*d,g=s[3*v+1]*d,y=s[3*v+2]*d,b=255):4===a&&(m=s[4*v]*d,g=s[4*v+1]*d,y=s[4*v+2]*d,b=s[4*v+3]*d),p[0+(_=4*v)]=Math.round(m),p[_+1]=Math.round(g),p[_+2]=Math.round(y),p[_+3]=Math.round(b);return null!=t&&(t.width=o,t.height=i,w=t.getContext("2d"),x=new ImageData(p,o,i),w.putImageData(x,0,0)),n!==e&&n.dispose(),[2,p]}}))}))},fromPixels:ES}),IS=function(){function e(){}return e.prototype.getClassName=function(){return this.constructor.className},e.fromConfig=function(e,t){return new e(t)},e}(),RS=function(){function e(){this.classNameMap={}}return e.getMap=function(){return null==e.instance&&(e.instance=new e),e.instance},e.register=function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]},e}();function TS(e){vp(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),vp("string"==typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),vp(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),RS.register(e)}function AS(){return 32===Sv.backend.floatPrecision()?.001:.1}function DS(e,t,n){var r=!0;if((Fp(e)||Fp(t))&&(r=!1),Fp(e)&&Fp(t)&&(r=!0),r){var i=e.constructor.name,o=t.constructor.name;if(i!==o)throw new Error("Arrays are of different type. Actual: "+i+". Expected: "+o)}if(Array.isArray(e)&&Array.isArray(t)){var a=Pm(e),s=Pm(t);if(!_p(a,s))throw new Error("Arrays have different shapes. Actual: ["+a+"]. Expected: ["+s+"]")}var u=Fp(e)?e:yp(e),c=Fp(t)?t:yp(t);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var h=u[l],f=c[l];if(!n(h,f))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+f+".\nActual:   "+u+".\nExpected: "+c+".")}}function NS(e,t,n){return!isFinite(e)&&!isFinite(t)||!(isNaN(e)||isNaN(t)||Math.abs(e-t)>n)}Object.freeze({Serializable:IS,SerializationMap:RS,registerClass:TS}),Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(e,t,n){return null==n&&(n=AS()),DS(e,t,(function(e,t){return NS(e,t,n)}))},testEpsilon:AS,expectPromiseToFail:function(e,t){e().then((function(){return t.fail()}),(function(){return t()}))},expectArraysEqual:function(e,t){var n="string"==typeof t||"number"==typeof t||"boolean"==typeof t?[t]:t;return Lp(e)||Lp(e[0])||Lp(t)||Lp(t[0])?DS(e,n,(function(e,t){return e==t})):DS(e,t,(function(e,t){return NS(e,t,0)}))},expectNumbersClose:function(e,t,n){if(null==n&&(n=AS()),!NS(e,t,n))throw new Error("Numbers differ: actual === "+e+", expected === "+t)},expectValuesInRange:function(e,t,n){for(var r=0;r<e.length;r++)if(e[r]<t||e[r]>n)throw new Error("Value out of range:"+e[r]+" low: "+t+", high: "+n)},expectArrayBuffersEqual:function(e,t){expect(new Float32Array(e)).toEqual(new Float32Array(t))}}),Object.freeze({gpgpu_util:S_,webgl_util:Tm,forceHalfFloat:function(){np().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Aw,setWebGLContext:Fv,GPGPUContext:I_});var OS=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $d(t,e),t.prototype.minimize=function(e,t,n){void 0===t&&(t=!1);var r=this.computeGradients(e,n),i=r.value,o=r.grads;if(null!=n){var a=n.map((function(e){return{name:e.name,tensor:o[e.name]}}));this.applyGradients(a)}else this.applyGradients(o);return Om(o),t?i:(i.dispose(),null)},Object.defineProperty(t.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),t.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},t.prototype.computeGradients=function(e,t){return function(e,t){vp(zp(e),(function(){return"The f passed in variableGrads(f) must be a function"})),vp(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof mv})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],Sv.registeredVariables)t.push(Sv.registeredVariables[r]);var i=n?t.filter((function(e){return!e.trainable})):null,o=t.length;vp((t=t.filter((function(e){return e.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var a=Sv.gradients(e,t,null,!0),s=a.value,u=a.grads;vp(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),vp(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=i&&i.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)},t.prototype.dispose=function(){null!=this.iterations_&&Om(this.iterations_)},t.prototype.saveIterations=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:tg(this.iterations_,"int32")}]}))}))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},t.prototype.extractIterations=function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){switch(n.label){case 0:return t=this,[4,e[0].tensor.data()];case 1:return t.iterations_=n.sent()[0],[2,e.slice(1)]}}))}))},t}(IS);Object.defineProperty(OS,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var FS=function(e){function t(t,n,r){void 0===r&&(r=null);var i=e.call(this)||this;return i.learningRate=t,i.rho=n,i.epsilon=r,i.accumulatedGrads=[],i.accumulatedUpdates=[],null==r&&(i.epsilon=Sv.backend.epsilon()),i}return $d(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Sv.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:Nm((function(){return hg(i).variable(!1)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:Nm((function(){return hg(i).variable(!1)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;Nm((function(){var e=a.mul(t.rho).add(o.square().mul(1-t.rho)),n=s.add(t.epsilon).sqrt().div(a.add(t.epsilon).sqrt()).mul(o),r=s.mul(t.rho).add(n.square().mul(1-t.rho));a.assign(e),s.assign(r);var u=n.mul(-t.learningRate).add(i);i.assign(u)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Om(this.accumulatedGrads.map((function(e){return e.variable}))),Om(this.accumulatedUpdates.map((function(e){return e.variable}))))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return e=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedGrads=e.slice(0,t=e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedUpdates=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.rho,t.epsilon)},t.className="Adadelta",t}(OS);TS(FS);var PS=function(e){function t(t,n){void 0===n&&(n=.1);var r=e.call(this)||this;return r.learningRate=t,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return $d(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Sv.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:n+"/accumulator",variable:Nm((function(){return ug(i.shape,t.initialAccumulatorValue).variable(!1)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=t.accumulatedGrads[r].variable;Nm((function(){var e=a.add(o.square());a.assign(e);var n=o.div(e.add(Sv.backend.epsilon()).sqrt()).mul(-t.learningRate).add(i);i.assign(n)}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedGrads&&Om(this.accumulatedGrads.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulatedGrads=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},t.fromConfig=function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)},t.className="Adagrad",t}(OS);TS(PS);var MS=function(e){function t(t,n,r,i){void 0===i&&(i=null);var o=e.call(this)||this;return o.learningRate=t,o.beta1=n,o.beta2=r,o.epsilon=i,o.accumulatedFirstMoment=[],o.accumulatedSecondMoment=[],Nm((function(){o.accBeta1=tg(n).variable(),o.accBeta2=tg(r).variable()})),null==i&&(o.epsilon=Sv.backend.epsilon()),o}return $d(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Nm((function(){var r=Jx(1,t.accBeta1),i=Jx(1,t.accBeta2);n.forEach((function(n,o){var a=Sv.registeredVariables[n];null==t.accumulatedFirstMoment[o]&&(t.accumulatedFirstMoment[o]={originalName:n+"/m",variable:Nm((function(){return hg(a).variable(!1)}))}),null==t.accumulatedSecondMoment[o]&&(t.accumulatedSecondMoment[o]={originalName:n+"/v",variable:Nm((function(){return hg(a).variable(!1)}))});var s=Array.isArray(e)?e[o].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[o].variable,c=t.accumulatedSecondMoment[o].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2).add(s.square().mul(1-t.beta2)),f=l.div(r),d=h.div(i);u.assign(l),c.assign(h);var p=f.div(d.sqrt().add(t.epsilon)).mul(-t.learningRate).add(a);a.assign(p)}})),t.accBeta1.assign(t.accBeta1.mul(t.beta1)),t.accBeta2.assign(t.accBeta2.mul(t.beta2))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Om(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&Om(this.accumulatedSecondMoment.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return e=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){var t,n=this;return Jd(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(e)];case 1:return e=r.sent(),Nm((function(){n.accBeta1.assign(Yx(n.beta1,n.iterations_+1)),n.accBeta2.assign(Yx(n.beta2,n.iterations_+1))})),this.accumulatedFirstMoment=e.slice(0,t=e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedSecondMoment=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)},t.className="Adam",t}(OS);TS(MS);var LS=function(e){function t(t,n,r,i,o){void 0===i&&(i=null),void 0===o&&(o=0);var a=e.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=r,a.epsilon=i,a.decay=o,a.accumulatedFirstMoment=[],a.accumulatedWeightedInfNorm=[],Nm((function(){a.iteration=tg(0).variable(),a.accBeta1=tg(n).variable()})),null==i&&(a.epsilon=Sv.backend.epsilon()),a}return $d(t,e),t.prototype.applyGradients=function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);Nm((function(){var r=Jx(1,t.accBeta1),i=Bx(-t.learningRate,t.iteration.mul(t.decay).add(1));n.forEach((function(n,o){var a=Sv.registeredVariables[n];null==t.accumulatedFirstMoment[o]&&(t.accumulatedFirstMoment[o]={originalName:n+"/m",variable:hg(a).variable(!1)}),null==t.accumulatedWeightedInfNorm[o]&&(t.accumulatedWeightedInfNorm[o]={originalName:n+"/v",variable:hg(a).variable(!1)});var s=Array.isArray(e)?e[o].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[o].variable,c=t.accumulatedWeightedInfNorm[o].variable,l=u.mul(t.beta1).add(s.mul(1-t.beta1)),h=c.mul(t.beta2),f=s.abs(),d=h.maximum(f);u.assign(l),c.assign(d);var p=i.div(r).mul(l.div(d.add(t.epsilon))).add(a);a.assign(p)}})),t.iteration.assign(t.iteration.add(1)),t.accBeta1.assign(t.accBeta1.mul(t.beta1))})),this.incrementIterations()},t.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Om(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&Om(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},t.fromConfig=function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)},t.className="Adamax",t}(OS);TS(LS);var BS=function(e){function t(t){var n=e.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return $d(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=Sv.registeredVariables[n];Nm((function(){var e=t.c.mul(i).add(o);o.assign(e)}))}})),this.incrementIterations()},t.prototype.setLearningRate=function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=function(e){return Sv.keep(e)}(tg(-e))},t.prototype.dispose=function(){this.c.dispose()},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()]]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:if(0!==(e=t.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate}},t.fromConfig=function(e,t){return new e(t.learningRate)},t.className="SGD",t}(OS);TS(BS);var US=function(e){function t(t,n,r){void 0===r&&(r=!1);var i=e.call(this,t)||this;return i.learningRate=t,i.momentum=n,i.useNesterov=r,i.accumulations=[],i.m=tg(i.momentum),i}return $d(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Sv.registeredVariables[n];null==t.accumulations[r]&&(t.accumulations[r]={originalName:n+"/momentum",variable:Nm((function(){return hg(i).variable(!1)}))});var o=t.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[n];null!=a&&Nm((function(){var e,n=t.m.mul(o).add(a);e=t.useNesterov?t.c.mul(a.add(n.mul(t.m))).add(i):t.c.mul(n).add(i),o.assign(n),i.assign(e)}))})),this.incrementIterations()},t.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Om(this.accumulations.map((function(e){return e.variable})))},t.prototype.setMomentum=function(e){this.momentum=e},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(e){switch(e.label){case 0:return[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){return Jd(this,(function(t){switch(t.label){case 0:return[4,this.extractIterations(e)];case 1:return e=t.sent(),this.accumulations=e.map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},t.fromConfig=function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)},t.className="Momentum",t}(BS);TS(US);var WS=function(e){function t(t,n,r,i,o){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===i&&(i=null),void 0===o&&(o=!1);var a=e.call(this)||this;if(a.learningRate=t,a.decay=n,a.momentum=r,a.epsilon=i,a.accumulatedMeanSquares=[],a.accumulatedMoments=[],a.accumulatedMeanGrads=[],a.centered=o,null==i&&(a.epsilon=Sv.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.");return a}return $d(t,e),t.prototype.applyGradients=function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var i=Sv.registeredVariables[n];null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:Nm((function(){return hg(i).variable(!1)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:n+"/momentum",variable:Nm((function(){return hg(i).variable(!1)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:Nm((function(){return hg(i).variable(!1)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var a=t.accumulatedMeanSquares[r].variable,s=t.accumulatedMoments[r].variable;Nm((function(){var e=a.mul(t.decay).add(o.square().mul(1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,u=n.mul(t.decay).add(o.mul(1-t.decay)),c=s.mul(t.momentum).add(o.mul(t.learningRate).div(e.sub(u.square().add(t.epsilon)).sqrt()));a.assign(e),n.assign(u),s.assign(c);var l=i.sub(c);i.assign(l)}else{var h=a.mul(t.decay).add(o.square().mul(1-t.decay));c=s.mul(t.momentum).add(o.mul(t.learningRate).div(h.add(t.epsilon).sqrt())),a.assign(h),s.assign(c),l=i.sub(c),i.assign(l)}}))}})),this.incrementIterations()},t.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Om(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Om(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&Om(this.accumulatedMoments.map((function(e){return e.variable})))},t.prototype.getWeights=function(){return Zd(this,void 0,void 0,(function(){var e;return Jd(this,(function(t){switch(t.label){case 0:return e=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&e.push.apply(e,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(e.map((function(e){return{name:e.originalName,tensor:e.variable}})))]}}))}))},t.prototype.setWeights=function(e){return Zd(this,void 0,void 0,(function(){var t;return Jd(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(e)];case 1:return e=n.sent(),this.accumulatedMeanSquares=e.slice(0,t=this.centered?e.length/3:e.length/2).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.accumulatedMoments=e.slice(t,2*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=e.slice(2*t,3*t).map((function(e){return{originalName:e.name,variable:e.tensor.variable(!1)}}))),[2]}}))}))},t.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},t.fromConfig=function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)},t.className="RMSProp",t}(OS);TS(WS),function(){function e(){}e.sgd=function(e){return new BS(e)},e.momentum=function(e,t,n){return void 0===n&&(n=!1),new US(e,t,n)},e.rmsprop=function(e,t,n,r,i){return void 0===t&&(t=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===i&&(i=!1),new WS(e,t,n,r,i)},e.adam=function(e,t,n,r){return void 0===e&&(e=.001),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new MS(e,t,n,r)},e.adadelta=function(e,t,n){return void 0===e&&(e=.001),void 0===t&&(t=.95),void 0===n&&(n=null),new FS(e,t,n)},e.adamax=function(e,t,n,r,i){return void 0===e&&(e=.002),void 0===t&&(t=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===i&&(i=0),new LS(e,t,n,r,i)},e.adagrad=function(e,t){return void 0===t&&(t=.1),new PS(e,t)}}(),"undefined"!=typeof requestAnimationFrame?requestAnimationFrame:"undefined"!=typeof setImmediate&&setImmediate,cv.prototype.squaredDifference=function(e){return Ow(this,e)},sv=mE;var zS=function(){function e(e,t){if(!QS(e)||!QS(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){return new e(1/this.width,1/this.height)},e}();function VS(e,t){return e instanceof cv&&e.shape.length===t}function jS(e){return VS(e,3)}function HS(e){return VS(e,4)}function qS(e){return e%2==0}function GS(e){return e&&e.width&&e.height}function KS(e){return e.reduce((function(e,t){return e.add(t)}),new YS(0,0)).div(new YS(e.length,e.length))}function XS(e,t,n){return Array(e).fill(0).map((function(e,r){return t+r*n}))}function QS(e){return!!e&&e!==1/0&&e!==-1/0&&!isNaN(e)||0===e}var YS=function(){function e(e,t){this._x=e,this._y=t}return Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.sub=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.mul=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.div=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e}(),$S=function(){function e(t,n){void 0===n&&(n=!0);var r=t||{},i=[r.left,r.top,r.right,r.bottom].every(QS),o=[r.x,r.y,r.width,r.height].every(QS);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],c=a[2],l=a[3];e.assertIsValidBox({x:s,y:u,width:c,height:l},"Box.constructor",n),this._x=s,this._y=u,this._width=c,this._height=l}return e.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(QS)},e.assertIsValidBox=function(t,n,r){if(void 0===r&&(r=!1),!e.isRect(t))throw new Error(n+" - invalid box: "+JSON.stringify(t)+", expected object with properties x, y, width, height");if(!r&&(t.width<0||t.height<0))throw new Error(n+" - width ("+t.width+") and height ("+t.height+") must be positive numbers")},Object.defineProperty(e.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topLeft",{get:function(){return new YS(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"topRight",{get:function(){return new YS(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomLeft",{get:function(){return new YS(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bottomRight",{get:function(){return new YS(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.round=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.round(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.floor=function(){var t=[this.x,this.y,this.width,this.height].map((function(e){return Math.floor(e)}));return new e({x:t[0],y:t[1],width:t[2],height:t[3]})},e.prototype.toSquare=function(){var t=this.x,n=this.y,r=this.width,i=this.height,o=Math.abs(r-i);return r<i&&(t-=o/2,r+=o),i<r&&(n-=o/2,i+=o),new e({x:t,y:n,width:r,height:i})},e.prototype.rescale=function(t){var n=GS(t)?t.width:t,r=GS(t)?t.height:t;return new e({x:this.x*n,y:this.y*r,width:this.width*n,height:this.height*r})},e.prototype.pad=function(t,n){var r=[this.x-t/2,this.y-n/2,this.width+t,this.height+n];return new e({x:r[0],y:r[1],width:r[2],height:r[3]})},e.prototype.clipAtImageBorders=function(t,n){var r=this.y,i=this.right,o=this.bottom,a=Math.max(this.x,0),s=Math.max(r,0),u=o-s;return new e({x:a,y:s,width:Math.min(i-a,t-a),height:Math.min(u,n-s)}).floor()},e.prototype.shift=function(t,n){return new e({x:this.x+t,y:this.y+n,width:this.width,height:this.height})},e.prototype.padAtBorders=function(e,t){var n=this.width+1,r=this.height+1,i=n,o=r,a=this.left,s=this.top,u=this.right,c=this.bottom;return u>t&&(i=-u+t+n,u=t),c>e&&(o=-c+e+r,c=e),a<1&&(o=2-a,a=1),s<1&&(o=2-s,s=1),{dy:1,edy:o,dx:1,edx:i,y:s,ey:c,x:a,ex:u,w:n,h:r}},e.prototype.calibrate=function(t){return new e({left:this.left+t.left*this.width,top:this.top+t.top*this.height,right:this.right+t.right*this.width,bottom:this.bottom+t.bottom*this.height}).toSquare().round()},e}(),ZS=function(e){function t(t,n,r,i,o){return void 0===o&&(o=!1),e.call(this,{left:t,top:n,right:r,bottom:i},o)||this}return Hd(t,e),t}($S),JS=function(){function e(e,t,n,r,i){this._imageDims=new zS(i.width,i.height),this._score=e,this._classScore=t,this._className=n,this._box=new $S(r).rescale(this._imageDims)}return Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativeBox",{get:function(){return new $S(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),e.prototype.forSize=function(t,n){return new e(this.score,this.classScore,this.className,this.relativeBox,{width:t,height:n})},e}(),eI=function(e){function t(t,n,r){return e.call(this,t,t,"",n,r)||this}return Hd(t,e),t.prototype.forSize=function(n,r){var i=e.prototype.forSize.call(this,n,r);return new t(i.score,i.relativeBox,i.imageDims)},t}(JS);function tI(e,t,n){void 0===n&&(n=!0);var r=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left))*Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));return n?r/(e.area+t.area-r):r/Math.min(e.area,t.area)}function nI(e,t,n,r){void 0===r&&(r=!0);for(var i=t.map((function(e,t){return{score:e,boxIndex:t}})).sort((function(e,t){return e.score-t.score})).map((function(e){return e.boxIndex})),o=[],a=function(){var t=i.pop();o.push(t);for(var a=i,s=[],u=0;u<a.length;u++)s.push(tI(e[t],e[a[u]],r));i=i.filter((function(e,t){return s[t]<=n}))};i.length>0;)a();return o}function rI(e,t){return Nm((function(){var n=t[0],r=t[1],i=t[2],o=ug(Xd(e.shape.slice(0,3),[1]),n),a=ug(Xd(e.shape.slice(0,3),[1]),r),s=ug(Xd(e.shape.slice(0,3),[1]),i),u=fg([o,a,s],3);return Jx(e,u)}))}function iI(e){return 1/(1+Math.exp(-e))}var oI,aI=function(e){function t(t,n,r,i,o){return void 0===o&&(o=!1),e.call(this,{x:t,y:n,width:r,height:i},o)||this}return Hd(t,e),t}($S),sI=function(){function e(e,t,n){void 0===n&&(n=new YS(0,0));var r=t.width,i=t.height;this._imgDims=new zS(r,i),this._shift=n,this._positions=e.map((function(e){return e.mul(new YS(r,i)).add(n)}))}return Object.defineProperty(e.prototype,"shift",{get:function(){return new YS(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map((function(t){return t.sub(e._shift).div(new YS(e.imageWidth,e.imageHeight))}))},enumerable:!0,configurable:!0}),e.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},e.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new YS(e,t))},e.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},e.prototype.align=function(e,t){if(void 0===t&&(t={}),e){var n=e instanceof eI?e.box.floor():new $S(e);return this.shiftBy(n.x,n.y).align(null,t)}var r=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),i=r.minBoxPadding;return r.useDlibAlignment?this.alignDlib():this.alignMinBbox(i)},e.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[1],n=e[2],r=function(e){return n.sub(e).magnitude()},i=(r(e[0])+r(t))/2,o=Math.floor(i/.45),a=KS(e),s=Math.floor(Math.max(0,a.x-.5*o)),u=Math.floor(Math.max(0,a.y-.43*o));return new aI(s,u,Math.min(o,this.imageWidth+s),Math.min(o,this.imageHeight+u))},e.prototype.alignMinBbox=function(e){var t,n,r,i,o,a,s,u=(n=(t=this.positions).map((function(e){return e.x})),r=t.map((function(e){return e.y})),i=n.reduce((function(e,t){return t<e?t:e}),1/0),o=r.reduce((function(e,t){return t<e?t:e}),1/0),a=n.reduce((function(e,t){return e<t?t:e}),0),s=r.reduce((function(e,t){return e<t?t:e}),0),new ZS(i,o,a,s));return u.pad(u.width*e,u.height*e)},e.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},e}(),uI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.getRefPointsForAlignment=function(){var e=this.positions;return[e[0],e[1],KS([e[3],e[4]])]},t}(sI),cI=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.getJawOutline=function(){return this.positions.slice(0,17)},t.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},t.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},t.prototype.getNose=function(){return this.positions.slice(27,36)},t.prototype.getLeftEye=function(){return this.positions.slice(36,42)},t.prototype.getRightEye=function(){return this.positions.slice(42,48)},t.prototype.getMouth=function(){return this.positions.slice(48,68)},t.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(KS)},t}(sI);function lI(e,t){return Object.assign({},e,{detection:t})}function hI(){var e=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D:CanvasRenderingContext2D,Image:HTMLImageElement,ImageData:ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:e,readFile:function(){throw new Error("readFile - filesystem not available for browser environment")}}}function fI(e){var t="";if(!e)try{e=n(!function(){var e=new Error("Cannot find module 'fs'");throw e.code="MODULE_NOT_FOUND",e}())}catch(r){t=r.toString()}return{readFile:e?function(t){return new Promise((function(n,r){e.readFile(t,(function(e,t){return e?r(e):n(t)}))}))}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+t)}}}function dI(){var e=global.Canvas||global.HTMLCanvasElement,t=global.Image||global.HTMLImageElement,n=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},r=fI();return qd({Canvas:e||function(){},CanvasRenderingContext2D:global.CanvasRenderingContext2D||function(){},Image:t||function(){},ImageData:global.ImageData||function(){},Video:global.HTMLVideoElement||function(){},createCanvasElement:function(){if(e)return new e;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},createImageElement:function(){if(t)return new t;throw new Error("createImageElement - missing Image implementation for nodejs environment")},fetch:n},r)}function pI(){return"object"==typeof window&&"undefined"!=typeof document&&"undefined"!=typeof HTMLImageElement&&"undefined"!=typeof HTMLCanvasElement&&"undefined"!=typeof HTMLVideoElement&&"undefined"!=typeof ImageData&&"undefined"!=typeof CanvasRenderingContext2D}function vI(){return"object"==typeof global&&void 0!==e&&"undefined"!=typeof process&&!!process.version}function mI(e){oI=e}function gI(){pI()&&mI(hI()),vI()&&mI(dI())}var yI={getEnv:function(){if(!oI)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return oI},setEnv:mI,initialize:gI,createBrowserEnv:hI,createFileSystem:fI,createNodejsEnv:dI,monkeyPatch:function(e){if(oI||gI(),!oI)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var t=e.Canvas,n=void 0===t?oI.Canvas:t,r=e.Image,i=void 0===r?oI.Image:r;oI.Canvas=n,oI.Image=i,oI.createCanvasElement=e.createCanvasElement||function(){return new n},oI.createImageElement=e.createImageElement||function(){return new i},oI.ImageData=e.ImageData||oI.ImageData,oI.Video=e.Video||oI.Video,oI.fetch=e.fetch||oI.fetch,oI.readFile=e.readFile||oI.readFile},isBrowser:pI,isNodejs:vI};function bI(e){return yI.isNodejs()||"string"!=typeof e?e:document.getElementById(e)}function _I(e){var t=yI.getEnv(),n=t.Canvas;if(e instanceof t.CanvasRenderingContext2D)return e;var r=bI(e);if(!(r instanceof n))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var i=r.getContext("2d");if(!i)throw new Error("resolveContext2d - canvas 2d context is null");return i}function wI(e){var t=yI.getEnv();return e instanceof t.Image&&e.complete||e instanceof t.Video&&e.readyState>=3}function xI(e){var t=yI.getEnv(),n=t.Video;return e instanceof t.Image?new zS(e.naturalWidth,e.naturalHeight):e instanceof n?new zS(e.videoWidth,e.videoHeight):new zS(e.width,e.height)}function kI(e){var t=e.width,n=e.height,r=(0,yI.getEnv().createCanvasElement)();return r.width=t,r.height=n,r}function CI(e,t){var n=yI.getEnv().ImageData;if(!(e instanceof n||wI(e)))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=t||xI(e),i=r.width,o=r.height,a=kI({width:i,height:o});return e instanceof n?_I(a).putImageData(e,0,0):_I(a).drawImage(e,0,0,i,o),a}function EI(e,t){return Gd(this,void 0,void 0,(function(){var n,r,i,o,a,s;return Kd(this,(function(u){switch(u.label){case 0:return n=t||yI.getEnv().createCanvasElement(),r=e.shape.slice(HS(e)?1:0),i=r[0],o=r[1],a=r[2],s=Nm((function(){return e.as3D(i,o,a).toInt()})),[4,SS.toPixels(s,n)];case 1:return u.sent(),s.dispose(),[2,n]}}))}))}function SI(e){var t=yI.getEnv();return e instanceof t.Image||e instanceof t.Canvas||e instanceof t.Video}gI();var II=function(){function e(e,t){var n=this;if(void 0===t&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach((function(e,t){if(jS(e))return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape);if(HS(e)){var r=e.shape[0];if(1!==r)throw new Error("NetInput - tf.Tensor4D with batchSize "+r+" passed, but not supported in input array");return n._imageTensors[t]=e,void(n._inputDimensions[t]=e.shape.slice(1))}var i=e instanceof yI.getEnv().Canvas?e:CI(e);n._canvases[t]=i,n._inputDimensions[t]=[i.height,i.width,3]}))}return Object.defineProperty(e.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reshapedInputDimensions",{get:function(){var e=this;return XS(this.batchSize,0,1).map((function(t,n){return e.getReshapedInputDimensions(n)}))},enumerable:!0,configurable:!0}),e.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},e.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},e.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},e.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},e.prototype.getReshapedInputDimensions=function(e){if("number"!=typeof this.inputSize)throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");return n=(t={width:this.getInputWidth(e),height:this.getInputHeight(e)}).width,r=t.height,i=this.inputSize/Math.max(r,n),new zS(Math.round(n*i),Math.round(r*i));var t,n,r,i},e.prototype.toBatchTensor=function(e,t){var n=this;return void 0===t&&(t=!0),this._inputSize=e,Nm((function(){var r=XS(n.batchSize,0,1).map((function(r){var i=n.getInput(r);if(i instanceof cv){var o=HS(i)?i:i.expandDims();return(o=function(e,t){return void 0===t&&(t=!1),Nm((function(){var n=e.shape.slice(1),r=n[0],i=n[1];if(r===i)return e;var o=Math.abs(r-i),a=Math.round(o*(t?.5:1)),s=r>i?2:1,u=function(t){var n=e.shape.slice();return n[s]=t,ug(n,0)},c=u(a),l=o-c.shape[s],h=[t&&l?u(l):null,e,c].filter((function(e){return!!e})).map((function(e){return e.toFloat()}));return fg(h,s)}))}(o,t)).shape[1]===e&&o.shape[2]===e||(o=sE.resizeBilinear(o,[e,e])),o.as3D(e,e,3)}if(i instanceof yI.getEnv().Canvas)return SS.fromPixels(function(e,t,n){void 0===n&&(n=!1);var r=yI.getEnv(),i=r.Canvas;if(!(e instanceof r.Image||e instanceof i))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var o=xI(e),a=t/Math.max(o.height,o.width),s=a*o.width,u=a*o.height,c=kI({width:t,height:t}),l=e instanceof i?e:CI(e),h=Math.abs(s-u)/2,f=n&&s<u?h:0,d=n&&u<s?h:0;return _I(c).drawImage(l,f,d,s,u),c}(i,e,t));throw new Error("toBatchTensor - at batchIdx "+r+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+i)}));return Jg(r.map((function(e){return e.toFloat()}))).as4D(n.batchSize,e,e,3)}))},e}();function RI(e){return Gd(this,void 0,void 0,(function(){var t,n,r;return Kd(this,(function(i){switch(i.label){case 0:if(e instanceof II)return[2,e];if(!(t=Array.isArray(e)?e:[e]).length)throw new Error("toNetInput - empty array passed as input");return n=function(t){return Array.isArray(e)?" at input index "+t+":":""},(r=t.map(bI)).forEach((function(e,r){if(!SI(e)&&!jS(e)&&!HS(e)){if("string"==typeof t[r])throw new Error("toNetInput -"+n(r)+" string passed, but could not resolve HTMLElement for element id "+t[r]);throw new Error("toNetInput -"+n(r)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id")}if(HS(e)){var i=e.shape[0];if(1!==i)throw new Error("toNetInput -"+n(r)+" tf.Tensor4D with batchSize "+i+" passed, but not supported in input array")}})),[4,Promise.all(r.map((function(e){return SI(e)&&(t=e,new Promise((function(e,n){if(t instanceof yI.getEnv().Canvas||wI(t))return e();function r(t){t.currentTarget&&(t.currentTarget.removeEventListener("load",r),t.currentTarget.removeEventListener("error",i),e(t))}function i(e){e.currentTarget&&(e.currentTarget.removeEventListener("load",r),e.currentTarget.removeEventListener("error",i),n(e))}t.addEventListener("load",r),t.addEventListener("error",i)})));var t})))];case 1:return i.sent(),[2,new II(r,Array.isArray(e))]}}))}))}function TI(e,t){return Gd(this,void 0,void 0,(function(){var n,r,i,o,a,s;return Kd(this,(function(u){switch(u.label){case 0:return n=yI.getEnv().Canvas,r=e,e instanceof n?[3,5]:[4,RI(e)];case 1:if((i=u.sent()).batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return(o=i.getInput(0))instanceof n?(a=o,[3,4]):[3,2];case 2:return[4,EI(o)];case 3:a=u.sent(),u.label=4;case 4:r=a,u.label=5;case 5:return s=_I(r),[2,t.map((function(e){return e instanceof eI?e.forSize(r.width,r.height).box.floor():e})).map((function(e){return e.clipAtImageBorders(r.width,r.height)})).map((function(e){var t=e.x,n=e.y,r=e.width,i=e.height,o=kI({width:r,height:i});return _I(o).putImageData(s.getImageData(t,n,r,i),0,0),o}))]}}))}))}function AI(e,t){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(n){if(!jS(e)&&!HS(e))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(HS(e)&&e.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Nm((function(){var n=e.shape.slice(HS(e)?1:0),r=n[0],i=n[1],o=n[2];return t.map((function(e){return e instanceof eI?e.forSize(i,r).box:e})).map((function(e){return e.clipAtImageBorders(i,r)})).map((function(t){var n=t.x,a=t.y,s=t.width,u=t.height;return Qk(e.as3D(r,i,o),[a,n,0],[u,s,o])}))}))]}))}))}function DI(e,t){return Gd(this,void 0,void 0,(function(){var n;return Kd(this,(function(r){switch(r.label){case 0:return[4,(0,yI.getEnv().fetch)(e,t)];case 1:if(!((n=r.sent()).status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}}))}))}function NI(e){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(t){switch(t.label){case 0:return[4,DI(e)];case 1:return[2,t.sent().json()]}}))}))}function OI(e,t){var n=t+"-weights_manifest.json";if(!e)return{modelBaseUri:"",manifestUri:n};if("/"===e)return{modelBaseUri:"/",manifestUri:"/"+n};var r=e.startsWith("http://")?"http://":e.startsWith("https://")?"https://":"",i=(e=e.replace(r,"")).split("/").filter((function(e){return e})),o=e.endsWith(".json")?i[i.length-1]:n,a=r+(e.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return{modelBaseUri:a=e.startsWith("/")?"/"+a:a,manifestUri:"/"===a?"/"+o:a+"/"+o}}function FI(e,t){return Gd(this,void 0,void 0,(function(){var n,r,i;return Kd(this,(function(o){switch(o.label){case 0:return n=OI(e,t),r=n.modelBaseUri,[4,NI(n.manifestUri)];case 1:return i=o.sent(),[2,kS.loadWeights(i,r)]}}))}))}var PI=function(){function e(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(e.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),e.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e);return t.obj[t.objProp]},e.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),r=n.obj,i=n.objProp;r[i].dispose(),r[i]=t},e.prototype.getParamList=function(){var e=this;return this._paramMappings.map((function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}}))},e.prototype.getTrainableParams=function(){return this.getParamList().filter((function(e){return e.tensor instanceof mv}))},e.prototype.getFrozenParams=function(){return this.getParamList().filter((function(e){return!(e.tensor instanceof mv)}))},e.prototype.variable=function(){var e=this;this.getFrozenParams().forEach((function(t){e.reassignParamFromPath(t.path,t.tensor.variable())}))},e.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach((function(t){var n=t.path,r=t.tensor,i=Jm(r.dataSync());r.dispose(),e.reassignParamFromPath(n,i)}))},e.prototype.dispose=function(e){void 0===e&&(e=!0),this.getParamList().forEach((function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()})),this._params=void 0},e.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map((function(e){return Array.from(e.tensor.dataSync())})).reduce((function(e,t){return e.concat(t)})))},e.prototype.load=function(e){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.loadFromUri=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromUri - expected model uri");return[4,FI(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}}))}))},e.prototype.loadFromDisk=function(e){return Gd(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,c;return Kd(this,(function(l){switch(l.label){case 0:if(e&&"string"!=typeof e)throw new Error(this._name+".loadFromDisk - expected model file path");return t=yI.getEnv().readFile,n=OI(e,this.getDefaultModelName()),r=n.manifestUri,i=n.modelBaseUri,o=kS.weightsLoaderFactory((function(e){return Promise.all(e.map((function(e){return t(e).then((function(e){return e.buffer}))})))})),u=(s=JSON).parse,[4,t(r)];case 1:return a=u.apply(s,[l.sent().toString()]),[4,o(a,i)];case 2:return c=l.sent(),this.loadFromWeightMap(c),[2]}}))}))},e.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.params;this._paramMappings=t.paramMappings,this._params=n},e.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.params;this._paramMappings=t.paramMappings,this._params=n},e.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce((function(t,n){if(!t.nextObj.hasOwnProperty(n))throw new Error("traversePropertyPath - object does not have property "+n+", for path "+e);return{obj:t.nextObj,objProp:n,nextObj:t.nextObj[n]}}),{nextObj:this.params}),n=t.obj,r=t.objProp;if(!(n&&r&&n[r]instanceof cv))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:r}},e}();function MI(e,t,n){return Nm((function(){var r=Rk(e,t.depthwise_filter,t.pointwise_filter,n,"same");return Fx(r,t.bias)}))}function LI(e,t,n){return void 0===n&&(n=!1),Nm((function(){var r=fC(n?Fx(wk(e,t.conv0.filters,[2,2],"same"),t.conv0.bias):MI(e,t.conv0,[2,2])),i=MI(r,t.conv1,[1,1]),o=MI(fC(Fx(r,i)),t.conv2,[1,1]);return fC(Fx(r,Fx(i,o)))}))}function BI(e,t,n,r){return void 0===n&&(n=!1),void 0===r&&(r=!0),Nm((function(){var i=fC(n?Fx(wk(e,t.conv0.filters,r?[2,2]:[1,1],"same"),t.conv0.bias):MI(e,t.conv0,r?[2,2]:[1,1])),o=MI(i,t.conv1,[1,1]),a=MI(fC(Fx(i,o)),t.conv2,[1,1]),s=MI(fC(Fx(i,Fx(o,a))),t.conv3,[1,1]);return fC(Fx(i,Fx(o,Fx(a,s))))}))}function UI(e,t,n,r){return void 0===n&&(n="same"),void 0===r&&(r=!1),Nm((function(){var i=Fx(wk(e,t.filters,[1,1],n),t.bias);return r?fC(i):i}))}function WI(e,t){Object.keys(e).forEach((function(n){t.some((function(e){return e.originalPath===n}))||e[n].dispose()}))}function zI(e,t){return function(n,r,i,o){var a=og(e(n*r*i*i),[i,i,n,r]),s=ng(e(r));return t.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function VI(e,t){return function(n,r,i){var o=rg(e(n*r),[n,r]),a=ng(e(r));return t.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var jI=function(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n};function HI(e,t){return function(n,r,i){var o=og(e(9*n),[3,3,n,1]),a=og(e(n*r),[1,1,n,r]),s=ng(e(r));return t.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new jI(o,a,s)}}function qI(e){return function(t){var n=e(t+"/depthwise_filter",4),r=e(t+"/pointwise_filter",4),i=e(t+"/bias",1);return new jI(n,r,i)}}function GI(e,t){return function(n,r,i){var o=e[n];if(!VS(o,r))throw new Error("expected weightMap["+n+"] to be a Tensor"+r+"D, instead have "+o);return t.push({originalPath:n,paramPath:i||n}),o}}function KI(e){var t=e;return{extractWeights:function(e){var n=t.slice(0,e);return t=t.slice(e),n},getRemainingWeights:function(){return t}}}function XI(e,t){var n=zI(e,t),r=HI(e,t);function i(e,t,i,o){return void 0===o&&(o=!1),{conv0:o?n(e,t,3,i+"/conv0"):r(e,t,i+"/conv0"),conv1:r(t,t,i+"/conv1"),conv2:r(t,t,i+"/conv2")}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:function(e,t,n,o){void 0===o&&(o=!1);var a=i(e,t,n,o);return{conv0:a.conv0,conv1:a.conv1,conv2:a.conv2,conv3:r(t,t,n+"/conv3")}}}}function QI(e){return function(t){return{filters:e(t+"/filters",4),bias:e(t+"/bias",1)}}}function YI(e,t){var n=GI(e,t),r=QI(n),i=qI(n);return{extractDenseBlock3Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2")}},extractDenseBlock4Params:function(e,t){return void 0===t&&(t=!1),{conv0:t?r(e+"/conv0"):i(e+"/conv0"),conv1:i(e+"/conv1"),conv2:i(e+"/conv2"),conv3:i(e+"/conv3")}}}}var $I=function(e){function t(){return e.call(this,"FaceFeatureExtractor")||this}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceFeatureExtractor - load model before inference");return Nm((function(){var n=BI(rI(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tg(255)),t.dense0,!0);return n=BI(n,t.dense1),n=BI(n,t.dense2),n=BI(n,t.dense3),Vk(n,[7,7],[2,2],"valid")}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=YI(e,t).extractDenseBlock4Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2"),dense3:n("dense3")};return WI(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=KI(e),r=n.getRemainingWeights,i=XI(n.extractWeights,t).extractDenseBlock4Params,o=i(3,32,"dense0",!0),a=i(32,64,"dense1"),s=i(64,128,"dense2"),u=i(128,256,"dense3");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:t,params:{dense0:o,dense1:a,dense2:s,dense3:u}}}(e)},t}(PI);function ZI(e,t){return Nm((function(){return Fx(Dk(e,t.weights),t.bias)}))}function JI(e){var t={},n={};return Object.keys(e).forEach((function(r){(r.startsWith("fc")?n:t)[r]=e[r]})),{featureExtractorMap:t,classifierMap:n}}var eR=function(e){function t(t,n){var r=e.call(this,t)||this;return r._faceFeatureExtractor=n,r}return Hd(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Nm((function(){var r=e instanceof II?t.faceFeatureExtractor.forwardInput(e):e;return ZI(r.as2D(r.shape[0],-1),n.fc)}))},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.paramMappings;this._params=t.params,this._paramMappings=n},t.prototype.extractClassifierParams=function(e){return function(e,t,n){var r=[],i=KI(e),o=i.getRemainingWeights,a=VI(i.extractWeights,r)(t,n,"fc");if(0!==o().length)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:r,params:{fc:a}}}(e,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},t.prototype.extractParamsFromWeigthMap=function(e){var t=JI(e),n=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(t.featureExtractorMap),function(e){var t=[],n=GI(e,t),r={fc:{weights:n("fc/weights",2),bias:n("fc/bias",1)}};return WI(e,t),{params:r,paramMappings:t}}(n)},t.prototype.extractParams=function(e){var t=this.getClassifierChannelsIn(),n=this.getClassifierChannelsOut(),r=n*t+n,i=e.slice(0,e.length-r),o=e.slice(e.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},t}(PI),tR=["neutral","happy","sad","angry","fearful","disgusted","surprised"],nR=function(){function e(e){var t=this;if(7!==e.length)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);tR.forEach((function(n,r){t[n]=e[r]}))}return e.prototype.asSortedArray=function(){var e=this;return tR.map((function(t){return{expression:t,probability:e[t]}})).sort((function(e,t){return t.probability-e.probability}))},e}(),rR=function(e){function t(t){return void 0===t&&(t=new $I),e.call(this,"FaceExpressionNet",t)||this}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this;return Nm((function(){return wy(t.runNet(e))}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictExpressions=function(e){return Gd(this,void 0,void 0,(function(){var t,n,r,i,o=this;return Kd(this,(function(a){switch(a.label){case 0:return[4,RI(e)];case 1:return t=a.sent(),[4,this.forwardInput(t)];case 2:return n=a.sent(),[4,Promise.all(ny(n).map((function(e){return Gd(o,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return[4,e.data()];case 1:return t=n.sent(),e.dispose(),[2,t]}}))}))})))];case 3:return r=a.sent(),n.dispose(),i=r.map((function(e){return new nR(e)})),[2,t.isBatchInput?i:i[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_expression_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t.prototype.getClassifierChannelsOut=function(){return 7},t}(eR);function iR(e,t){var n=e.detection.box,r=t.shiftBy(n.x,n.y),i=r.align(),o=e.detection.imageDims,a=new eI(e.detection.score,i.rescale(o.reverse()),o);return Object.assign({},e,{landmarks:r,unshiftedLandmarks:t,alignedRect:a})}function oR(e,t,n){return Fx(wk(e,t.filters,n,"same"),t.bias)}function aR(e,t,n){void 0===n&&(n=!0);var r=n?fC(e):e;return r=MI(r,t.separable_conv0,[1,1]),r=MI(fC(r),t.separable_conv1,[1,1]),r=zk(r,[3,3],[2,2],"same"),Fx(r,oR(e,t.expansion_conv,[2,2]))}var sR=function(e){function t(t){var n=e.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this,n=this.params;if(!n)throw new Error("TinyXception - load model before inference");return Nm((function(){var r=rI(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tg(256)),i=fC(oR(r,n.entry_flow.conv_in,[2,2]));return i=aR(i,n.entry_flow.reduction_block_0,!1),i=aR(i,n.entry_flow.reduction_block_1),XS(t._numMainBlocks,0,1).forEach((function(e){i=function(e,t){var n=MI(fC(e),t.separable_conv0,[1,1]);return n=MI(fC(n),t.separable_conv1,[1,1]),n=MI(fC(n),t.separable_conv2,[1,1]),Fx(n,e)}(i,n.middle_flow["main_block_"+e])})),i=aR(i,n.exit_flow.reduction_block),i=fC(MI(i,n.exit_flow.separable_conv,[1,1]))}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_xception_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n=[],r=function(e,t){var n=GI(e,t),r=QI(n),i=qI(n);return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),expansion_conv:r(e+"/expansion_conv")}},extractMainBlockParams:function(e){return{separable_conv0:i(e+"/separable_conv0"),separable_conv1:i(e+"/separable_conv1"),separable_conv2:i(e+"/separable_conv2")}}}}(e,n),i=r.extractSeparableConvParams,o=r.extractReductionBlockParams,a=r.extractMainBlockParams,s={conv_in:(0,r.extractConvParams)("entry_flow/conv_in"),reduction_block_0:o("entry_flow/reduction_block_0"),reduction_block_1:o("entry_flow/reduction_block_1")},u={};XS(t,0,1).forEach((function(e){u["main_block_"+e]=a("middle_flow/main_block_"+e)}));var c={reduction_block:o("exit_flow/reduction_block"),separable_conv:i("exit_flow/separable_conv")};return WI(e,n),{params:{entry_flow:s,middle_flow:u,exit_flow:c},paramMappings:n}}(e,this._numMainBlocks)},t.prototype.extractParams=function(e){return function(e,t){var n=[],r=KI(e),i=r.getRemainingWeights,o=function(e,t){var n=zI(e,t),r=HI(e,t);return{extractConvParams:n,extractSeparableConvParams:r,extractReductionBlockParams:function(e,t,i){return{separable_conv0:r(e,t,i+"/separable_conv0"),separable_conv1:r(t,t,i+"/separable_conv1"),expansion_conv:n(e,t,1,i+"/expansion_conv")}},extractMainBlockParams:function(e,t){return{separable_conv0:r(e,e,t+"/separable_conv0"),separable_conv1:r(e,e,t+"/separable_conv1"),separable_conv2:r(e,e,t+"/separable_conv2")}}}}(r.extractWeights,n),a=o.extractSeparableConvParams,s=o.extractReductionBlockParams,u=o.extractMainBlockParams,c={conv_in:(0,o.extractConvParams)(3,32,3,"entry_flow/conv_in"),reduction_block_0:s(32,64,"entry_flow/reduction_block_0"),reduction_block_1:s(64,128,"entry_flow/reduction_block_1")},l={};XS(t,0,1).forEach((function(e){l["main_block_"+e]=u(128,"middle_flow/main_block_"+e)}));var h={reduction_block:s(128,256,"exit_flow/reduction_block"),separable_conv:a(256,512,"exit_flow/separable_conv")};if(0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:n,params:{entry_flow:c,middle_flow:l,exit_flow:h}}}(e,this._numMainBlocks)},t}(PI),uR=function(e){return e.FEMALE="female",e.MALE="male",e}({}),cR=function(e){function t(t){void 0===t&&(t=new sR(2));var n=e.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Hd(t,e),Object.defineProperty(t.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),t.prototype.runNet=function(e){var t=this,n=this.params;if(!n)throw new Error(this._name+" - load model before inference");return Nm((function(){var r=e instanceof II?t.faceFeatureExtractor.forwardInput(e):e,i=Vk(r,[7,7],[2,2],"valid").as2D(r.shape[0],-1);return{age:ZI(i,n.fc.age).as1D(),gender:ZI(i,n.fc.gender)}}))},t.prototype.forwardInput=function(e){var t=this;return Nm((function(){var n=t.runNet(e);return{age:n.age,gender:wy(n.gender)}}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.predictAgeAndGender=function(e){return Gd(this,void 0,void 0,(function(){var t,n,r,i,o,a,s=this;return Kd(this,(function(u){switch(u.label){case 0:return[4,RI(e)];case 1:return t=u.sent(),[4,this.forwardInput(t)];case 2:return n=u.sent(),r=ny(n.age),i=ny(n.gender),o=r.map((function(e,t){return{ageTensor:e,genderTensor:i[t]}})),[4,Promise.all(o.map((function(e){var t=e.ageTensor,n=e.genderTensor;return Gd(s,void 0,void 0,(function(){var e,r,i,o,a;return Kd(this,(function(s){switch(s.label){case 0:return[4,t.data()];case 1:return e=s.sent()[0],[4,n.data()];case 2:return r=s.sent()[0],o=(i=r>.5)?uR.MALE:uR.FEMALE,a=i?r:1-r,t.dispose(),n.dispose(),[2,{age:e,gender:o,genderProbability:a}]}}))}))})))];case 3:return a=u.sent(),n.age.dispose(),n.gender.dispose(),[2,t.isBatchInput?a:a[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"age_gender_model"},t.prototype.dispose=function(t){void 0===t&&(t=!0),this.faceFeatureExtractor.dispose(t),e.prototype.dispose.call(this,t)},t.prototype.loadClassifierParams=function(e){var t=this.extractClassifierParams(e),n=t.paramMappings;this._params=t.params,this._paramMappings=n},t.prototype.extractClassifierParams=function(e){return function(e){var t=[],n=KI(e),r=n.getRemainingWeights,i=VI(n.extractWeights,t),o=i(512,1,"fc/age"),a=i(512,2,"fc/gender");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:t,params:{fc:{age:o,gender:a}}}}(e)},t.prototype.extractParamsFromWeigthMap=function(e){var t=JI(e),n=t.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(t.featureExtractorMap),function(e){var t=[],n=GI(e,t);function r(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return WI(e,t),{params:i,paramMappings:t}}(n)},t.prototype.extractParams=function(e){var t=e.slice(0,e.length-1539),n=e.slice(e.length-1539);return this.faceFeatureExtractor.extractWeights(t),this.extractClassifierParams(n)},t}(PI),lR=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.postProcess=function(e,t,n){var r=n.map((function(e){var n=e.width,r=e.height,i=t/Math.max(r,n);return{width:n*i,height:r*i}})),i=r.length;return Nm((function(){var n=function(e,t){return Jg([ug([68],e),ug([68],t)],1).as2D(1,136).as1D()},o=function(e,t){var n=r[e],i=n.width,o=n.height;return t(i,o)?Math.abs(i-o)/2:0};return e.mul(ug([i,136],t)).sub(Jg(Array.from(Array(i),(function(e,t){return n(function(e){return o(e,(function(e,t){return e<t}))}(t),function(e){return o(e,(function(e,t){return t<e}))}(t))})))).div(Jg(Array.from(Array(i),(function(e,t){return n(r[t].width,r[t].height)}))))}))},t.prototype.forwardInput=function(e){var t=this;return Nm((function(){var n=t.runNet(e);return t.postProcess(n,e.inputSize,e.inputDimensions.map((function(e){return{height:e[0],width:e[1]}})))}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.detectLandmarks=function(e){return Gd(this,void 0,void 0,(function(){var t,n,r,i=this;return Kd(this,(function(o){switch(o.label){case 0:return[4,RI(e)];case 1:return t=o.sent(),n=Nm((function(){return ny(i.forwardInput(t))})),[4,Promise.all(n.map((function(e,n){return Gd(i,void 0,void 0,(function(){var r,i,o,a,s;return Kd(this,(function(u){switch(u.label){case 0:return o=(i=Array).from,[4,e.data()];case 1:return r=o.apply(i,[u.sent()]),a=r.filter((function(e,t){return qS(t)})),s=r.filter((function(e,t){return!qS(t)})),[2,new cI(Array(68).fill(0).map((function(e,t){return new YS(a[t],s[t])})),{height:t.getInputHeight(n),width:t.getInputWidth(n)})]}}))}))})))];case 2:return r=o.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getClassifierChannelsOut=function(){return 136},t}(eR),hR=function(e){function t(t){return void 0===t&&(t=new $I),e.call(this,"FaceLandmark68Net",t)||this}return Hd(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},t.prototype.getClassifierChannelsIn=function(){return 256},t}(lR),fR=function(e){function t(){return e.call(this,"TinyFaceFeatureExtractor")||this}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Nm((function(){var n=LI(rI(e.toBatchTensor(112,!0),[122.782,117.001,104.298]).div(tg(255)),t.dense0,!0);return n=LI(n,t.dense1),n=LI(n,t.dense2),Vk(n,[14,14],[2,2],"valid")}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=YI(e,t).extractDenseBlock3Params,r={dense0:n("dense0",!0),dense1:n("dense1"),dense2:n("dense2")};return WI(e,t),{params:r,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=KI(e),r=n.getRemainingWeights,i=XI(n.extractWeights,t).extractDenseBlock3Params,o=i(3,32,"dense0",!0),a=i(32,64,"dense1"),s=i(64,128,"dense2");if(0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{paramMappings:t,params:{dense0:o,dense1:a,dense2:s}}}(e)},t}(PI),dR=function(e){function t(t){return void 0===t&&(t=new fR),e.call(this,"FaceLandmark68TinyNet",t)||this}return Hd(t,e),t.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},t.prototype.getClassifierChannelsIn=function(){return 128},t}(lR);function pR(e,t,n,r,i){void 0===i&&(i="same");var o=t.conv,a=o.bias,s=wk(e,o.filters,n,i);return s=function(e,t){return Fx(Xx(e,t.weights),t.biases)}(s=Fx(s,a),t.scale),r?fC(s):s}function vR(e,t){return pR(e,t,[1,1],!1)}function mR(e,t){return pR(e,t,[2,2],!0,"valid")}function gR(e,t){var n=function(e,t){return pR(e,t,[1,1],!0)}(e,t.conv1);return n=vR(n,t.conv2),n=Fx(n,e),fC(n)}function yR(e,t){var n=mR(e,t.conv1);n=vR(n,t.conv2);var r=Vk(e,2,2,"valid"),i=sg(r.shape),o=r.shape[3]!==n.shape[3];if(r.shape[1]!==n.shape[1]||r.shape[2]!==n.shape[2]){var a=Xd(n.shape);a[1]=1;var s=sg(a),u=Xd((n=fg([n,s],1)).shape);u[2]=1;var c=sg(u);n=fg([n,c],2)}return r=o?fg([r,i],3):r,n=Fx(r,n),fC(n)}var bR=function(e){function t(){return e.call(this,"FaceRecognitionNet")||this}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("FaceRecognitionNet - load model before inference");return Nm((function(){var n=mR(rI(e.toBatchTensor(150,!0).toFloat(),[122.782,117.001,104.298]).div(tg(256)),t.conv32_down);n=gR(n=zk(n,3,2,"valid"),t.conv32_1),n=gR(n,t.conv32_2),n=gR(n,t.conv32_3),n=gR(n=yR(n,t.conv64_down),t.conv64_1),n=gR(n,t.conv64_2),n=gR(n,t.conv64_3),n=gR(n=yR(n,t.conv128_down),t.conv128_1),n=gR(n,t.conv128_2),n=gR(n=yR(n,t.conv256_down),t.conv256_1);var r=(n=yR(n=gR(n,t.conv256_2),t.conv256_down_out)).mean([1,2]);return Dk(r,t.fc)}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.computeFaceDescriptor=function(e){return Gd(this,void 0,void 0,(function(){var t,n,r,i=this;return Kd(this,(function(o){switch(o.label){case 0:return[4,RI(e)];case 1:return t=o.sent(),n=Nm((function(){return ny(i.forwardInput(t))})),[4,Promise.all(n.map((function(e){return e.data()})))];case 2:return r=o.sent(),n.forEach((function(e){return e.dispose()})),[2,t.isBatchInput?r:r[0]]}}))}))},t.prototype.getDefaultModelName=function(){return"face_recognition_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=GI(e,t);function r(e){return{conv:{filters:n(e+"/conv/filters",4),bias:n(e+"/conv/bias",1)},scale:function(e){return{weights:n(e+"/scale/weights",1),biases:n(e+"/scale/biases",1)}}(e)}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e){return{conv1:r(e+"/conv1"),conv2:r(e+"/conv2")}}}}(e,t),r=n.extractResidualLayerParams,i=(0,n.extractConvLayerParams)("conv32_down"),o=r("conv32_1"),a=r("conv32_2"),s=r("conv32_3"),u=r("conv64_down"),c=r("conv64_1"),l=r("conv64_2"),h=r("conv64_3"),f=r("conv128_down"),d=r("conv128_1"),p=r("conv128_2"),v=r("conv256_down"),m=r("conv256_1"),g=r("conv256_2"),y=r("conv256_down_out"),b=e.fc;if(t.push({originalPath:"fc",paramPath:"fc"}),!VS(b,2))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+b);var _={conv32_down:i,conv32_1:o,conv32_2:a,conv32_3:s,conv64_down:u,conv64_1:c,conv64_2:l,conv64_3:h,conv128_down:f,conv128_1:d,conv128_2:p,conv256_down:v,conv256_1:m,conv256_2:g,conv256_down_out:y,fc:b};return WI(e,t),{params:_,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=KI(e),n=t.extractWeights,r=t.getRemainingWeights,i=[],o=function(e,t){function n(n,r,i,o){var a=function(t,n,r){var i=e(t),o=i.length/(n*r*r);if(o%1!=0)throw new Error("depth has to be an integer: "+o+", weights.length: "+i.length+", numFilters: "+n+", filterSize: "+r);return Nm((function(){return vC(og(i,[n,o,r,r]),[2,3,1,0])}))}(n,r,i),s=ng(e(r));return t.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}function r(r,i,o,a){return{conv:n(r,i,o,a+"/conv"),scale:function(n,r){var i=ng(e(n)),o=ng(e(n));return t.push({paramPath:r+"/weights"},{paramPath:r+"/biases"}),{weights:i,biases:o}}(i,a+"/scale")}}return{extractConvLayerParams:r,extractResidualLayerParams:function(e,t,n,i,o){return void 0===o&&(o=!1),{conv1:r((o?.5:1)*e,t,n,i+"/conv1"),conv2:r(e,t,n,i+"/conv2")}}}}(n,i),a=o.extractResidualLayerParams,s=(0,o.extractConvLayerParams)(4704,32,7,"conv32_down"),u=a(9216,32,3,"conv32_1"),c=a(9216,32,3,"conv32_2"),l=a(9216,32,3,"conv32_3"),h=a(36864,64,3,"conv64_down",!0),f=a(36864,64,3,"conv64_1"),d=a(36864,64,3,"conv64_2"),p=a(36864,64,3,"conv64_3"),v=a(147456,128,3,"conv128_down",!0),m=a(147456,128,3,"conv128_1"),g=a(147456,128,3,"conv128_2"),y=a(589824,256,3,"conv256_down",!0),b=a(589824,256,3,"conv256_1"),_=a(589824,256,3,"conv256_2"),w=a(589824,256,3,"conv256_down_out"),x=Nm((function(){return vC(rg(n(32768),[128,256]),[1,0])}));if(i.push({paramPath:"fc"}),0!==r().length)throw new Error("weights remaing after extract: "+r().length);return{params:{conv32_down:s,conv32_1:u,conv32_2:c,conv32_3:l,conv64_down:h,conv64_1:f,conv64_2:d,conv64_3:p,conv128_down:v,conv128_1:m,conv128_2:g,conv256_down:y,conv256_1:b,conv256_2:_,conv256_down_out:w,fc:x},paramMappings:i}}(e)},t}(PI),_R=function(){function e(e){var t=void 0===e?{}:e,n=t.minFaceSize,r=t.scaleFactor,i=t.maxNumScales,o=t.scoreThresholds,a=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=r||.709,this._maxNumScales=i||10,this._scoreThresholds=o||[.6,.7,.7],this._scaleSteps=a,"number"!=typeof this._minFaceSize||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if("number"!=typeof this._scaleFactor||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if("number"!=typeof this._maxNumScales||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||3!==this._scoreThresholds.length||this._scoreThresholds.some((function(e){return"number"!=typeof e})))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some((function(e){return"number"!=typeof e}))))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(e.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),e}();function wR(e,t,n){return Nm((function(){var r=wk(e,t.filters,n,"same");return r=Fx(r,t.batch_norm_offset),Vw(r,0,6)}))}function xR(e,t,n){var r=e.arraySync(),i=Math.min(r[t][0],r[t][2]),o=Math.min(r[t][1],r[t][3]),a=Math.max(r[t][0],r[t][2]),s=Math.max(r[t][1],r[t][3]),u=Math.min(r[n][0],r[n][2]),c=Math.min(r[n][1],r[n][3]),l=Math.max(r[n][0],r[n][2]),h=Math.max(r[n][1],r[n][3]),f=(a-i)*(s-o),d=(l-u)*(h-c);if(f<=0||d<=0)return 0;var p=Math.max(i,u),v=Math.max(o,c),m=Math.min(a,l),g=Math.min(s,h),y=Math.max(m-p,0)*Math.max(g-v,0);return y/(f+d-y)}function kR(e,t){return Nm((function(){var n=e.shape[0];return{boxPredictionEncoding:Yg(UI(e,t.box_encoding_predictor),[n,-1,1,4]),classPrediction:Yg(UI(e,t.class_predictor),[n,-1,3])}}))}var CR=function(){function e(e){var t=void 0===e?{}:e,n=t.minConfidence,r=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=r||100,"number"!=typeof this._minConfidence||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if("number"!=typeof this._maxResults)throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(e.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),e}(),ER=function(e){function t(){return e.call(this,"SsdMobilenetv1")||this}return Hd(t,e),t.prototype.forwardInput=function(e){var t=this.params;if(!t)throw new Error("SsdMobilenetv1 - load model before inference");return Nm((function(){var n=e.toBatchTensor(512,!1).toFloat(),r=function(e,t){return Nm((function(){var n=null,r=wR(e,t.conv_0,[2,2]);if([t.conv_1,t.conv_2,t.conv_3,t.conv_4,t.conv_5,t.conv_6,t.conv_7,t.conv_8,t.conv_9,t.conv_10,t.conv_11,t.conv_12,t.conv_13].forEach((function(e,t){var i=t+1,o=function(e){return[2,4,6,12].some((function(t){return t===e}))?[2,2]:[1,1]}(i);r=wR(r=function(e,t,n){return Nm((function(){var r=Ek(e,t.filters,n,"same");return r=Cx(r,t.batch_norm_mean,t.batch_norm_variance,t.batch_norm_offset,t.batch_norm_scale,.0010000000474974513),Vw(r,0,6)}))}(r,e.depthwise_conv,o),e.pointwise_conv,[1,1]),11===i&&(n=r)})),null===n)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:n}}))}(Jx(Xx(n,tg(.007843137718737125)),tg(1)),t.mobilenetv1),i=function(e,t,n){return Nm((function(){var r=wR(e,n.conv_0,[1,1]),i=wR(r,n.conv_1,[2,2]),o=wR(i,n.conv_2,[1,1]),a=wR(o,n.conv_3,[2,2]),s=wR(a,n.conv_4,[1,1]),u=wR(s,n.conv_5,[2,2]),c=wR(u,n.conv_6,[1,1]),l=wR(c,n.conv_7,[2,2]),h=kR(t,n.box_predictor_0),f=kR(e,n.box_predictor_1),d=kR(i,n.box_predictor_2),p=kR(a,n.box_predictor_3),v=kR(u,n.box_predictor_4),m=kR(l,n.box_predictor_5);return{boxPredictions:fg([h.boxPredictionEncoding,f.boxPredictionEncoding,d.boxPredictionEncoding,p.boxPredictionEncoding,v.boxPredictionEncoding,m.boxPredictionEncoding],1),classPredictions:fg([h.classPrediction,f.classPrediction,d.classPrediction,p.classPrediction,v.classPrediction,m.classPrediction],1)}}))}(r.out,r.conv11,t.prediction_layer);return function(e,t,n){return Nm((function(){var r=e.shape[0],i=function(e,t){var n=function(e){var t=ny(vC(e,[1,0])),n=[Jx(t[2],t[0]),Jx(t[3],t[1])];return{sizes:n,centers:[Fx(t[0],Bx(n[0],tg(2))),Fx(t[1],Bx(n[1],tg(2)))]}}(e),r=n.sizes,i=n.centers,o=ny(vC(t,[1,0])),a=Bx(Xx(Gw(Bx(o[2],tg(5))),r[0]),tg(2)),s=Fx(Xx(Bx(o[0],tg(10)),r[0]),i[0]),u=Bx(Xx(Gw(Bx(o[3],tg(5))),r[1]),tg(2)),c=Fx(Xx(Bx(o[1],tg(10)),r[1]),i[1]);return vC(Jg([Jx(s,a),Jx(c,u),Fx(s,a),Fx(c,u)]),[1,0])}(Yg(ey(n.extra_dim,[r,1,1]),[-1,4]),Yg(e,[-1,4]));i=Yg(i,[r,i.shape[0]/r,4]);var o=nx(Gk(t,[0,0,1],[-1,-1,-1])),a=Gk(o,[0,0,0],[-1,-1,1]);return a=Yg(a,[r,a.shape[1]]),{boxes:ny(i),scores:ny(a)}}))}(i.boxPredictions,i.classPredictions,t.output_layer)}))},t.prototype.forward=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=this.forwardInput,[4,RI(e)];case 1:return[2,t.apply(this,[n.sent()])]}}))}))},t.prototype.locateFaces=function(e,t){return void 0===t&&(t={}),Gd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,g,y,b,_,w;return Kd(this,(function(x){switch(x.label){case 0:return n=new CR(t),r=n.maxResults,i=n.minConfidence,[4,RI(e)];case 1:for(o=x.sent(),a=this.forwardInput(o),c=(s=a.boxes)[0],l=(u=a.scores)[0],h=1;h<s.length;h++)s[h].dispose(),u[h].dispose();return p=(d=Array).from,[4,l.data()];case 2:return f=p.apply(d,[x.sent()]),v=function(e,t,n,r,i){var o=Math.min(n,e.shape[0]),a=t.map((function(e,t){return{score:e,boxIndex:t}})).filter((function(e){return e.score>i})).sort((function(e,t){return t.score-e.score})),s=[];return a.forEach((function(t){if(!(s.length>=o)){for(var n=t.score,r=s.length-1;r>=0;--r){var a=xR(e,t.boxIndex,s[r]);if(0!==a&&(t.score*=a<=.5?1:0,t.score<=i))break}n===t.score&&s.push(t.boxIndex)}})),s}(c,f,r,0,i),m=o.getReshapedInputDimensions(0),y=(g=o.inputSize)/m.width,b=g/m.height,_=c.arraySync(),w=v.map((function(e){var t=[Math.max(0,_[e][0]),Math.min(1,_[e][2])].map((function(e){return e*b})),n=t[0],r=t[1],i=[Math.max(0,_[e][1]),Math.min(1,_[e][3])].map((function(e){return e*y})),a=i[0];return new eI(f[e],new aI(a,n,i[1]-a,r-n),{height:o.getInputHeight(0),width:o.getInputWidth(0)})})),c.dispose(),l.dispose(),[2,w]}}))}))},t.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=GI(e,t);function r(e,t,r){return{filters:n(e+"/Conv2d_"+t+"_pointwise/weights",4,r+"/filters"),batch_norm_offset:n(e+"/Conv2d_"+t+"_pointwise/convolution_bn_offset",1,r+"/batch_norm_offset")}}function i(e){var t="mobilenetv1/conv_"+e,i="MobilenetV1/Conv2d_"+e+"_depthwise",o=t+"/depthwise_conv",a=t+"/pointwise_conv";return{depthwise_conv:{filters:n(i+"/depthwise_weights",4,o+"/filters"),batch_norm_scale:n(i+"/BatchNorm/gamma",1,o+"/batch_norm_scale"),batch_norm_offset:n(i+"/BatchNorm/beta",1,o+"/batch_norm_offset"),batch_norm_mean:n(i+"/BatchNorm/moving_mean",1,o+"/batch_norm_mean"),batch_norm_variance:n(i+"/BatchNorm/moving_variance",1,o+"/batch_norm_variance")},pointwise_conv:r("MobilenetV1",e,a)}}function o(e,t){return{filters:n(e+"/weights",4,t+"/filters"),bias:n(e+"/biases",1,t+"/bias")}}function a(e){return{box_encoding_predictor:o("Prediction/BoxPredictor_"+e+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+e+"/box_encoding_predictor"),class_predictor:o("Prediction/BoxPredictor_"+e+"/ClassPredictor","prediction_layer/box_predictor_"+e+"/class_predictor")}}return{extractMobilenetV1Params:function(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}},extractPredictionLayerParams:function(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:a(0),box_predictor_1:a(1),box_predictor_2:a(2),box_predictor_3:a(3),box_predictor_4:a(4),box_predictor_5:a(5)}}}}(e,t),r=n.extractMobilenetV1Params,i=n.extractPredictionLayerParams,o=e["Output/extra_dim"];if(t.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!jS(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return WI(e,t),{params:a,paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=[],n=KI(e),r=n.extractWeights,i=n.getRemainingWeights,o=function(e,t){function n(n,r,i,o,a){var s=og(e(n*r*i*i),[i,i,n,r]),u=ng(e(r));return t.push({paramPath:o+"/filters"},{paramPath:o+"/"+(a?"batch_norm_offset":"bias")}),{filters:s,bias:u}}function r(e,t,r,i){var o=n(e,t,r,i,!0);return{filters:o.filters,batch_norm_offset:o.bias}}function i(n,i,o){return{depthwise_conv:function(n,r){var i=og(e(9*n),[3,3,n,1]),o=ng(e(n)),a=ng(e(n)),s=ng(e(n)),u=ng(e(n));return t.push({paramPath:r+"/filters"},{paramPath:r+"/batch_norm_scale"},{paramPath:r+"/batch_norm_offset"},{paramPath:r+"/batch_norm_mean"},{paramPath:r+"/batch_norm_variance"}),{filters:i,batch_norm_scale:o,batch_norm_offset:a,batch_norm_mean:s,batch_norm_variance:u}}(n,o+"/depthwise_conv"),pointwise_conv:r(n,i,1,o+"/pointwise_conv")}}return{extractMobilenetV1Params:function(){return{conv_0:r(3,32,3,"mobilenetv1/conv_0"),conv_1:i(32,64,"mobilenetv1/conv_1"),conv_2:i(64,128,"mobilenetv1/conv_2"),conv_3:i(128,128,"mobilenetv1/conv_3"),conv_4:i(128,256,"mobilenetv1/conv_4"),conv_5:i(256,256,"mobilenetv1/conv_5"),conv_6:i(256,512,"mobilenetv1/conv_6"),conv_7:i(512,512,"mobilenetv1/conv_7"),conv_8:i(512,512,"mobilenetv1/conv_8"),conv_9:i(512,512,"mobilenetv1/conv_9"),conv_10:i(512,512,"mobilenetv1/conv_10"),conv_11:i(512,512,"mobilenetv1/conv_11"),conv_12:i(512,1024,"mobilenetv1/conv_12"),conv_13:i(1024,1024,"mobilenetv1/conv_13")}},extractPredictionLayerParams:function(){return{conv_0:r(1024,256,1,"prediction_layer/conv_0"),conv_1:r(256,512,3,"prediction_layer/conv_1"),conv_2:r(512,128,1,"prediction_layer/conv_2"),conv_3:r(128,256,3,"prediction_layer/conv_3"),conv_4:r(256,128,1,"prediction_layer/conv_4"),conv_5:r(128,256,3,"prediction_layer/conv_5"),conv_6:r(256,64,1,"prediction_layer/conv_6"),conv_7:r(64,128,3,"prediction_layer/conv_7"),box_predictor_0:{box_encoding_predictor:n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),class_predictor:n(512,9,1,"prediction_layer/box_predictor_0/class_predictor")},box_predictor_1:{box_encoding_predictor:n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),class_predictor:n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor")},box_predictor_2:{box_encoding_predictor:n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),class_predictor:n(512,18,1,"prediction_layer/box_predictor_2/class_predictor")},box_predictor_3:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_3/class_predictor")},box_predictor_4:{box_encoding_predictor:n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),class_predictor:n(256,18,1,"prediction_layer/box_predictor_4/class_predictor")},box_predictor_5:{box_encoding_predictor:n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),class_predictor:n(128,18,1,"prediction_layer/box_predictor_5/class_predictor")}}}}}(r,t),a=o.extractPredictionLayerParams,s=(0,o.extractMobilenetV1Params)(),u=a(),c={extra_dim:ig(r(20472),[1,5118,4])};if(t.push({paramPath:"output_layer/extra_dim"}),0!==i().length)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:s,prediction_layer:u,output_layer:c},paramMappings:t}}(e)},t}(PI),SR=[new YS(.738768,.874946),new YS(2.42204,2.65704),new YS(4.30971,7.04493),new YS(10.246,4.59428),new YS(12.6868,11.8741)],IR=[new YS(1.603231,2.094468),new YS(6.041143,7.080126),new YS(2.882459,3.518061),new YS(4.266906,5.178857),new YS(9.041765,10.66308)],RR=[117.001,114.697,97.404],TR=function(e){return"number"==typeof e};function AR(e){return Nm((function(){var t=Xx(e,tg(.10000000149011612));return Fx(fC(Jx(e,t)),t)}))}function DR(e,t){return Nm((function(){var n=zg(e,[[0,0],[1,1],[1,1],[0,0]]);return n=wk(n,t.conv.filters,[1,1],"valid"),n=Jx(n,t.bn.sub),n=Xx(n,t.bn.truediv),AR(n=Fx(n,t.conv.bias))}))}function NR(e,t){return Nm((function(){var n=zg(e,[[0,0],[1,1],[1,1],[0,0]]);return n=Rk(n,t.depthwise_filter,t.pointwise_filter,[1,1],"valid"),AR(n=Fx(n,t.bias))}))}var OR=function(){function e(e){var t=void 0===e?{}:e,n=t.inputSize,r=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=r||.5,"number"!=typeof this._inputSize||this._inputSize%32!=0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if("number"!=typeof this._scoreThreshold||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(e.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),e}(),FR=function(e){function t(t){var n=e.call(this,"TinyYolov2")||this;return function(e){if(!e)throw new Error("invalid config: "+e);if("boolean"!=typeof e.withSeparableConvs)throw new Error("config.withSeparableConvs has to be a boolean, have: "+e.withSeparableConvs);if(!TR(e.iouThreshold)||e.iouThreshold<0||e.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+e.iouThreshold);if(!Array.isArray(e.classes)||!e.classes.length||!e.classes.every((function(e){return"string"==typeof e})))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(e.classes));if(!Array.isArray(e.anchors)||!e.anchors.length||!e.anchors.map((function(e){return e||{}})).every((function(e){return TR(e.x)&&TR(e.y)})))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(e.anchors));if(e.meanRgb&&(!Array.isArray(e.meanRgb)||3!==e.meanRgb.length||!e.meanRgb.every(TR)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(e.meanRgb))}(t),n._config=t,n}return Hd(t,e),Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),t.prototype.runTinyYolov2=function(e,t){var n=DR(e,t.conv0);return n=DR(n=zk(n,[2,2],[2,2],"same"),t.conv1),n=DR(n=zk(n,[2,2],[2,2],"same"),t.conv2),n=DR(n=zk(n,[2,2],[2,2],"same"),t.conv3),n=DR(n=zk(n,[2,2],[2,2],"same"),t.conv4),n=DR(n=zk(n,[2,2],[2,2],"same"),t.conv5),n=DR(n=zk(n,[2,2],[1,1],"same"),t.conv6),UI(n=DR(n,t.conv7),t.conv8,"valid",!1)},t.prototype.runMobilenet=function(e,t){var n=this.config.isFirstLayerConv2d?AR(UI(e,t.conv0,"valid",!1)):NR(e,t.conv0);return n=NR(n=zk(n,[2,2],[2,2],"same"),t.conv1),n=NR(n=zk(n,[2,2],[2,2],"same"),t.conv2),n=NR(n=zk(n,[2,2],[2,2],"same"),t.conv3),n=NR(n=zk(n,[2,2],[2,2],"same"),t.conv4),n=NR(n=zk(n,[2,2],[2,2],"same"),t.conv5),n=zk(n,[2,2],[1,1],"same"),n=t.conv6?NR(n,t.conv6):n,UI(n=t.conv7?NR(n,t.conv7):n,t.conv8,"valid",!1)},t.prototype.forwardInput=function(e,t){var n=this,r=this.params;if(!r)throw new Error("TinyYolov2 - load model before inference");return Nm((function(){var i=e.toBatchTensor(t,!1).toFloat();return i=(i=n.config.meanRgb?rI(i,n.config.meanRgb):i).div(tg(256)),n.config.withSeparableConvs?n.runMobilenet(i,r):n.runTinyYolov2(i,r)}))},t.prototype.forward=function(e,t){return Gd(this,void 0,void 0,(function(){var n;return Kd(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,RI(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent()]}}))}))},t.prototype.detect=function(e,t){return void 0===t&&(t={}),Gd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,h,f,d,p=this;return Kd(this,(function(v){switch(v.label){case 0:return n=new OR(t),r=n.inputSize,i=n.scoreThreshold,[4,RI(e)];case 1:return o=v.sent(),[4,this.forwardInput(o,r)];case 2:return a=v.sent(),s=Nm((function(){return ny(a)[0].expandDims()})),u={width:o.getInputWidth(0),height:o.getInputHeight(0)},[4,this.extractBoxes(s,o.getReshapedInputDimensions(0),i)];case 3:return c=v.sent(),a.dispose(),s.dispose(),l=c.map((function(e){return e.box})),h=c.map((function(e){return e.score})),f=c.map((function(e){return e.classScore})),d=c.map((function(e){return p.config.classes[e.label]})),[2,nI(l.map((function(e){return e.rescale(r)})),h,this.config.iouThreshold,!0).map((function(e){return new JS(h[e],f[e],d[e],l[e],u)}))]}}))}))},t.prototype.getDefaultModelName=function(){return""},t.prototype.extractParamsFromWeigthMap=function(e){return function(e,t){var n,r=[],i=function(e,t){var n=GI(e,t);function r(e){return{filters:n(e+"/filters",4),bias:n(e+"/bias",1)}}return{extractConvParams:r,extractConvWithBatchNormParams:function(e){return{conv:r(e+"/conv"),bn:function(e){return{sub:n(e+"/sub",1),truediv:n(e+"/truediv",1)}}(e+"/bn")}},extractSeparableConvParams:qI(n)}}(e,r),o=i.extractConvParams,a=i.extractConvWithBatchNormParams,s=i.extractSeparableConvParams;if(t.withSeparableConvs){var u=t.filterSizes&&t.filterSizes.length||9;n={conv0:t.isFirstLayerConv2d?o("conv0"):s("conv0"),conv1:s("conv1"),conv2:s("conv2"),conv3:s("conv3"),conv4:s("conv4"),conv5:s("conv5"),conv6:u>7?s("conv6"):void 0,conv7:u>8?s("conv7"):void 0,conv8:o("conv8")}}else n={conv0:a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:a("conv6"),conv7:a("conv7"),conv8:o("conv8")};return WI(e,r),{params:n,paramMappings:r}}(e,this.config)},t.prototype.extractParams=function(e){var n=this.config.filterSizes||t.DEFAULT_FILTER_SIZES,r=n?n.length:void 0;if(7!==r&&8!==r&&9!==r)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+r+" filterSizes in config");return function(e,t,n,r){var i,o=KI(e),a=o.getRemainingWeights,s=[],u=function(e,t){var n=zI(e,t),r=HI(e,t);return{extractConvParams:n,extractConvWithBatchNormParams:function(r,i,o){return{conv:n(r,i,3,o+"/conv"),bn:function(n,r){var i=ng(e(n)),o=ng(e(n));return t.push({paramPath:r+"/sub"},{paramPath:r+"/truediv"}),{sub:i,truediv:o}}(i,o+"/bn")}},extractSeparableConvParams:r}}(o.extractWeights,s),c=u.extractConvParams,l=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams;if(t.withSeparableConvs){var f=r[0],d=r[1],p=r[2],v=r[3],m=r[4],g=r[5],y=r[6],b=r[7],_=r[8];i={conv0:t.isFirstLayerConv2d?c(f,d,3,"conv0"):h(f,d,"conv0"),conv1:h(d,p,"conv1"),conv2:h(p,v,"conv2"),conv3:h(v,m,"conv3"),conv4:h(m,g,"conv4"),conv5:h(g,y,"conv5"),conv6:b?h(y,b,"conv6"):void 0,conv7:_?h(b,_,"conv7"):void 0,conv8:c(_||b||y,5*n,1,"conv8")}}else p=r[2],v=r[3],m=r[4],g=r[5],y=r[6],b=r[7],_=r[8],i={conv0:l(f=r[0],d=r[1],"conv0"),conv1:l(d,p,"conv1"),conv2:l(p,v,"conv2"),conv3:l(v,m,"conv3"),conv4:l(m,g,"conv4"),conv5:l(g,y,"conv5"),conv6:l(y,b,"conv6"),conv7:l(b,_,"conv7"),conv8:c(_,5*n,1,"conv8")};if(0!==a().length)throw new Error("weights remaing after extract: "+a().length);return{params:i,paramMappings:s}}(e,this.config,this.boxEncodingSize,n)},t.prototype.extractBoxes=function(e,t,n){return Gd(this,void 0,void 0,(function(){var r,i,o,a,s,u,c,l,h,f,d,p,v,m,g,y,b,_,w,x,k,C,E,S,I,R,T,A,D,N=this;return Kd(this,(function(O){switch(O.label){case 0:return r=t.width,i=t.height,o=Math.max(r,i),a=o/r,s=o/i,u=e.shape[1],c=this.config.anchors.length,l=Nm((function(){var t=e.reshape([u,u,c,N.boxEncodingSize]);return[t.slice([0,0,0,0],[u,u,c,4]),t.slice([0,0,0,4],[u,u,c,1]),N.withClassScores?wy(t.slice([0,0,0,5],[u,u,c,N.config.classes.length]),3):tg(0)]})),h=l[0],d=l[2],p=[],[4,(f=l[1]).array()];case 1:return v=O.sent(),[4,h.array()];case 2:m=O.sent(),g=0,O.label=3;case 3:if(!(g<u))return[3,12];y=0,O.label=4;case 4:if(!(y<u))return[3,11];b=0,O.label=5;case 5:return b<c?(_=iI(v[g][y][b][0]),!n||_>n?(w=(y+iI(m[g][y][b][0]))/u*a,x=(g+iI(m[g][y][b][1]))/u*s,k=Math.exp(m[g][y][b][2])*this.config.anchors[b].x/u*a,C=Math.exp(m[g][y][b][3])*this.config.anchors[b].y/u*s,E=w-k/2,S=x-C/2,I={row:g,col:y,anchor:b},this.withClassScores?[4,this.extractPredictedClass(d,I)]:[3,7]):[3,9]):[3,10];case 6:return D=O.sent(),[3,8];case 7:D={classScore:1,label:0},O.label=8;case 8:T=(R=D).classScore,A=R.label,p.push(qd({box:new ZS(E,S,E+k,S+C),score:_,classScore:_*T,label:A},I)),O.label=9;case 9:return b++,[3,5];case 10:return y++,[3,4];case 11:return g++,[3,3];case 12:return h.dispose(),f.dispose(),d.dispose(),[2,p]}}))}))},t.prototype.extractPredictedClass=function(e,t){return Gd(this,void 0,void 0,(function(){var n,r,i,o;return Kd(this,(function(a){switch(a.label){case 0:return n=t.row,r=t.col,i=t.anchor,[4,e.array()];case 1:return o=a.sent(),[2,Array(this.config.classes.length).fill(0).map((function(e,t){return o[n][r][i][t]})).map((function(e,t){return{classScore:e,label:t}})).reduce((function(e,t){return e.classScore>t.classScore?e:t}))]}}))}))},t.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],t}(PI),PR=function(e){function t(t){void 0===t&&(t=!0);var n=Object.assign({},{withSeparableConvs:t,iouThreshold:.4,classes:["face"]},t?{anchors:IR,meanRgb:RR}:{anchors:SR,withClassScores:!0});return e.call(this,n)||this}return Hd(t,e),Object.defineProperty(t.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new eI(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return this.withSeparableConvs?"tiny_yolov2_separable_conv_model":"tiny_yolov2_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(FR),MR=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return Hd(t,e),t}(OR),LR=function(){function e(){}return e.prototype.then=function(e){return Gd(this,void 0,void 0,(function(){var t;return Kd(this,(function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}}))}))},e.prototype.run=function(){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(e){throw new Error("ComposableTask - run is not implemented")}))}))},e}();function BR(e,t,n,r,i){return void 0===i&&(i=function(e){return e.alignedRect}),Gd(this,void 0,void 0,(function(){var o,a,s,u,c;return Kd(this,(function(l){switch(l.label){case 0:return o=e.map((function(e){return function(e){return e.detection instanceof eI}(t=e)&&t.landmarks instanceof sI&&t.unshiftedLandmarks instanceof sI&&t.alignedRect instanceof eI?i(e):e.detection;var t})),(s=r)?[3,5]:t instanceof cv?[4,AI(t,o)]:[3,2];case 1:return u=l.sent(),[3,4];case 2:return[4,TI(t,o)];case 3:u=l.sent(),l.label=4;case 4:s=u,l.label=5;case 5:return[4,n(a=s)];case 6:return c=l.sent(),a.forEach((function(e){return e instanceof cv&&e.dispose()})),[2,c]}}))}))}function UR(e,t){var n=t[1];return{height:Math.floor(t[0]*e),width:Math.floor(n*e)}}var WR=function(e){function t(t,n,r,i){return e.call(this,{left:t,top:n,right:r,bottom:i},!0)||this}return Hd(t,e),t}($S);function zR(e){return Nm((function(){return Xx(Jx(e,tg(127.5)),tg(.0078125))}))}function VR(e,t){return Nm((function(){return Fx(fC(e),Xx(t,Zw(fC(Zw(e)))))}))}function jR(e,t,n){return void 0===n&&(n=!1),Nm((function(){var r=UI(e,t.conv1,"valid");return r=VR(r,t.prelu1_alpha),r=VR(r=UI(r=zk(r,n?[2,2]:[3,3],[2,2],"same"),t.conv2,"valid"),t.prelu2_alpha),VR(r=UI(r=n?r:zk(r,[3,3],[2,2],"valid"),t.conv3,"valid"),t.prelu3_alpha)}))}function HR(e,t,n,r,i){i.stage1=[];var o=t.map((function(t){return Nm((function(){var n={scale:t},i=function(e,t){return Nm((function(){var n=UR(t,e.shape.slice(1)),r=zR(sE.resizeBilinear(e,[n.height,n.width]));return vC(r,[0,2,1,3])}))}(e,t),o=Date.now(),a=function(e,t){return Nm((function(){var n=jR(e,t,!0),r=UI(n,t.conv4_1,"valid"),i=Lg(rC(r,3),3);return{prob:wy(Jx(r,i),3),regions:UI(n,t.conv4_2,"valid")}}))}(i,r),s=a.prob,u=a.regions;return n.pnet=Date.now()-o,{scoresTensor:ny(ny(s,3)[1])[0],regionsTensor:ny(u)[0],scale:t,statsForScale:n}}))})).map((function(e){var t=e.scoresTensor,r=e.regionsTensor,o=e.statsForScale,a=function(e,t,n,r){for(var i=[],o=e.arraySync(),a=0;a<e.shape[0];a++)for(var s=0;s<e.shape[1];s++)o[a][s]>=r&&i.push(new YS(s,a));return i.map((function(e){var r=new ZS(Math.round((2*e.y+1)/n),Math.round((2*e.x+1)/n),Math.round((2*e.y+12)/n),Math.round((2*e.x+12)/n)),i=o[e.y][e.x],a=t.arraySync();return{cell:r,score:i,region:new WR(a[e.y][e.x][0],a[e.y][e.x][1],a[e.y][e.x][2],a[e.y][e.x][3])}}))}(t,r,e.scale,n);if(t.dispose(),r.dispose(),!a.length)return i.stage1.push(o),[];var s=Date.now(),u=nI(a.map((function(e){return e.cell})),a.map((function(e){return e.score})),.5);return o.nms=Date.now()-s,o.numBoxes=u.length,i.stage1.push(o),u.map((function(e){return a[e]}))})).reduce((function(e,t){return e.concat(t)}),[]),a=[],s=[];if(o.length>0){var u=Date.now(),c=nI(o.map((function(e){return e.cell})),o.map((function(e){return e.score})),.7);i.stage1_nms=Date.now()-u,s=c.map((function(e){return o[e].score})),a=c.map((function(e){return o[e]})).map((function(e){var t=e.cell,n=e.region;return new ZS(t.left+n.left*t.width,t.top+n.top*t.height,t.right+n.right*t.width,t.bottom+n.bottom*t.height).toSquare().round()}))}return{boxes:a,scores:s}}function qR(e,t,n){var r=n.width,i=n.height;return Gd(this,void 0,void 0,(function(){var n,o,a,s=this;return Kd(this,(function(u){switch(u.label){case 0:return n=_I(e),[4,Promise.all(t.map((function(t){return Gd(s,void 0,void 0,(function(){var r,i,o,a;return Kd(this,(function(s){return r=t.padAtBorders(e.height,e.width),a=n.getImageData(i=r.x-1,o=r.y-1,r.ex-i,r.ey-o),[2,yI.isNodejs()?CI(a):createImageBitmap(a)]}))}))})))];case 1:return o=u.sent(),a=[],o.forEach((function(e){var t=_I(kI({width:r,height:i}));t.drawImage(e,0,0,r,i);for(var n=t.getImageData(0,0,r,i).data,o=[],s=0;s<n.length;s+=4)o.push(n[s+2]),o.push(n[s+1]),o.push(n[s]);a.push(o)})),[2,a.map((function(e){return Nm((function(){return zR(vC(og(e,[1,r,i,3]),[0,2,1,3]).toFloat())}))}))]}}))}))}function GR(e,t,n,r,i){return Gd(this,void 0,void 0,(function(){var o,a,s,u,c,l,h,f,d,p,v,m,g,y;return Kd(this,(function(b){switch(b.label){case 0:return o=Date.now(),[4,qR(e,t,{width:24,height:24})];case 1:return a=b.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map((function(e){var t=function(e,t){return Nm((function(){var n=jR(e,t),r=VR(ZI(Yg(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu4_alpha),i=ZI(r,t.fc2_1),o=Lg(rC(i,1),1),a=wy(Jx(i,o),1),s=ZI(r,t.fc2_2);return{scores:ny(a,1)[1],regions:s}}))}(e,r);return e.dispose(),t})),i.stage2_rnet=Date.now()-o,u=s.length>1?fg(s.map((function(e){return e.scores}))):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[b.sent()]),u.dispose(),f=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),d=f.map((function(e){return t[e]})),p=f.map((function(e){return c[e]})),v=[],m=[],d.length>0&&(o=Date.now(),g=nI(d,p,.7),i.stage2_nms=Date.now()-o,y=g.map((function(e){var t=s[f[e]].regions.arraySync();return new WR(t[0][0],t[0][1],t[0][2],t[0][3])})),m=g.map((function(e){return p[e]})),v=g.map((function(e,t){return d[e].calibrate(y[t])}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose()})),[2,{boxes:v,scores:m}]}}))}))}function KR(e,t,n,r,i){return Gd(this,void 0,void 0,(function(){var o,a,s,u,c,l,h,f,d,p,v,m,g,y,b;return Kd(this,(function(_){switch(_.label){case 0:return o=Date.now(),[4,qR(e,t,{width:48,height:48})];case 1:return a=_.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map((function(e){var t=function(e,t){return Nm((function(){var n=jR(e,t);n=VR(n=UI(n=zk(n,[2,2],[2,2],"same"),t.conv4,"valid"),t.prelu4_alpha);var r=VR(ZI(Yg(n,[n.shape[0],t.fc1.weights.shape[0]]),t.fc1),t.prelu5_alpha),i=ZI(r,t.fc2_1),o=Lg(rC(i,1),1),a=wy(Jx(i,o),1),s=ZI(r,t.fc2_2),u=ZI(r,t.fc2_3);return{scores:ny(a,1)[1],regions:s,points:u}}))}(e,r);return e.dispose(),t})),i.stage3_onet=Date.now()-o,u=s.length>1?fg(s.map((function(e){return e.scores}))):s[0].scores,h=(l=Array).from,[4,u.data()];case 2:return c=h.apply(l,[_.sent()]),u.dispose(),f=c.map((function(e,t){return{score:e,idx:t}})).filter((function(e){return e.score>n})).map((function(e){return e.idx})),d=f.map((function(e){var t=s[e].regions.arraySync();return new WR(t[0][0],t[0][1],t[0][2],t[0][3])})),p=f.map((function(e,n){return t[e].calibrate(d[n])})),v=f.map((function(e){return c[e]})),m=[],g=[],y=[],p.length>0&&(o=Date.now(),b=nI(p,v,.7,!1),i.stage3_nms=Date.now()-o,m=b.map((function(e){return p[e]})),g=b.map((function(e){return v[e]})),y=b.map((function(e,t){return Array(5).fill(0).map((function(n,r){var i=s[e].points.arraySync();return new YS(i[0][r]*(m[t].width+1)+m[t].left,i[0][r+5]*(m[t].height+1)+m[t].top)}))}))),s.forEach((function(e){e.regions.dispose(),e.scores.dispose(),e.points.dispose()})),[2,{boxes:m,scores:g,points:y}]}}))}))}var XR,QR=function(e){function t(){return e.call(this,"Mtcnn")||this}return Hd(t,e),t.prototype.load=function(t){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.load.call(this,t)]}))}))},t.prototype.loadFromDisk=function(t){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(n){return console.warn("mtcnn is deprecated and will be removed soon"),[2,e.prototype.loadFromDisk.call(this,t)]}))}))},t.prototype.forwardInput=function(e,t){return void 0===t&&(t={}),Gd(this,void 0,void 0,(function(){var n,r,i,o,a,s,u,c,l,h,f,d,p,v,m,g,y,b,_,w;return Kd(this,(function(x){switch(x.label){case 0:if(!(n=this.params))throw new Error("Mtcnn - load model before inference");if(!(r=e.canvases[0]))throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return i={},o=Date.now(),a=Nm((function(){return e=Lg(SS.fromPixels(r)).toFloat(),Nm((function(){return Jg(ny(e,3).reverse(),3)}));var e})),s=function(e){return a.dispose(),i.total=Date.now()-o,e},u=a.shape.slice(1),c=u[0],l=u[1],h=new _R(t),f=h.minFaceSize,d=h.scaleFactor,p=h.maxNumScales,v=h.scoreThresholds,m=(h.scaleSteps||function(e,t,n){for(var r=12/e,i=[],o=Math.min(n[0],n[1])*r,a=0;o>=12;)i.push(r*Math.pow(t,a)),o*=t,a+=1;return i}(f,d,[c,l])).filter((function(e){var t=UR(e,[c,l]);return Math.min(t.width,t.height)>12})).slice(0,p),i.scales=m,i.pyramid=m.map((function(e){return UR(e,[c,l])})),g=Date.now(),[4,HR(a,m,v[0],n.pnet,i)];case 1:return y=x.sent(),i.total_stage1=Date.now()-g,y.boxes.length?(i.stage2_numInputBoxes=y.boxes.length,g=Date.now(),[4,GR(r,y.boxes,v[1],n.rnet,i)]):[2,s({results:[],stats:i})];case 2:return b=x.sent(),i.total_stage2=Date.now()-g,b.boxes.length?(i.stage3_numInputBoxes=b.boxes.length,g=Date.now(),[4,KR(r,b.boxes,v[2],n.onet,i)]):[2,s({results:[],stats:i})];case 3:return _=x.sent(),i.total_stage3=Date.now()-g,w=_.boxes.map((function(e,t){return iR(lI({},new eI(_.scores[t],new aI(e.left/l,e.top/c,e.width/l,e.height/c),{height:c,width:l})),new uI(_.points[t].map((function(t){return t.sub(new YS(e.left,e.top)).div(new YS(e.width,e.height))})),{width:e.width,height:e.height}))})),[2,s({results:w,stats:i})]}}))}))},t.prototype.forward=function(e,t){return void 0===t&&(t={}),Gd(this,void 0,void 0,(function(){var n;return Kd(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,RI(e)];case 1:return[4,n.apply(this,[r.sent(),t])];case 2:return[2,r.sent().results]}}))}))},t.prototype.forwardWithStats=function(e,t){return void 0===t&&(t={}),Gd(this,void 0,void 0,(function(){var n;return Kd(this,(function(r){switch(r.label){case 0:return n=this.forwardInput,[4,RI(e)];case 1:return[2,n.apply(this,[r.sent(),t])]}}))}))},t.prototype.getDefaultModelName=function(){return"mtcnn_model"},t.prototype.extractParamsFromWeigthMap=function(e){return function(e){var t=[],n=function(e,t){var n=GI(e,t);function r(e){return{filters:n(e+"/weights",4,e+"/filters"),bias:n(e+"/bias",1)}}function i(e){return{weights:n(e+"/weights",2),bias:n(e+"/bias",1)}}function o(e){return n(e,1)}function a(e){return{conv1:r(e+"/conv1"),prelu1_alpha:o(e+"/prelu1_alpha"),conv2:r(e+"/conv2"),prelu2_alpha:o(e+"/prelu2_alpha"),conv3:r(e+"/conv3"),prelu3_alpha:o(e+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=a("pnet"),t=r("pnet/conv4_1"),n=r("pnet/conv4_2");return qd(qd({},e),{conv4_1:t,conv4_2:n})},extractRNetParams:function(){var e=a("rnet"),t=i("rnet/fc1"),n=o("rnet/prelu4_alpha"),r=i("rnet/fc2_1"),s=i("rnet/fc2_2");return qd(qd({},e),{fc1:t,prelu4_alpha:n,fc2_1:r,fc2_2:s})},extractONetParams:function(){var e=a("onet"),t=r("onet/conv4"),n=o("onet/prelu4_alpha"),s=i("onet/fc1"),u=o("onet/prelu5_alpha"),c=i("onet/fc2_1"),l=i("onet/fc2_2"),h=i("onet/fc2_3");return qd(qd({},e),{conv4:t,prelu4_alpha:n,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(e,t),r=n.extractRNetParams,i=n.extractONetParams,o=(0,n.extractPNetParams)(),a=r(),s=i();return WI(e,t),{params:{pnet:o,rnet:a,onet:s},paramMappings:t}}(e)},t.prototype.extractParams=function(e){return function(e){var t=KI(e),n=t.getRemainingWeights,r=[],i=function(e,t){var n=zI(e,t),r=VI(e,t);function i(n,r){var i=ng(e(n));return t.push({paramPath:r}),i}function o(e,t,r){return void 0===r&&(r=!1),{conv1:n(e[0],e[1],3,t+"/conv1"),prelu1_alpha:i(e[1],t+"/prelu1_alpha"),conv2:n(e[1],e[2],3,t+"/conv2"),prelu2_alpha:i(e[2],t+"/prelu2_alpha"),conv3:n(e[2],e[3],r?2:3,t+"/conv3"),prelu3_alpha:i(e[3],t+"/prelu3_alpha")}}return{extractPNetParams:function(){var e=o([3,10,16,32],"pnet"),t=n(32,2,1,"pnet/conv4_1"),r=n(32,4,1,"pnet/conv4_2");return qd(qd({},e),{conv4_1:t,conv4_2:r})},extractRNetParams:function(){var e=o([3,28,48,64],"rnet",!0),t=r(576,128,"rnet/fc1"),n=i(128,"rnet/prelu4_alpha"),a=r(128,2,"rnet/fc2_1"),s=r(128,4,"rnet/fc2_2");return qd(qd({},e),{fc1:t,prelu4_alpha:n,fc2_1:a,fc2_2:s})},extractONetParams:function(){var e=o([3,32,64,64],"onet"),t=n(64,128,2,"onet/conv4"),a=i(128,"onet/prelu4_alpha"),s=r(1152,256,"onet/fc1"),u=i(256,"onet/prelu5_alpha"),c=r(256,2,"onet/fc2_1"),l=r(256,4,"onet/fc2_2"),h=r(256,10,"onet/fc2_3");return qd(qd({},e),{conv4:t,prelu4_alpha:a,fc1:s,prelu5_alpha:u,fc2_1:c,fc2_2:l,fc2_3:h})}}}(t.extractWeights,r),o=i.extractRNetParams,a=i.extractONetParams,s=(0,i.extractPNetParams)(),u=o(),c=a();if(0!==n().length)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:s,rnet:u,onet:c},paramMappings:r}}(e)},t}(PI),YR=[new YS(1.603231,2.094468),new YS(6.041143,7.080126),new YS(2.882459,3.518061),new YS(4.266906,5.178857),new YS(9.041765,10.66308)],$R=[117.001,114.697,97.404],ZR=function(e){function t(){return e.call(this,{withSeparableConvs:!0,iouThreshold:.4,classes:["face"],anchors:YR,meanRgb:$R,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]})||this}return Hd(t,e),Object.defineProperty(t.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),t.prototype.locateFaces=function(e,t){return Gd(this,void 0,void 0,(function(){return Kd(this,(function(n){switch(n.label){case 0:return[4,this.detect(e,t)];case 1:return[2,n.sent().map((function(e){return new eI(e.score,e.relativeBox,{width:e.imageWidth,height:e.imageHeight})}))]}}))}))},t.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},t.prototype.extractParamsFromWeigthMap=function(t){return e.prototype.extractParamsFromWeigthMap.call(this,t)},t}(FR),JR={ssdMobilenetv1:new ER,tinyFaceDetector:new ZR,tinyYolov2:new PR,mtcnn:new QR,faceLandmark68Net:new hR,faceLandmark68TinyNet:new dR,faceRecognitionNet:new bR,faceExpressionNet:new rR,ageGenderNet:new cR},eT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.run=function(){return Gd(this,void 0,void 0,(function(){var e,t,n=this;return Kd(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,BR(e=r.sent(),this.input,(function(e){return Gd(n,void 0,void 0,(function(){return Kd(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return JR.faceExpressionNet.predictExpressions(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){return Object.assign({},e,{expressions:t[n]})}))]}}))}))},t.prototype.withAgeAndGender=function(){return new nT(this,this.input)},t}(function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Hd(t,e),t}(LR)),tT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.withAgeAndGender=function(){return new rT(this,this.input)},t.prototype.withFaceDescriptors=function(){return new iT(this,this.input)},t}(eT),nT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.run=function(){return Gd(this,void 0,void 0,(function(){var e,t,n=this;return Kd(this,(function(r){switch(r.label){case 0:return[4,this.parentTask];case 1:return[4,BR(e=r.sent(),this.input,(function(e){return Gd(n,void 0,void 0,(function(){return Kd(this,(function(t){switch(t.label){case 0:return[4,Promise.all(e.map((function(e){return JR.ageGenderNet.predictAgeAndGender(e)})))];case 1:return[2,t.sent()]}}))}))}),this.extractedFaces)];case 2:return t=r.sent(),[2,e.map((function(e,n){var r=t[n],i=r.age;return function(e,t){return Object.assign({},e,{age:t})}(Object.assign({},e,{gender:r.gender,genderProbability:r.genderProbability}),i)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new eT(this,this.input)},t}(function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.extractedFaces=r,i}return Hd(t,e),t}(LR)),rT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.withFaceExpressions=function(){return new tT(this,this.input)},t.prototype.withFaceDescriptors=function(){return new iT(this,this.input)},t}(nT),iT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.run=function(){return Gd(this,void 0,void 0,(function(){var e;return Kd(this,(function(t){switch(t.label){case 0:return[4,this.parentTask];case 1:return[4,BR(e=t.sent(),this.input,(function(e){return Promise.all(e.map((function(e){return JR.faceRecognitionNet.computeFaceDescriptor(e)})))}),null,(function(e){return e.landmarks.align(null,{useDlibAlignment:!0})}))];case 2:return[2,t.sent().map((function(t,n){return function(e,t){return Object.assign({},e,{descriptor:t})}(e[n],t)}))]}}))}))},t.prototype.withFaceExpressions=function(){return new tT(this,this.input)},t.prototype.withAgeAndGender=function(){return new rT(this,this.input)},t}(function(e){function t(t,n){var r=e.call(this)||this;return r.parentTask=t,r.input=n,r}return Hd(t,e),t}(LR)),oT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.run=function(){return Gd(this,void 0,void 0,(function(){var e,t,n,r,i,o=this;return Kd(this,(function(a){switch(a.label){case 0:return[4,this.parentTask];case 1:return e=a.sent(),t=e.map((function(e){return e.detection})),this.input instanceof cv?[4,AI(this.input,t)]:[3,3];case 2:return r=a.sent(),[3,5];case 3:return[4,TI(this.input,t)];case 4:r=a.sent(),a.label=5;case 5:return n=r,[4,Promise.all(n.map((function(e){return o.landmarkNet.detectLandmarks(e)})))];case 6:return i=a.sent(),n.forEach((function(e){return e instanceof cv&&e.dispose()})),[2,e.map((function(e,t){return iR(e,i[t])}))]}}))}))},t.prototype.withFaceExpressions=function(){return new tT(this,this.input)},t.prototype.withAgeAndGender=function(){return new rT(this,this.input)},t.prototype.withFaceDescriptors=function(){return new iT(this,this.input)},t}(function(e){function t(t,n,r){var i=e.call(this)||this;return i.parentTask=t,i.input=n,i.useTinyLandmarkNet=r,i}return Hd(t,e),Object.defineProperty(t.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?JR.faceLandmark68TinyNet:JR.faceLandmark68Net},enumerable:!0,configurable:!0}),t}(LR)),aT=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Hd(t,e),t.prototype.run=function(){return Gd(this,void 0,void 0,(function(){var e,t,n,r;return Kd(this,(function(i){switch(i.label){case 0:return t=(e=this).input,(n=e.options)instanceof _R?[4,JR.mtcnn.forward(t,n)]:[3,2];case 1:return[2,i.sent().map((function(e){return e.detection}))];case 2:if(!(r=n instanceof MR?function(e){return JR.tinyFaceDetector.locateFaces(e,n)}:n instanceof CR?function(e){return JR.ssdMobilenetv1.locateFaces(e,n)}:n instanceof OR?function(e){return JR.tinyYolov2.locateFaces(e,n)}:null))throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,r(t)]}}))}))},t.prototype.runAndExtendWithFaceDetections=function(){var e=this;return new Promise((function(t){return Gd(e,void 0,void 0,(function(){var e;return Kd(this,(function(n){switch(n.label){case 0:return[4,this.run()];case 1:return e=n.sent(),[2,t(e.map((function(e){return lI({},e)})))]}}))}))}))},t.prototype.withFaceLandmarks=function(e){return void 0===e&&(e=!1),new oT(this.runAndExtendWithFaceDetections(),this.input,e)},t.prototype.withFaceExpressions=function(){return new eT(this.runAndExtendWithFaceDetections(),this.input)},t.prototype.withAgeAndGender=function(){return new nT(this.runAndExtendWithFaceDetections(),this.input)},t}(function(e){function t(t,n){void 0===n&&(n=new CR);var r=e.call(this)||this;return r.input=t,r.options=n,r}return Hd(t,e),t}(LR)),sT=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this,e,r)).scheduler=e,i.work=r,i.pending=!1,i}return _createClass(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this}},{key:"requestAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return setInterval(e.flush.bind(e,this),n)}},{key:"recycleAsyncId",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)}},{key:"execute",value:function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}},{key:"_execute",value:function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r}},{key:"_unsubscribe",value:function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null}}]),n}(function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){return _classCallCheck(this,n),t.call(this)}return _createClass(n,[{key:"schedule",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this}}]),n}(f)),uT=function(){var e=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.now;_classCallCheck(this,e),this.SchedulerAction=t,this.now=n}return _createClass(e,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return new this.SchedulerAction(this,e).schedule(n,t)}}]),e}();return e.now=function(){return Date.now()},e}(),cT=new(function(e){_inherits(n,e);var t=_createSuper(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:uT.now;return _classCallCheck(this,n),(r=t.call(this,e,(function(){return n.delegate&&n.delegate!==_assertThisInitialized(r)?n.delegate.now():i()}))).actions=[],r.active=!1,r.scheduled=void 0,r}return _createClass(n,[{key:"schedule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;return n.delegate&&n.delegate!==this?n.delegate.schedule(e,t,r):_get(_getPrototypeOf(n.prototype),"schedule",this).call(this,e,t,r)}},{key:"flush",value:function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}}}]),n}(uT))(sT);function lT(e){return null!=e&&""+e!="false"}function hT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(e){return!isNaN(parseFloat(e))&&!isNaN(Number(e))}(e)?Number(e):t}function fT(e){return e instanceof Ea?e.nativeElement:e}try{XR="undefined"!=typeof Intl&&Intl.v8BreakIterator}catch(CO){XR=!1}var dT,pT,vT,mT,gT=((mT=function e(t){_classCallCheck(this,e),this._platformId=t,this.isBrowser=this._platformId?gc(this._platformId):"object"==typeof document&&!!document,this.EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent),this.TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent),this.BLINK=this.isBrowser&&!(!window.chrome&&!XR)&&"undefined"!=typeof CSS&&!this.EDGE&&!this.TRIDENT,this.WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT,this.IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window),this.FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent),this.ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT,this.SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT}).\u0275fac=function(e){return new(e||mT)(Ze(Ls,8))},mT.\u0275prov=pe({factory:function(){return new mT(Ze(Ls,8))},token:mT,providedIn:"root"}),mT),yT=((vT=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:vT}),vT.\u0275inj=ve({factory:function(e){return new(e||vT)}}),vT);function bT(e){return function(){if(null==dT&&"undefined"!=typeof window)try{window.addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){return dT=!0}}))}finally{dT=dT||!1}return dT}()?e:!!e.capture}function _T(e){return 0===e.buttons}"undefined"!=typeof Element&&Element;var wT,xT=new je("cdk-focus-monitor-default-options"),kT=bT({passive:!0,capture:!0}),CT=((wT=function(){function e(t,n,r,i){var o=this;_classCallCheck(this,e),this._ngZone=t,this._platform=n,this._origin=null,this._windowFocused=!1,this._elementInfo=new Map,this._monitoredElementCount=0,this._rootNodeFocusListenerCount=new Map,this._documentKeydownListener=function(){o._lastTouchTarget=null,o._setOriginForCurrentEventQueue("keyboard")},this._documentMousedownListener=function(e){if(!o._lastTouchTarget){var t=_T(e)?"keyboard":"mouse";o._setOriginForCurrentEventQueue(t)}},this._documentTouchstartListener=function(e){null!=o._touchTimeoutId&&clearTimeout(o._touchTimeoutId),o._lastTouchTarget=ET(e),o._touchTimeoutId=setTimeout((function(){return o._lastTouchTarget=null}),650)},this._windowFocusListener=function(){o._windowFocused=!0,o._windowFocusTimeoutId=setTimeout((function(){return o._windowFocused=!1}))},this._rootNodeFocusAndBlurListener=function(e){for(var t=ET(e),n="focus"===e.type?o._onFocus:o._onBlur,r=t;r;r=r.parentElement)n.call(o,e,r)},this._document=r,this._detectionMode=(null==i?void 0:i.detectionMode)||0}return _createClass(e,[{key:"monitor",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._platform.isBrowser)return nl(null);var n=fT(e),r=function(e){if(function(){if(null==pT){var e="undefined"!=typeof document?document.head:null;pT=!(!e||!e.createShadowRoot&&!e.attachShadow)}return pT}()){var t=e.getRootNode?e.getRootNode():null;if("undefined"!=typeof ShadowRoot&&ShadowRoot&&t instanceof ShadowRoot)return t}return null}(n)||this._getDocument(),i=this._elementInfo.get(n);if(i)return t&&(i.checkChildren=!0),i.subject.asObservable();var o={checkChildren:t,subject:new R,rootNode:r};return this._elementInfo.set(n,o),this._registerGlobalListeners(o),o.subject.asObservable()}},{key:"stopMonitoring",value:function(e){var t=fT(e),n=this._elementInfo.get(t);n&&(n.subject.complete(),this._setClasses(t),this._elementInfo.delete(t),this._removeGlobalListeners(n))}},{key:"focusVia",value:function(e,t,n){var r=fT(e);this._setOriginForCurrentEventQueue(t),"function"==typeof r.focus&&r.focus(n)}},{key:"ngOnDestroy",value:function(){var e=this;this._elementInfo.forEach((function(t,n){return e.stopMonitoring(n)}))}},{key:"_getDocument",value:function(){return this._document||document}},{key:"_getWindow",value:function(){return this._getDocument().defaultView||window}},{key:"_toggleClass",value:function(e,t,n){n?e.classList.add(t):e.classList.remove(t)}},{key:"_getFocusOrigin",value:function(e){return this._origin?this._origin:this._windowFocused&&this._lastFocusOrigin?this._lastFocusOrigin:this._wasCausedByTouch(e)?"touch":"program"}},{key:"_setClasses",value:function(e,t){this._toggleClass(e,"cdk-focused",!!t),this._toggleClass(e,"cdk-touch-focused","touch"===t),this._toggleClass(e,"cdk-keyboard-focused","keyboard"===t),this._toggleClass(e,"cdk-mouse-focused","mouse"===t),this._toggleClass(e,"cdk-program-focused","program"===t)}},{key:"_setOriginForCurrentEventQueue",value:function(e){var t=this;this._ngZone.runOutsideAngular((function(){t._origin=e,0===t._detectionMode&&(t._originTimeoutId=setTimeout((function(){return t._origin=null}),1))}))}},{key:"_wasCausedByTouch",value:function(e){var t=ET(e);return this._lastTouchTarget instanceof Node&&t instanceof Node&&(t===this._lastTouchTarget||t.contains(this._lastTouchTarget))}},{key:"_onFocus",value:function(e,t){var n=this._elementInfo.get(t);if(n&&(n.checkChildren||t===ET(e))){var r=this._getFocusOrigin(e);this._setClasses(t,r),this._emitOrigin(n.subject,r),this._lastFocusOrigin=r}}},{key:"_onBlur",value:function(e,t){var n=this._elementInfo.get(t);!n||n.checkChildren&&e.relatedTarget instanceof Node&&t.contains(e.relatedTarget)||(this._setClasses(t),this._emitOrigin(n.subject,null))}},{key:"_emitOrigin",value:function(e,t){this._ngZone.run((function(){return e.next(t)}))}},{key:"_registerGlobalListeners",value:function(e){var t=this;if(this._platform.isBrowser){var n=e.rootNode,r=this._rootNodeFocusListenerCount.get(n)||0;r||this._ngZone.runOutsideAngular((function(){n.addEventListener("focus",t._rootNodeFocusAndBlurListener,kT),n.addEventListener("blur",t._rootNodeFocusAndBlurListener,kT)})),this._rootNodeFocusListenerCount.set(n,r+1),1==++this._monitoredElementCount&&this._ngZone.runOutsideAngular((function(){var e=t._getDocument(),n=t._getWindow();e.addEventListener("keydown",t._documentKeydownListener,kT),e.addEventListener("mousedown",t._documentMousedownListener,kT),e.addEventListener("touchstart",t._documentTouchstartListener,kT),n.addEventListener("focus",t._windowFocusListener)}))}}},{key:"_removeGlobalListeners",value:function(e){var t=e.rootNode;if(this._rootNodeFocusListenerCount.has(t)){var n=this._rootNodeFocusListenerCount.get(t);n>1?this._rootNodeFocusListenerCount.set(t,n-1):(t.removeEventListener("focus",this._rootNodeFocusAndBlurListener,kT),t.removeEventListener("blur",this._rootNodeFocusAndBlurListener,kT),this._rootNodeFocusListenerCount.delete(t))}if(!--this._monitoredElementCount){var r=this._getDocument(),i=this._getWindow();r.removeEventListener("keydown",this._documentKeydownListener,kT),r.removeEventListener("mousedown",this._documentMousedownListener,kT),r.removeEventListener("touchstart",this._documentTouchstartListener,kT),i.removeEventListener("focus",this._windowFocusListener),clearTimeout(this._windowFocusTimeoutId),clearTimeout(this._touchTimeoutId),clearTimeout(this._originTimeoutId)}}}]),e}()).\u0275fac=function(e){return new(e||wT)(Ze(Js),Ze(gT),Ze(Nu,8),Ze(xT,8))},wT.\u0275prov=pe({factory:function(){return new wT(Ze(Js),Ze(gT),Ze(Nu,8),Ze(xT,8))},token:wT,providedIn:"root"}),wT);function ET(e){return e.composedPath?e.composedPath()[0]:e.target}var ST,IT,RT,TT=((ST=function(){function e(t,n){_classCallCheck(this,e),this._platform=t,this._document=n}return _createClass(e,[{key:"getHighContrastMode",value:function(){if(!this._platform.isBrowser)return 0;var e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);var t=this._document.defaultView||window,n=t&&t.getComputedStyle?t.getComputedStyle(e):null,r=(n&&n.backgroundColor||"").replace(/ /g,"");switch(this._document.body.removeChild(e),r){case"rgb(0,0,0)":return 2;case"rgb(255,255,255)":return 1}return 0}},{key:"_applyBodyHighContrastModeCssClasses",value:function(){if(this._platform.isBrowser&&this._document.body){var e=this._document.body.classList;e.remove("cdk-high-contrast-active"),e.remove("cdk-high-contrast-black-on-white"),e.remove("cdk-high-contrast-white-on-black");var t=this.getHighContrastMode();1===t?(e.add("cdk-high-contrast-active"),e.add("cdk-high-contrast-black-on-white")):2===t&&(e.add("cdk-high-contrast-active"),e.add("cdk-high-contrast-white-on-black"))}}}]),e}()).\u0275fac=function(e){return new(e||ST)(Ze(gT),Ze(Nu))},ST.\u0275prov=pe({factory:function(){return new ST(Ze(gT),Ze(Nu))},token:ST,providedIn:"root"}),ST),AT=new je("cdk-dir-doc",{providedIn:"root",factory:function(){return Je(Nu)}}),DT=((RT=function(){function e(t){if(_classCallCheck(this,e),this.value="ltr",this.change=new ps,t){var n=t.documentElement?t.documentElement.dir:null,r=(t.body?t.body.dir:null)||n;this.value="ltr"===r||"rtl"===r?r:"ltr"}}return _createClass(e,[{key:"ngOnDestroy",value:function(){this.change.complete()}}]),e}()).\u0275fac=function(e){return new(e||RT)(Ze(AT,8))},RT.\u0275prov=pe({factory:function(){return new RT(Ze(AT,8))},token:RT,providedIn:"root"}),RT),NT=((IT=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:IT}),IT.\u0275inj=ve({factory:function(e){return new(e||IT)}}),IT),OT=new Na("9.2.4"),FT=function e(){_classCallCheck(this,e)};function PT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return{type:2,steps:e,options:t}}function MT(e){return{type:6,styles:e,offset:null}}function LT(e){Promise.resolve(null).then(e)}var BT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;_classCallCheck(this,e),this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this.parentPlayer=null,this.totalTime=t+n}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"init",value:function(){}},{key:"play",value:function(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}},{key:"triggerMicrotask",value:function(){var e=this;LT((function(){return e._onFinish()}))}},{key:"_onStart",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"pause",value:function(){}},{key:"restart",value:function(){}},{key:"finish",value:function(){this._onFinish()}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){}},{key:"setPosition",value:function(e){}},{key:"getPosition",value:function(){return 0}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}(),UT=function(){function e(t){var n=this;_classCallCheck(this,e),this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=t;var r=0,i=0,o=0,a=this.players.length;0==a?LT((function(){return n._onFinish()})):this.players.forEach((function(e){e.onDone((function(){++r==a&&n._onFinish()})),e.onDestroy((function(){++i==a&&n._onDestroy()})),e.onStart((function(){++o==a&&n._onStart()}))})),this.totalTime=this.players.reduce((function(e,t){return Math.max(e,t.totalTime)}),0)}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this.players.forEach((function(e){return e.init()}))}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"_onStart",value:function(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[])}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach((function(e){return e.play()}))}},{key:"pause",value:function(){this.players.forEach((function(e){return e.pause()}))}},{key:"restart",value:function(){this.players.forEach((function(e){return e.restart()}))}},{key:"finish",value:function(){this._onFinish(),this.players.forEach((function(e){return e.finish()}))}},{key:"destroy",value:function(){this._onDestroy()}},{key:"_onDestroy",value:function(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach((function(e){return e.destroy()})),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"reset",value:function(){this.players.forEach((function(e){return e.reset()})),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"setPosition",value:function(e){var t=e*this.totalTime;this.players.forEach((function(e){var n=e.totalTime?Math.min(1,t/e.totalTime):1;e.setPosition(n)}))}},{key:"getPosition",value:function(){var e=0;return this.players.forEach((function(t){var n=t.getPosition();e=Math.min(n,e)})),e}},{key:"beforeDestroy",value:function(){this.players.forEach((function(e){e.beforeDestroy&&e.beforeDestroy()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}}]),e}();function WT(){return"undefined"!=typeof process&&"[object process]"==={}.toString.call(process)}function zT(e){switch(e.length){case 0:return new BT;case 1:return e[0];default:return new UT(e)}}function VT(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=[],s=[],u=-1,c=null;if(r.forEach((function(e){var n=e.offset,r=n==u,l=r&&c||{};Object.keys(e).forEach((function(n){var r=n,s=e[n];if("offset"!==n)switch(r=t.normalizePropertyName(r,a),s){case"!":s=i[n];break;case"*":s=o[n];break;default:s=t.normalizeStyleValue(n,r,s,a)}l[r]=s})),r||s.push(l),c=l,u=n})),a.length){var l="\n - ";throw new Error("Unable to animate due to the following errors:".concat(l).concat(a.join(l)))}return s}function jT(e,t,n,r){switch(t){case"start":e.onStart((function(){return r(n&&HT(n,"start",e))}));break;case"done":e.onDone((function(){return r(n&&HT(n,"done",e))}));break;case"destroy":e.onDestroy((function(){return r(n&&HT(n,"destroy",e))}))}}function HT(e,t,n){var r=n.totalTime,i=qT(e.element,e.triggerName,e.fromState,e.toState,t||e.phaseName,null==r?e.totalTime:r,!!n.disabled),o=e._data;return null!=o&&(i._data=o),i}function qT(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6?arguments[6]:void 0;return{element:e,triggerName:t,fromState:n,toState:r,phaseName:i,totalTime:o,disabled:!!a}}function GT(e,t,n){var r;return e instanceof Map?(r=e.get(t))||e.set(t,r=n):(r=e[t])||(r=e[t]=n),r}function KT(e){var t=e.indexOf(":");return[e.substring(1,t),e.substr(t+1)]}var XT=function(e,t){return!1},QT=function(e,t){return!1},YT=function(e,t,n){return[]},$T=WT();($T||"undefined"!=typeof Element)&&(XT=function(e,t){return e.contains(t)},QT=function(){if($T||Element.prototype.matches)return function(e,t){return e.matches(t)};var e=Element.prototype,t=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector;return t?function(e,n){return t.apply(e,[n])}:QT}(),YT=function(e,t,n){var r=[];if(n)r.push.apply(r,_toConsumableArray(e.querySelectorAll(t)));else{var i=e.querySelector(t);i&&r.push(i)}return r});var ZT=null,JT=!1;function eA(e){ZT||(ZT=("undefined"!=typeof document?document.body:null)||{},JT=!!ZT.style&&"WebkitAppearance"in ZT.style);var t=!0;return ZT.style&&!function(e){return"ebkit"==e.substring(1,6)}(e)&&(!(t=e in ZT.style)&&JT)&&(t="Webkit"+e.charAt(0).toUpperCase()+e.substr(1)in ZT.style),t}var tA=QT,nA=XT,rA=YT;function iA(e){var t={};return Object.keys(e).forEach((function(n){var r=n.replace(/([a-z])([A-Z])/g,"$1-$2");t[r]=e[n]})),t}var oA,aA=((oA=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return eA(e)}},{key:"matchesElement",value:function(e,t){return tA(e,t)}},{key:"containsElement",value:function(e,t){return nA(e,t)}},{key:"query",value:function(e,t,n){return rA(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return n||""}},{key:"animate",value:function(e,t,n,r,i){return arguments.length>5&&void 0!==arguments[5]&&arguments[5],arguments.length>6&&arguments[6],new BT(n,r)}}]),e}()).\u0275fac=function(e){return new(e||oA)},oA.\u0275prov=pe({token:oA,factory:oA.\u0275fac}),oA),sA=function(){var e=function e(){_classCallCheck(this,e)};return e.NOOP=new aA,e}();function uA(e){if("number"==typeof e)return e;var t=e.match(/^(-?[\.\d]+)(m?s)/);return!t||t.length<2?0:cA(parseFloat(t[1]),t[2])}function cA(e,t){switch(t){case"s":return 1e3*e;default:return e}}function lA(e,t,n){return e.hasOwnProperty("duration")?e:function(e,t,n){var r,i=0,o="";if("string"==typeof e){var a=e.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return t.push('The provided timing value "'.concat(e,'" is invalid.')),{duration:0,delay:0,easing:""};r=cA(parseFloat(a[1]),a[2]);var s=a[3];null!=s&&(i=cA(parseFloat(s),a[4]));var u=a[5];u&&(o=u)}else r=e;if(!n){var c=!1,l=t.length;r<0&&(t.push("Duration values below 0 are not allowed for this animation step."),c=!0),i<0&&(t.push("Delay values below 0 are not allowed for this animation step."),c=!0),c&&t.splice(l,0,'The provided timing value "'.concat(e,'" is invalid.'))}return{duration:r,delay:i,easing:o}}(e,t,n)}function hA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).forEach((function(n){t[n]=e[n]})),t}function fA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(t)for(var r in e)n[r]=e[r];else hA(e,n);return n}function dA(e,t,n){return n?t+":"+n+";":""}function pA(e){for(var t="",n=0;n<e.style.length;n++){var r=e.style.item(n);t+=dA(0,r,e.style.getPropertyValue(r))}for(var i in e.style)e.style.hasOwnProperty(i)&&!i.startsWith("_")&&(t+=dA(0,i.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e.style[i]));e.setAttribute("style",t)}function vA(e,t,n){e.style&&(Object.keys(t).forEach((function(r){var i=kA(r);n&&!n.hasOwnProperty(r)&&(n[r]=e.style[i]),e.style[i]=t[r]})),WT()&&pA(e))}function mA(e,t){e.style&&(Object.keys(t).forEach((function(t){var n=kA(t);e.style[n]=""})),WT()&&pA(e))}function gA(e){return Array.isArray(e)?1==e.length?e[0]:PT(e):e}var yA=new RegExp("{{\\s*(.+?)\\s*}}","g");function bA(e){var t=[];if("string"==typeof e){for(var n;n=yA.exec(e);)t.push(n[1]);yA.lastIndex=0}return t}function _A(e,t,n){var r=e.toString(),i=r.replace(yA,(function(e,r){var i=t[r];return t.hasOwnProperty(r)||(n.push("Please provide a value for the animation param "+r),i=""),i.toString()}));return i==r?e:i}function wA(e){for(var t=[],n=e.next();!n.done;)t.push(n.value),n=e.next();return t}var xA=/-+([a-z0-9])/g;function kA(e){return e.replace(xA,(function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t[1].toUpperCase()}))}function CA(e,t){return 0===e||0===t}function EA(e,t,n){var r=Object.keys(n);if(r.length&&t.length){var i=t[0],o=[];if(r.forEach((function(e){i.hasOwnProperty(e)||o.push(e),i[e]=n[e]})),o.length)for(var a=function(){var n=t[s];o.forEach((function(t){n[t]=IA(e,t)}))},s=1;s<t.length;s++)a()}return t}function SA(e,t,n){switch(t.type){case 7:return e.visitTrigger(t,n);case 0:return e.visitState(t,n);case 1:return e.visitTransition(t,n);case 2:return e.visitSequence(t,n);case 3:return e.visitGroup(t,n);case 4:return e.visitAnimate(t,n);case 5:return e.visitKeyframes(t,n);case 6:return e.visitStyle(t,n);case 8:return e.visitReference(t,n);case 9:return e.visitAnimateChild(t,n);case 10:return e.visitAnimateRef(t,n);case 11:return e.visitQuery(t,n);case 12:return e.visitStagger(t,n);default:throw new Error("Unable to resolve animation metadata node #"+t.type)}}function IA(e,t){return window.getComputedStyle(e)[t]}var RA=new Set(["true","1"]),TA=new Set(["false","0"]);function AA(e,t){var n=RA.has(e)||TA.has(e),r=RA.has(t)||TA.has(t);return function(i,o){var a="*"==e||e==i,s="*"==t||t==o;return!a&&n&&"boolean"==typeof i&&(a=i?RA.has(e):TA.has(e)),!s&&r&&"boolean"==typeof o&&(s=o?RA.has(t):TA.has(t)),a&&s}}var DA=new RegExp("s*:selfs*,?","g");function NA(e,t,n){return new OA(e).build(t,n)}var OA=function(){function e(t){_classCallCheck(this,e),this._driver=t}return _createClass(e,[{key:"build",value:function(e,t){var n=new FA(t);return this._resetContextStyleTimingState(n),SA(this,gA(e),n)}},{key:"_resetContextStyleTimingState",value:function(e){e.currentQuerySelector="",e.collectedStyles={},e.collectedStyles[""]={},e.currentTime=0}},{key:"visitTrigger",value:function(e,t){var n=this,r=t.queryCount=0,i=t.depCount=0,o=[],a=[];return"@"==e.name.charAt(0)&&t.errors.push("animation triggers cannot be prefixed with an `@` sign (e.g. trigger('@foo', [...]))"),e.definitions.forEach((function(e){if(n._resetContextStyleTimingState(t),0==e.type){var s=e,u=s.name;u.toString().split(/\s*,\s*/).forEach((function(e){s.name=e,o.push(n.visitState(s,t))})),s.name=u}else if(1==e.type){var c=n.visitTransition(e,t);r+=c.queryCount,i+=c.depCount,a.push(c)}else t.errors.push("only state() and transition() definitions can sit inside of a trigger()")})),{type:7,name:e.name,states:o,transitions:a,queryCount:r,depCount:i,options:null}}},{key:"visitState",value:function(e,t){var n=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(n.containsDynamicStyles){var i=new Set,o=r||{};if(n.styles.forEach((function(e){if(PA(e)){var t=e;Object.keys(t).forEach((function(e){bA(t[e]).forEach((function(e){o.hasOwnProperty(e)||i.add(e)}))}))}})),i.size){var a=wA(i.values());t.errors.push('state("'.concat(e.name,'", ...) must define default values for all the following style substitutions: ').concat(a.join(", ")))}}return{type:0,name:e.name,style:n,options:r?{params:r}:null}}},{key:"visitTransition",value:function(e,t){t.queryCount=0,t.depCount=0;var n,r,i,o=SA(this,gA(e.animation),t);return{type:1,matchers:(n=e.expr,r=t.errors,i=[],"string"==typeof n?n.split(/\s*,\s*/).forEach((function(e){return function(e,t,n){if(":"==e[0]){var r=function(e,t){switch(e){case":enter":return"void => *";case":leave":return"* => void";case":increment":return function(e,t){return parseFloat(t)>parseFloat(e)};case":decrement":return function(e,t){return parseFloat(t)<parseFloat(e)};default:return t.push('The transition alias value "'.concat(e,'" is not supported')),"* => *"}}(e,n);if("function"==typeof r)return void t.push(r);e=r}var i=e.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return n.push('The provided transition expression "'.concat(e,'" is not supported')),t;var o=i[1],a=i[2],s=i[3];t.push(AA(o,s)),"<"!=a[0]||"*"==o&&"*"==s||t.push(AA(s,o))}(e,i,r)})):i.push(n),i),animation:o,queryCount:t.queryCount,depCount:t.depCount,options:MA(e.options)}}},{key:"visitSequence",value:function(e,t){var n=this;return{type:2,steps:e.steps.map((function(e){return SA(n,e,t)})),options:MA(e.options)}}},{key:"visitGroup",value:function(e,t){var n=this,r=t.currentTime,i=0,o=e.steps.map((function(e){t.currentTime=r;var o=SA(n,e,t);return i=Math.max(i,t.currentTime),o}));return t.currentTime=i,{type:3,steps:o,options:MA(e.options)}}},{key:"visitAnimate",value:function(e,t){var n,r=function(e,t){var n=null;if(e.hasOwnProperty("duration"))n=e;else if("number"==typeof e)return LA(lA(e,t).duration,0,"");var r=e;if(r.split(/\s+/).some((function(e){return"{"==e.charAt(0)&&"{"==e.charAt(1)}))){var i=LA(0,0,"");return i.dynamic=!0,i.strValue=r,i}return LA((n=n||lA(r,t)).duration,n.delay,n.easing)}(e.timings,t.errors);t.currentAnimateTimings=r;var i=e.styles?e.styles:MT({});if(5==i.type)n=this.visitKeyframes(i,t);else{var o=e.styles,a=!1;if(!o){a=!0;var s={};r.easing&&(s.easing=r.easing),o=MT(s)}t.currentTime+=r.duration+r.delay;var u=this.visitStyle(o,t);u.isEmptyStep=a,n=u}return t.currentAnimateTimings=null,{type:4,timings:r,style:n,options:null}}},{key:"visitStyle",value:function(e,t){var n=this._makeStyleAst(e,t);return this._validateStyleAst(n,t),n}},{key:"_makeStyleAst",value:function(e,t){var n=[];Array.isArray(e.styles)?e.styles.forEach((function(e){"string"==typeof e?"*"==e?n.push(e):t.errors.push("The provided style string value ".concat(e," is not allowed.")):n.push(e)})):n.push(e.styles);var r=!1,i=null;return n.forEach((function(e){if(PA(e)){var t=e,n=t.easing;if(n&&(i=n,delete t.easing),!r)for(var o in t)if(t[o].toString().indexOf("{{")>=0){r=!0;break}}})),{type:6,styles:n,easing:i,offset:e.offset,containsDynamicStyles:r,options:null}}},{key:"_validateStyleAst",value:function(e,t){var n=this,r=t.currentAnimateTimings,i=t.currentTime,o=t.currentTime;r&&o>0&&(o-=r.duration+r.delay),e.styles.forEach((function(e){"string"!=typeof e&&Object.keys(e).forEach((function(r){if(n._driver.validateStyleProperty(r)){var a,s,u,c,l,h=t.collectedStyles[t.currentQuerySelector],f=h[r],d=!0;f&&(o!=i&&o>=f.startTime&&i<=f.endTime&&(t.errors.push('The CSS property "'.concat(r,'" that exists between the times of "').concat(f.startTime,'ms" and "').concat(f.endTime,'ms" is also being animated in a parallel animation between the times of "').concat(o,'ms" and "').concat(i,'ms"')),d=!1),o=f.startTime),d&&(h[r]={startTime:o,endTime:i}),t.options&&(a=e[r],s=t.options,u=t.errors,c=s.params||{},(l=bA(a)).length&&l.forEach((function(e){c.hasOwnProperty(e)||u.push("Unable to resolve the local animation param ".concat(e," in the given list of values"))})))}else t.errors.push('The provided animation property "'.concat(r,'" is not a supported CSS property for animations'))}))}))}},{key:"visitKeyframes",value:function(e,t){var n=this,r={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push("keyframes() must be placed inside of a call to animate()"),r;var i=0,o=[],a=!1,s=!1,u=0,c=e.steps.map((function(e){var r=n._makeStyleAst(e,t),c=null!=r.offset?r.offset:function(e){if("string"==typeof e)return null;var t=null;if(Array.isArray(e))e.forEach((function(e){if(PA(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}}));else if(PA(e)&&e.hasOwnProperty("offset")){var n=e;t=parseFloat(n.offset),delete n.offset}return t}(r.styles),l=0;return null!=c&&(i++,l=r.offset=c),s=s||l<0||l>1,a=a||l<u,u=l,o.push(l),r}));s&&t.errors.push("Please ensure that all keyframe offsets are between 0 and 1"),a&&t.errors.push("Please ensure that all keyframe offsets are in order");var l=e.steps.length,h=0;i>0&&i<l?t.errors.push("Not all style() steps within the declared keyframes() contain offsets"):0==i&&(h=1/(l-1));var f=l-1,d=t.currentTime,p=t.currentAnimateTimings,v=p.duration;return c.forEach((function(e,i){var a=h>0?i==f?1:h*i:o[i],s=a*v;t.currentTime=d+p.delay+s,p.duration=s,n._validateStyleAst(e,t),e.offset=a,r.styles.push(e)})),r}},{key:"visitReference",value:function(e,t){return{type:8,animation:SA(this,gA(e.animation),t),options:MA(e.options)}}},{key:"visitAnimateChild",value:function(e,t){return t.depCount++,{type:9,options:MA(e.options)}}},{key:"visitAnimateRef",value:function(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:MA(e.options)}}},{key:"visitQuery",value:function(e,t){var n=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;var i=_slicedToArray(function(e){var t=!!e.split(/\s*,\s*/).find((function(e){return":self"==e}));return t&&(e=e.replace(DA,"")),[e=e.replace(/@\*/g,".ng-trigger").replace(/@\w+/g,(function(e){return".ng-trigger-"+e.substr(1)})).replace(/:animating/g,".ng-animating"),t]}(e.selector),2),o=i[0],a=i[1];t.currentQuerySelector=n.length?n+" "+o:o,GT(t.collectedStyles,t.currentQuerySelector,{});var s=SA(this,gA(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=n,{type:11,selector:o,limit:r.limit||0,optional:!!r.optional,includeSelf:a,animation:s,originalSelector:e.selector,options:MA(e.options)}}},{key:"visitStagger",value:function(e,t){t.currentQuery||t.errors.push("stagger() can only be used inside of query()");var n="full"===e.timings?{duration:0,delay:0,easing:"full"}:lA(e.timings,t.errors,!0);return{type:12,animation:SA(this,gA(e.animation),t),timings:n,options:null}}}]),e}(),FA=function e(t){_classCallCheck(this,e),this.errors=t,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles={},this.options=null};function PA(e){return!Array.isArray(e)&&"object"==typeof e}function MA(e){var t;return e?(e=hA(e)).params&&(e.params=(t=e.params)?hA(t):null):e={},e}function LA(e,t,n){return{duration:e,delay:t,easing:n}}function BA(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return{type:1,element:e,keyframes:t,preStyleProps:n,postStyleProps:r,duration:i,delay:o,totalTime:i+o,easing:a,subTimeline:s}}var UA=function(){function e(){_classCallCheck(this,e),this._map=new Map}return _createClass(e,[{key:"consume",value:function(e){var t=this._map.get(e);return t?this._map.delete(e):t=[],t}},{key:"append",value:function(e,t){var n,r=this._map.get(e);r||this._map.set(e,r=[]),(n=r).push.apply(n,_toConsumableArray(t))}},{key:"has",value:function(e){return this._map.has(e)}},{key:"clear",value:function(){this._map.clear()}}]),e}(),WA=new RegExp(":enter","g"),zA=new RegExp(":leave","g");function VA(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{},s=arguments.length>7?arguments[7]:void 0,u=arguments.length>8?arguments[8]:void 0,c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];return(new jA).buildKeyframes(e,t,n,r,i,o,a,s,u,c)}var jA=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"buildKeyframes",value:function(e,t,n,r,i,o,a,s,u){var c=arguments.length>9&&void 0!==arguments[9]?arguments[9]:[];u=u||new UA;var l=new qA(e,t,u,r,i,c,[]);l.options=s,l.currentTimeline.setStyles([o],null,l.errors,s),SA(this,n,l);var h=l.timelines.filter((function(e){return e.containsAnimation()}));if(h.length&&Object.keys(a).length){var f=h[h.length-1];f.allowOnlyTimelineStyles()||f.setStyles([a],null,l.errors,s)}return h.length?h.map((function(e){return e.buildKeyframes()})):[BA(t,[],[],[],0,0,"",!1)]}},{key:"visitTrigger",value:function(e,t){}},{key:"visitState",value:function(e,t){}},{key:"visitTransition",value:function(e,t){}},{key:"visitAnimateChild",value:function(e,t){var n=t.subInstructions.consume(t.element);if(n){var r=t.createSubContext(e.options),i=t.currentTimeline.currentTime,o=this._visitSubInstructions(n,r,r.options);i!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}},{key:"visitAnimateRef",value:function(e,t){var n=t.createSubContext(e.options);n.transformIntoNewTimeline(),this.visitReference(e.animation,n),t.transformIntoNewTimeline(n.currentTimeline.currentTime),t.previousNode=e}},{key:"_visitSubInstructions",value:function(e,t,n){var r=t.currentTimeline.currentTime,i=null!=n.duration?uA(n.duration):null,o=null!=n.delay?uA(n.delay):null;return 0!==i&&e.forEach((function(e){var n=t.appendInstructionToTimeline(e,i,o);r=Math.max(r,n.duration+n.delay)})),r}},{key:"visitReference",value:function(e,t){t.updateOptions(e.options,!0),SA(this,e.animation,t),t.previousNode=e}},{key:"visitSequence",value:function(e,t){var n=this,r=t.subContextCount,i=t,o=e.options;if(o&&(o.params||o.delay)&&((i=t.createSubContext(o)).transformIntoNewTimeline(),null!=o.delay)){6==i.previousNode.type&&(i.currentTimeline.snapshotCurrentStyles(),i.previousNode=HA);var a=uA(o.delay);i.delayNextStep(a)}e.steps.length&&(e.steps.forEach((function(e){return SA(n,e,i)})),i.currentTimeline.applyStylesToKeyframe(),i.subContextCount>r&&i.transformIntoNewTimeline()),t.previousNode=e}},{key:"visitGroup",value:function(e,t){var n=this,r=[],i=t.currentTimeline.currentTime,o=e.options&&e.options.delay?uA(e.options.delay):0;e.steps.forEach((function(a){var s=t.createSubContext(e.options);o&&s.delayNextStep(o),SA(n,a,s),i=Math.max(i,s.currentTimeline.currentTime),r.push(s.currentTimeline)})),r.forEach((function(e){return t.currentTimeline.mergeTimelineCollectedStyles(e)})),t.transformIntoNewTimeline(i),t.previousNode=e}},{key:"_visitTiming",value:function(e,t){if(e.dynamic){var n=e.strValue;return lA(t.params?_A(n,t.params,t.errors):n,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}},{key:"visitAnimate",value:function(e,t){var n=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;n.delay&&(t.incrementTime(n.delay),r.snapshotCurrentStyles());var i=e.style;5==i.type?this.visitKeyframes(i,t):(t.incrementTime(n.duration),this.visitStyle(i,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}},{key:"visitStyle",value:function(e,t){var n=t.currentTimeline,r=t.currentAnimateTimings;!r&&n.getCurrentStyleProperties().length&&n.forwardFrame();var i=r&&r.easing||e.easing;e.isEmptyStep?n.applyEmptyStep(i):n.setStyles(e.styles,i,t.errors,t.options),t.previousNode=e}},{key:"visitKeyframes",value:function(e,t){var n=t.currentAnimateTimings,r=t.currentTimeline.duration,i=n.duration,o=t.createSubContext().currentTimeline;o.easing=n.easing,e.styles.forEach((function(e){o.forwardTime((e.offset||0)*i),o.setStyles(e.styles,e.easing,t.errors,t.options),o.applyStylesToKeyframe()})),t.currentTimeline.mergeTimelineCollectedStyles(o),t.transformIntoNewTimeline(r+i),t.previousNode=e}},{key:"visitQuery",value:function(e,t){var n=this,r=t.currentTimeline.currentTime,i=e.options||{},o=i.delay?uA(i.delay):0;o&&(6===t.previousNode.type||0==r&&t.currentTimeline.getCurrentStyleProperties().length)&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=HA);var a=r,s=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!i.optional,t.errors);t.currentQueryTotal=s.length;var u=null;s.forEach((function(r,i){t.currentQueryIndex=i;var s=t.createSubContext(e.options,r);o&&s.delayNextStep(o),r===t.element&&(u=s.currentTimeline),SA(n,e.animation,s),s.currentTimeline.applyStylesToKeyframe(),a=Math.max(a,s.currentTimeline.currentTime)})),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(a),u&&(t.currentTimeline.mergeTimelineCollectedStyles(u),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}},{key:"visitStagger",value:function(e,t){var n=t.parentContext,r=t.currentTimeline,i=e.timings,o=Math.abs(i.duration),a=o*(t.currentQueryTotal-1),s=o*t.currentQueryIndex;switch(i.duration<0?"reverse":i.easing){case"reverse":s=a-s;break;case"full":s=n.currentStaggerTime}var u=t.currentTimeline;s&&u.delayNextStep(s);var c=u.currentTime;SA(this,e.animation,t),t.previousNode=e,n.currentStaggerTime=r.currentTime-c+(r.startTime-n.currentTimeline.startTime)}}]),e}(),HA={},qA=function(){function e(t,n,r,i,o,a,s,u){_classCallCheck(this,e),this._driver=t,this.element=n,this.subInstructions=r,this._enterClassName=i,this._leaveClassName=o,this.errors=a,this.timelines=s,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=HA,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=u||new GA(this._driver,n,0),s.push(this.currentTimeline)}return _createClass(e,[{key:"updateOptions",value:function(e,t){var n=this;if(e){var r=e,i=this.options;null!=r.duration&&(i.duration=uA(r.duration)),null!=r.delay&&(i.delay=uA(r.delay));var o=r.params;if(o){var a=i.params;a||(a=this.options.params={}),Object.keys(o).forEach((function(e){t&&a.hasOwnProperty(e)||(a[e]=_A(o[e],a,n.errors))}))}}}},{key:"_copyOptions",value:function(){var e={};if(this.options){var t=this.options.params;if(t){var n=e.params={};Object.keys(t).forEach((function(e){n[e]=t[e]}))}}return e}},{key:"createSubContext",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,i=n||this.element,o=new e(this._driver,i,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(i,r||0));return o.previousNode=this.previousNode,o.currentAnimateTimings=this.currentAnimateTimings,o.options=this._copyOptions(),o.updateOptions(t),o.currentQueryIndex=this.currentQueryIndex,o.currentQueryTotal=this.currentQueryTotal,o.parentContext=this,this.subContextCount++,o}},{key:"transformIntoNewTimeline",value:function(e){return this.previousNode=HA,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}},{key:"appendInstructionToTimeline",value:function(e,t,n){var r={duration:null!=t?t:e.duration,delay:this.currentTimeline.currentTime+(null!=n?n:0)+e.delay,easing:""},i=new KA(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(i),r}},{key:"incrementTime",value:function(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}},{key:"delayNextStep",value:function(e){e>0&&this.currentTimeline.delayNextStep(e)}},{key:"invokeQuery",value:function(e,t,n,r,i,o){var a=[];if(r&&a.push(this.element),e.length>0){e=(e=e.replace(WA,"."+this._enterClassName)).replace(zA,"."+this._leaveClassName);var s=this._driver.query(this.element,e,1!=n);0!==n&&(s=n<0?s.slice(s.length+n,s.length):s.slice(0,n)),a.push.apply(a,_toConsumableArray(s))}return i||0!=a.length||o.push('`query("'.concat(t,'")` returned zero elements. (Use `query("').concat(t,'", { optional: true })` if you wish to allow this.)')),a}},{key:"params",get:function(){return this.options.params}}]),e}(),GA=function(){function e(t,n,r,i){_classCallCheck(this,e),this._driver=t,this.element=n,this.startTime=r,this._elementTimelineStylesLookup=i,this.duration=0,this._previousKeyframe={},this._currentKeyframe={},this._keyframes=new Map,this._styleSummary={},this._pendingStyles={},this._backFill={},this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._localTimelineStyles=Object.create(this._backFill,{}),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(n),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(n,this._localTimelineStyles)),this._loadKeyframe()}return _createClass(e,[{key:"containsAnimation",value:function(){switch(this._keyframes.size){case 0:return!1;case 1:return this.getCurrentStyleProperties().length>0;default:return!0}}},{key:"getCurrentStyleProperties",value:function(){return Object.keys(this._currentKeyframe)}},{key:"delayNextStep",value:function(e){var t=1==this._keyframes.size&&Object.keys(this._pendingStyles).length;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}},{key:"fork",value:function(t,n){return this.applyStylesToKeyframe(),new e(this._driver,t,n||this.currentTime,this._elementTimelineStylesLookup)}},{key:"_loadKeyframe",value:function(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=Object.create(this._backFill,{}),this._keyframes.set(this.duration,this._currentKeyframe))}},{key:"forwardFrame",value:function(){this.duration+=1,this._loadKeyframe()}},{key:"forwardTime",value:function(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}},{key:"_updateStyle",value:function(e,t){this._localTimelineStyles[e]=t,this._globalTimelineStyles[e]=t,this._styleSummary[e]={time:this.currentTime,value:t}}},{key:"allowOnlyTimelineStyles",value:function(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}},{key:"applyEmptyStep",value:function(e){var t=this;e&&(this._previousKeyframe.easing=e),Object.keys(this._globalTimelineStyles).forEach((function(e){t._backFill[e]=t._globalTimelineStyles[e]||"*",t._currentKeyframe[e]="*"})),this._currentEmptyStepKeyframe=this._currentKeyframe}},{key:"setStyles",value:function(e,t,n,r){var i=this;t&&(this._previousKeyframe.easing=t);var o=r&&r.params||{},a=function(e,t){var n,r={};return e.forEach((function(e){"*"===e?(n=n||Object.keys(t)).forEach((function(e){r[e]="*"})):fA(e,!1,r)})),r}(e,this._globalTimelineStyles);Object.keys(a).forEach((function(e){var t=_A(a[e],o,n);i._pendingStyles[e]=t,i._localTimelineStyles.hasOwnProperty(e)||(i._backFill[e]=i._globalTimelineStyles.hasOwnProperty(e)?i._globalTimelineStyles[e]:"*"),i._updateStyle(e,t)}))}},{key:"applyStylesToKeyframe",value:function(){var e=this,t=this._pendingStyles,n=Object.keys(t);0!=n.length&&(this._pendingStyles={},n.forEach((function(n){e._currentKeyframe[n]=t[n]})),Object.keys(this._localTimelineStyles).forEach((function(t){e._currentKeyframe.hasOwnProperty(t)||(e._currentKeyframe[t]=e._localTimelineStyles[t])})))}},{key:"snapshotCurrentStyles",value:function(){var e=this;Object.keys(this._localTimelineStyles).forEach((function(t){var n=e._localTimelineStyles[t];e._pendingStyles[t]=n,e._updateStyle(t,n)}))}},{key:"getFinalKeyframe",value:function(){return this._keyframes.get(this.duration)}},{key:"mergeTimelineCollectedStyles",value:function(e){var t=this;Object.keys(e._styleSummary).forEach((function(n){var r=t._styleSummary[n],i=e._styleSummary[n];(!r||i.time>r.time)&&t._updateStyle(n,i.value)}))}},{key:"buildKeyframes",value:function(){var e=this;this.applyStylesToKeyframe();var t=new Set,n=new Set,r=1===this._keyframes.size&&0===this.duration,i=[];this._keyframes.forEach((function(o,a){var s=fA(o,!0);Object.keys(s).forEach((function(e){var r=s[e];"!"==r?t.add(e):"*"==r&&n.add(e)})),r||(s.offset=a/e.duration),i.push(s)}));var o=t.size?wA(t.values()):[],a=n.size?wA(n.values()):[];if(r){var s=i[0],u=hA(s);s.offset=0,u.offset=1,i=[s,u]}return BA(this.element,i,o,a,this.duration,this.startTime,this.easing,!1)}},{key:"currentTime",get:function(){return this.startTime+this.duration}},{key:"properties",get:function(){var e=[];for(var t in this._currentKeyframe)e.push(t);return e}}]),e}(),KA=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a,s){var u,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return _classCallCheck(this,n),(u=t.call(this,e,r,s.delay)).element=r,u.keyframes=i,u.preStyleProps=o,u.postStyleProps=a,u._stretchStartingKeyframe=c,u.timings={duration:s.duration,delay:s.delay,easing:s.easing},u}return _createClass(n,[{key:"containsAnimation",value:function(){return this.keyframes.length>1}},{key:"buildKeyframes",value:function(){var e=this.keyframes,t=this.timings,n=t.delay,r=t.duration,i=t.easing;if(this._stretchStartingKeyframe&&n){var o=[],a=r+n,s=n/a,u=fA(e[0],!1);u.offset=0,o.push(u);var c=fA(e[0],!1);c.offset=XA(s),o.push(c);for(var l=e.length-1,h=1;h<=l;h++){var f=fA(e[h],!1);f.offset=XA((n+f.offset*r)/a),o.push(f)}r=a,n=0,i="",e=o}return BA(this.element,e,this.preStyleProps,this.postStyleProps,r,n,i,!0)}}]),n}(GA);function XA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,t-1);return Math.round(e*n)/n}var QA=function e(){_classCallCheck(this,e)},YA=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return _createClass(n,[{key:"normalizePropertyName",value:function(e,t){return kA(e)}},{key:"normalizeStyleValue",value:function(e,t,n,r){var i="",o=n.toString().trim();if($A[t]&&0!==n&&"0"!==n)if("number"==typeof n)i="px";else{var a=n.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push("Please provide a CSS unit value for ".concat(e,":").concat(n))}return o+i}}]),n}(QA),$A=function(e){var t={};return e.forEach((function(e){return t[e]=!0})),t}("width,height,minWidth,minHeight,maxWidth,maxHeight,left,top,bottom,right,fontSize,outlineWidth,outlineOffset,paddingTop,paddingLeft,paddingBottom,paddingRight,marginTop,marginLeft,marginBottom,marginRight,borderRadius,borderWidth,borderTopWidth,borderLeftWidth,borderRightWidth,borderBottomWidth,textIndent,perspective".split(","));function ZA(e,t,n,r,i,o,a,s,u,c,l,h,f){return{type:0,element:e,triggerName:t,isRemovalTransition:i,fromState:n,fromStyles:o,toState:r,toStyles:a,timelines:s,queriedElements:u,preStyleProps:c,postStyleProps:l,totalTime:h,errors:f}}var JA={},eD=function(){function e(t,n,r){_classCallCheck(this,e),this._triggerName=t,this.ast=n,this._stateStyles=r}return _createClass(e,[{key:"match",value:function(e,t,n,r){return function(e,t,n,r,i){return e.some((function(e){return e(t,n,r,i)}))}(this.ast.matchers,e,t,n,r)}},{key:"buildStyles",value:function(e,t,n){var r=this._stateStyles["*"],i=this._stateStyles[e],o=r?r.buildStyles(t,n):{};return i?i.buildStyles(t,n):o}},{key:"build",value:function(e,t,n,r,i,o,a,s,u,c){var l=[],h=this.ast.options&&this.ast.options.params||JA,f=this.buildStyles(n,a&&a.params||JA,l),d=s&&s.params||JA,p=this.buildStyles(r,d,l),v=new Set,m=new Map,g=new Map,y="void"===r,b={params:Object.assign(Object.assign({},h),d)},_=c?[]:VA(e,t,this.ast.animation,i,o,f,p,b,u,l),w=0;if(_.forEach((function(e){w=Math.max(e.duration+e.delay,w)})),l.length)return ZA(t,this._triggerName,n,r,y,f,p,[],[],m,g,w,l);_.forEach((function(e){var n=e.element,r=GT(m,n,{});e.preStyleProps.forEach((function(e){return r[e]=!0}));var i=GT(g,n,{});e.postStyleProps.forEach((function(e){return i[e]=!0})),n!==t&&v.add(n)}));var x=wA(v.values());return ZA(t,this._triggerName,n,r,y,f,p,_,x,m,g,w)}}]),e}(),tD=function(){function e(t,n){_classCallCheck(this,e),this.styles=t,this.defaultParams=n}return _createClass(e,[{key:"buildStyles",value:function(e,t){var n={},r=hA(this.defaultParams);return Object.keys(e).forEach((function(t){var n=e[t];null!=n&&(r[t]=n)})),this.styles.styles.forEach((function(e){if("string"!=typeof e){var i=e;Object.keys(i).forEach((function(e){var o=i[e];o.length>1&&(o=_A(o,r,t)),n[e]=o}))}})),n}}]),e}(),nD=function(){function e(t,n){var r=this;_classCallCheck(this,e),this.name=t,this.ast=n,this.transitionFactories=[],this.states={},n.states.forEach((function(e){r.states[e.name]=new tD(e.style,e.options&&e.options.params||{})})),rD(this.states,"true","1"),rD(this.states,"false","0"),n.transitions.forEach((function(e){r.transitionFactories.push(new eD(t,e,r.states))})),this.fallbackTransition=new eD(t,{type:1,animation:{type:2,steps:[],options:null},matchers:[function(e,t){return!0}],options:null,queryCount:0,depCount:0},this.states)}return _createClass(e,[{key:"matchTransition",value:function(e,t,n,r){return this.transitionFactories.find((function(i){return i.match(e,t,n,r)}))||null}},{key:"matchStyles",value:function(e,t,n){return this.fallbackTransition.buildStyles(e,t,n)}},{key:"containsQueries",get:function(){return this.ast.queryCount>0}}]),e}();function rD(e,t,n){e.hasOwnProperty(t)?e.hasOwnProperty(n)||(e[n]=e[t]):e.hasOwnProperty(n)&&(e[t]=e[n])}var iD=new UA,oD=function(){function e(t,n,r){_classCallCheck(this,e),this.bodyNode=t,this._driver=n,this._normalizer=r,this._animations={},this._playersById={},this.players=[]}return _createClass(e,[{key:"register",value:function(e,t){var n=[],r=NA(this._driver,t,n);if(n.length)throw new Error("Unable to build the animation due to the following errors: "+n.join("\n"));this._animations[e]=r}},{key:"_buildPlayer",value:function(e,t,n){var r=e.element,i=VT(0,this._normalizer,0,e.keyframes,t,n);return this._driver.animate(r,i,e.duration,e.delay,e.easing,[],!0)}},{key:"create",value:function(e,t){var n,r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=[],a=this._animations[e],s=new Map;if(a?(n=VA(this._driver,t,a,"ng-enter","ng-leave",{},{},i,iD,o)).forEach((function(e){var t=GT(s,e.element,{});e.postStyleProps.forEach((function(e){return t[e]=null}))})):(o.push("The requested animation doesn't exist or has already been destroyed"),n=[]),o.length)throw new Error("Unable to create the animation due to the following errors: "+o.join("\n"));s.forEach((function(e,t){Object.keys(e).forEach((function(n){e[n]=r._driver.computeStyle(t,n,"*")}))}));var u=zT(n.map((function(e){var t=s.get(e.element);return r._buildPlayer(e,{},t)})));return this._playersById[e]=u,u.onDestroy((function(){return r.destroy(e)})),this.players.push(u),u}},{key:"destroy",value:function(e){var t=this._getPlayer(e);t.destroy(),delete this._playersById[e];var n=this.players.indexOf(t);n>=0&&this.players.splice(n,1)}},{key:"_getPlayer",value:function(e){var t=this._playersById[e];if(!t)throw new Error("Unable to find the timeline player referenced by "+e);return t}},{key:"listen",value:function(e,t,n,r){var i=qT(t,"","","");return jT(this._getPlayer(e),n,i,r),function(){}}},{key:"command",value:function(e,t,n,r){if("register"!=n)if("create"!=n){var i=this._getPlayer(e);switch(n){case"play":i.play();break;case"pause":i.pause();break;case"reset":i.reset();break;case"restart":i.restart();break;case"finish":i.finish();break;case"init":i.init();break;case"setPosition":i.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}else this.create(e,t,r[0]||{});else this.register(e,r[0])}}]),e}(),aD=[],sD={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},uD={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},cD=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,e),this.namespaceId=n;var r,i=t&&t.hasOwnProperty("value");if(this.value=null!=(r=i?t.value:t)?r:null,i){var o=hA(t);delete o.value,this.options=o}else this.options={};this.options.params||(this.options.params={})}return _createClass(e,[{key:"absorbOptions",value:function(e){var t=e.params;if(t){var n=this.options.params;Object.keys(t).forEach((function(e){null==n[e]&&(n[e]=t[e])}))}}},{key:"params",get:function(){return this.options.params}}]),e}(),lD=new cD("void"),hD=function(){function e(t,n,r){_classCallCheck(this,e),this.id=t,this.hostElement=n,this._engine=r,this.players=[],this._triggers={},this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+t,yD(n,this._hostClassName)}return _createClass(e,[{key:"listen",value:function(e,t,n,r){var i,o=this;if(!this._triggers.hasOwnProperty(t))throw new Error('Unable to listen on the animation trigger event "'.concat(n,'" because the animation trigger "').concat(t,"\" doesn't exist!"));if(null==n||0==n.length)throw new Error('Unable to listen on the animation trigger "'.concat(t,'" because the provided event is undefined!'));if("start"!=(i=n)&&"done"!=i)throw new Error('The provided animation trigger event "'.concat(n,'" for the animation trigger "').concat(t,'" is not supported!'));var a=GT(this._elementListeners,e,[]),s={name:t,phase:n,callback:r};a.push(s);var u=GT(this._engine.statesByElement,e,{});return u.hasOwnProperty(t)||(yD(e,"ng-trigger"),yD(e,"ng-trigger-"+t),u[t]=lD),function(){o._engine.afterFlush((function(){var e=a.indexOf(s);e>=0&&a.splice(e,1),o._triggers[t]||delete u[t]}))}}},{key:"register",value:function(e,t){return!this._triggers[e]&&(this._triggers[e]=t,!0)}},{key:"_getTrigger",value:function(e){var t=this._triggers[e];if(!t)throw new Error('The provided animation trigger "'.concat(e,'" has not been registered!'));return t}},{key:"trigger",value:function(e,t,n){var r=this,i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this._getTrigger(t),a=new dD(this.id,t,e),s=this._engine.statesByElement.get(e);s||(yD(e,"ng-trigger"),yD(e,"ng-trigger-"+t),this._engine.statesByElement.set(e,s={}));var u=s[t],c=new cD(n,this.id);if(!(n&&n.hasOwnProperty("value"))&&u&&c.absorbOptions(u.options),s[t]=c,u||(u=lD),"void"===c.value||u.value!==c.value){var l=GT(this._engine.playersByElement,e,[]);l.forEach((function(e){e.namespaceId==r.id&&e.triggerName==t&&e.queued&&e.destroy()}));var h=o.matchTransition(u.value,c.value,e,c.params),f=!1;if(!h){if(!i)return;h=o.fallbackTransition,f=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:h,fromState:u,toState:c,player:a,isFallbackTransition:f}),f||(yD(e,"ng-animate-queued"),a.onStart((function(){bD(e,"ng-animate-queued")}))),a.onDone((function(){var t=r.players.indexOf(a);t>=0&&r.players.splice(t,1);var n=r._engine.playersByElement.get(e);if(n){var i=n.indexOf(a);i>=0&&n.splice(i,1)}})),this.players.push(a),l.push(a),a}if(!function(e,t){var n=Object.keys(e),r=Object.keys(t);if(n.length!=r.length)return!1;for(var i=0;i<n.length;i++){var o=n[i];if(!t.hasOwnProperty(o)||e[o]!==t[o])return!1}return!0}(u.params,c.params)){var d=[],p=o.matchStyles(u.value,u.params,d),v=o.matchStyles(c.value,c.params,d);d.length?this._engine.reportError(d):this._engine.afterFlush((function(){mA(e,p),vA(e,v)}))}}},{key:"deregister",value:function(e){var t=this;delete this._triggers[e],this._engine.statesByElement.forEach((function(t,n){delete t[e]})),this._elementListeners.forEach((function(n,r){t._elementListeners.set(r,n.filter((function(t){return t.name!=e})))}))}},{key:"clearElementCache",value:function(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);var t=this._engine.playersByElement.get(e);t&&(t.forEach((function(e){return e.destroy()})),this._engine.playersByElement.delete(e))}},{key:"_signalRemovalForInnerTriggers",value:function(e,t){var n=this,r=this._engine.driver.query(e,".ng-trigger",!0);r.forEach((function(e){if(!e.__ng_removed){var r=n._engine.fetchNamespacesByElement(e);r.size?r.forEach((function(n){return n.triggerLeaveAnimation(e,t,!1,!0)})):n.clearElementCache(e)}})),this._engine.afterFlushAnimationsDone((function(){return r.forEach((function(e){return n.clearElementCache(e)}))}))}},{key:"triggerLeaveAnimation",value:function(e,t,n,r){var i=this,o=this._engine.statesByElement.get(e);if(o){var a=[];if(Object.keys(o).forEach((function(t){if(i._triggers[t]){var n=i.trigger(e,t,"void",r);n&&a.push(n)}})),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t),n&&zT(a).onDone((function(){return i._engine.processLeaveNode(e)})),!0}return!1}},{key:"prepareLeaveAnimationListeners",value:function(e){var t=this,n=this._elementListeners.get(e);if(n){var r=new Set;n.forEach((function(n){var i=n.name;if(!r.has(i)){r.add(i);var o=t._triggers[i].fallbackTransition,a=t._engine.statesByElement.get(e)[i]||lD,s=new cD("void"),u=new dD(t.id,i,e);t._engine.totalQueuedPlayers++,t._queue.push({element:e,triggerName:i,transition:o,fromState:a,toState:s,player:u,isFallbackTransition:!0})}}))}}},{key:"removeNode",value:function(e,t){var n=this,r=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),!this.triggerLeaveAnimation(e,t,!0)){var i=!1;if(r.totalAnimations){var o=r.players.length?r.playersByQueriedElement.get(e):[];if(o&&o.length)i=!0;else for(var a=e;a=a.parentNode;)if(r.statesByElement.get(a)){i=!0;break}}if(this.prepareLeaveAnimationListeners(e),i)r.markElementAsRemoved(this.id,e,!1,t);else{var s=e.__ng_removed;s&&s!==sD||(r.afterFlush((function(){return n.clearElementCache(e)})),r.destroyInnerAnimations(e),r._onRemovalComplete(e,t))}}}},{key:"insertNode",value:function(e,t){yD(e,this._hostClassName)}},{key:"drainQueuedTransitions",value:function(e){var t=this,n=[];return this._queue.forEach((function(r){var i=r.player;if(!i.destroyed){var o=r.element,a=t._elementListeners.get(o);a&&a.forEach((function(t){if(t.name==r.triggerName){var n=qT(o,r.triggerName,r.fromState.value,r.toState.value);n._data=e,jT(r.player,t.phase,n,t.callback)}})),i.markedForDestroy?t._engine.afterFlush((function(){i.destroy()})):n.push(r)}})),this._queue=[],n.sort((function(e,n){var r=e.transition.ast.depCount,i=n.transition.ast.depCount;return 0==r||0==i?r-i:t._engine.driver.containsElement(e.element,n.element)?1:-1}))}},{key:"destroy",value:function(e){this.players.forEach((function(e){return e.destroy()})),this._signalRemovalForInnerTriggers(this.hostElement,e)}},{key:"elementContainsData",value:function(e){var t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find((function(t){return t.element===e}))||t}}]),e}(),fD=function(){function e(t,n,r){_classCallCheck(this,e),this.bodyNode=t,this.driver=n,this._normalizer=r,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=function(e,t){}}return _createClass(e,[{key:"_onRemovalComplete",value:function(e,t){this.onRemovalComplete(e,t)}},{key:"createNamespace",value:function(e,t){var n=new hD(e,t,this);return t.parentNode?this._balanceNamespaceList(n,t):(this.newHostElements.set(t,n),this.collectEnterElement(t)),this._namespaceLookup[e]=n}},{key:"_balanceNamespaceList",value:function(e,t){var n=this._namespaceList.length-1;if(n>=0){for(var r=!1,i=n;i>=0;i--)if(this.driver.containsElement(this._namespaceList[i].hostElement,t)){this._namespaceList.splice(i+1,0,e),r=!0;break}r||this._namespaceList.splice(0,0,e)}else this._namespaceList.push(e);return this.namespacesByHostElement.set(t,e),e}},{key:"register",value:function(e,t){var n=this._namespaceLookup[e];return n||(n=this.createNamespace(e,t)),n}},{key:"registerTrigger",value:function(e,t,n){var r=this._namespaceLookup[e];r&&r.register(t,n)&&this.totalAnimations++}},{key:"destroy",value:function(e,t){var n=this;if(e){var r=this._fetchNamespace(e);this.afterFlush((function(){n.namespacesByHostElement.delete(r.hostElement),delete n._namespaceLookup[e];var t=n._namespaceList.indexOf(r);t>=0&&n._namespaceList.splice(t,1)})),this.afterFlushAnimationsDone((function(){return r.destroy(t)}))}}},{key:"_fetchNamespace",value:function(e){return this._namespaceLookup[e]}},{key:"fetchNamespacesByElement",value:function(e){var t=new Set,n=this.statesByElement.get(e);if(n)for(var r=Object.keys(n),i=0;i<r.length;i++){var o=n[r[i]].namespaceId;if(o){var a=this._fetchNamespace(o);a&&t.add(a)}}return t}},{key:"trigger",value:function(e,t,n,r){if(pD(t)){var i=this._fetchNamespace(e);if(i)return i.trigger(t,n,r),!0}return!1}},{key:"insertNode",value:function(e,t,n,r){if(pD(t)){var i=t.__ng_removed;if(i&&i.setForRemoval){i.setForRemoval=!1,i.setForMove=!0;var o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){var a=this._fetchNamespace(e);a&&a.insertNode(t,n)}r&&this.collectEnterElement(t)}}},{key:"collectEnterElement",value:function(e){this.collectedEnterElements.push(e)}},{key:"markElementAsDisabled",value:function(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),yD(e,"ng-animate-disabled")):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),bD(e,"ng-animate-disabled"))}},{key:"removeNode",value:function(e,t,n,r){if(pD(t)){var i=e?this._fetchNamespace(e):null;if(i?i.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),n){var o=this.namespacesByHostElement.get(t);o&&o.id!==e&&o.removeNode(t,r)}}else this._onRemovalComplete(t,r)}},{key:"markElementAsRemoved",value:function(e,t,n,r){this.collectedLeaveElements.push(t),t.__ng_removed={namespaceId:e,setForRemoval:r,hasAnimation:n,removedBeforeQueried:!1}}},{key:"listen",value:function(e,t,n,r,i){return pD(t)?this._fetchNamespace(e).listen(t,n,r,i):function(){}}},{key:"_buildInstruction",value:function(e,t,n,r,i){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,n,r,e.fromState.options,e.toState.options,t,i)}},{key:"destroyInnerAnimations",value:function(e){var t=this,n=this.driver.query(e,".ng-trigger",!0);n.forEach((function(e){return t.destroyActiveAnimationsForElement(e)})),0!=this.playersByQueriedElement.size&&(n=this.driver.query(e,".ng-animating",!0)).forEach((function(e){return t.finishActiveQueriedAnimationOnElement(e)}))}},{key:"destroyActiveAnimationsForElement",value:function(e){var t=this.playersByElement.get(e);t&&t.forEach((function(e){e.queued?e.markedForDestroy=!0:e.destroy()}))}},{key:"finishActiveQueriedAnimationOnElement",value:function(e){var t=this.playersByQueriedElement.get(e);t&&t.forEach((function(e){return e.finish()}))}},{key:"whenRenderingDone",value:function(){var e=this;return new Promise((function(t){if(e.players.length)return zT(e.players).onDone((function(){return t()}));t()}))}},{key:"processLeaveNode",value:function(e){var t=this,n=e.__ng_removed;if(n&&n.setForRemoval){if(e.__ng_removed=sD,n.namespaceId){this.destroyInnerAnimations(e);var r=this._fetchNamespace(n.namespaceId);r&&r.clearElementCache(e)}this._onRemovalComplete(e,n.setForRemoval)}this.driver.matchesElement(e,".ng-animate-disabled")&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach((function(e){t.markElementAsDisabled(e,!1)}))}},{key:"flush",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,n=[];if(this.newHostElements.size&&(this.newHostElements.forEach((function(t,n){return e._balanceNamespaceList(t,n)})),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(var r=0;r<this.collectedEnterElements.length;r++)yD(this.collectedEnterElements[r],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){var i=[];try{n=this._flushAnimations(i,t)}finally{for(var o=0;o<i.length;o++)i[o]()}}else for(var a=0;a<this.collectedLeaveElements.length;a++)this.processLeaveNode(this.collectedLeaveElements[a]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach((function(e){return e()})),this._flushFns=[],this._whenQuietFns.length){var s=this._whenQuietFns;this._whenQuietFns=[],n.length?zT(n).onDone((function(){s.forEach((function(e){return e()}))})):s.forEach((function(e){return e()}))}}},{key:"reportError",value:function(e){throw new Error("Unable to process animations due to the following failed trigger transitions\n "+e.join("\n"))}},{key:"_flushAnimations",value:function(e,t){var n=this,r=new UA,i=[],o=new Map,a=[],s=new Map,u=new Map,c=new Map,l=new Set;this.disabledNodes.forEach((function(e){l.add(e);for(var t=n.driver.query(e,".ng-animate-queued",!0),r=0;r<t.length;r++)l.add(t[r])}));var h=this.bodyNode,f=Array.from(this.statesByElement.keys()),d=gD(f,this.collectedEnterElements),p=new Map,v=0;d.forEach((function(e,t){var n="ng-enter"+v++;p.set(t,n),e.forEach((function(e){return yD(e,n)}))}));for(var m=[],g=new Set,y=new Set,b=0;b<this.collectedLeaveElements.length;b++){var _=this.collectedLeaveElements[b],w=_.__ng_removed;w&&w.setForRemoval&&(m.push(_),g.add(_),w.hasAnimation?this.driver.query(_,".ng-star-inserted",!0).forEach((function(e){return g.add(e)})):y.add(_))}var x=new Map,k=gD(f,Array.from(g));k.forEach((function(e,t){var n="ng-leave"+v++;x.set(t,n),e.forEach((function(e){return yD(e,n)}))})),e.push((function(){d.forEach((function(e,t){var n=p.get(t);e.forEach((function(e){return bD(e,n)}))})),k.forEach((function(e,t){var n=x.get(t);e.forEach((function(e){return bD(e,n)}))})),m.forEach((function(e){n.processLeaveNode(e)}))}));for(var C=[],E=[],S=this._namespaceList.length-1;S>=0;S--)this._namespaceList[S].drainQueuedTransitions(t).forEach((function(e){var t=e.player,o=e.element;if(C.push(t),n.collectedEnterElements.length){var l=o.__ng_removed;if(l&&l.setForMove)return void t.destroy()}var f=!h||!n.driver.containsElement(h,o),d=x.get(o),v=p.get(o),m=n._buildInstruction(e,r,v,d,f);if(m.errors&&m.errors.length)E.push(m);else{if(f)return t.onStart((function(){return mA(o,m.fromStyles)})),t.onDestroy((function(){return vA(o,m.toStyles)})),void i.push(t);if(e.isFallbackTransition)return t.onStart((function(){return mA(o,m.fromStyles)})),t.onDestroy((function(){return vA(o,m.toStyles)})),void i.push(t);m.timelines.forEach((function(e){return e.stretchStartingKeyframe=!0})),r.append(o,m.timelines),a.push({instruction:m,player:t,element:o}),m.queriedElements.forEach((function(e){return GT(s,e,[]).push(t)})),m.preStyleProps.forEach((function(e,t){var n=Object.keys(e);if(n.length){var r=u.get(t);r||u.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))}})),m.postStyleProps.forEach((function(e,t){var n=Object.keys(e),r=c.get(t);r||c.set(t,r=new Set),n.forEach((function(e){return r.add(e)}))}))}}));if(E.length){var I=[];E.forEach((function(e){I.push("@".concat(e.triggerName," has failed due to:\n")),e.errors.forEach((function(e){return I.push("- ".concat(e,"\n"))}))})),C.forEach((function(e){return e.destroy()})),this.reportError(I)}var R=new Map,T=new Map;a.forEach((function(e){var t=e.element;r.has(t)&&(T.set(t,t),n._beforeAnimationBuild(e.player.namespaceId,e.instruction,R))})),i.forEach((function(e){var t=e.element;n._getPreviousPlayers(t,!1,e.namespaceId,e.triggerName,null).forEach((function(e){GT(R,t,[]).push(e),e.destroy()}))}));var A=m.filter((function(e){return wD(e,u,c)})),D=new Map;mD(D,this.driver,y,c,"*").forEach((function(e){wD(e,u,c)&&A.push(e)}));var N=new Map;d.forEach((function(e,t){mD(N,n.driver,new Set(e),u,"!")})),A.forEach((function(e){var t=D.get(e),n=N.get(e);D.set(e,Object.assign(Object.assign({},t),n))}));var O=[],F=[],P={};a.forEach((function(e){var t=e.element,a=e.player,s=e.instruction;if(r.has(t)){if(l.has(t))return a.onDestroy((function(){return vA(t,s.toStyles)})),a.disabled=!0,a.overrideTotalTime(s.totalTime),void i.push(a);var u=P;if(T.size>1){for(var c=t,h=[];c=c.parentNode;){var f=T.get(c);if(f){u=f;break}h.push(c)}h.forEach((function(e){return T.set(e,u)}))}var d=n._buildAnimation(a.namespaceId,s,R,o,N,D);if(a.setRealPlayer(d),u===P)O.push(a);else{var p=n.playersByElement.get(u);p&&p.length&&(a.parentPlayer=zT(p)),i.push(a)}}else mA(t,s.fromStyles),a.onDestroy((function(){return vA(t,s.toStyles)})),F.push(a),l.has(t)&&i.push(a)})),F.forEach((function(e){var t=o.get(e.element);if(t&&t.length){var n=zT(t);e.setRealPlayer(n)}})),i.forEach((function(e){e.parentPlayer?e.syncPlayerEvents(e.parentPlayer):e.destroy()}));for(var M=0;M<m.length;M++){var L=m[M],B=L.__ng_removed;if(bD(L,"ng-leave"),!B||!B.hasAnimation){var U=[];if(s.size){var W=s.get(L);W&&W.length&&U.push.apply(U,_toConsumableArray(W));for(var z=this.driver.query(L,".ng-animating",!0),V=0;V<z.length;V++){var j=s.get(z[V]);j&&j.length&&U.push.apply(U,_toConsumableArray(j))}}var H=U.filter((function(e){return!e.destroyed}));H.length?_D(this,L,H):this.processLeaveNode(L)}}return m.length=0,O.forEach((function(e){n.players.push(e),e.onDone((function(){e.destroy();var t=n.players.indexOf(e);n.players.splice(t,1)})),e.play()})),O}},{key:"elementContainsData",value:function(e,t){var n=!1,r=t.__ng_removed;return r&&r.setForRemoval&&(n=!0),this.playersByElement.has(t)&&(n=!0),this.playersByQueriedElement.has(t)&&(n=!0),this.statesByElement.has(t)&&(n=!0),this._fetchNamespace(e).elementContainsData(t)||n}},{key:"afterFlush",value:function(e){this._flushFns.push(e)}},{key:"afterFlushAnimationsDone",value:function(e){this._whenQuietFns.push(e)}},{key:"_getPreviousPlayers",value:function(e,t,n,r,i){var o=[];if(t){var a=this.playersByQueriedElement.get(e);a&&(o=a)}else{var s=this.playersByElement.get(e);if(s){var u=!i||"void"==i;s.forEach((function(e){e.queued||(u||e.triggerName==r)&&o.push(e)}))}}return(n||r)&&(o=o.filter((function(e){return!(n&&n!=e.namespaceId||r&&r!=e.triggerName)}))),o}},{key:"_beforeAnimationBuild",value:function(e,t,n){var r,i=this,o=t.element,a=t.isRemovalTransition?void 0:e,s=t.isRemovalTransition?void 0:t.triggerName,u=_createForOfIteratorHelper(t.timelines);try{var c=function(){var e=r.value.element,u=e!==o,c=GT(n,e,[]);i._getPreviousPlayers(e,u,a,s,t.toState).forEach((function(e){var t=e.getRealPlayer();t.beforeDestroy&&t.beforeDestroy(),e.destroy(),c.push(e)}))};for(u.s();!(r=u.n()).done;)c()}catch(l){u.e(l)}finally{u.f()}mA(o,t.fromStyles)}},{key:"_buildAnimation",value:function(e,t,n,r,i,o){var a=this,s=t.triggerName,u=t.element,c=[],l=new Set,h=new Set,f=t.timelines.map((function(t){var f=t.element;l.add(f);var d=f.__ng_removed;if(d&&d.removedBeforeQueried)return new BT(t.duration,t.delay);var p,v,m=f!==u,g=(p=(n.get(f)||aD).map((function(e){return e.getRealPlayer()})),v=[],function e(t,n){for(var r=0;r<t.length;r++){var i=t[r];i instanceof UT?e(i.players,n):n.push(i)}}(p,v),v).filter((function(e){return!!e.element&&e.element===f})),y=i.get(f),b=o.get(f),_=VT(0,a._normalizer,0,t.keyframes,y,b),w=a._buildPlayer(t,_,g);if(t.subTimeline&&r&&h.add(f),m){var x=new dD(e,s,f);x.setRealPlayer(w),c.push(x)}return w}));c.forEach((function(e){GT(a.playersByQueriedElement,e.element,[]).push(e),e.onDone((function(){return function(e,t,n){var r;if(e instanceof Map){if(r=e.get(t)){if(r.length){var i=r.indexOf(n);r.splice(i,1)}0==r.length&&e.delete(t)}}else if(r=e[t]){if(r.length){var o=r.indexOf(n);r.splice(o,1)}0==r.length&&delete e[t]}return r}(a.playersByQueriedElement,e.element,e)}))})),l.forEach((function(e){return yD(e,"ng-animating")}));var d=zT(f);return d.onDestroy((function(){l.forEach((function(e){return bD(e,"ng-animating")})),vA(u,t.toStyles)})),h.forEach((function(e){GT(r,e,[]).push(d)})),d}},{key:"_buildPlayer",value:function(e,t,n){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,n):new BT(e.duration,e.delay)}},{key:"queuedPlayers",get:function(){var e=[];return this._namespaceList.forEach((function(t){t.players.forEach((function(t){t.queued&&e.push(t)}))})),e}}]),e}(),dD=function(){function e(t,n,r){_classCallCheck(this,e),this.namespaceId=t,this.triggerName=n,this.element=r,this._player=new BT,this._containsRealPlayer=!1,this._queuedCallbacks={},this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}return _createClass(e,[{key:"setRealPlayer",value:function(e){var t=this;this._containsRealPlayer||(this._player=e,Object.keys(this._queuedCallbacks).forEach((function(n){t._queuedCallbacks[n].forEach((function(t){return jT(e,n,void 0,t)}))})),this._queuedCallbacks={},this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}},{key:"getRealPlayer",value:function(){return this._player}},{key:"overrideTotalTime",value:function(e){this.totalTime=e}},{key:"syncPlayerEvents",value:function(e){var t=this,n=this._player;n.triggerCallback&&e.onStart((function(){return n.triggerCallback("start")})),e.onDone((function(){return t.finish()})),e.onDestroy((function(){return t.destroy()}))}},{key:"_queueEvent",value:function(e,t){GT(this._queuedCallbacks,e,[]).push(t)}},{key:"onDone",value:function(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}},{key:"onStart",value:function(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}},{key:"onDestroy",value:function(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}},{key:"init",value:function(){this._player.init()}},{key:"hasStarted",value:function(){return!this.queued&&this._player.hasStarted()}},{key:"play",value:function(){!this.queued&&this._player.play()}},{key:"pause",value:function(){!this.queued&&this._player.pause()}},{key:"restart",value:function(){!this.queued&&this._player.restart()}},{key:"finish",value:function(){this._player.finish()}},{key:"destroy",value:function(){this.destroyed=!0,this._player.destroy()}},{key:"reset",value:function(){!this.queued&&this._player.reset()}},{key:"setPosition",value:function(e){this.queued||this._player.setPosition(e)}},{key:"getPosition",value:function(){return this.queued?0:this._player.getPosition()}},{key:"triggerCallback",value:function(e){var t=this._player;t.triggerCallback&&t.triggerCallback(e)}}]),e}();function pD(e){return e&&1===e.nodeType}function vD(e,t){var n=e.style.display;return e.style.display=null!=t?t:"none",n}function mD(e,t,n,r,i){var o=[];n.forEach((function(e){return o.push(vD(e))}));var a=[];r.forEach((function(n,r){var o={};n.forEach((function(e){var n=o[e]=t.computeStyle(r,e,i);n&&0!=n.length||(r.__ng_removed=uD,a.push(r))})),e.set(r,o)}));var s=0;return n.forEach((function(e){return vD(e,o[s++])})),a}function gD(e,t){var n=new Map;if(e.forEach((function(e){return n.set(e,[])})),0==t.length)return n;var r=new Set(t),i=new Map;return t.forEach((function(e){var t=function e(t){if(!t)return 1;var o=i.get(t);if(o)return o;var a=t.parentNode;return o=n.has(a)?a:r.has(a)?1:e(a),i.set(t,o),o}(e);1!==t&&n.get(t).push(e)})),n}function yD(e,t){if(e.classList)e.classList.add(t);else{var n=e.$$classes;n||(n=e.$$classes={}),n[t]=!0}}function bD(e,t){if(e.classList)e.classList.remove(t);else{var n=e.$$classes;n&&delete n[t]}}function _D(e,t,n){zT(n).onDone((function(){return e.processLeaveNode(t)}))}function wD(e,t,n){var r=n.get(e);if(!r)return!1;var i=t.get(e);return i?r.forEach((function(e){return i.add(e)})):t.set(e,r),n.delete(e),!0}var xD=function(){function e(t,n,r){var i=this;_classCallCheck(this,e),this.bodyNode=t,this._driver=n,this._triggerCache={},this.onRemovalComplete=function(e,t){},this._transitionEngine=new fD(t,n,r),this._timelineEngine=new oD(t,n,r),this._transitionEngine.onRemovalComplete=function(e,t){return i.onRemovalComplete(e,t)}}return _createClass(e,[{key:"registerTrigger",value:function(e,t,n,r,i){var o=e+"-"+r,a=this._triggerCache[o];if(!a){var s=[],u=NA(this._driver,i,s);if(s.length)throw new Error('The animation trigger "'.concat(r,'" has failed to build due to the following errors:\n - ').concat(s.join("\n - ")));a=function(e,t){return new nD(e,t)}(r,u),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}},{key:"register",value:function(e,t){this._transitionEngine.register(e,t)}},{key:"destroy",value:function(e,t){this._transitionEngine.destroy(e,t)}},{key:"onInsert",value:function(e,t,n,r){this._transitionEngine.insertNode(e,t,n,r)}},{key:"onRemove",value:function(e,t,n,r){this._transitionEngine.removeNode(e,t,r||!1,n)}},{key:"disableAnimations",value:function(e,t){this._transitionEngine.markElementAsDisabled(e,t)}},{key:"process",value:function(e,t,n,r){if("@"==n.charAt(0)){var i=_slicedToArray(KT(n),2),o=i[0],a=i[1];this._timelineEngine.command(o,t,a,r)}else this._transitionEngine.trigger(e,t,n,r)}},{key:"listen",value:function(e,t,n,r,i){if("@"==n.charAt(0)){var o=_slicedToArray(KT(n),2),a=o[0],s=o[1];return this._timelineEngine.listen(a,t,s,i)}return this._transitionEngine.listen(e,t,n,r,i)}},{key:"flush",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._transitionEngine.flush(e)}},{key:"whenRenderingDone",value:function(){return this._transitionEngine.whenRenderingDone()}},{key:"players",get:function(){return this._transitionEngine.players.concat(this._timelineEngine.players)}}]),e}();function kD(e,t){var n=null,r=null;return Array.isArray(t)&&t.length?(n=ED(t[0]),t.length>1&&(r=ED(t[t.length-1]))):t&&(n=ED(t)),n||r?new CD(e,n,r):null}var CD=function(){var e=function(){function e(t,n,r){_classCallCheck(this,e),this._element=t,this._startStyles=n,this._endStyles=r,this._state=0;var i=e.initialStylesByElement.get(t);i||e.initialStylesByElement.set(t,i={}),this._initialStyles=i}return _createClass(e,[{key:"start",value:function(){this._state<1&&(this._startStyles&&vA(this._element,this._startStyles,this._initialStyles),this._state=1)}},{key:"finish",value:function(){this.start(),this._state<2&&(vA(this._element,this._initialStyles),this._endStyles&&(vA(this._element,this._endStyles),this._endStyles=null),this._state=1)}},{key:"destroy",value:function(){this.finish(),this._state<3&&(e.initialStylesByElement.delete(this._element),this._startStyles&&(mA(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(mA(this._element,this._endStyles),this._endStyles=null),vA(this._element,this._initialStyles),this._state=3)}}]),e}();return e.initialStylesByElement=new WeakMap,e}();function ED(e){for(var t=null,n=Object.keys(e),r=0;r<n.length;r++){var i=n[r];SD(i)&&((t=t||{})[i]=e[i])}return t}function SD(e){return"display"===e||"position"===e}var ID=function(){function e(t,n,r,i,o,a,s){var u=this;_classCallCheck(this,e),this._element=t,this._name=n,this._duration=r,this._delay=i,this._easing=o,this._fillMode=a,this._onDoneFn=s,this._finished=!1,this._destroyed=!1,this._startTime=0,this._position=0,this._eventFn=function(e){return u._handleCallback(e)}}return _createClass(e,[{key:"apply",value:function(){var e,t,n;e=this._element,t="".concat(this._duration,"ms ").concat(this._easing," ").concat(this._delay,"ms 1 normal ").concat(this._fillMode," ").concat(this._name),(n=OD(e,"").trim()).length&&(function(e,t){for(var n=0;n<e.length;n++)e.charAt(n)}(n),t="".concat(n,", ").concat(t)),ND(e,"",t),DD(this._element,this._eventFn,!1),this._startTime=Date.now()}},{key:"pause",value:function(){RD(this._element,this._name,"paused")}},{key:"resume",value:function(){RD(this._element,this._name,"running")}},{key:"setPosition",value:function(e){var t=TD(this._element,this._name);this._position=e*this._duration,ND(this._element,"Delay","-".concat(this._position,"ms"),t)}},{key:"getPosition",value:function(){return this._position}},{key:"_handleCallback",value:function(e){var t=e._ngTestManualTimestamp||Date.now(),n=1e3*parseFloat(e.elapsedTime.toFixed(3));e.animationName==this._name&&Math.max(t-this._startTime,0)>=this._delay&&n>=this._duration&&this.finish()}},{key:"finish",value:function(){this._finished||(this._finished=!0,this._onDoneFn(),DD(this._element,this._eventFn,!0))}},{key:"destroy",value:function(){var e,t,n,r;this._destroyed||(this._destroyed=!0,this.finish(),e=this._element,t=this._name,n=OD(e,"").split(","),(r=AD(n,t))>=0&&(n.splice(r,1),ND(e,"",n.join(","))))}}]),e}();function RD(e,t,n){ND(e,"PlayState",n,TD(e,t))}function TD(e,t){var n=OD(e,"");return n.indexOf(",")>0?AD(n.split(","),t):AD([n],t)}function AD(e,t){for(var n=0;n<e.length;n++)if(e[n].indexOf(t)>=0)return n;return-1}function DD(e,t,n){n?e.removeEventListener("animationend",t):e.addEventListener("animationend",t)}function ND(e,t,n,r){var i="animation"+t;if(null!=r){var o=e.style[i];if(o.length){var a=o.split(",");a[r]=n,n=a.join(",")}}e.style[i]=n}function OD(e,t){return e.style["animation"+t]}var FD=function(){function e(t,n,r,i,o,a,s,u){_classCallCheck(this,e),this.element=t,this.keyframes=n,this.animationName=r,this._duration=i,this._delay=o,this._finalStyles=s,this._specialStyles=u,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._started=!1,this.currentSnapshot={},this._state=0,this.easing=a||"linear",this.totalTime=i+o,this._buildStyler()}return _createClass(e,[{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"destroy",value:function(){this.init(),this._state>=4||(this._state=4,this._styler.destroy(),this._flushStartFns(),this._flushDoneFns(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"_flushDoneFns",value:function(){this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[]}},{key:"_flushStartFns",value:function(){this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[]}},{key:"finish",value:function(){this.init(),this._state>=3||(this._state=3,this._styler.finish(),this._flushStartFns(),this._specialStyles&&this._specialStyles.finish(),this._flushDoneFns())}},{key:"setPosition",value:function(e){this._styler.setPosition(e)}},{key:"getPosition",value:function(){return this._styler.getPosition()}},{key:"hasStarted",value:function(){return this._state>=2}},{key:"init",value:function(){this._state>=1||(this._state=1,this._styler.apply(),this._delay&&this._styler.pause())}},{key:"play",value:function(){this.init(),this.hasStarted()||(this._flushStartFns(),this._state=2,this._specialStyles&&this._specialStyles.start()),this._styler.resume()}},{key:"pause",value:function(){this.init(),this._styler.pause()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"reset",value:function(){this._styler.destroy(),this._buildStyler(),this._styler.apply()}},{key:"_buildStyler",value:function(){var e=this;this._styler=new ID(this.element,this.animationName,this._duration,this._delay,this.easing,"forwards",(function(){return e.finish()}))}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"beforeDestroy",value:function(){var e=this;this.init();var t={};if(this.hasStarted()){var n=this._state>=3;Object.keys(this._finalStyles).forEach((function(r){"offset"!=r&&(t[r]=n?e._finalStyles[r]:IA(e.element,r))}))}this.currentSnapshot=t}}]),e}(),PD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this)).element=e,i._startingStyles={},i.__initialized=!1,i._styles=iA(r),i}return _createClass(n,[{key:"init",value:function(){var e=this;!this.__initialized&&this._startingStyles&&(this.__initialized=!0,Object.keys(this._styles).forEach((function(t){e._startingStyles[t]=e.element.style[t]})),_get(_getPrototypeOf(n.prototype),"init",this).call(this))}},{key:"play",value:function(){var e=this;this._startingStyles&&(this.init(),Object.keys(this._styles).forEach((function(t){return e.element.style.setProperty(t,e._styles[t])})),_get(_getPrototypeOf(n.prototype),"play",this).call(this))}},{key:"destroy",value:function(){var e=this;this._startingStyles&&(Object.keys(this._startingStyles).forEach((function(t){var n=e._startingStyles[t];n?e.element.style.setProperty(t,n):e.element.style.removeProperty(t)})),this._startingStyles=null,_get(_getPrototypeOf(n.prototype),"destroy",this).call(this))}}]),n}(BT),MD=function(){function e(){_classCallCheck(this,e),this._count=0,this._head=document.querySelector("head"),this._warningIssued=!1}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return eA(e)}},{key:"matchesElement",value:function(e,t){return tA(e,t)}},{key:"containsElement",value:function(e,t){return nA(e,t)}},{key:"query",value:function(e,t,n){return rA(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"buildKeyframeElement",value:function(e,t,n){n=n.map((function(e){return iA(e)}));var r="@keyframes ".concat(t," {\n"),i="";n.forEach((function(e){i=" ";var t=parseFloat(e.offset);r+="".concat(i).concat(100*t,"% {\n"),i+=" ",Object.keys(e).forEach((function(t){var n=e[t];switch(t){case"offset":return;case"easing":return void(n&&(r+="".concat(i,"animation-timing-function: ").concat(n,";\n")));default:return void(r+="".concat(i).concat(t,": ").concat(n,";\n"))}})),r+=i+"}\n"})),r+="}\n";var o=document.createElement("style");return o.innerHTML=r,o}},{key:"animate",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0;a&&this._notifyFaultyScrubber();var s=o.filter((function(e){return e instanceof FD})),u={};CA(n,r)&&s.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var c=function(e){var t={};return e&&(Array.isArray(e)?e:[e]).forEach((function(e){Object.keys(e).forEach((function(n){"offset"!=n&&"easing"!=n&&(t[n]=e[n])}))})),t}(t=EA(e,t,u));if(0==n)return new PD(e,c);var l="gen_css_kf_"+this._count++,h=this.buildKeyframeElement(e,l,t);document.querySelector("head").appendChild(h);var f=kD(e,t),d=new FD(e,t,l,n,r,i,c,f);return d.onDestroy((function(){var e;(e=h).parentNode.removeChild(e)})),d}},{key:"_notifyFaultyScrubber",value:function(){this._warningIssued||(console.warn("@angular/animations: please load the web-animations.js polyfill to allow programmatic access...\n","  visit http://bit.ly/IWukam to learn more about using the web-animation-js polyfill."),this._warningIssued=!0)}}]),e}(),LD=function(){function e(t,n,r,i){_classCallCheck(this,e),this.element=t,this.keyframes=n,this.options=r,this._specialStyles=i,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this.time=0,this.parentPlayer=null,this.currentSnapshot={},this._duration=r.duration,this._delay=r.delay||0,this.time=this._duration+this._delay}return _createClass(e,[{key:"_onFinish",value:function(){this._finished||(this._finished=!0,this._onDoneFns.forEach((function(e){return e()})),this._onDoneFns=[])}},{key:"init",value:function(){this._buildPlayer(),this._preparePlayerBeforeStart()}},{key:"_buildPlayer",value:function(){var e=this;if(!this._initialized){this._initialized=!0;var t=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,t,this.options),this._finalKeyframe=t.length?t[t.length-1]:{},this.domPlayer.addEventListener("finish",(function(){return e._onFinish()}))}}},{key:"_preparePlayerBeforeStart",value:function(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}},{key:"_triggerWebAnimation",value:function(e,t,n){return e.animate(t,n)}},{key:"onStart",value:function(e){this._onStartFns.push(e)}},{key:"onDone",value:function(e){this._onDoneFns.push(e)}},{key:"onDestroy",value:function(e){this._onDestroyFns.push(e)}},{key:"play",value:function(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach((function(e){return e()})),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}},{key:"pause",value:function(){this.init(),this.domPlayer.pause()}},{key:"finish",value:function(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}},{key:"reset",value:function(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1}},{key:"_resetDomPlayerState",value:function(){this.domPlayer&&this.domPlayer.cancel()}},{key:"restart",value:function(){this.reset(),this.play()}},{key:"hasStarted",value:function(){return this._started}},{key:"destroy",value:function(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach((function(e){return e()})),this._onDestroyFns=[])}},{key:"setPosition",value:function(e){this.domPlayer.currentTime=e*this.time}},{key:"getPosition",value:function(){return this.domPlayer.currentTime/this.time}},{key:"beforeDestroy",value:function(){var e=this,t={};this.hasStarted()&&Object.keys(this._finalKeyframe).forEach((function(n){"offset"!=n&&(t[n]=e._finished?e._finalKeyframe[n]:IA(e.element,n))})),this.currentSnapshot=t}},{key:"triggerCallback",value:function(e){var t="start"==e?this._onStartFns:this._onDoneFns;t.forEach((function(e){return e()})),t.length=0}},{key:"totalTime",get:function(){return this._delay+this._duration}}]),e}(),BD=function(){function e(){_classCallCheck(this,e),this._isNativeImpl=/\{\s*\[native\s+code\]\s*\}/.test(UD().toString()),this._cssKeyframesDriver=new MD}return _createClass(e,[{key:"validateStyleProperty",value:function(e){return eA(e)}},{key:"matchesElement",value:function(e,t){return tA(e,t)}},{key:"containsElement",value:function(e,t){return nA(e,t)}},{key:"query",value:function(e,t,n){return rA(e,t,n)}},{key:"computeStyle",value:function(e,t,n){return window.getComputedStyle(e)[t]}},{key:"overrideWebAnimationsSupport",value:function(e){this._isNativeImpl=e}},{key:"animate",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0;if(!a&&!this._isNativeImpl)return this._cssKeyframesDriver.animate(e,t,n,r,i,o);var s={duration:n,delay:r,fill:0==r?"both":"forwards"};i&&(s.easing=i);var u={},c=o.filter((function(e){return e instanceof LD}));CA(n,r)&&c.forEach((function(e){var t=e.currentSnapshot;Object.keys(t).forEach((function(e){return u[e]=t[e]}))}));var l=kD(e,t=EA(e,t=t.map((function(e){return fA(e,!1)})),u));return new LD(e,t,s,l)}}]),e}();function UD(){return"undefined"!=typeof window&&void 0!==window.document&&Element.prototype.animate||{}}var WD,zD=((WD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this))._nextAnimationId=0,i._renderer=e.createRenderer(r.body,{id:"0",encapsulation:ft.None,styles:[],data:{animation:[]}}),i}return _createClass(n,[{key:"build",value:function(e){var t=this._nextAnimationId.toString();this._nextAnimationId++;var n=Array.isArray(e)?PT(e):e;return HD(this._renderer,null,t,"register",[n]),new VD(t,this._renderer)}}]),n}(FT)).\u0275fac=function(e){return new(e||WD)(Ze(Ia),Ze(Nu))},WD.\u0275prov=pe({token:WD,factory:WD.\u0275fac}),WD),VD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r){var i;return _classCallCheck(this,n),(i=t.call(this))._id=e,i._renderer=r,i}return _createClass(n,[{key:"create",value:function(e,t){return new jD(this._id,e,t||{},this._renderer)}}]),n}(function(){return function e(){_classCallCheck(this,e)}}()),jD=function(){function e(t,n,r,i){_classCallCheck(this,e),this.id=t,this.element=n,this._renderer=i,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",r)}return _createClass(e,[{key:"_listen",value:function(e,t){return this._renderer.listen(this.element,"@@".concat(this.id,":").concat(e),t)}},{key:"_command",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return HD(this._renderer,this.element,this.id,e,n)}},{key:"onDone",value:function(e){this._listen("done",e)}},{key:"onStart",value:function(e){this._listen("start",e)}},{key:"onDestroy",value:function(e){this._listen("destroy",e)}},{key:"init",value:function(){this._command("init")}},{key:"hasStarted",value:function(){return this._started}},{key:"play",value:function(){this._command("play"),this._started=!0}},{key:"pause",value:function(){this._command("pause")}},{key:"restart",value:function(){this._command("restart")}},{key:"finish",value:function(){this._command("finish")}},{key:"destroy",value:function(){this._command("destroy")}},{key:"reset",value:function(){this._command("reset")}},{key:"setPosition",value:function(e){this._command("setPosition",e)}},{key:"getPosition",value:function(){return 0}}]),e}();function HD(e,t,n,r,i){return e.setProperty(t,"@@".concat(n,":").concat(r),i)}var qD,GD,KD,XD,QD=((qD=function(){function e(t,n,r){_classCallCheck(this,e),this.delegate=t,this.engine=n,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),n.onRemovalComplete=function(e,t){t&&t.parentNode(e)&&t.removeChild(e.parentNode,e)}}return _createClass(e,[{key:"createRenderer",value:function(e,t){var n=this,r=this.delegate.createRenderer(e,t);if(!(e&&t&&t.data&&t.data.animation)){var i=this._rendererCache.get(r);return i||(i=new YD("",r,this.engine),this._rendererCache.set(r,i)),i}var o=t.id,a=t.id+"-"+this._currentId;return this._currentId++,this.engine.register(a,e),t.data.animation.forEach((function t(r){Array.isArray(r)?r.forEach(t):n.engine.registerTrigger(o,a,e,r.name,r)})),new $D(this,a,r,this.engine)}},{key:"begin",value:function(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}},{key:"_scheduleCountTask",value:function(){var e=this;this.promise.then((function(){e._microtaskId++}))}},{key:"scheduleListenerCallback",value:function(e,t,n){var r=this;e>=0&&e<this._microtaskId?this._zone.run((function(){return t(n)})):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then((function(){r._zone.run((function(){r._animationCallbacksBuffer.forEach((function(e){var t=_slicedToArray(e,2);(0,t[0])(t[1])})),r._animationCallbacksBuffer=[]}))})),this._animationCallbacksBuffer.push([t,n]))}},{key:"end",value:function(){var e=this;this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular((function(){e._scheduleCountTask(),e.engine.flush(e._microtaskId)})),this.delegate.end&&this.delegate.end()}},{key:"whenRenderingDone",value:function(){return this.engine.whenRenderingDone()}}]),e}()).\u0275fac=function(e){return new(e||qD)(Ze(Ia),Ze(xD),Ze(Js))},qD.\u0275prov=pe({token:qD,factory:qD.\u0275fac}),qD),YD=function(){function e(t,n,r){_classCallCheck(this,e),this.namespaceId=t,this.delegate=n,this.engine=r,this.destroyNode=this.delegate.destroyNode?function(e){return n.destroyNode(e)}:null}return _createClass(e,[{key:"destroy",value:function(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy()}},{key:"createElement",value:function(e,t){return this.delegate.createElement(e,t)}},{key:"createComment",value:function(e){return this.delegate.createComment(e)}},{key:"createText",value:function(e){return this.delegate.createText(e)}},{key:"appendChild",value:function(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}},{key:"insertBefore",value:function(e,t,n){this.delegate.insertBefore(e,t,n),this.engine.onInsert(this.namespaceId,t,e,!0)}},{key:"removeChild",value:function(e,t,n){this.engine.onRemove(this.namespaceId,t,this.delegate,n)}},{key:"selectRootElement",value:function(e,t){return this.delegate.selectRootElement(e,t)}},{key:"parentNode",value:function(e){return this.delegate.parentNode(e)}},{key:"nextSibling",value:function(e){return this.delegate.nextSibling(e)}},{key:"setAttribute",value:function(e,t,n,r){this.delegate.setAttribute(e,t,n,r)}},{key:"removeAttribute",value:function(e,t,n){this.delegate.removeAttribute(e,t,n)}},{key:"addClass",value:function(e,t){this.delegate.addClass(e,t)}},{key:"removeClass",value:function(e,t){this.delegate.removeClass(e,t)}},{key:"setStyle",value:function(e,t,n,r){this.delegate.setStyle(e,t,n,r)}},{key:"removeStyle",value:function(e,t,n){this.delegate.removeStyle(e,t,n)}},{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)&&"@.disabled"==t?this.disableAnimations(e,!!n):this.delegate.setProperty(e,t,n)}},{key:"setValue",value:function(e,t){this.delegate.setValue(e,t)}},{key:"listen",value:function(e,t,n){return this.delegate.listen(e,t,n)}},{key:"disableAnimations",value:function(e,t){this.engine.disableAnimations(e,t)}},{key:"data",get:function(){return this.delegate.data}}]),e}(),$D=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o){var a;return _classCallCheck(this,n),(a=t.call(this,r,i,o)).factory=e,a.namespaceId=r,a}return _createClass(n,[{key:"setProperty",value:function(e,t,n){"@"==t.charAt(0)?"."==t.charAt(1)&&"@.disabled"==t?this.disableAnimations(e,n=void 0===n||!!n):this.engine.process(this.namespaceId,e,t.substr(1),n):this.delegate.setProperty(e,t,n)}},{key:"listen",value:function(e,t,n){var r,i,o=this;if("@"==t.charAt(0)){var a,s=function(e){switch(e){case"body":return document.body;case"document":return document;case"window":return window;default:return e}}(e),u=t.substr(1),c="";return"@"!=u.charAt(0)&&(i=(r=u).indexOf("."),u=(a=_slicedToArray([r.substring(0,i),r.substr(i+1)],2))[0],c=a[1]),this.engine.listen(this.namespaceId,s,u,c,(function(e){o.factory.scheduleListenerCallback(e._data||-1,n,e)}))}return this.delegate.listen(e,t,n)}}]),n}(YD),ZD=((GD=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){return _classCallCheck(this,n),t.call(this,e.body,r,i)}return n}(xD)).\u0275fac=function(e){return new(e||GD)(Ze(Nu),Ze(sA),Ze(QA))},GD.\u0275prov=pe({token:GD,factory:GD.\u0275fac}),GD),JD=new je("AnimationModuleType"),eN=[{provide:sA,useFactory:function(){return"function"==typeof UD()?new BD:new MD}},{provide:JD,useValue:"BrowserAnimations"},{provide:FT,useClass:zD},{provide:QA,useFactory:function(){return new YA}},{provide:xD,useClass:ZD},{provide:Ia,useFactory:function(e,t,n){return new QD(e,t,n)},deps:[jc,xD,Js]}],tN=((KD=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:KD}),KD.\u0275inj=ve({factory:function(e){return new(e||KD)},providers:eN,imports:[tl]}),KD),nN=new Na("9.2.4"),rN=new je("mat-sanity-checks",{providedIn:"root",factory:function(){return!0}}),iN=((XD=function(){function e(t,n,r){_classCallCheck(this,e),this._hasDoneGlobalChecks=!1,this._document=r,t._applyBodyHighContrastModeCssClasses(),this._sanityChecks=n,this._hasDoneGlobalChecks||(this._checkDoctypeIsDefined(),this._checkThemeIsPresent(),this._checkCdkVersionMatch(),this._hasDoneGlobalChecks=!0)}return _createClass(e,[{key:"_getDocument",value:function(){var e=this._document||document;return"object"==typeof e&&e?e:null}},{key:"_getWindow",value:function(){var e=this._getDocument(),t=(null==e?void 0:e.defaultView)||window;return"object"==typeof t&&t?t:null}},{key:"_checksAreEnabled",value:function(){return lr()&&!this._isTestEnv()}},{key:"_isTestEnv",value:function(){var e=this._getWindow();return e&&(e.__karma__||e.jasmine)}},{key:"_checkDoctypeIsDefined",value:function(){var e=this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.doctype),t=this._getDocument();e&&t&&!t.doctype&&console.warn("Current document does not have a doctype. This may cause some Angular Material components not to behave as expected.")}},{key:"_checkThemeIsPresent",value:function(){var e=!this._checksAreEnabled()||!1===this._sanityChecks||!this._sanityChecks.theme,t=this._getDocument();if(!e&&t&&t.body&&"function"==typeof getComputedStyle){var n=t.createElement("div");n.classList.add("mat-theme-loaded-marker"),t.body.appendChild(n);var r=getComputedStyle(n);r&&"none"!==r.display&&console.warn("Could not find Angular Material core theme. Most Material components may not work as expected. For more info refer to the theming guide: https://material.angular.io/guide/theming"),t.body.removeChild(n)}}},{key:"_checkCdkVersionMatch",value:function(){this._checksAreEnabled()&&(!0===this._sanityChecks||this._sanityChecks.version)&&nN.full!==OT.full&&console.warn("The Angular Material version ("+nN.full+") does not match the Angular CDK version ("+OT.full+").\nPlease ensure the versions of these two packages exactly match.")}}]),e}()).\u0275mod=_t({type:XD}),XD.\u0275inj=ve({factory:function(e){return new(e||XD)(Ze(TT),Ze(rN,8),Ze(Nu,8))},imports:[[NT],NT]}),XD);function oN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return function(e){_inherits(r,e);var n=_createSuper(r);function r(){var e;_classCallCheck(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=n.call.apply(n,[this].concat(o)))._tabIndex=t,e}return _createClass(r,[{key:"tabIndex",get:function(){return this.disabled?-1:this._tabIndex},set:function(e){this._tabIndex=null!=e?e:t}}]),r}(e)}try{"undefined"!=typeof Intl}catch(CO){!1}var aN,sN,uN,cN,lN,hN,fN,dN,pN,vN=function(){function e(t,n,r){_classCallCheck(this,e),this._renderer=t,this.element=n,this.config=r,this.state=3}return _createClass(e,[{key:"fadeOut",value:function(){this._renderer.fadeOutRipple(this)}}]),e}(),mN={enterDuration:450,exitDuration:400},gN=bT({passive:!0}),yN=["mousedown","touchstart"],bN=["mouseup","mouseleave","touchend","touchcancel"],_N=function(){function e(t,n,r,i){_classCallCheck(this,e),this._target=t,this._ngZone=n,this._isPointerDown=!1,this._activeRipples=new Set,this._pointerUpEventsRegistered=!1,i.isBrowser&&(this._containerElement=fT(r))}return _createClass(e,[{key:"fadeInRipple",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this._containerRect=this._containerRect||this._containerElement.getBoundingClientRect(),o=Object.assign(Object.assign({},mN),r.animation);r.centered&&(e=i.left+i.width/2,t=i.top+i.height/2);var a=r.radius||function(e,t,n){var r=Math.max(Math.abs(e-n.left),Math.abs(e-n.right)),i=Math.max(Math.abs(t-n.top),Math.abs(t-n.bottom));return Math.sqrt(r*r+i*i)}(e,t,i),s=e-i.left,u=t-i.top,c=o.enterDuration,l=document.createElement("div");l.classList.add("mat-ripple-element"),l.style.left=s-a+"px",l.style.top=u-a+"px",l.style.height=2*a+"px",l.style.width=2*a+"px",null!=r.color&&(l.style.backgroundColor=r.color),l.style.transitionDuration=c+"ms",this._containerElement.appendChild(l),window.getComputedStyle(l).getPropertyValue("opacity"),l.style.transform="scale(1)";var h=new vN(this,l,r);return h.state=0,this._activeRipples.add(h),r.persistent||(this._mostRecentTransientRipple=h),this._runTimeoutOutsideZone((function(){var e=h===n._mostRecentTransientRipple;h.state=1,r.persistent||e&&n._isPointerDown||h.fadeOut()}),c),h}},{key:"fadeOutRipple",value:function(e){var t=this._activeRipples.delete(e);if(e===this._mostRecentTransientRipple&&(this._mostRecentTransientRipple=null),this._activeRipples.size||(this._containerRect=null),t){var n=e.element,r=Object.assign(Object.assign({},mN),e.config.animation);n.style.transitionDuration=r.exitDuration+"ms",n.style.opacity="0",e.state=2,this._runTimeoutOutsideZone((function(){e.state=3,n.parentNode.removeChild(n)}),r.exitDuration)}}},{key:"fadeOutAll",value:function(){this._activeRipples.forEach((function(e){return e.fadeOut()}))}},{key:"setupTriggerEvents",value:function(e){var t=fT(e);t&&t!==this._triggerElement&&(this._removeTriggerEvents(),this._triggerElement=t,this._registerEvents(yN))}},{key:"handleEvent",value:function(e){"mousedown"===e.type?this._onMousedown(e):"touchstart"===e.type?this._onTouchStart(e):this._onPointerUp(),this._pointerUpEventsRegistered||(this._registerEvents(bN),this._pointerUpEventsRegistered=!0)}},{key:"_onMousedown",value:function(e){var t=_T(e),n=this._lastTouchStartEvent&&Date.now()<this._lastTouchStartEvent+800;this._target.rippleDisabled||t||n||(this._isPointerDown=!0,this.fadeInRipple(e.clientX,e.clientY,this._target.rippleConfig))}},{key:"_onTouchStart",value:function(e){if(!this._target.rippleDisabled){this._lastTouchStartEvent=Date.now(),this._isPointerDown=!0;for(var t=e.changedTouches,n=0;n<t.length;n++)this.fadeInRipple(t[n].clientX,t[n].clientY,this._target.rippleConfig)}}},{key:"_onPointerUp",value:function(){this._isPointerDown&&(this._isPointerDown=!1,this._activeRipples.forEach((function(e){!e.config.persistent&&(1===e.state||e.config.terminateOnPointerUp&&0===e.state)&&e.fadeOut()})))}},{key:"_runTimeoutOutsideZone",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this._ngZone.runOutsideAngular((function(){return setTimeout(e,t)}))}},{key:"_registerEvents",value:function(e){var t=this;this._ngZone.runOutsideAngular((function(){e.forEach((function(e){t._triggerElement.addEventListener(e,t,gN)}))}))}},{key:"_removeTriggerEvents",value:function(){var e=this;this._triggerElement&&(yN.forEach((function(t){e._triggerElement.removeEventListener(t,e,gN)})),this._pointerUpEventsRegistered&&bN.forEach((function(t){e._triggerElement.removeEventListener(t,e,gN)})))}}]),e}(),wN=new je("mat-ripple-global-options"),xN=((sN=function(){function e(t,n,r,i,o){_classCallCheck(this,e),this._elementRef=t,this._animationMode=o,this.radius=0,this._disabled=!1,this._isInitialized=!1,this._globalOptions=i||{},this._rippleRenderer=new _N(this,n,t,r)}return _createClass(e,[{key:"ngOnInit",value:function(){this._isInitialized=!0,this._setupTriggerEventsIfEnabled()}},{key:"ngOnDestroy",value:function(){this._rippleRenderer._removeTriggerEvents()}},{key:"fadeOutAll",value:function(){this._rippleRenderer.fadeOutAll()}},{key:"_setupTriggerEventsIfEnabled",value:function(){!this.disabled&&this._isInitialized&&this._rippleRenderer.setupTriggerEvents(this.trigger)}},{key:"launch",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0;return"number"==typeof e?this._rippleRenderer.fadeInRipple(e,t,Object.assign(Object.assign({},this.rippleConfig),n)):this._rippleRenderer.fadeInRipple(0,0,Object.assign(Object.assign({},this.rippleConfig),e))}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=e,this._setupTriggerEventsIfEnabled()}},{key:"trigger",get:function(){return this._trigger||this._elementRef.nativeElement},set:function(e){this._trigger=e,this._setupTriggerEventsIfEnabled()}},{key:"rippleConfig",get:function(){return{centered:this.centered,radius:this.radius,color:this.color,animation:Object.assign(Object.assign(Object.assign({},this._globalOptions.animation),"NoopAnimations"===this._animationMode?{enterDuration:0,exitDuration:0}:{}),this.animation),terminateOnPointerUp:this._globalOptions.terminateOnPointerUp}}},{key:"rippleDisabled",get:function(){return this.disabled||!!this._globalOptions.disabled}}]),e}()).\u0275fac=function(e){return new(e||sN)(Mo(Ea),Mo(Js),Mo(gT),Mo(wN,8),Mo(JD,8))},sN.\u0275dir=xt({type:sN,selectors:[["","mat-ripple",""],["","matRipple",""]],hostAttrs:[1,"mat-ripple"],hostVars:2,hostBindings:function(e,t){2&e&&Jo("mat-ripple-unbounded",t.unbounded)},inputs:{radius:["matRippleRadius","radius"],disabled:["matRippleDisabled","disabled"],trigger:["matRippleTrigger","trigger"],color:["matRippleColor","color"],unbounded:["matRippleUnbounded","unbounded"],centered:["matRippleCentered","centered"],animation:["matRippleAnimation","animation"]},exportAs:["matRipple"]}),sN),kN=((aN=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:aN}),aN.\u0275inj=ve({factory:function(e){return new(e||aN)},imports:[[iN,yT],iN]}),aN),CN=new je("NgValueAccessor"),EN=((uN=function(){function e(){_classCallCheck(this,e),this._listeners=[]}return _createClass(e,[{key:"notify",value:function(e,t){var n,r=_createForOfIteratorHelper(this._listeners);try{for(r.s();!(n=r.n()).done;)(0,n.value)(e,t)}catch(i){r.e(i)}finally{r.f()}}},{key:"listen",value:function(e){var t=this;return this._listeners.push(e),function(){t._listeners=t._listeners.filter((function(t){return e!==t}))}}},{key:"ngOnDestroy",value:function(){this._listeners=[]}}]),e}()).\u0275fac=function(e){return new(e||uN)},uN.\u0275prov=pe({factory:function(){return new uN},token:uN,providedIn:"root"}),uN),SN=["input"],IN=function(){return{enterDuration:150}},RN=["*"],TN=new je("mat-radio-default-options",{providedIn:"root",factory:function(){return{color:"accent"}}}),AN=0,DN={provide:CN,useExisting:Ie((function(){return ON})),multi:!0},NN=function e(t,n){_classCallCheck(this,e),this.source=t,this.value=n},ON=((cN=function(){function e(t){_classCallCheck(this,e),this._changeDetector=t,this._value=null,this._name="mat-radio-group-"+AN++,this._selected=null,this._isInitialized=!1,this._labelPosition="after",this._disabled=!1,this._required=!1,this._controlValueAccessorChangeFn=function(){},this.onTouched=function(){},this.change=new ps}return _createClass(e,[{key:"_checkSelectedRadioButton",value:function(){this._selected&&!this._selected.checked&&(this._selected.checked=!0)}},{key:"ngAfterContentInit",value:function(){this._isInitialized=!0}},{key:"_touch",value:function(){this.onTouched&&this.onTouched()}},{key:"_updateRadioButtonNames",value:function(){var e=this;this._radios&&this._radios.forEach((function(t){t.name=e.name,t._markForCheck()}))}},{key:"_updateSelectedRadioFromValue",value:function(){var e=this;this._radios&&(null===this._selected||this._selected.value!==this._value)&&(this._selected=null,this._radios.forEach((function(t){t.checked=e.value===t.value,t.checked&&(e._selected=t)})))}},{key:"_emitChangeEvent",value:function(){this._isInitialized&&this.change.emit(new NN(this._selected,this._value))}},{key:"_markRadiosForCheck",value:function(){this._radios&&this._radios.forEach((function(e){return e._markForCheck()}))}},{key:"writeValue",value:function(e){this.value=e,this._changeDetector.markForCheck()}},{key:"registerOnChange",value:function(e){this._controlValueAccessorChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){this.disabled=e,this._changeDetector.markForCheck()}},{key:"name",get:function(){return this._name},set:function(e){this._name=e,this._updateRadioButtonNames()}},{key:"labelPosition",get:function(){return this._labelPosition},set:function(e){this._labelPosition="before"===e?"before":"after",this._markRadiosForCheck()}},{key:"value",get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,this._updateSelectedRadioFromValue(),this._checkSelectedRadioButton())}},{key:"selected",get:function(){return this._selected},set:function(e){this._selected=e,this.value=e?e.value:null,this._checkSelectedRadioButton()}},{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=lT(e),this._markRadiosForCheck()}},{key:"required",get:function(){return this._required},set:function(e){this._required=lT(e),this._markRadiosForCheck()}}]),e}()).\u0275fac=function(e){return new(e||cN)(Mo(ro))},cN.\u0275dir=xt({type:cN,selectors:[["mat-radio-group"]],contentQueries:function(e,t,n){var r,i,o;1&e&&(i=n,o=MN,function(e,t,n,r,i,o,a,s){e.firstCreatePass&&(Ts(e,new bs(n,!0,!1,void 0),a.index),function(e,t){var n=e.contentQueries||(e.contentQueries=[]);t!==(e.contentQueries.length?n[n.length-1]:-1)&&n.push(e.queries.length-1,t)}(e,s)),Rs(e,t)}(Yt(),Qt(),o,0,0,0,Zt(),i)),2&e&&Es(r=Is())&&(t._radios=r)},hostAttrs:["role","radiogroup",1,"mat-radio-group"],inputs:{name:"name",labelPosition:"labelPosition",value:"value",selected:"selected",disabled:"disabled",required:"required",color:"color"},outputs:{change:"change"},exportAs:["matRadioGroup"],features:[wa([DN])]}),cN),FN=function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i)))._disableRipple=!1,e}return _createClass(n,[{key:"disableRipple",get:function(){return this._disableRipple},set:function(e){this._disableRipple=lT(e)}}]),n}(oN((function e(t){_classCallCheck(this,e),this._elementRef=t}))),PN=((hN=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a,s,u){var c;return _classCallCheck(this,n),(c=t.call(this,r))._changeDetector=i,c._focusMonitor=o,c._radioDispatcher=a,c._animationMode=s,c._providerOverride=u,c._uniqueId="mat-radio-"+ ++AN,c.id=c._uniqueId,c.change=new ps,c._checked=!1,c._value=null,c._removeUniqueSelectionListener=function(){},c.radioGroup=e,c._removeUniqueSelectionListener=a.listen((function(e,t){e!==c.id&&t===c.name&&(c.checked=!1)})),c}return _createClass(n,[{key:"focus",value:function(e){this._focusMonitor.focusVia(this._inputElement,"keyboard",e)}},{key:"_markForCheck",value:function(){this._changeDetector.markForCheck()}},{key:"ngOnInit",value:function(){this.radioGroup&&(this.checked=this.radioGroup.value===this._value,this.name=this.radioGroup.name)}},{key:"ngAfterViewInit",value:function(){var e=this;this._focusMonitor.monitor(this._elementRef,!0).subscribe((function(t){!t&&e.radioGroup&&e.radioGroup._touch()}))}},{key:"ngOnDestroy",value:function(){this._focusMonitor.stopMonitoring(this._elementRef),this._removeUniqueSelectionListener()}},{key:"_emitChangeEvent",value:function(){this.change.emit(new NN(this,this._value))}},{key:"_isRippleDisabled",value:function(){return this.disableRipple||this.disabled}},{key:"_onInputClick",value:function(e){e.stopPropagation()}},{key:"_onInputChange",value:function(e){e.stopPropagation();var t=this.radioGroup&&this.value!==this.radioGroup.value;this.checked=!0,this._emitChangeEvent(),this.radioGroup&&(this.radioGroup._controlValueAccessorChangeFn(this.value),t&&this.radioGroup._emitChangeEvent())}},{key:"_setDisabled",value:function(e){this._disabled!==e&&(this._disabled=e,this._changeDetector.markForCheck())}},{key:"checked",get:function(){return this._checked},set:function(e){var t=lT(e);this._checked!==t&&(this._checked=t,t&&this.radioGroup&&this.radioGroup.value!==this.value?this.radioGroup.selected=this:!t&&this.radioGroup&&this.radioGroup.value===this.value&&(this.radioGroup.selected=null),t&&this._radioDispatcher.notify(this.id,this.name),this._changeDetector.markForCheck())}},{key:"value",get:function(){return this._value},set:function(e){this._value!==e&&(this._value=e,null!==this.radioGroup&&(this.checked||(this.checked=this.radioGroup.value===e),this.checked&&(this.radioGroup.selected=this)))}},{key:"labelPosition",get:function(){return this._labelPosition||this.radioGroup&&this.radioGroup.labelPosition||"after"},set:function(e){this._labelPosition=e}},{key:"disabled",get:function(){return this._disabled||null!==this.radioGroup&&this.radioGroup.disabled},set:function(e){this._setDisabled(lT(e))}},{key:"required",get:function(){return this._required||this.radioGroup&&this.radioGroup.required},set:function(e){this._required=lT(e)}},{key:"color",get:function(){return this._color||this.radioGroup&&this.radioGroup.color||this._providerOverride&&this._providerOverride.color||"accent"},set:function(e){this._color=e}},{key:"inputId",get:function(){return(this.id||this._uniqueId)+"-input"}}]),n}(FN)).\u0275fac=function(e){return new(e||hN)(Mo(ON,8),Mo(Ea),Mo(ro),Mo(CT),Mo(EN),Mo(JD,8),Mo(TN,8))},hN.\u0275dir=xt({type:hN,viewQuery:function(e,t){var n;1&e&&Ss(SN,!0),2&e&&Es(n=Is())&&(t._inputElement=n.first)},inputs:{id:"id",checked:"checked",value:"value",labelPosition:"labelPosition",disabled:"disabled",required:"required",color:"color",name:"name",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"]},outputs:{change:"change"},features:[ca]}),hN),MN=((lN=function(e){_inherits(n,e);var t=_createSuper(n);function n(){return _classCallCheck(this,n),t.apply(this,arguments)}return n}(PN)).\u0275fac=function(e){return LN(e||lN)},lN.\u0275cmp=mt({type:lN,selectors:[["mat-radio-button"]],hostAttrs:[1,"mat-radio-button"],hostVars:17,hostBindings:function(e,t){1&e&&qo("focus",(function(){return t._inputElement.nativeElement.focus()})),2&e&&(No("tabindex",-1)("id",t.id)("aria-label",null)("aria-labelledby",null)("aria-describedby",null),Jo("mat-radio-checked",t.checked)("mat-radio-disabled",t.disabled)("_mat-animation-noopable","NoopAnimations"===t._animationMode)("mat-primary","primary"===t.color)("mat-accent","accent"===t.color)("mat-warn","warn"===t.color))},inputs:{disableRipple:"disableRipple",tabIndex:"tabIndex"},exportAs:["matRadioButton"],features:[ca],ngContentSelectors:RN,decls:13,vars:19,consts:[[1,"mat-radio-label"],["label",""],[1,"mat-radio-container"],[1,"mat-radio-outer-circle"],[1,"mat-radio-inner-circle"],["type","radio",1,"mat-radio-input","cdk-visually-hidden",3,"id","checked","disabled","tabIndex","required","change","click"],["input",""],["mat-ripple","",1,"mat-radio-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleCentered","matRippleRadius","matRippleAnimation"],[1,"mat-ripple-element","mat-radio-persistent-ripple"],[1,"mat-radio-label-content"],[2,"display","none"]],template:function(e,t){if(1&e&&(function(e){var t=Qt()[16][6];if(!t.projection)for(var n=t.projection=ut(1,null),r=n.slice(),i=t.child;null!==i;)r[0]?r[0].projectionNext=i:n[0]=i,r[0]=i,i=i.next}(),zo(0,"label",0,1),zo(2,"div",2),jo(3,"div",3),jo(4,"div",4),zo(5,"input",5,6),qo("change",(function(e){return t._onInputChange(e)}))("click",(function(e){return t._onInputClick(e)})),Vo(),zo(7,"div",7),jo(8,"div",8),Vo(),Vo(),zo(9,"div",9),zo(10,"span",10),ia(11,"\xa0"),Vo(),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r=Qt(),i=Yt(),o=Hr(i,r[6],e,1,null,n||null);null===o.projection&&(o.projection=t),tn(),function(e,t,n){Gi(t[11],0,t,n,Mi(e,n,t),zi(n.parent||t[6],t))}(i,r,o)}(12),Vo(),Vo()),2&e){var n=Po(1);No("for",t.inputId),Or(5),Uo("id",t.inputId)("checked",t.checked)("disabled",t.disabled)("tabIndex",t.tabIndex)("required",t.required),No("name",t.name)("value",t.value)("aria-label",t.ariaLabel)("aria-labelledby",t.ariaLabelledby)("aria-describedby",t.ariaDescribedby),Or(2),Uo("matRippleTrigger",n)("matRippleDisabled",t._isRippleDisabled())("matRippleCentered",!0)("matRippleRadius",20)("matRippleAnimation",(r=IN,i=Kt.lFrame,-1===(o=i.bindingRootIndex)&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),a=o+18,(s=Qt())[a]===Rr?function(e,t,n){return e[t]=n}(s,a,r()):function(e,t){return e[t]}(s,a))),Or(2),Jo("mat-radio-label-before","before"==t.labelPosition)}var r,i,o,a,s},directives:[xN],styles:[".mat-radio-button{display:inline-block;-webkit-tap-highlight-color:transparent;outline:0}.mat-radio-label{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:pointer;display:inline-flex;align-items:center;white-space:nowrap;vertical-align:middle;width:100%}.mat-radio-container{box-sizing:border-box;display:inline-block;position:relative;width:20px;height:20px;flex-shrink:0}.mat-radio-outer-circle{box-sizing:border-box;height:20px;left:0;position:absolute;top:0;transition:border-color ease 280ms;width:20px;border-width:2px;border-style:solid;border-radius:50%}._mat-animation-noopable .mat-radio-outer-circle{transition:none}.mat-radio-inner-circle{border-radius:50%;box-sizing:border-box;height:20px;left:0;position:absolute;top:0;transition:transform ease 280ms,background-color ease 280ms;width:20px;transform:scale(0.001)}._mat-animation-noopable .mat-radio-inner-circle{transition:none}.mat-radio-checked .mat-radio-inner-circle{transform:scale(0.5)}.cdk-high-contrast-active .mat-radio-checked .mat-radio-inner-circle{border:solid 10px}.mat-radio-label-content{-webkit-user-select:auto;-moz-user-select:auto;-ms-user-select:auto;user-select:auto;display:inline-block;order:0;line-height:inherit;padding-left:8px;padding-right:0}[dir=rtl] .mat-radio-label-content{padding-right:8px;padding-left:0}.mat-radio-label-content.mat-radio-label-before{order:-1;padding-left:0;padding-right:8px}[dir=rtl] .mat-radio-label-content.mat-radio-label-before{padding-right:0;padding-left:8px}.mat-radio-disabled,.mat-radio-disabled .mat-radio-label{cursor:default}.mat-radio-button .mat-radio-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.mat-radio-button .mat-radio-ripple .mat-ripple-element:not(.mat-radio-persistent-ripple){opacity:.16}.mat-radio-persistent-ripple{width:100%;height:100%;transform:none}.mat-radio-container:hover .mat-radio-persistent-ripple{opacity:.04}.mat-radio-button:not(.mat-radio-disabled).cdk-keyboard-focused .mat-radio-persistent-ripple,.mat-radio-button:not(.mat-radio-disabled).cdk-program-focused .mat-radio-persistent-ripple{opacity:.12}.mat-radio-persistent-ripple,.mat-radio-disabled .mat-radio-container:hover .mat-radio-persistent-ripple{opacity:0}@media(hover: none){.mat-radio-container:hover .mat-radio-persistent-ripple{display:none}}.mat-radio-input{bottom:0;left:50%}.cdk-high-contrast-active .mat-radio-disabled{opacity:.5}\n"],encapsulation:2,changeDetection:0}),lN),LN=(fN=MN,oe((function(){var e=Object.getPrototypeOf(fN.prototype).constructor,t=e[ze]||function e(t){var n=t;if(Te(t))return function(){var t=e(Re(n));return t?t():null};var r=Ct(n);if(null===r){var i=ye(n);r=i&&i.factory}return r||null}(e);return null!==t?t:function(e){return new e}}))),BN=((dN=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:dN}),dN.\u0275inj=ve({factory:function(e){return new(e||dN)},imports:[[kN,iN],iN]}),dN),UN=["sliderWrapper"],WN=bT({passive:!1}),zN={provide:CN,useExisting:Ie((function(){return HN})),multi:!0},VN=function e(){_classCallCheck(this,e)},jN=oN(function(e,t){return function(e){_inherits(r,e);var n=_createSuper(r);function r(){var e;_classCallCheck(this,r);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=n.call.apply(n,[this].concat(o))).color=t,e}return _createClass(r,[{key:"color",get:function(){return this._color},set:function(e){var n=e||t;n!==this._color&&(this._color&&this._elementRef.nativeElement.classList.remove("mat-"+this._color),n&&this._elementRef.nativeElement.classList.add("mat-"+n),this._color=n)}}]),r}(e)}(function(e){return function(e){_inherits(n,e);var t=_createSuper(n);function n(){var e;_classCallCheck(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=t.call.apply(t,[this].concat(i)))._disabled=!1,e}return _createClass(n,[{key:"disabled",get:function(){return this._disabled},set:function(e){this._disabled=lT(e)}}]),n}(e)}((function e(t){_classCallCheck(this,e),this._elementRef=t})),"accent")),HN=((pN=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i,o,a,s,u,c){var l;return _classCallCheck(this,n),(l=t.call(this,e))._focusMonitor=r,l._changeDetectorRef=i,l._dir=o,l._animationMode=s,l._ngZone=u,l._invert=!1,l._max=100,l._min=0,l._step=1,l._thumbLabel=!1,l._tickInterval=0,l._value=null,l._vertical=!1,l.change=new ps,l.input=new ps,l.valueChange=new ps,l.onTouched=function(){},l._percent=0,l._isSliding=!1,l._isActive=!1,l._tickIntervalPercent=0,l._sliderDimensions=null,l._controlValueAccessorChangeFn=function(){},l._dirChangeSubscription=f.EMPTY,l._pointerDown=function(e){l.disabled||l._isSliding||!qN(e)&&0!==e.button||l._runInsideZone((function(){var t=l.value,n=GN(e);l._isSliding=!0,l._lastPointerEvent=e,e.preventDefault(),l._focusHostElement(),l._onMouseenter(),l._bindGlobalEvents(e),l._focusHostElement(),l._updateValueFromPosition(n),l._valueOnSlideStart=l.value,l._pointerPositionOnStart=n,t!=l.value&&(l._emitInputEvent(),l._emitChangeEvent())}))},l._pointerMove=function(e){if(l._isSliding){e.preventDefault();var t=l.value;l._lastPointerEvent=e,l._updateValueFromPosition(GN(e)),t!=l.value&&l._emitInputEvent()}},l._pointerUp=function(e){if(l._isSliding){var t=l._pointerPositionOnStart,n=GN(e);e.preventDefault(),l._removeGlobalEvents(),l._valueOnSlideStart=l._pointerPositionOnStart=l._lastPointerEvent=null,l._isSliding=!1,l._valueOnSlideStart==l.value||l.disabled||!t||t.x===n.x&&t.y===n.y||l._emitChangeEvent()}},l._windowBlur=function(){l._lastPointerEvent&&l._pointerUp(l._lastPointerEvent)},l._document=c,l.tabIndex=parseInt(a)||0,l._runOutsizeZone((function(){var t=e.nativeElement;t.addEventListener("mousedown",l._pointerDown,WN),t.addEventListener("touchstart",l._pointerDown,WN)})),l}return _createClass(n,[{key:"focus",value:function(e){this._focusHostElement(e)}},{key:"blur",value:function(){this._blurHostElement()}},{key:"_shouldInvertMouseCoords",value:function(){return"rtl"!=this._getDirection()||this.vertical?this._invertAxis:!this._invertAxis}},{key:"_getDirection",value:function(){return this._dir&&"rtl"==this._dir.value?"rtl":"ltr"}},{key:"ngOnInit",value:function(){var e=this;this._focusMonitor.monitor(this._elementRef,!0).subscribe((function(t){e._isActive=!!t&&"keyboard"!==t,e._changeDetectorRef.detectChanges()})),this._dir&&(this._dirChangeSubscription=this._dir.change.subscribe((function(){e._changeDetectorRef.markForCheck()})))}},{key:"ngOnDestroy",value:function(){var e=this._elementRef.nativeElement;e.removeEventListener("mousedown",this._pointerDown,WN),e.removeEventListener("touchstart",this._pointerDown,WN),this._lastPointerEvent=null,this._removeGlobalEvents(),this._focusMonitor.stopMonitoring(this._elementRef),this._dirChangeSubscription.unsubscribe()}},{key:"_onMouseenter",value:function(){this.disabled||(this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent())}},{key:"_onFocus",value:function(){this._sliderDimensions=this._getSliderDimensions(),this._updateTickIntervalPercent()}},{key:"_onBlur",value:function(){this.onTouched()}},{key:"_onKeydown",value:function(e){if(!this.disabled&&!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.length?n.some((function(t){return e[t]})):e.altKey||e.shiftKey||e.ctrlKey||e.metaKey}(e)){var t=this.value;switch(e.keyCode){case 33:this._increment(10);break;case 34:this._increment(-10);break;case 35:this.value=this.max;break;case 36:this.value=this.min;break;case 37:this._increment("rtl"==this._getDirection()?1:-1);break;case 38:this._increment(1);break;case 39:this._increment("rtl"==this._getDirection()?-1:1);break;case 40:this._increment(-1);break;default:return}t!=this.value&&(this._emitInputEvent(),this._emitChangeEvent()),this._isSliding=!0,e.preventDefault()}}},{key:"_onKeyup",value:function(){this._isSliding=!1}},{key:"_getWindow",value:function(){var e;return(null===(e=this._document)||void 0===e?void 0:e.defaultView)||window}},{key:"_bindGlobalEvents",value:function(e){var t=this._document;if(void 0!==t&&t){var n=qN(e),r=n?"touchend":"mouseup";t.addEventListener(n?"touchmove":"mousemove",this._pointerMove,WN),t.addEventListener(r,this._pointerUp,WN),n&&t.addEventListener("touchcancel",this._pointerUp,WN)}var i=this._getWindow();void 0!==i&&i&&i.addEventListener("blur",this._windowBlur)}},{key:"_removeGlobalEvents",value:function(){var e=this._document;void 0!==e&&e&&(e.removeEventListener("mousemove",this._pointerMove,WN),e.removeEventListener("mouseup",this._pointerUp,WN),e.removeEventListener("touchmove",this._pointerMove,WN),e.removeEventListener("touchend",this._pointerUp,WN),e.removeEventListener("touchcancel",this._pointerUp,WN));var t=this._getWindow();void 0!==t&&t&&t.removeEventListener("blur",this._windowBlur)}},{key:"_increment",value:function(e){this.value=this._clamp((this.value||0)+this.step*e,this.min,this.max)}},{key:"_updateValueFromPosition",value:function(e){if(this._sliderDimensions){var t=this._clamp(((this.vertical?e.y:e.x)-(this.vertical?this._sliderDimensions.top:this._sliderDimensions.left))/(this.vertical?this._sliderDimensions.height:this._sliderDimensions.width));if(this._shouldInvertMouseCoords()&&(t=1-t),0===t)this.value=this.min;else if(1===t)this.value=this.max;else{var n=this._calculateValue(t),r=Math.round((n-this.min)/this.step)*this.step+this.min;this.value=this._clamp(r,this.min,this.max)}}}},{key:"_emitChangeEvent",value:function(){this._controlValueAccessorChangeFn(this.value),this.valueChange.emit(this.value),this.change.emit(this._createChangeEvent())}},{key:"_emitInputEvent",value:function(){this.input.emit(this._createChangeEvent())}},{key:"_updateTickIntervalPercent",value:function(){if(this.tickInterval&&this._sliderDimensions)if("auto"==this.tickInterval){var e=this.vertical?this._sliderDimensions.height:this._sliderDimensions.width,t=Math.ceil(30/(e*this.step/(this.max-this.min)));this._tickIntervalPercent=t*this.step/e}else this._tickIntervalPercent=this.tickInterval*this.step/(this.max-this.min)}},{key:"_createChangeEvent",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.value,t=new VN;return t.source=this,t.value=e,t}},{key:"_calculatePercentage",value:function(e){return((e||0)-this.min)/(this.max-this.min)}},{key:"_calculateValue",value:function(e){return this.min+e*(this.max-this.min)}},{key:"_clamp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.max(t,Math.min(e,n))}},{key:"_getSliderDimensions",value:function(){return this._sliderWrapper?this._sliderWrapper.nativeElement.getBoundingClientRect():null}},{key:"_focusHostElement",value:function(e){this._elementRef.nativeElement.focus(e)}},{key:"_blurHostElement",value:function(){this._elementRef.nativeElement.blur()}},{key:"_runInsideZone",value:function(e){this._ngZone?this._ngZone.run(e):e()}},{key:"_runOutsizeZone",value:function(e){this._ngZone?this._ngZone.runOutsideAngular(e):e()}},{key:"writeValue",value:function(e){this.value=e}},{key:"registerOnChange",value:function(e){this._controlValueAccessorChangeFn=e}},{key:"registerOnTouched",value:function(e){this.onTouched=e}},{key:"setDisabledState",value:function(e){this.disabled=e}},{key:"invert",get:function(){return this._invert},set:function(e){this._invert=lT(e)}},{key:"max",get:function(){return this._max},set:function(e){this._max=hT(e,this._max),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}},{key:"min",get:function(){return this._min},set:function(e){this._min=hT(e,this._min),null===this._value&&(this.value=this._min),this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}},{key:"step",get:function(){return this._step},set:function(e){this._step=hT(e,this._step),this._step%1!=0&&(this._roundToDecimal=this._step.toString().split(".").pop().length),this._changeDetectorRef.markForCheck()}},{key:"thumbLabel",get:function(){return this._thumbLabel},set:function(e){this._thumbLabel=lT(e)}},{key:"tickInterval",get:function(){return this._tickInterval},set:function(e){this._tickInterval="auto"===e?"auto":"number"==typeof e||"string"==typeof e?hT(e,this._tickInterval):0}},{key:"value",get:function(){return null===this._value&&(this.value=this._min),this._value},set:function(e){if(e!==this._value){var t=hT(e);this._roundToDecimal&&(t=parseFloat(t.toFixed(this._roundToDecimal))),this._value=t,this._percent=this._calculatePercentage(this._value),this._changeDetectorRef.markForCheck()}}},{key:"vertical",get:function(){return this._vertical},set:function(e){this._vertical=lT(e)}},{key:"displayValue",get:function(){return this.displayWith?this.displayWith(this.value):this._roundToDecimal&&this.value&&this.value%1!=0?this.value.toFixed(this._roundToDecimal):this.value||0}},{key:"percent",get:function(){return this._clamp(this._percent)}},{key:"_invertAxis",get:function(){return this.vertical?!this.invert:this.invert}},{key:"_isMinValue",get:function(){return 0===this.percent}},{key:"_thumbGap",get:function(){return this.disabled?7:this._isMinValue&&!this.thumbLabel?this._isActive?10:7:0}},{key:"_trackBackgroundStyles",get:function(){var e=this.vertical?"1, ".concat(1-this.percent,", 1"):1-this.percent+", 1, 1";return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this._shouldInvertMouseCoords()?"-":"").concat(this._thumbGap,"px) scale3d(").concat(e,")")}}},{key:"_trackFillStyles",get:function(){var e=this.percent,t=this.vertical?"1, ".concat(e,", 1"):e+", 1, 1";return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this._shouldInvertMouseCoords()?"":"-").concat(this._thumbGap,"px) scale3d(").concat(t,")"),display:0===e?"none":""}}},{key:"_ticksContainerStyles",get:function(){return{transform:"translate".concat(this.vertical?"Y":"X","(").concat(this.vertical||"rtl"!=this._getDirection()?"-":"").concat(this._tickIntervalPercent/2*100,"%)")}}},{key:"_ticksStyles",get:function(){var e=100*this._tickIntervalPercent,t={backgroundSize:this.vertical?"2px ".concat(e,"%"):e+"% 2px",transform:"translateZ(0) translate".concat(this.vertical?"Y":"X","(").concat(this.vertical||"rtl"!=this._getDirection()?"":"-").concat(e/2,"%)").concat(this.vertical||"rtl"!=this._getDirection()?"":" rotate(180deg)")};return this._isMinValue&&this._thumbGap&&(t["padding"+(this.vertical?this._invertAxis?"Bottom":"Top":this._invertAxis?"Right":"Left")]=this._thumbGap+"px"),t}},{key:"_thumbContainerStyles",get:function(){return{transform:"translate".concat(this.vertical?"Y":"X","(-").concat(100*(("rtl"!=this._getDirection()||this.vertical?this._invertAxis:!this._invertAxis)?this.percent:1-this.percent),"%)")}}}]),n}(jN)).\u0275fac=function(e){return new(e||pN)(Mo(Ea),Mo(CT),Mo(ro),Mo(DT,8),Lo("tabindex"),Mo(JD,8),Mo(Js),Mo(Nu,8))},pN.\u0275cmp=mt({type:pN,selectors:[["mat-slider"]],viewQuery:function(e,t){var n;1&e&&Ss(UN,!0),2&e&&Es(n=Is())&&(t._sliderWrapper=n.first)},hostAttrs:["role","slider",1,"mat-slider","mat-focus-indicator"],hostVars:28,hostBindings:function(e,t){1&e&&qo("focus",(function(){return t._onFocus()}))("blur",(function(){return t._onBlur()}))("keydown",(function(e){return t._onKeydown(e)}))("keyup",(function(){return t._onKeyup()}))("mouseenter",(function(){return t._onMouseenter()}))("selectstart",(function(e){return e.preventDefault()})),2&e&&(sa("tabIndex",t.tabIndex),No("aria-disabled",t.disabled)("aria-valuemax",t.max)("aria-valuemin",t.min)("aria-valuenow",t.value)("aria-orientation",t.vertical?"vertical":"horizontal"),Jo("mat-slider-disabled",t.disabled)("mat-slider-has-ticks",t.tickInterval)("mat-slider-horizontal",!t.vertical)("mat-slider-axis-inverted",t._invertAxis)("mat-slider-invert-mouse-coords",t._shouldInvertMouseCoords())("mat-slider-sliding",t._isSliding)("mat-slider-thumb-label-showing",t.thumbLabel)("mat-slider-vertical",t.vertical)("mat-slider-min-value",t._isMinValue)("mat-slider-hide-last-tick",t.disabled||t._isMinValue&&t._thumbGap&&t._invertAxis)("_mat-animation-noopable","NoopAnimations"===t._animationMode))},inputs:{disabled:"disabled",color:"color",tabIndex:"tabIndex",invert:"invert",max:"max",min:"min",value:"value",step:"step",thumbLabel:"thumbLabel",tickInterval:"tickInterval",vertical:"vertical",displayWith:"displayWith"},outputs:{change:"change",input:"input",valueChange:"valueChange"},exportAs:["matSlider"],features:[wa([zN]),ca],decls:13,vars:6,consts:[[1,"mat-slider-wrapper"],["sliderWrapper",""],[1,"mat-slider-track-wrapper"],[1,"mat-slider-track-background",3,"ngStyle"],[1,"mat-slider-track-fill",3,"ngStyle"],[1,"mat-slider-ticks-container",3,"ngStyle"],[1,"mat-slider-ticks",3,"ngStyle"],[1,"mat-slider-thumb-container",3,"ngStyle"],[1,"mat-slider-focus-ring"],[1,"mat-slider-thumb"],[1,"mat-slider-thumb-label"],[1,"mat-slider-thumb-label-text"]],template:function(e,t){1&e&&(zo(0,"div",0,1),zo(2,"div",2),jo(3,"div",3),jo(4,"div",4),Vo(),zo(5,"div",5),jo(6,"div",6),Vo(),zo(7,"div",7),jo(8,"div",8),jo(9,"div",9),zo(10,"div",10),zo(11,"span",11),ia(12),Vo(),Vo(),Vo(),Vo()),2&e&&(Or(3),Uo("ngStyle",t._trackBackgroundStyles),Or(1),Uo("ngStyle",t._trackFillStyles),Or(1),Uo("ngStyle",t._ticksContainerStyles),Or(1),Uo("ngStyle",t._ticksStyles),Or(1),Uo("ngStyle",t._thumbContainerStyles),Or(5),oa(t.displayValue))},directives:[vc],styles:['.mat-slider{display:inline-block;position:relative;box-sizing:border-box;padding:8px;outline:none;vertical-align:middle}.mat-slider:not(.mat-slider-disabled):active,.mat-slider.mat-slider-sliding:not(.mat-slider-disabled){cursor:-webkit-grabbing;cursor:grabbing}.mat-slider-wrapper{position:absolute}.mat-slider-track-wrapper{position:absolute;top:0;left:0;overflow:hidden}.mat-slider-track-fill{position:absolute;transform-origin:0 0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-track-background{position:absolute;transform-origin:100% 100%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-ticks-container{position:absolute;left:0;top:0;overflow:hidden}.mat-slider-ticks{background-repeat:repeat;background-clip:content-box;box-sizing:border-box;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-container{position:absolute;z-index:1;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-focus-ring{position:absolute;width:30px;height:30px;border-radius:50%;transform:scale(0);opacity:0;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider.cdk-keyboard-focused .mat-slider-focus-ring,.mat-slider.cdk-program-focused .mat-slider-focus-ring{transform:scale(1);opacity:1}.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb-label,.mat-slider:not(.mat-slider-disabled):not(.mat-slider-sliding) .mat-slider-thumb{cursor:-webkit-grab;cursor:grab}.mat-slider-thumb{position:absolute;right:-10px;bottom:-10px;box-sizing:border-box;width:20px;height:20px;border:3px solid transparent;border-radius:50%;transform:scale(0.7);transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-thumb-label{display:none;align-items:center;justify-content:center;position:absolute;width:28px;height:28px;border-radius:50%;transition:transform 400ms cubic-bezier(0.25, 0.8, 0.25, 1),border-radius 400ms cubic-bezier(0.25, 0.8, 0.25, 1),background-color 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.cdk-high-contrast-active .mat-slider-thumb-label{outline:solid 1px}.mat-slider-thumb-label-text{z-index:1;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-sliding .mat-slider-track-fill,.mat-slider-sliding .mat-slider-track-background,.mat-slider-sliding .mat-slider-thumb-container{transition-duration:0ms}.mat-slider-has-ticks .mat-slider-wrapper::after{content:"";position:absolute;border-width:0;border-style:solid;opacity:0;transition:opacity 400ms cubic-bezier(0.25, 0.8, 0.25, 1)}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after,.mat-slider-has-ticks:hover:not(.mat-slider-hide-last-tick) .mat-slider-wrapper::after{opacity:1}.mat-slider-has-ticks.cdk-focused:not(.mat-slider-disabled) .mat-slider-ticks,.mat-slider-has-ticks:hover:not(.mat-slider-disabled) .mat-slider-ticks{opacity:1}.mat-slider-thumb-label-showing .mat-slider-focus-ring{display:none}.mat-slider-thumb-label-showing .mat-slider-thumb-label{display:flex}.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:100% 100%}.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:0 0}.mat-slider:not(.mat-slider-disabled).cdk-focused.mat-slider-thumb-label-showing .mat-slider-thumb{transform:scale(0)}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label{border-radius:50% 50% 0}.mat-slider:not(.mat-slider-disabled).cdk-focused .mat-slider-thumb-label-text{opacity:1}.mat-slider:not(.mat-slider-disabled).cdk-mouse-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-touch-focused .mat-slider-thumb,.mat-slider:not(.mat-slider-disabled).cdk-program-focused .mat-slider-thumb{border-width:2px;transform:scale(1)}.mat-slider-disabled .mat-slider-focus-ring{transform:scale(0);opacity:0}.mat-slider-disabled .mat-slider-thumb{border-width:4px;transform:scale(0.5)}.mat-slider-disabled .mat-slider-thumb-label{display:none}.mat-slider-horizontal{height:48px;min-width:128px}.mat-slider-horizontal .mat-slider-wrapper{height:2px;top:23px;left:8px;right:8px}.mat-slider-horizontal .mat-slider-wrapper::after{height:2px;border-left-width:2px;right:0;top:0}.mat-slider-horizontal .mat-slider-track-wrapper{height:2px;width:100%}.mat-slider-horizontal .mat-slider-track-fill{height:2px;width:100%;transform:scaleX(0)}.mat-slider-horizontal .mat-slider-track-background{height:2px;width:100%;transform:scaleX(1)}.mat-slider-horizontal .mat-slider-ticks-container{height:2px;width:100%}.cdk-high-contrast-active .mat-slider-horizontal .mat-slider-ticks-container{height:0;outline:solid 2px;top:1px}.mat-slider-horizontal .mat-slider-ticks{height:2px;width:100%}.mat-slider-horizontal .mat-slider-thumb-container{width:100%;height:0;top:50%}.mat-slider-horizontal .mat-slider-focus-ring{top:-15px;right:-15px}.mat-slider-horizontal .mat-slider-thumb-label{right:-14px;top:-40px;transform:translateY(26px) scale(0.01) rotate(45deg)}.mat-slider-horizontal .mat-slider-thumb-label-text{transform:rotate(-45deg)}.mat-slider-horizontal.cdk-focused .mat-slider-thumb-label{transform:rotate(45deg)}.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label,.cdk-high-contrast-active .mat-slider-horizontal.cdk-focused .mat-slider-thumb-label-text{transform:none}.mat-slider-vertical{width:48px;min-height:128px}.mat-slider-vertical .mat-slider-wrapper{width:2px;top:8px;bottom:8px;left:23px}.mat-slider-vertical .mat-slider-wrapper::after{width:2px;border-top-width:2px;bottom:0;left:0}.mat-slider-vertical .mat-slider-track-wrapper{height:100%;width:2px}.mat-slider-vertical .mat-slider-track-fill{height:100%;width:2px;transform:scaleY(0)}.mat-slider-vertical .mat-slider-track-background{height:100%;width:2px;transform:scaleY(1)}.mat-slider-vertical .mat-slider-ticks-container{width:2px;height:100%}.cdk-high-contrast-active .mat-slider-vertical .mat-slider-ticks-container{width:0;outline:solid 2px;left:1px}.mat-slider-vertical .mat-slider-focus-ring{bottom:-15px;left:-15px}.mat-slider-vertical .mat-slider-ticks{width:2px;height:100%}.mat-slider-vertical .mat-slider-thumb-container{height:100%;width:0;left:50%}.mat-slider-vertical .mat-slider-thumb{-webkit-backface-visibility:hidden;backface-visibility:hidden}.mat-slider-vertical .mat-slider-thumb-label{bottom:-14px;left:-40px;transform:translateX(26px) scale(0.01) rotate(-45deg)}.mat-slider-vertical .mat-slider-thumb-label-text{transform:rotate(45deg)}.mat-slider-vertical.cdk-focused .mat-slider-thumb-label{transform:rotate(-45deg)}[dir=rtl] .mat-slider-wrapper::after{left:0;right:auto}[dir=rtl] .mat-slider-horizontal .mat-slider-track-fill{transform-origin:100% 100%}[dir=rtl] .mat-slider-horizontal .mat-slider-track-background{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-fill{transform-origin:0 0}[dir=rtl] .mat-slider-horizontal.mat-slider-axis-inverted .mat-slider-track-background{transform-origin:100% 100%}.mat-slider._mat-animation-noopable .mat-slider-track-fill,.mat-slider._mat-animation-noopable .mat-slider-track-background,.mat-slider._mat-animation-noopable .mat-slider-ticks,.mat-slider._mat-animation-noopable .mat-slider-thumb-container,.mat-slider._mat-animation-noopable .mat-slider-focus-ring,.mat-slider._mat-animation-noopable .mat-slider-thumb,.mat-slider._mat-animation-noopable .mat-slider-thumb-label,.mat-slider._mat-animation-noopable .mat-slider-thumb-label-text,.mat-slider._mat-animation-noopable .mat-slider-has-ticks .mat-slider-wrapper::after{transition:none}\n'],encapsulation:2,changeDetection:0}),pN);function qN(e){return"t"===e.type[0]}function GN(e){var t=qN(e)?e.touches[0]||e.changedTouches[0]:e;return{x:t.clientX,y:t.clientY}}var KN,XN=((KN=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:KN}),KN.\u0275inj=ve({factory:function(e){return new(e||KN)},imports:[[mc,iN],iN]}),KN);function QN(e,t){1&e&&(zo(0,"div"),ia(1,"loading models..."),Vo())}function YN(e,t){if(1&e&&(zo(0,"mat-radio-button",10),jo(1,"img",11),Vo()),2&e){var n=t.$implicit;Uo("value",n),Or(1),Qo("src","assets/images/",n,".png",pr)}}function $N(e,t){if(1&e){var n=Qt();zo(0,"div"),zo(1,"mat-radio-group",1,2),qo("change",(function(){$t(n);var e=Po(9),t=Po(2);return Xo().blockFaces(.01*e.value,t.value)})),Fo(3,YN,2,2,"mat-radio-button",3),Vo(),zo(4,"div"),zo(5,"label",4),ia(6,"Face Recognition Selectivity"),Vo(),jo(7,"br"),zo(8,"mat-slider",5,6),qo("change",(function(){$t(n);var e=Po(9),t=Po(2);return Xo().blockFaces(.01*e.value,t.value)})),Vo(),Vo(),zo(10,"input",7),qo("change",(function(e){$t(n);var t=Po(9),r=Po(2);return Xo().handleFileInput(e.target.files,.01*t.value,r.value)})),Vo(),zo(11,"input",8),qo("click",(function(){return $t(n),Xo().exportAsImage()})),Vo(),jo(12,"canvas",9),Vo()}if(2&e){var r=Xo();Or(3),Uo("ngForOf",r.glows)}}var ZN,JN=((ZN=function(){function e(){_classCallCheck(this,e),this.title="laser-eyes",this.file=null,this.ready=!1,this.glows=["red","blue","pink","white","yellow","purple","green","glow"]}return _createClass(e,[{key:"ngOnInit",value:function(){return Gd(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,JR.tinyFaceDetector.loadFromUri("assets/models");case 2:return e.next=4,JR.faceLandmark68TinyNet.loadFromUri("assets/models");case 4:return e.next=6,JR.ssdMobilenetv1.loadFromUri("assets/models");case 6:this.ready=!0;case 7:case"end":return e.stop()}}),e,this)})))}},{key:"blockFaces",value:function(e,t){return Gd(this,void 0,void 0,regeneratorRuntime.mark((function n(){var r,i,o,a,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:this.file&&(this.hideDownloadButton(),r=document.getElementById("overlay"),i=r.getContext("2d"),r.width=600,r.height=40,i.fillStyle="#FFA500",i.fillText("processing...",10,10),o=document.createElement("img"),a=window.URL.createObjectURL(this.file),(s=document.createElement("img")).src="assets/images/"+t+".png",o.src=a,o.onload=function(){return Gd(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.width=o.width,r.height=o.height,t.next=3,function(e,t){return void 0===t&&(t=new CR),new aT(e,t)}(o,new CR({minConfidence:e})).withFaceLandmarks(!0);case 3:n=t.sent,i.drawImage(o,0,0),i.fillStyle="#000000",console.log(n.length),n.sort((function(e,t){return e.detection.box.area-t.detection.box.area})),n.forEach((function(e){var t=eO(e.landmarks.getLeftEye()),n=eO(e.landmarks.getRightEye()),r=e.detection.box.width;i.drawImage(s,t.x-r,t.y-r,2*r,2*r),i.drawImage(s,n.x-r,n.y-r,2*r,2*r)})),document.getElementById("download").hidden=!1,URL.revokeObjectURL(o.src);case 5:case"end":return t.stop()}}),t)})))});case 1:case"end":return n.stop()}}),n,this)})))}},{key:"handleFileInput",value:function(e,t,n){return Gd(this,void 0,void 0,regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:e&&(this.hideDownloadButton(),this.file=e.item(0),this.blockFaces(t,n));case 1:case"end":return r.stop()}}),r,this)})))}},{key:"hideDownloadButton",value:function(){document.getElementById("download").hidden=!0}},{key:"exportAsImage",value:function(){if(null!=this.file){var e=this.file.type,t="masked_"+this.file.name,n=document.getElementById("overlay").toDataURL(e);Object(Qd.saveAs)(n,t)}}}]),e}()).\u0275fac=function(e){return new(e||ZN)},ZN.\u0275cmp=mt({type:ZN,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[3,"change"],["radioGroup","matRadioGroup"],[3,"value",4,"ngFor","ngForOf"],["for","myslider",2,"font-weight","bold"],["min","5","max","50","step","5","value","50",2,"width","50%",3,"change"],["myslider",""],["type","file","accept","image/*","id","input",3,"change"],["type","button","id","download","value","download image","hidden","",3,"click"],["id","overlay",2,"width","98%","padding","1%"],[3,"value"],[3,"src"]],template:function(e,t){1&e&&(Fo(0,QN,2,0,"div",0),Fo(1,$N,13,1,"div",0)),2&e&&(Uo("ngIf",!t.ready),Or(1),Uo("ngIf",t.ready))},directives:[lc,ON,uc,HN,MN],styles:[".mat-slider-min-value:not(.mat-slider-thumb-label-showing) .mat-slider-thumb{background-color:#69f0ae}.mat-radio-button[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:50px}"]}),ZN);function eO(e){return{x:e.reduce((function(t,n){return t+n.x/e.length}),0),y:e.reduce((function(t,n){return t+n.y/e.length}),0)}}function tO(e,t){return new x(t?function(n){return t.schedule(nO,0,{error:e,subscriber:n})}:function(t){return t.error(e)})}function nO(e){var t=e.error;e.subscriber.error(t)}function rO(e,t,n,i){return r(n)&&(i=n,n=void 0),i?rO(e,t,n).pipe(U((function(e){return u(e)?i.apply(void 0,_toConsumableArray(e)):i(e)}))):new x((function(r){!function e(t,n,r,i,o){var a;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var s=t;t.addEventListener(n,r,o),a=function(){return s.removeEventListener(n,r,o)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var u=t;t.on(n,r),a=function(){return u.off(n,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var c=t;t.addListener(n,r),a=function(){return c.removeListener(n,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var l=0,h=t.length;l<h;l++)e(t[l],n,r,i,o)}i.add(a)}(e,t,(function(e){r.next(arguments.length>1?Array.prototype.slice.call(arguments):e)}),r,n)}))}var iO,oO,aO,sO=new x(Hl),uO=((iO=function(){function e(t,n,r){_classCallCheck(this,e),this.kind=t,this.value=n,this.error=r,this.hasValue="N"===t}return _createClass(e,[{key:"observe",value:function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}}},{key:"do",value:function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}}},{key:"accept",value:function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)}},{key:"toObservable",value:function(){switch(this.kind){case"N":return nl(this.value);case"E":return tO(this.error);case"C":return cl()}throw new Error("unexpected notification kind value")}}],[{key:"createNext",value:function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification}},{key:"createError",value:function(t){return new e("E",void 0,t)}},{key:"createComplete",value:function(){return e.completeNotification}}]),e}()).completeNotification=new iO("C"),iO.undefinedValueNotification=new iO("N",void 0),iO),cO=function(){function e(t,n){_classCallCheck(this,e),this.delay=t,this.scheduler=n}return _createClass(e,[{key:"call",value:function(e,t){return t.subscribe(new lO(e,this.delay,this.scheduler))}}]),e}(),lO=function(e){_inherits(n,e);var t=_createSuper(n);function n(e,r,i){var o;return _classCallCheck(this,n),(o=t.call(this,e)).delay=r,o.scheduler=i,o.queue=[],o.active=!1,o.errored=!1,o}return _createClass(n,[{key:"_schedule",value:function(e){this.active=!0,this.destination.add(e.schedule(n.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))}},{key:"scheduleNotification",value:function(e){if(!0!==this.errored){var t=this.scheduler,n=new hO(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}}},{key:"_next",value:function(e){this.scheduleNotification(uO.createNext(e))}},{key:"_error",value:function(e){this.errored=!0,this.queue=[],this.destination.error(e),this.unsubscribe()}},{key:"_complete",value:function(){this.scheduleNotification(uO.createComplete()),this.unsubscribe()}}],[{key:"dispatch",value:function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1}}]),n}(v),hO=function e(t,n){_classCallCheck(this,e),this.time=t,this.notification=n},fO="Service workers are disabled or not supported by this browser",dO=function(){function e(t){if(_classCallCheck(this,e),this.serviceWorker=t,t){var n=rO(t,"controllerchange").pipe(U((function(){return t.controller}))),r=Ul(ll((function(){return nl(t.controller)})),n);this.worker=r.pipe(fl((function(e){return!!e}))),this.registration=this.worker.pipe(Ml((function(){return t.getRegistration()})));var i=rO(t,"message").pipe(U((function(e){return e.data}))).pipe(fl((function(e){return e&&e.type}))).pipe(ne(new R));i.connect(),this.events=i}else this.worker=this.events=this.registration=ll((function(){return tO(new Error("Service workers are disabled or not supported by this browser"))}))}return _createClass(e,[{key:"postMessage",value:function(e,t){return this.worker.pipe(Al(1),ql((function(n){n.postMessage(Object.assign({action:e},t))}))).toPromise().then((function(){}))}},{key:"postMessageWithStatus",value:function(e,t,n){var r=this.waitForStatus(n),i=this.postMessage(e,t);return Promise.all([r,i]).then((function(){}))}},{key:"generateNonce",value:function(){return Math.round(1e7*Math.random())}},{key:"eventsOfType",value:function(e){return this.events.pipe(fl((function(t){return t.type===e})))}},{key:"nextEventOfType",value:function(e){return this.eventsOfType(e).pipe(Al(1))}},{key:"waitForStatus",value:function(e){return this.eventsOfType("STATUS").pipe(fl((function(t){return t.nonce===e})),Al(1),U((function(e){if(!e.status)throw new Error(e.error)}))).toPromise()}},{key:"isEnabled",get:function(){return!!this.serviceWorker}}]),e}(),pO=((aO=function(){function e(t){if(_classCallCheck(this,e),this.sw=t,this.subscriptionChanges=new R,!t.isEnabled)return this.messages=sO,this.notificationClicks=sO,void(this.subscription=sO);this.messages=this.sw.eventsOfType("PUSH").pipe(U((function(e){return e.data}))),this.notificationClicks=this.sw.eventsOfType("NOTIFICATION_CLICK").pipe(U((function(e){return e.data}))),this.pushManager=this.sw.registration.pipe(U((function(e){return e.pushManager})));var n=this.pushManager.pipe(Ml((function(e){return e.getSubscription()})));this.subscription=Q(n,this.subscriptionChanges)}return _createClass(e,[{key:"requestSubscription",value:function(e){var t=this;if(!this.sw.isEnabled)return Promise.reject(new Error(fO));for(var n={userVisibleOnly:!0},r=this.decodeBase64(e.serverPublicKey.replace(/_/g,"/").replace(/-/g,"+")),i=new Uint8Array(new ArrayBuffer(r.length)),o=0;o<r.length;o++)i[o]=r.charCodeAt(o);return n.applicationServerKey=i,this.pushManager.pipe(Ml((function(e){return e.subscribe(n)})),Al(1)).toPromise().then((function(e){return t.subscriptionChanges.next(e),e}))}},{key:"unsubscribe",value:function(){var e=this;return this.sw.isEnabled?this.subscription.pipe(Al(1),Ml((function(t){if(null===t)throw new Error("Not subscribed to push notifications.");return t.unsubscribe().then((function(t){if(!t)throw new Error("Unsubscribe failed!");e.subscriptionChanges.next(null)}))}))).toPromise():Promise.reject(new Error(fO))}},{key:"decodeBase64",value:function(e){return atob(e)}},{key:"isEnabled",get:function(){return this.sw.isEnabled}}]),e}()).\u0275fac=function(e){return new(e||aO)(Ze(dO))},aO.\u0275prov=pe({token:aO,factory:aO.\u0275fac}),aO),vO=((oO=function(){function e(t){if(_classCallCheck(this,e),this.sw=t,!t.isEnabled)return this.available=sO,void(this.activated=sO);this.available=this.sw.eventsOfType("UPDATE_AVAILABLE"),this.activated=this.sw.eventsOfType("UPDATE_ACTIVATED")}return _createClass(e,[{key:"checkForUpdate",value:function(){if(!this.sw.isEnabled)return Promise.reject(new Error(fO));var e=this.sw.generateNonce();return this.sw.postMessageWithStatus("CHECK_FOR_UPDATES",{statusNonce:e},e)}},{key:"activateUpdate",value:function(){if(!this.sw.isEnabled)return Promise.reject(new Error(fO));var e=this.sw.generateNonce();return this.sw.postMessageWithStatus("ACTIVATE_UPDATE",{statusNonce:e},e)}},{key:"isEnabled",get:function(){return this.sw.isEnabled}}]),e}()).\u0275fac=function(e){return new(e||oO)(Ze(dO))},oO.\u0275prov=pe({token:oO,factory:oO.\u0275fac}),oO),mO=function e(){_classCallCheck(this,e)},gO=new je("NGSW_REGISTER_SCRIPT");function yO(e,t,n,r){return function(){if(gc(r)&&"serviceWorker"in navigator&&!1!==n.enabled){var i;if(navigator.serviceWorker.addEventListener("controllerchange",(function(){null!==navigator.serviceWorker.controller&&navigator.serviceWorker.controller.postMessage({action:"INITIALIZE"})})),"function"==typeof n.registrationStrategy)i=n.registrationStrategy();else{var o=_toArray((n.registrationStrategy||"registerWhenStable").split(":")),a=o[0],s=o.slice(1);switch(a){case"registerImmediately":i=nl(null);break;case"registerWithDelay":i=nl(null).pipe(function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cT,r=(t=e)instanceof Date&&!isNaN(+t)?+e-n.now():Math.abs(e);return function(e){return e.lift(new cO(r,n))}}(+s[0]||0));break;case"registerWhenStable":i=e.get(bu).isStable.pipe(fl((function(e){return e})));break;default:throw new Error("Unknown ServiceWorker registration strategy: "+n.registrationStrategy)}}i.pipe(Al(1)).subscribe((function(){return navigator.serviceWorker.register(t,{scope:n.scope}).catch((function(e){return console.error("Service worker registration failed with:",e)}))}))}}}function bO(e,t){return new dO(gc(t)&&!1!==e.enabled?navigator.serviceWorker:void 0)}var _O,wO,xO=((wO=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"register",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{ngModule:e,providers:[{provide:gO,useValue:t},{provide:mO,useValue:n},{provide:dO,useFactory:bO,deps:[mO,Ls]},{provide:Ds,useFactory:yO,deps:[_o,gO,mO,Ls],multi:!0}]}}}]),e}()).\u0275mod=_t({type:wO}),wO.\u0275inj=ve({factory:function(e){return new(e||wO)},providers:[pO,vO]}),wO),kO=((_O=function e(){_classCallCheck(this,e)}).\u0275mod=_t({type:_O,bootstrap:[JN]}),_O.\u0275inj=ve({factory:function(e){return new(e||_O)},providers:[],imports:[[tl,Vd,tN,XN,BN,xO.register("ngsw-worker.js",{enabled:!0})]]}),_O);(function(){if(cr)throw new Error("Cannot enable prod mode after platform setup.");ur=!1})(),Jc().bootstrapModule(kO).catch((function(e){return console.error(e)}))},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0]]]);